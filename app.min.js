const STATE={bookmarks:JSON.parse(localStorage.getItem("crown_bookmarks"))||[],read:JSON.parse(localStorage.getItem("crown_read"))||[],streak:parseInt(localStorage.getItem("crown_streak"))||0,lastVisit:localStorage.getItem("crown_last_visit")||null,fontSize:parseFloat(localStorage.getItem("crown_font_size"))||1};function getPreferredLang(){return"function"==typeof getCurrentLang?getCurrentLang():localStorage.getItem("crown_lang")||"ps"}function isPashtoMode(){return"ps"===getPreferredLang()}const els={cards:document.querySelectorAll(".dua-card"),searchInput:document.getElementById("searchInput"),searchClear:document.getElementById("searchClear"),noResults:document.getElementById("noResults"),pills:document.querySelectorAll(".pill"),bookmarkCount:document.getElementById("bookmarkCount"),readCount:document.getElementById("readCount"),streakCount:document.getElementById("streakCount"),lastVisit:document.getElementById("lastVisit"),progressBar:document.getElementById("progressFill"),toast:document.getElementById("toast"),dailyArabic:document.getElementById("dailyArabic"),dailyTranslation:document.getElementById("dailyTranslation"),nav:document.getElementById("topNav")};function init(){const e=document.getElementById("splashScreen");e&&setTimeout(()=>{e.classList.add("hidden"),setTimeout(()=>e.remove(),1e3)},1200),updateStats(),checkStreak(),loadDailyDua(),applyFontSize(STATE.fontSize),applyTheme(),injectShareImageButtons(),injectAudioButtons(),renderTimeBanner(),trackDailyActivity(),renderBookmarksPanel(),wrapArabicWords(),initDailyReminderPrompt(),"function"==typeof applyLanguage&&applyLanguage(),showOnboardingIfFirstTime(),enhanceAccessibility(),setBottomNavActive("home"),els.searchInput&&els.searchInput.addEventListener("input",e=>filterDuas(e.target.value)),window.addEventListener("scroll",()=>{const e=document.body.scrollTop||document.documentElement.scrollTop,t=e/(document.documentElement.scrollHeight-document.documentElement.clientHeight)*100;els.progressBar&&(els.progressBar.style.width=t+"%");const n=document.querySelector(".back-to-top");n&&n.classList.toggle("visible",e>500),els.nav&&(e>50?els.nav.classList.add("scrolled"):els.nav.classList.remove("scrolled")),updateInAppFabVisibility()}),STATE.bookmarks.forEach(e=>{const t=document.querySelector(`.dua-card[data-id="${e}"] .bookmark-btn`);t&&(t.classList.add("bookmarked"),t.innerHTML="â˜…")}),STATE.read.forEach(e=>{const t=document.querySelector(`.dua-card[data-id="${e}"]`);if(t){t.classList.add("read-card");const e=t.querySelector('.action-btn[onclick*="markRead"]');e&&(e.classList.add("read"),e.innerHTML="âœ“ Read")}});if(JSON.parse(localStorage.getItem("crown_collapsed_sections")||"[]").forEach(e=>{const t=document.querySelector(`.section-header[data-section="${e}"]`);if(t){t.classList.add("collapsed");const e=t.querySelector(".section-collapse-hint");e&&(e.textContent="tap to expand");let n=t.nextElementSibling;for(;n&&!n.classList.contains("section-header");)n.classList.contains("dua-card")&&(n.style.display="none"),n=n.nextElementSibling}}),"IntersectionObserver"in window){const e=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(t.target.classList.add("visible"),e.unobserve(t.target))})},{root:null,rootMargin:"0px",threshold:.05});els.cards.forEach(t=>{e.observe(t)})}document.addEventListener("keydown",e=>{if("Escape"===e.key){if(document.querySelector(".progress-panel.active"))return void closeProgress();if(document.querySelector(".tasbeeh-panel.active"))return void closeTasbeeh();if(document.querySelector(".etiquette-panel.active"))return void closeEtiquette();if(document.querySelector(".routine-panel.active"))return void closeRoutine();if(document.querySelector(".prayer-panel.active"))return void closePrayer();if(document.querySelector(".quran-panel.active"))return void closeQuran();const e=document.getElementById("memorizePanel");if(e&&e.classList.contains("active"))return void closeMemorizeSession();const t=document.getElementById("bookmarksPanel");if(t&&t.classList.contains("active"))return void toggleBookmarksPanel();if(els.searchInput&&els.searchInput.value)return clearSearch(),void els.searchInput.blur()}}),document.addEventListener("keydown",function(e){const t=e.target;t.classList.contains("card-header")&&("Enter"!==e.key&&" "!==e.key||(e.preventDefault(),toggleCard(t))),t.classList.contains("section-header")&&("Enter"!==e.key&&" "!==e.key||(e.preventDefault(),toggleSection(t)))}),document.querySelectorAll(".section-header").forEach(e=>{e.setAttribute("role","button"),e.setAttribute("tabindex","0"),e.setAttribute("aria-expanded",String(!e.classList.contains("collapsed")))}),setTimeout(()=>{const e=window.location.hash;"#daily"===e?scrollToDailyDua():"#tasbeeh"===e?openTasbeeh():"#routine"===e?openRoutine():"#prayer"===e?openPrayer():"#quran"===e&&openQuran(),window.location.hash=""},1500),initInAppNavigationUX(),updateInAppFabVisibility()}function enhanceAccessibility(){document.querySelectorAll(".cat-card").forEach(e=>{if(e.hasAttribute("role")||e.setAttribute("role","button"),e.hasAttribute("tabindex")||e.setAttribute("tabindex","0"),!e.hasAttribute("aria-label")){const t=e.querySelector(".cat-card-name")?.textContent?.trim()||"Category",n=e.querySelector(".cat-card-count")?.textContent?.trim()||"";e.setAttribute("aria-label",n?`Open category: ${t}, ${n}`:`Open category: ${t}`)}e.dataset.a11yBound||(e.addEventListener("keydown",t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),e.click())}),e.dataset.a11yBound="1")}),document.querySelectorAll(".lang-toggle").forEach(e=>{e.hasAttribute("tabindex")||e.setAttribute("tabindex","0"),e.dataset.a11yBound||(e.addEventListener("keydown",t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),e.click())}),e.dataset.a11yBound="1")}),document.querySelectorAll(".fallah-logo").forEach(e=>{if(e.hasAttribute("role")||e.setAttribute("role","button"),e.hasAttribute("tabindex")||e.setAttribute("tabindex","0"),!e.hasAttribute("aria-label")){const t="Scroll to top";e.setAttribute("aria-label",t)}e.dataset.a11yBound||(e.addEventListener("keydown",t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),e.click())}),e.dataset.a11yBound="1")}),document.querySelectorAll(".card-header").forEach((e,t)=>{const n=e.closest(".dua-card"),a=n?.querySelector(".dua-title")?.textContent?.trim()||`Dua ${t+1}`,r=n?.querySelector(".card-body");r&&!r.id&&(r.id=`dua-body-${n?.getAttribute("data-id")||t+1}`),r&&e.setAttribute("aria-controls",r.id),e.hasAttribute("aria-label")||e.setAttribute("aria-label",`Toggle dua: ${a}`)}),document.querySelectorAll(".bookmark-btn").forEach(e=>{const t=e.closest(".dua-card")?.querySelector(".dua-title")?.textContent?.trim();e.setAttribute("aria-label",t?`Bookmark dua: ${t}`:"Bookmark dua")}),document.querySelectorAll("button").forEach(e=>{if(e.getAttribute("aria-label"))return;const t=(e.textContent||"").trim();if(!/[A-Za-z0-9\u0600-\u06FF]/.test(t)){const t=e.getAttribute("title")||"Button";e.setAttribute("aria-label",t)}}),document.querySelectorAll(".tasbeeh-panel, .etiquette-panel, .routine-panel, .prayer-panel, .quran-panel, .progress-panel, .side-panel").forEach(e=>{e.setAttribute("role","dialog"),e.setAttribute("aria-modal","true")})}function runTabFadeTransition(e){e&&(e.classList.add("tab-fade-target"),e.classList.add("is-fading"),setTimeout(()=>e.classList.remove("is-fading"),300))}function initDailyReminderPrompt(){const e=document.getElementById("dailyReminderPrompt");if(!e)return;const t="true"===localStorage.getItem("crown_daily_dua_prompt_dismissed"),n="true"===localStorage.getItem("crown_notifications");t||n?e.classList.remove("visible"):e.classList.add("visible")}function showOnboardingIfFirstTime(){if("true"===localStorage.getItem("crown_onboarding_done"))return;const e=isPashtoMode(),t=e?[{title:"ÚšÙ‡ Ø±Ø§ØºÙ„Ø§Ø³Øª",body:"Ø§Ø³Ø§Ø³ÙŠ Ø¯Ø¹Ø§Ú«Ø§Ù†Ùˆ ØªÙ‡ ÚšÙ‡ Ø±Ø§ØºÙ„Ø§Ø³Øª â€” Ø¯ Ù‚Ø±Ø¢Ù† Ø§Ùˆ Ø³Ù†ØªÙˆ Ú…Ø®Ù‡ ØªØ§ÛŒÛŒØ¯ Ø´ÙˆÛ ØºÙˆØ±Ù‡ Ø¯Ø¹Ø§Ú«Ø§Ù†Û."},{title:"Ù…Ù‡Ù…Û ÚØ§Ù†Ú«Ú“Ù†Û",body:"Ø¯ Ú©Ù¼Ú«ÙˆØ±Û Ù„Ù‡ Ù…Ø®Û ÙˆÙ„Ù¼ÙˆØ¦ØŒ Ø®ÙˆÚšÛ Ø®ÙˆÙ†Ø¯ÙŠ Ú©Ú“Ø¦ØŒ Ù¾Ø±Ù…Ø®ØªÚ« ØªØ¹Ù‚ÛŒØ¨ Ú©Ú“Ø¦ØŒ ØªØ³Ø¨ÛŒØ­ ÙˆÚ©Ø§Ø±ÙˆØ¦ØŒ Ø§Ùˆ Ø¯ Ù‚Ø¨Ù„Û Ø³Ø±Ù‡ Ø¯ Ù„Ù…Ø§Ù†ÚÙ‡ ÙˆØ®ØªÙˆÙ†Ù‡ ÙˆÚ«ÙˆØ±Ø¦."},{title:"Ø¯ Ú©Ø§Ø±ÙˆÙ„Ùˆ Ø·Ø±ÛŒÙ‚Ù‡",body:'Ú©Ù¼Ú«ÙˆØ±ÙŠ Ù¼Ú© Ú©Ú“Ø¦ØŒ Ú©Ø§Ø±Øª Ø®Ù„Ø§Øµ Ú©Ú“Ø¦ØŒ Ø§Ùˆ Ø¯ Ù„Ú“Û Ø¬ÙˆÚ“ÙˆÙ„Ùˆ Ù„Ù¾Ø§Ø±Ù‡ "Ù„ÙˆØ³ØªÙ„ Ø´ÙˆÛŒ" ÙˆÚ©Ø§Ø±ÙˆØ¦.'},{title:"Ù¾ÛŒÙ„ ÙˆÚ©Ú“Ø¦",body:"Ù†Ù† ÛŒÙˆØ§Ø²Û Ù„Ù‡ ÛŒÙˆÛ Ø¯Ø¹Ø§ Ù¾ÛŒÙ„ ÙˆÚ©Ú“Ø¦. Ù„Ú– Ø¯ÙˆØ§Ù… Ù„ÙˆÛŒ Ø¨Ø±Ú©Øª Ø±Ø§ÙˆÙ„ÙŠ."}]:[{title:"Welcome",body:"Welcome to Essential Duas â€” your curated collection of verified duas from Quran and Sunnah."},{title:"Key Features",body:"Browse by category, save favorites, track progress, use Tasbeeh, and view prayer times with Qibla."},{title:"How to Use",body:"Tap a category to explore, expand a card to read details, and use Mark Read to build your streak."},{title:"Get Started",body:"Begin with one dua today. Small consistency brings lasting barakah over time."}];let n=0;const a=document.createElement("div");a.className="onboarding-overlay",a.id="onboardingOverlay";let r="next",o=0,i=0;function s(){n>=t.length-1?d():(r="next",n++,c())}function l(){const e=a.querySelector(".onboarding-card");e&&(e.addEventListener("touchstart",function(e){e.touches&&e.touches[0]&&(o=e.touches[0].clientX,i=e.touches[0].clientY)},{passive:!0}),e.addEventListener("touchend",function(e){if(!e.changedTouches||!e.changedTouches[0])return;const t=e.changedTouches[0].clientX,a=e.changedTouches[0].clientY,l=t-o,d=a-i,u=Math.abs(l),m=Math.abs(d);u<40||u<=1.2*m||(l<0?s():n<=0||(r="prev",n--,c()))},{passive:!0}))}function d(){localStorage.setItem("crown_onboarding_done","true"),a.classList.remove("active"),setTimeout(()=>a.remove(),300),unlockScroll()}function c(){const o=t[n],i=t.map((e,t)=>`<span class="onboarding-dot ${t===n?"active":""}"></span>`).join(""),c=n===t.length-1,u="prev"===r?"slide-in-prev":"slide-in-next";a.innerHTML=`\n                <div class="onboarding-card ${u}" role="dialog" aria-modal="true" aria-label="App onboarding">\n                    <div class="onboarding-step">${e?"Ú«Ø§Ù…":"Step"} ${n+1} ${e?"Ù„Ù‡":"of"} ${t.length}</div>\n                    <div class="onboarding-title">${o.title}</div>\n                    <div class="onboarding-body">${o.body}</div>\n                    <div class="onboarding-dots">${i}</div>\n                    <div class="onboarding-actions">\n                        <button class="onboarding-btn" id="onboardingSkip">${e?"ØªÛØ±ÙˆÙ„":"Skip"}</button>\n                        <button class="onboarding-btn ${c?"primary":""}" id="onboardingNext">${c?e?"Ù¾ÛŒÙ„":"Get Started":e?"Ø¨Ù„":"Next"}</button>\n                    </div>\n                </div>`;const m=a.querySelector("#onboardingSkip"),p=a.querySelector("#onboardingNext");m&&(m.onclick=d),p&&(p.onclick=function(){c?d():s()}),l()}c(),document.body.appendChild(a),lockScroll(),requestAnimationFrame(()=>a.classList.add("active"))}function applyFontSize(e){document.documentElement.style.setProperty("--font-scale",e)}window.dismissDailyDuaPrompt=function(){localStorage.setItem("crown_daily_dua_prompt_dismissed","true");const e=document.getElementById("dailyReminderPrompt");e&&e.classList.remove("visible")},window.enableDailyDuaReminders=function(){window.togglePrayerNotifications(!0),dismissDailyDuaPrompt()},window.toggleCard=function(e){const t=e.closest(".dua-card"),n=t.classList.toggle("expanded");e.setAttribute("aria-expanded",n),n&&wrapArabicWords();const a=document.getElementById("categoryGrid");!!a&&a.classList.contains("hidden-grid")&&(n?recordInAppRoute(!0,{[IN_APP_HISTORY_FLAG]:!0,view:IN_APP_VIEWS.DUA_DETAIL,category:localStorage.getItem("crown_active_category")||"all",duaId:Number(t.getAttribute("data-id"))||null,ts:Date.now()}):recordInAppRoute(!1,{[IN_APP_HISTORY_FLAG]:!0,view:IN_APP_VIEWS.CATEGORY_VIEW,category:localStorage.getItem("crown_active_category")||"all",ts:Date.now()}))},window.toggleAllCards=function(e){els.cards.forEach(t=>{e?t.classList.add("expanded"):t.classList.remove("expanded");const n=t.querySelector(".card-header");n&&n.setAttribute("aria-expanded",e)}),showToast(e?"All Expanded":"All Collapsed")},window.adjustFontSize=function(e){let t=Math.max(.8,Math.min(1.6,STATE.fontSize+e));STATE.fontSize=t,localStorage.setItem("crown_font_size",t),applyFontSize(t)};let scrollPosition=0;function lockScroll(){scrollPosition=window.pageYOffset,document.body.classList.add("panel-open"),document.body.style.top=`-${scrollPosition}px`}function unlockScroll(){document.body.classList.remove("panel-open"),document.body.style.top="",window.scrollTo(0,scrollPosition)}function setBottomNavActive(e){document.querySelectorAll(".bottom-nav-item").forEach(e=>{e.classList.remove("active"),e.removeAttribute("aria-current")});const t=document.querySelector(`.bottom-nav-item[data-nav="${e}"]`);t&&(t.classList.add("active"),t.setAttribute("aria-current","page"))}let inAppCurrentRoute="home";const IN_APP_HISTORY_FLAG="__essential_duas_in_app";let inAppHistorySuppressed=!1,inAppTopVisible=!1;const IN_APP_VIEWS={HOME:"home",CATEGORY_VIEW:"category_view",DUA_DETAIL:"dua_detail",QURAN_TAB:"quran_tab",SURAH_READER:"surah_reader",PANEL:"panel"};function isCategorySubViewActive(){const e=document.getElementById("categoryGrid");return!!e&&e.classList.contains("hidden-grid")}function getActivePanelElement(){return document.querySelector(".quran-panel.active")||document.querySelector(".prayer-panel.active")||document.querySelector(".routine-panel.active")||document.querySelector(".tasbeeh-panel.active")||document.querySelector(".etiquette-panel.active")||document.querySelector(".progress-panel.active")||document.querySelector("#bookmarksPanel.active")}function getExpandedDuaCard(){return document.querySelector("#duaListSection .dua-card.expanded:not(.hidden-card)")}function getInAppStateFromDom(){const e=document.querySelector(".quran-panel.active"),t=document.getElementById("quranReaderScreen");if(e&&t?.classList.contains("active"))return{[IN_APP_HISTORY_FLAG]:!0,view:IN_APP_VIEWS.SURAH_READER,surah:Number(quranState.currentSurah)||null,ayah:Number((quranState.audioAyah||"").split(":")[1])||null,ts:Date.now()};if(e)return{[IN_APP_HISTORY_FLAG]:!0,view:IN_APP_VIEWS.QURAN_TAB,quranView:quranState.view||"surah",ts:Date.now()};const n=[[".prayer-panel.active","prayer"],[".routine-panel.active","routine"],[".tasbeeh-panel.active","tasbeeh"],[".etiquette-panel.active","etiquette"],[".progress-panel.active","progress"],["#bookmarksPanel.active","bookmarks"]];for(const[e,t]of n)if(document.querySelector(e))return{[IN_APP_HISTORY_FLAG]:!0,view:IN_APP_VIEWS.PANEL,panel:t,ts:Date.now()};if(isCategorySubViewActive()){const e=getExpandedDuaCard();return e?{[IN_APP_HISTORY_FLAG]:!0,view:IN_APP_VIEWS.DUA_DETAIL,category:localStorage.getItem("crown_active_category")||"all",duaId:Number(e.getAttribute("data-id"))||null,ts:Date.now()}:{[IN_APP_HISTORY_FLAG]:!0,view:IN_APP_VIEWS.CATEGORY_VIEW,category:localStorage.getItem("crown_active_category")||"all",ts:Date.now()}}return{[IN_APP_HISTORY_FLAG]:!0,view:IN_APP_VIEWS.HOME,ts:Date.now()}}function getInAppRoute(){return getInAppStateFromDom().view||IN_APP_VIEWS.HOME}function sameInAppState(e,t){return!(!e||!t)&&(e.view===t.view&&e.panel===t.panel&&e.category===t.category&&e.duaId===t.duaId&&e.surah===t.surah&&e.quranView===t.quranView)}function getActiveScrollableElement(){return document.querySelector(".quran-panel.active")?document.querySelector(".quran-panel"):document.querySelector(".prayer-panel.active")?document.querySelector(".prayer-panel"):document.querySelector(".routine-panel.active")?document.querySelector(".routine-panel"):document.querySelector(".tasbeeh-panel.active")?document.querySelector(".tasbeeh-panel"):document.querySelector(".etiquette-panel.active")?document.querySelector(".etiquette-panel"):document.querySelector(".progress-panel.active")?document.querySelector(".progress-panel"):document.scrollingElement||document.documentElement||document.body||window}function updateInAppFabVisibility(){const e=document.getElementById("inAppBackBtn"),t=document.getElementById("inAppTopBtn"),n=getInAppRoute();e&&e.classList.toggle("visible",n!==IN_APP_VIEWS.HOME);const a=getActiveScrollableElement(),r=a===window?window.scrollY||document.documentElement.scrollTop||document.body.scrollTop||0:Math.max(a.scrollTop||0,window.scrollY||0,document.documentElement.scrollTop||0,document.body.scrollTop||0);r>300?inAppTopVisible=!0:r<100&&(inAppTopVisible=!1),t&&t.classList.toggle("visible",inAppTopVisible)}function recordInAppRoute(e=!1,t=null){if(inAppHistorySuppressed)return void updateInAppFabVisibility();const n=t||getInAppStateFromDom(),a=history.state;if(!a||!a[IN_APP_HISTORY_FLAG])return history.replaceState(n,""),inAppCurrentRoute=n.view||IN_APP_VIEWS.HOME,void updateInAppFabVisibility();e&&!sameInAppState(n,a)?history.pushState(n,""):history.replaceState(n,""),inAppCurrentRoute=n.view||IN_APP_VIEWS.HOME,updateInAppFabVisibility()}function scrollActiveViewToTop(){const e=getActiveScrollableElement();e===window?window.scrollTo({top:0,behavior:"smooth"}):e.scrollTo({top:0,behavior:"smooth"})}function closeAllPanelsForStateApply(){document.querySelector(".quran-panel.active")&&closeQuran(),document.querySelector(".prayer-panel.active")&&closePrayer(),document.querySelector(".routine-panel.active")&&closeRoutine(),document.querySelector(".tasbeeh-panel.active")&&closeTasbeeh(),document.querySelector(".etiquette-panel.active")&&closeEtiquette(),document.querySelector(".progress-panel.active")&&closeProgress();const e=document.getElementById("bookmarksPanel");e?.classList.contains("active")&&toggleBookmarksPanel()}function collapseExpandedDuaCards(){document.querySelectorAll("#duaListSection .dua-card.expanded").forEach(e=>{e.classList.remove("expanded");const t=e.querySelector(".card-header");t&&t.setAttribute("aria-expanded","false")})}async function applyInAppState(e){if(e&&e[IN_APP_HISTORY_FLAG]){inAppHistorySuppressed=!0;try{const t=e.view||IN_APP_VIEWS.HOME;if(closeAllPanelsForStateApply(),t===IN_APP_VIEWS.HOME)isCategorySubViewActive()&&backToCategories(),collapseExpandedDuaCards();else if(t===IN_APP_VIEWS.CATEGORY_VIEW)openCategory(e.category||"all",{skipScroll:!0}),collapseExpandedDuaCards();else if(t===IN_APP_VIEWS.DUA_DETAIL){const t=e.category||"all";openCategory(t,{skipScroll:!0}),collapseExpandedDuaCards();const n=document.querySelector(`#duaListSection .dua-card[data-id="${e.duaId}"]`),a=n?.querySelector(".card-header");n&&a&&!n.classList.contains("expanded")&&toggleCard(a)}else if(t===IN_APP_VIEWS.QURAN_TAB)await openQuran(),setQuranView("surah");else if(t===IN_APP_VIEWS.SURAH_READER)await openQuran(),await openQuranSurah(Number(e.surah)||1,Number(e.ayah)||1);else if(t===IN_APP_VIEWS.PANEL){const t=e.panel;"prayer"===t?openPrayer():"routine"===t?openRoutine():"tasbeeh"===t?openTasbeeh():"etiquette"===t?openEtiquette():"progress"===t?openProgress():"bookmarks"===t&&toggleBookmarksPanel()}}finally{inAppHistorySuppressed=!1,updateInAppFabVisibility()}}}function triggerInAppBack(){getInAppRoute()!==IN_APP_VIEWS.HOME&&history.back()}function initInAppNavigationUX(){const e=document.getElementById("inAppBackBtn"),t=document.getElementById("inAppTopBtn");e&&"1"!==e.dataset.bound&&(e.addEventListener("touchstart",e=>{e.preventDefault(),triggerInAppBack()},{passive:!1}),e.addEventListener("click",triggerInAppBack),e.dataset.bound="1"),t&&"1"!==t.dataset.bound&&(t.addEventListener("touchstart",e=>{e.preventDefault(),scrollActiveViewToTop()},{passive:!1}),t.addEventListener("click",scrollActiveViewToTop),t.dataset.bound="1"),window.addEventListener("popstate",e=>{const t=e.state;if(t&&t[IN_APP_HISTORY_FLAG])applyInAppState(t);else{if(getInAppRoute()!==IN_APP_VIEWS.HOME){inAppHistorySuppressed=!0;try{closeAllPanelsForStateApply(),isCategorySubViewActive()&&backToCategories(),collapseExpandedDuaCards()}finally{inAppHistorySuppressed=!1}}updateInAppFabVisibility()}});let n=0,a=0,r=!1;const o=document.getElementById("inAppSwipeIndicator");document.addEventListener("touchstart",e=>{const t=e.touches?.[0];t&&(r=t.clientX<=30,r&&(n=t.clientX,a=t.clientY))},{passive:!0}),document.addEventListener("touchmove",e=>{if(!r)return;const t=e.touches?.[0];if(!t)return;const i=t.clientX-n;if(Math.abs(t.clientY-a)>60)return r=!1,void(o&&o.classList.remove("visible"));o&&o.classList.toggle("visible",i>12&&"home"!==getInAppRoute())},{passive:!0}),document.addEventListener("touchend",e=>{if(!r)return;const t=e.changedTouches?.[0];if(r=!1,o&&o.classList.remove("visible"),!t)return;t.clientX-n>=80&&getInAppRoute()!==IN_APP_VIEWS.HOME&&triggerInAppBack()},{passive:!0}),window.addEventListener("scroll",updateInAppFabVisibility,{passive:!0}),document.addEventListener("scroll",updateInAppFabVisibility,{passive:!0});const i=document.getElementById("mainContainer");i&&i.addEventListener("scroll",updateInAppFabVisibility,{passive:!0}),document.querySelectorAll(".quran-panel, .prayer-panel, .routine-panel, .tasbeeh-panel, .etiquette-panel").forEach(e=>{e.addEventListener("scroll",updateInAppFabVisibility,{passive:!0})});const s=getInAppStateFromDom();history.state&&history.state[IN_APP_HISTORY_FLAG]?recordInAppRoute(!1,s):history.replaceState(s,""),updateInAppFabVisibility()}function filterDuas(e){e=(e||"").toLowerCase();let t=0;els.searchClear&&els.searchClear.classList.toggle("visible",e.length>0),els.cards.forEach(n=>{const a=n.textContent.toLowerCase().includes(e)||(n.getAttribute("data-keywords")||"").includes(e);n.classList.toggle("hidden-card",!a),a&&t++}),els.noResults&&els.noResults.classList.toggle("visible",0===t),document.querySelectorAll(".section-header").forEach(t=>{if(e){let e=!1,n=t.nextElementSibling;for(;n&&!n.classList.contains("section-header");){if(n.classList.contains("dua-card")&&!n.classList.contains("hidden-card")){e=!0;break}n=n.nextElementSibling}t.style.display=e?"":"none"}else t.style.display=""})}window.toggleBookmark=function(e){const t=STATE.bookmarks.indexOf(e),n=document.querySelector(`.dua-card[data-id="${e}"] .bookmark-btn`);-1===t?(STATE.bookmarks.push(e),n&&(n.classList.add("bookmarked"),n.innerHTML="â˜…"),showToast("Added to Bookmarks")):(STATE.bookmarks.splice(t,1),n&&(n.classList.remove("bookmarked"),n.innerHTML="â˜†"),showToast("Removed from Bookmarks")),localStorage.setItem("crown_bookmarks",JSON.stringify(STATE.bookmarks)),updateStats(),renderBookmarksPanel()},window.markRead=function(e,t){if(STATE.read.includes(t))showToast("Already marked as read");else{STATE.read.push(t),localStorage.setItem("crown_read",JSON.stringify(STATE.read));const n=document.querySelector(`.dua-card[data-id="${t}"]`);n&&n.classList.add("read-card"),e&&(e.classList.add("read"),e.innerHTML="âœ“ Read"),updateStats(),showToast(`Marked as Read (${STATE.read.length}/63)`)}},window.copyText=function(e,t){navigator.clipboard.writeText(t).then(()=>{if(e){const t=e.innerHTML;e.innerHTML="âœ“ Copied!",e.classList.add("copied"),setTimeout(()=>{e.innerHTML=t,e.classList.remove("copied")},2e3)}showToast("Copied to clipboard")}).catch(()=>showToast("Failed to copy"))},window.clearSearch=function(){els.searchInput&&(els.searchInput.value=""),filterDuas(""),els.searchClear&&els.searchClear.classList.remove("visible")},window.filterCategory=function(e,t){runTabFadeTransition(document.getElementById("duaListSection")),els.pills&&els.pills.forEach(e=>e.classList.remove("active")),t&&t.classList.contains("pill")&&t.classList.add("active");let n=0;els.cards.forEach(t=>{const a=t.getAttribute("data-categories").split(","),r="all"===e||a.includes(e);t.classList.toggle("hidden-card",!r),t.style.display="",r&&n++}),document.querySelectorAll(".section-header.collapsed").forEach(e=>{e.classList.remove("collapsed");const t=e.querySelector(".section-collapse-hint");if(t){const e="function"==typeof getCurrentLang&&"ps"===getCurrentLang();t.textContent=e&&"undefined"!=typeof PS_UI?PS_UI.tapCollapse:"tap to collapse"}let n=e.nextElementSibling;for(;n&&!n.classList.contains("section-header");)n.classList.contains("dua-card")&&(n.style.display=""),n=n.nextElementSibling}),document.querySelectorAll(".section-header").forEach(t=>{if("all"!==e)t.style.display="none";else{let e=!1,n=t.nextElementSibling;for(;n&&!n.classList.contains("section-header");){if(n.classList.contains("dua-card")&&!n.classList.contains("hidden-card")){e=!0;break}n=n.nextElementSibling}t.style.display=e?"":"none"}}),els.noResults&&els.noResults.classList.toggle("visible",0===n),window.scrollTo({top:0,behavior:"smooth"})};const CATEGORY_META={all:{icon:"ğŸ“¿",title:"All Duas",subtitle:"The complete collection of 63 essential supplications"},quran:{icon:"ğŸ“–",title:"The Quranic Foundation",subtitle:"The speech of Allah â€” the highest authority"},protection:{icon:"ğŸ›¡ï¸",title:"Protection & Refuge",subtitle:"Shield yourself with the words of Allah and His Messenger ï·º"},forgiveness:{icon:"ğŸ¤²",title:"Forgiveness",subtitle:"Turn back to Allah with these powerful supplications"},guidance:{icon:"ğŸŒŸ",title:"Guidance & Faith",subtitle:"Ask Allah for direction and steadfastness"},wellbeing:{icon:"ğŸ’š",title:"Wellbeing & Relief",subtitle:"Healing, ease, and comfort from the Sunnah"},prophets:{icon:"ğŸ•Œ",title:"Prophets' Duas",subtitle:"Supplications of the Prophets Ø¹Ù„ÙŠÙ‡Ù… Ø§Ù„Ø³Ù„Ø§Ù…"},"morning-evening":{icon:"ğŸŒ…",title:"Morning & Evening",subtitle:"Daily adhkar for protection and blessings"},provision:{icon:"ğŸŒ¾",title:"Provision",subtitle:"Ask Allah for sustenance and barakah"},prayer:{icon:"ğŸ•‹",title:"Prayer",subtitle:"The greatest names and supplications in salah"},family:{icon:"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§",title:"Family",subtitle:"Duas for parents, spouse, and children"},travel:{icon:"âœˆï¸",title:"Travel & Knowledge",subtitle:"Supplications for journeys and seeking knowledge"},scholars:{icon:"ğŸ“š",title:"Treasures of the Scholars",subtitle:"Gems with honest transparent authentication"},ramadan:{icon:"ğŸŒ™",title:"Ramadan & Fasting",subtitle:"Supplications for the blessed month and the discipline of fasting"},"evil-eye":{icon:"ğŸ§¿",title:"Evil Eye & Envy",subtitle:"Prophetic shields against hasad and al-'ayn"}};function renderBookmarksPanel(){const e=document.getElementById("bookmarkListContainer");if(!e)return;if(0===STATE.bookmarks.length)return void(e.innerHTML='<div class="panel-empty">No bookmarks yet.<br>Tap the star icon to save duas here.</div>');let t="";STATE.bookmarks.forEach(e=>{const n=document.querySelector(`.dua-card[data-id="${e}"]`);if(n){const a=n.querySelector(".dua-title").textContent,r=n.querySelector(".arabic-text").textContent;t+=`<div class="panel-item" onclick="scrollToDua(${e}); toggleBookmarksPanel()">\n                    <div class="panel-item-title">${a}</div>\n                    <div class="panel-item-arabic">${r}</div>\n                </div>`}}),e.innerHTML=t}window.openCategory=function(e,t){t=t||{};const n=document.getElementById("categoryGrid"),a=document.getElementById("duaListSection"),r=document.getElementById("categoryDetailHeader"),o=CATEGORY_META[e]||{icon:"ğŸ“¿",title:e,subtitle:""};n.classList.add("hidden-grid"),a.classList.remove("hidden-list");const i=document.querySelector(".hero");i&&(i.style.display="none"),document.getElementById("cdhIcon").textContent=o.icon;const s="function"==typeof getCurrentLang&&"ps"===getCurrentLang(),l="undefined"!=typeof PS_UI?PS_UI:null;document.getElementById("cdhTitle").textContent=s&&l&&l.catCardTitles[e]?l.catCardTitles[e]:o.title,document.getElementById("cdhSubtitle").textContent=s&&l&&l.catCardSubtitles[e]?l.catCardSubtitles[e]:o.subtitle,r.classList.add("visible");const d=document.getElementById("categoryPills");d&&(d.style.display="none");const c=document.querySelector(`.pill[data-category="${e}"]`);filterCategory(e,c),document.querySelectorAll("#duaListSection .dua-card.expanded").forEach(e=>{e.classList.remove("expanded");const t=e.querySelector(".card-header");t&&t.setAttribute("aria-expanded","false")}),t.skipScroll||a.scrollIntoView({behavior:"smooth",block:"start"}),localStorage.setItem("crown_active_category",e),recordInAppRoute(!0,{[IN_APP_HISTORY_FLAG]:!0,view:IN_APP_VIEWS.CATEGORY_VIEW,category:e,ts:Date.now()})},window.backToCategories=function(){const e=document.getElementById("categoryGrid"),t=document.getElementById("duaListSection"),n=document.getElementById("categoryDetailHeader");e.classList.remove("hidden-grid"),t.classList.add("hidden-list"),n.classList.remove("visible");const a=document.querySelector(".hero");a&&(a.style.display="");const r=document.getElementById("categoryPills");r&&(r.style.display=""),els.cards.forEach(e=>{e.classList.remove("hidden-card"),e.style.display=""}),document.querySelectorAll(".section-header").forEach(e=>{e.style.display=""}),els.pills&&els.pills.forEach(e=>e.classList.remove("active"));const o=document.querySelector('.pill[data-category="all"]');o&&o.classList.add("active"),els.searchInput&&(els.searchInput.value=""),els.searchClear&&els.searchClear.classList.remove("visible"),localStorage.removeItem("crown_active_category"),recordInAppRoute(!1,{[IN_APP_HISTORY_FLAG]:!0,view:IN_APP_VIEWS.HOME,ts:Date.now()})},function(){const e=document.getElementById("searchInput");e&&e.addEventListener("focus",function(){const e=document.getElementById("categoryGrid");if(e&&!e.classList.contains("hidden-grid")){openCategory("all",{skipScroll:!0});const e=document.querySelector(".search-container");e&&e.scrollIntoView({behavior:"smooth",block:"start"})}})}(),function(){const e=localStorage.getItem("crown_active_category");e&&openCategory(e)}(),window.toggleBookmarksPanel=function(){if(!document.getElementById("bookmarksPanel")){const e=document.createElement("div");if(e.id="bookmarksPanel",e.className="side-panel",e.innerHTML='\n                <div class="panel-header">\n                    <div class="panel-title">Your Saved Duas</div>\n                    <button class="panel-close" onclick="toggleBookmarksPanel()">âœ•</button>\n                </div>\n                <div id="bookmarkListContainer"></div>',document.body.appendChild(e),!document.querySelector(".overlay")){const e=document.createElement("div");e.className="overlay",e.onclick=toggleBookmarksPanel,document.body.appendChild(e)}}enhanceAccessibility(),renderBookmarksPanel();const e=document.getElementById("bookmarksPanel"),t=document.querySelector(".overlay"),n=!e.classList.contains("active");e.classList.toggle("active"),t.classList.toggle("active"),n?(lockScroll(),setBottomNavActive("saved"),recordInAppRoute(!0)):(unlockScroll(),setBottomNavActive("home"),recordInAppRoute(!1))},window.scrollToDua=function(e){const t=document.getElementById("categoryGrid");t&&!t.classList.contains("hidden-grid")&&openCategory("all");const n=document.querySelector(`.dua-card[data-id="${e}"]`);if(n){n.classList.remove("hidden-card"),n.style.display="",n.classList.add("expanded");const e=n.querySelector(".card-header");e&&e.setAttribute("aria-expanded","true"),setTimeout(()=>{n.scrollIntoView({behavior:"smooth",block:"center"})},100),n.style.borderColor="var(--emerald-light)",n.style.boxShadow="0 0 20px rgba(46, 196, 122, 0.15)",setTimeout(()=>{n.style.borderColor="",n.style.boxShadow=""},2500)}};const DHIKR_LIST=[{id:"subhanallah",ar:"Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ù±Ù„Ù„ÙÙ‘Ù‡Ù",en:"Subhanallah",virtue:"33Ã— after every salah",defaultTarget:33},{id:"alhamdulillah",ar:"Ù±Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù",en:"Alhamdulillah",virtue:"33Ã— after every salah",defaultTarget:33},{id:"allahuakbar",ar:"Ù±Ù„Ù„ÙÙ‘Ù‡Ù Ø£ÙÙƒÙ’Ø¨ÙØ±Ù",en:"Allahu Akbar",virtue:"34Ã— after every salah",defaultTarget:34},{id:"lailaha",ar:"Ù„ÙØ§ Ø¥ÙÙ„ÙÙ°Ù‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ù±Ù„Ù„ÙÙ‘Ù‡Ù",en:"La ilaha illallah",virtue:"Best dhikr â€” Tirmidhi 3383",defaultTarget:100},{id:"astaghfirullah",ar:"Ø£ÙØ³Ù’ØªÙØºÙ’ÙÙØ±Ù Ù±Ù„Ù„ÙÙ‘Ù‡Ù",en:"Astaghfirullah",virtue:"100Ã— daily â€” Muslim 2702",defaultTarget:100},{id:"subhanwabi",ar:"Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ù±Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙØ¨ÙØ­ÙÙ…Ù’Ø¯ÙÙ‡Ù",en:"Subhanallahi wa bihamdihi",virtue:"Plants a tree in Jannah â€” Tirmidhi 3464",defaultTarget:100},{id:"lahawla",ar:"Ù„ÙØ§ Ø­ÙÙˆÙ’Ù„Ù ÙˆÙÙ„ÙØ§ Ù‚ÙÙˆÙÙ‘Ø©Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø¨ÙÙ±Ù„Ù„ÙÙ‘Ù‡Ù",en:"La hawla wala quwwata illa billah",virtue:"A treasure of Jannah â€” Bukhari 6384",defaultTarget:33}];let tasbeehCount=0,tasbeehTarget=33,currentDhikrIndex=0,tasbeehSoundEnabled="true"===localStorage.getItem("crown_tasbeeh_sound"),tasbeehAudioCtx=null;function getDhikrTotals(){try{return JSON.parse(localStorage.getItem("crown_dhikr_totals")||"{}")}catch{return{}}}function saveDhikrTotal(e,t){const n=getDhikrTotals();n[e]=(n[e]||0)+t,localStorage.setItem("crown_dhikr_totals",JSON.stringify(n))}function getOverallTotal(){const e=getDhikrTotals();return Object.values(e).reduce((e,t)=>e+t,0)}function renderDhikrSelector(){const e=document.getElementById("dhikrSelector");if(!e)return;e.innerHTML=DHIKR_LIST.map((e,t)=>`\n            <div class="dhikr-option${t===currentDhikrIndex?" active":""}" onclick="selectDhikr(${t})">\n                <div class="dhikr-option-ar">${e.ar}</div>\n                <div class="dhikr-option-en">${e.en}</div>\n            </div>\n        `).join("");const t=e.querySelector(".dhikr-option.active");t&&t.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}function updateTasbeehUI(){const e=DHIKR_LIST[currentDhikrIndex],t=document.getElementById("tasbeehArabic"),n=document.getElementById("tasbeehVirtue"),a=document.getElementById("tasbeehLifetime");t&&(t.textContent=e.ar),n&&(n.textContent=e.virtue),a&&(a.innerHTML=`TOTAL: <span>${getOverallTotal().toLocaleString()}</span>`)}function updateTasbeehSoundToggle(){const e=document.getElementById("tasbeehSoundToggle");e&&(e.textContent=tasbeehSoundEnabled?"ğŸ”Š Click Sound":"ğŸ”‡ Click Sound")}function playTasbeehClick(){if(tasbeehSoundEnabled)try{if(!tasbeehAudioCtx){const e=window.AudioContext||window.webkitAudioContext;if(!e)return;tasbeehAudioCtx=new e}"suspended"===tasbeehAudioCtx.state&&tasbeehAudioCtx.resume();const e=tasbeehAudioCtx.createOscillator(),t=tasbeehAudioCtx.createGain();e.type="triangle",e.frequency.value=760,t.gain.setValueAtTime(1e-4,tasbeehAudioCtx.currentTime),t.gain.exponentialRampToValueAtTime(.03,tasbeehAudioCtx.currentTime+.004),t.gain.exponentialRampToValueAtTime(1e-4,tasbeehAudioCtx.currentTime+.045),e.connect(t),t.connect(tasbeehAudioCtx.destination),e.start(),e.stop(tasbeehAudioCtx.currentTime+.05)}catch(e){}}function triggerTasbeehCelebration(){const e=document.querySelector(".tasbeeh-panel");e&&(e.classList.add("celebrate"),setTimeout(()=>e.classList.remove("celebrate"),780))}function updateStats(){if(els.bookmarkCount){const e=STATE.bookmarks.length;els.bookmarkCount.innerText=e||"â€”";const t=els.bookmarkCount.closest(".stat-item")?.querySelector(".stat-label"),n=isPashtoMode();t&&(t.innerText=e?n?"Ø®ÙˆÙ†Ø¯ÙŠ":"Saved":n?"Ø®ÙˆÙ†Ø¯ÙŠ Ú©Ú“Ø¦":"Tap â™¡")}if(els.readCount){const e=STATE.read.length;els.readCount.innerText=e||"â€”";const t=els.readCount.closest(".stat-item")?.querySelector(".stat-label"),n=isPashtoMode();t&&(t.innerText=e?n?"Ù„ÙˆØ³ØªÙ„ Ø´ÙˆÙŠ":"Read":n?"Ù¾ÛŒÙ„ Ú©Ú“Ø¦":"Start")}const e=document.getElementById("readProgressRing");if(e){const t=63,n=STATE.read.length,a=2*Math.PI*22,r=a-n/t*a;e.style.strokeDashoffset=r}}function showToast(e){els.toast||(els.toast=document.getElementById("toast")),els.toast&&(els.toast.innerText=e,els.toast.classList.add("show"),setTimeout(()=>els.toast.classList.remove("show"),3e3))}function checkStreak(){const e=(new Date).toDateString();if(STATE.lastVisit!==e){const t=new Date;t.setDate(t.getDate()-1),STATE.lastVisit===t.toDateString()?STATE.streak++:STATE.streak=1,STATE.lastVisit=e,localStorage.setItem("crown_streak",STATE.streak),localStorage.setItem("crown_last_visit",e)}els.streakCount&&(els.streakCount.innerText=STATE.streak),els.lastVisit&&(els.lastVisit.innerText="Today")}function loadDailyDua(){const e=Math.floor((new Date-new Date((new Date).getFullYear(),0,0))/1e3/60/60/24)%63+1;setTimeout(()=>{const t=document.querySelector(`.dua-card[data-id="${e}"]`);t&&els.dailyArabic&&(els.dailyArabic.innerText=t.querySelector(".arabic-text").innerText,els.dailyTranslation.innerText=t.querySelector(".translation").innerText.substring(0,80)+"...",document.getElementById("dailyDua").onclick=function(){scrollToDua(e)})},500)}function loadRoutineDailyDua(){const e=Math.floor((new Date-new Date((new Date).getFullYear(),0,0))/1e3/60/60/24)%63+1,t=document.querySelector(`.dua-card[data-id="${e}"]`),n=document.getElementById("routineDailyArabic"),a=document.getElementById("routineDailyTranslation");t&&n&&(n.innerText=t.querySelector(".arabic-text").innerText,a.innerText=t.querySelector(".translation").innerText.substring(0,80)+"...")}function renderProgressPanel(){const e=document.getElementById("progressPanelContent");if(!e)return;const t=STATE.read.length,n=STATE.bookmarks.length,a=Math.round(t/63*100),r=["quran","protection","forgiveness","guidance","wellbeing","prophets","morning-evening","provision","prayer","family","travel","scholars","ramadan","evil-eye"],o={};r.forEach(e=>o[e]=0),STATE.read.forEach(e=>{const t=document.querySelector(`.dua-card[data-id="${e}"]`);t&&(t.getAttribute("data-categories")||"").split(",").forEach(e=>{const t=e.trim();t in o&&o[t]++})});const i=new Set(Object.keys(o).filter(e=>o[e]>0)),s={};r.forEach(e=>s[e]=0),document.querySelectorAll(".dua-card").forEach(e=>{(e.getAttribute("data-categories")||"").split(",").forEach(e=>{const t=e.trim();t in s&&s[t]++})});const l=JSON.parse(localStorage.getItem("crown_activity")||"[]"),d=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];let c="";for(let e=6;e>=0;e--){const t=new Date;t.setDate(t.getDate()-e);const n=t.toISOString().slice(0,10),a=l.includes(n);c+=`<div class="progress-day-cell${a?" active":""}${0===e?" today":""}">\n                <div>${d[t.getDay()]}</div>\n                <div style="font-size:0.8rem;margin-top:2px;">${a?"âœ“":"Â·"}</div>\n            </div>`}const u=l.length;let m="";const p={quran:"#7e57c2",protection:"#2ec47a",forgiveness:"#c9a84c",guidance:"#64b5f6",wellbeing:"#4db6ac",prophets:"#ffb74d","morning-evening":"#aed581",provision:"#ce93d8",prayer:"#81c784",family:"#f48fb1",travel:"#90caf9",scholars:"#b39ddb",ramadan:"#4db6ac","evil-eye":"#9575cd"};r.forEach(e=>{const t=o[e]||0,n=s[e]||1,a=Math.round(t/n*100),r=e.charAt(0).toUpperCase()+e.slice(1).replace("-"," ");m+=`<div class="progress-category-bar">\n                <div class="progress-cat-label">${r}</div>\n                <div class="progress-cat-bar"><div class="progress-cat-fill" style="width:${a}%;background:${p[e]||"#2ec47a"}"></div></div>\n                <div class="progress-cat-count">${t}/${n}</div>\n            </div>`});const h=[{icon:"ğŸŒ±",name:"First Step",earned:t>=1,desc:"Read your first dua"},{icon:"ğŸ“–",name:"Bookworm",earned:n>=5,desc:"Bookmark 5 duas"},{icon:"ğŸ”¥",name:"On Fire",earned:STATE.streak>=3,desc:"3-day streak"},{icon:"â­",name:"Dedicated",earned:STATE.streak>=7,desc:"7-day streak"},{icon:"ğŸŒ",name:"Explorer",earned:i.size>=7,desc:"Explore 7 categories"},{icon:"ğŸ’ª",name:"Halfway",earned:t>=32,desc:"Read 32+ duas"},{icon:"ğŸ†",name:"Crown Master",earned:t>=63,desc:"All 63 duas"},{icon:"ğŸ”®",name:"Scholar",earned:i.size>=14,desc:"All 14 categories"}],g=h.filter(e=>e.earned).length;let y=h.map(e=>`\n            <div class="achievement-badge ${e.earned?"earned":"locked"}" title="${e.desc}">\n                <div class="achievement-icon">${e.icon}</div>\n                ${e.earned?"":'<div class="achievement-lock">ğŸ”’</div>'}\n                <div class="achievement-name">${e.name}</div>\n            </div>`).join(""),f="";f=t>=55?"ğŸ† Completed the entire Crown Collection!":t>=40?"â­ Almost there â€” a true seeker of knowledge!":t>=25?"ğŸ’ª Halfway champion â€” keep going!":t>=10?"ğŸŒ± Growing beautifully â€” 10+ duas learned!":t>=1?"âœ¨ The journey of a thousand miles begins with one step.":'ğŸ“– Start your journey â€” tap "Mark Read" on any dua!',e.innerHTML=`\n            <h2>Your Journey</h2>\n\n            <div class="progress-stat-card">\n                <div class="progress-stat-icon">ğŸ“–</div>\n                <div class="progress-stat-info">\n                    <div class="progress-stat-label">Duas Read</div>\n                    <div class="progress-stat-value">${t} / 63</div>\n                    <div class="progress-bar-visual">\n                        <div class="progress-bar-fill" style="width:${a}%"></div>\n                    </div>\n                    <div class="progress-stat-sub">${a}% complete</div>\n                </div>\n            </div>\n\n            <div class="progress-stat-card">\n                <div class="progress-stat-icon">ğŸ”¥</div>\n                <div class="progress-stat-info">\n                    <div class="progress-stat-label">Current Streak</div>\n                    <div class="progress-stat-value">${STATE.streak} days</div>\n                    <div class="progress-stat-sub">Total days active: ${u}</div>\n                </div>\n            </div>\n\n            <div class="progress-stat-card" style="flex-direction:column;">\n                <div class="progress-stat-label" style="margin-bottom:8px;">This Week</div>\n                <div class="progress-week-grid">${c}</div>\n            </div>\n\n            <div class="progress-stat-card">\n                <div class="progress-stat-icon">â­</div>\n                <div class="progress-stat-info">\n                    <div class="progress-stat-label">Bookmarked</div>\n                    <div class="progress-stat-value">${n}</div>\n                    <div class="progress-stat-sub">Your favourite duas saved for quick access</div>\n                </div>\n            </div>\n\n            <div class="progress-stat-card" style="flex-direction:column;">\n                <div class="progress-stat-label" style="margin-bottom:8px;">Category Breakdown</div>\n                ${m}\n            </div>\n\n            <div class="progress-stat-card" style="flex-direction:column;">\n                <div class="progress-stat-label" style="margin-bottom:8px;">Achievements (${g}/${h.length})</div>\n                <div class="progress-achievements">${y}</div>\n            </div>\n\n            <div class="progress-stat-card" style="text-align:center;justify-content:center;flex-direction:column;">\n                <div style="font-size:1.2rem;margin-bottom:8px;">${f}</div>\n            </div>\n            <button class="progress-reset-btn" onclick="if(confirm('Reset all reading progress? Bookmarks will be kept.')) { STATE.read=[]; localStorage.setItem('crown_read',JSON.stringify([])); document.querySelectorAll('.dua-card').forEach(c=>{c.classList.remove('read-card');const b=c.querySelector('.action-btn[onclick*=markRead]');if(b){b.classList.remove('read');b.innerHTML='âœ“ Mark Read';}}); updateStats(); renderProgressPanel(); showToast('Progress reset'); }">âš  Reset Reading Progress</button>\n\n            <button class="progress-share-btn" onclick="shareProgress()">ğŸ“¤ Share Your Progress</button>\n        `}window.selectDhikr=function(e){tasbeehCount>0&&saveDhikrTotal(DHIKR_LIST[currentDhikrIndex].id,tasbeehCount),currentDhikrIndex=e;const t=DHIKR_LIST[e];tasbeehTarget=t.defaultTarget,tasbeehCount=0;const n=document.getElementById("tasbeehDisplay");n&&(n.textContent="0");const a=document.getElementById("tasbeehTargetLabel");a&&(a.textContent=`TARGET: ${tasbeehTarget}`),document.querySelectorAll(".tasbeeh-preset").forEach(e=>e.classList.remove("active")),updateTasbeehUI(),renderDhikrSelector(),localStorage.setItem("crown_dhikr_selected",e)},window.openTasbeeh=function(){const e=document.querySelector(".tasbeeh-panel");e&&e.classList.add("active"),lockScroll(),setBottomNavActive("tasbeeh");const t=parseInt(localStorage.getItem("crown_dhikr_selected")||"0",10);currentDhikrIndex=t>=0&&t<DHIKR_LIST.length?t:0,tasbeehTarget=DHIKR_LIST[currentDhikrIndex].defaultTarget,resetTasbeeh(),renderDhikrSelector(),updateTasbeehUI();const n=document.getElementById("tasbeehTargetLabel");n&&(n.textContent=`TARGET: ${tasbeehTarget}`),updateTasbeehSoundToggle();const a=document.querySelector(".tasbeeh-close");a&&a.focus(),recordInAppRoute(!0)},window.openTasbeehWith=function(e){openTasbeeh(),tasbeehTarget=36===e?100:33;const t=document.getElementById("tasbeehTargetLabel");t&&(t.textContent=`TARGET: ${tasbeehTarget}`)},window.closeTasbeeh=function(){tasbeehCount>0&&(saveDhikrTotal(DHIKR_LIST[currentDhikrIndex].id,tasbeehCount),tasbeehCount=0);const e=document.querySelector(".tasbeeh-panel");e&&e.classList.remove("active"),unlockScroll(),setBottomNavActive("home"),recordInAppRoute(!1)},window.tapTasbeeh=function(e){tasbeehCount++;const t=document.getElementById("tasbeehDisplay"),n=document.querySelector(".tasbeeh-tap-btn");if(t&&(t.textContent=tasbeehCount,t.classList.remove("bump"),requestAnimationFrame(()=>t.classList.add("bump"))),n&&(n.classList.add("pulse"),setTimeout(()=>n.classList.remove("pulse"),100),e)){const t=n.getBoundingClientRect(),a=document.createElement("span");a.className="tasbeeh-ripple",a.style.left=e.clientX-t.left+"px",a.style.top=e.clientY-t.top+"px",n.appendChild(a),setTimeout(()=>a.remove(),700)}navigator.vibrate&&navigator.vibrate(50),playTasbeehClick(),tasbeehCount===tasbeehTarget&&0!==tasbeehTarget&&(navigator.vibrate&&navigator.vibrate([100,50,100]),saveDhikrTotal(DHIKR_LIST[currentDhikrIndex].id,tasbeehCount),triggerTasbeehCelebration(),tasbeehCount=0,showToast("Target reached! âœ¨ Count saved."),setTimeout(()=>{const e=document.getElementById("tasbeehDisplay");e&&(e.textContent="0"),updateTasbeehUI()},300))},window.resetTasbeeh=function(){tasbeehCount>0&&saveDhikrTotal(DHIKR_LIST[currentDhikrIndex].id,tasbeehCount),tasbeehCount=0;const e=document.getElementById("tasbeehDisplay");e&&(e.textContent="0"),updateTasbeehUI()},window.setTasbeehTarget=function(e){tasbeehTarget=e;const t=document.getElementById("tasbeehTargetLabel");t&&(t.textContent=0===e?"OPEN COUNT":`TARGET: ${e}`),resetTasbeeh(),document.querySelectorAll(".tasbeeh-preset").forEach(e=>e.classList.remove("active"));const n=document.querySelector(`.tasbeeh-preset[onclick="setTasbeehTarget(${e})"]`);n&&n.classList.add("active")},window.toggleTasbeehSound=function(){tasbeehSoundEnabled=!tasbeehSoundEnabled,localStorage.setItem("crown_tasbeeh_sound",tasbeehSoundEnabled?"true":"false"),updateTasbeehSoundToggle(),showToast(tasbeehSoundEnabled?"Tasbeeh click sound ON":"Tasbeeh click sound OFF")},window.openEtiquette=function(){const e=document.querySelector(".etiquette-panel");if(!e)return;e.querySelector(".etiquette-content").innerHTML.trim()||(e.querySelector(".etiquette-content").innerHTML='\n                <h2>The Etiquette of Dua</h2>\n                <div class="etiquette-item"><div class="etiquette-num">1</div><div class="etiquette-text"><strong>Begin with praise of Allah</strong> and send Salawat upon the Prophet ï·º. <span class="ref">(Tirmidhi 3477)</span></div></div>\n                <div class="etiquette-item"><div class="etiquette-num">2</div><div class="etiquette-text"><strong>Have absolute certainty (YaqÄ«n)</strong> that Allah will answer. The Prophet ï·º said: "Call upon Allah with certainty that He will respond." <span class="ref">(Tirmidhi 3479)</span></div></div>\n                <div class="etiquette-item"><div class="etiquette-num">3</div><div class="etiquette-text"><strong>Be persistent â€” never give up.</strong> "Your dua is answered as long as you do not say: \'I prayed but was not answered.\'" <span class="ref">(Bukhari 6340)</span></div></div>\n                <div class="etiquette-item"><div class="etiquette-num">4</div><div class="etiquette-text"><strong>Presence of heart.</strong> Allah does not accept dua from a heedless, distracted heart. <span class="ref">(Tirmidhi 3479)</span></div></div>\n                <div class="etiquette-item"><div class="etiquette-num">5</div><div class="etiquette-text"><strong>Face the Qiblah</strong> and raise your hands. The Prophet ï·º was shy to return empty hands that were raised to Him. <span class="ref">(Abu Dawud 1488)</span></div></div>\n                <div class="etiquette-item"><div class="etiquette-num">6</div><div class="etiquette-text"><strong>Be in a state of wudu</strong> (ablution) when possible. Purity elevates the dua.</div></div>\n                <div class="etiquette-item"><div class="etiquette-num">7</div><div class="etiquette-text"><strong>Use Allah\'s Beautiful Names</strong> that match your request. Asking for mercy? Use "YÄ Raá¸¥mÄn." Asking for provision? Use "YÄ RazzÄq." <span class="ref">(Quran 7:180)</span></div></div>\n                <div class="etiquette-item"><div class="etiquette-num">8</div><div class="etiquette-text"><strong>Seek the blessed times:</strong> Last third of the night, between Adhan and Iqamah, while prostrating, while fasting, while travelling, on Friday. <span class="ref">(Muslim 757, Abu Dawud 521)</span></div></div>\n                <div class="etiquette-item"><div class="etiquette-num">9</div><div class="etiquette-text"><strong>Admit your sins and need</strong> before asking. Acknowledge your weakness â€” as in the Dua of Yunus and Adam Ø¹Ù„ÙŠÙ‡Ù…Ø§ Ø§Ù„Ø³Ù„Ø§Ù….</div></div>\n                <div class="etiquette-item"><div class="etiquette-num">10</div><div class="etiquette-text"><strong>End with Salawat</strong> upon the Prophet ï·º. "Every dua is suspended between heaven and earth until you send Salawat upon the Prophet ï·º." <span class="ref">(Tirmidhi 486)</span></div></div>'),e.classList.add("active"),lockScroll();const t=e.querySelector(".etiquette-close");t&&t.focus(),recordInAppRoute(!0)},window.closeEtiquette=function(){const e=document.querySelector(".etiquette-panel");e&&e.classList.remove("active"),unlockScroll(),recordInAppRoute(!1)},window.openRoutine=function(){const e=document.querySelector(".routine-panel");if(!e)return;e.querySelector(".routine-content").innerHTML.trim()||(e.querySelector(".routine-content").innerHTML='\n                <h2>Recommended Daily Routine</h2>\n                <div class="progress-stat-card daily-dua-progress" style="flex-direction:column;text-align:center;cursor:pointer;border-color:rgba(201,168,76,0.15);" onclick="toggleRoutineDailyDua(event);">\n                    <div style="font-family:var(--font-title);font-size:0.7rem;letter-spacing:2.5px;text-transform:uppercase;color:rgba(201,168,76,0.8);margin-bottom:0.5rem;"><span class="sparkle">âœ¦</span> Dua of the Day <span class="sparkle">âœ¦</span></div>\n                    <div id="routineDailyArabic" style="font-family:var(--font-arabic);font-size:calc(1.3rem * var(--font-scale));color:var(--gold-light);direction:rtl;line-height:2.2;margin:0.4rem 0;"></div>\n                    <div id="routineDailyTranslation" style="font-family:var(--font-text);font-size:0.88rem;color:var(--text-muted);font-style:italic;line-height:1.6;"></div>\n                    <div id="routineDailyPrompt" style="margin-top:10px;font-size:0.7rem;color:var(--text-subtle);letter-spacing:1px;text-transform:uppercase;">Tap to expand translation &amp; references â†“</div>\n                </div>\n                <div id="routineDailyExtra" style="display:none;margin-top:10px;padding:12px;background:rgba(46,196,122,0.08);border:1px solid rgba(46,196,122,0.18);border-radius:var(--radius-md);"></div>\n                <div class="routine-item">\n                    <div class="routine-time">ğŸŒ… MORNING (After Fajr)</div>\n                    <div class="routine-desc">\n                        1. <span class="dua-ref" onclick="scrollToDua(2);closeRoutine()">Ayatul Kursi</span><br>\n                        2. <span class="dua-ref" onclick="scrollToDua(6);closeRoutine()">3 Quls (3x each)</span><br>\n                        3. <span class="dua-ref" onclick="scrollToDua(12);closeRoutine()">Bismillah Protection (3x)</span><br>\n                        4. <span class="dua-ref" onclick="scrollToDua(16);closeRoutine()">Sayyid al-Istighfar</span><br>\n                        5. <span class="dua-ref" onclick="scrollToDua(14);closeRoutine()">Contentment with Allah (3x)</span><br>\n                        6. <span class="dua-ref" onclick="scrollToDua(35);closeRoutine()">Hasbiyallah (7x)</span><br>\n                        7. <span class="dua-ref" onclick="scrollToDua(38);closeRoutine()">Beneficial Knowledge</span><br>\n                        8. <span class="dua-ref" onclick="scrollToDua(34);closeRoutine()">Morning Remembrance</span>\n                    </div>\n                </div>\n                <div class="routine-item">\n                    <div class="routine-time">ğŸŒ‡ EVENING (After Asr/Maghrib)</div>\n                    <div class="routine-desc">\n                        Same as morning adhkar, plus:<br>\n                        â€¢ <span class="dua-ref" onclick="scrollToDua(23);closeRoutine()">Asking for \'Afiyah</span><br>\n                        â€¢ <span class="dua-ref" onclick="scrollToDua(48);closeRoutine()">Protection from Four Evils</span>\n                    </div>\n                </div>\n                <div class="routine-item">\n                    <div class="routine-time">ğŸ•Œ IN EVERY PRAYER</div>\n                    <div class="routine-desc">\n                        â€¢ <span class="dua-ref" onclick="scrollToDua(1);closeRoutine()">Al-Fatiha</span><br>\n                        â€¢ <span class="dua-ref" onclick="scrollToDua(13);closeRoutine()">Four Refuges (before salam)</span><br>\n                        â€¢ <span class="dua-ref" onclick="scrollToDua(7);closeRoutine()">Rabbana Atina</span><br>\n                        â€¢ <span class="dua-ref" onclick="scrollToDua(46);closeRoutine()">Ibrahimic Salawat</span>\n                    </div>\n                </div>\n                <div class="routine-item">\n                    <div class="routine-time">ğŸŒ™ BEFORE SLEEP</div>\n                    <div class="routine-desc">\n                        1. <span class="dua-ref" onclick="scrollToDua(2);closeRoutine()">Ayatul Kursi</span><br>\n                        2. <span class="dua-ref" onclick="scrollToDua(6);closeRoutine()">3 Quls (Blow & Wipe 3x)</span><br>\n                        3. <span class="dua-ref" onclick="scrollToDua(5);closeRoutine()">Last 2 Verses of Al-Baqarah</span><br>\n                        4. <span class="dua-ref" onclick="scrollToDua(49);closeRoutine()">Sleep Dua</span><br>\n                        5. <span class="dua-ref" onclick="scrollToDua(36);closeRoutine()">Tahlil (before sleeping)</span>\n                    </div>\n                </div>\n                <div class="routine-item">\n                    <div class="routine-time">ğŸ“¿ DAILY DHIKR</div>\n                    <div class="routine-desc">\n                        â€¢ <span class="dua-ref" onclick="scrollToDua(36);closeRoutine()">Tahlil 100x</span> â€” Use the Tasbeeh counter<br>\n                        â€¢ SubhanAllah 33x, Alhamdulillah 33x, Allahu Akbar 34x after each prayer<br>\n                        â€¢ <span class="dua-ref" onclick="scrollToDua(19);closeRoutine()">Ya Muqallibal Qulub</span> â€” as often as possible\n                    </div>\n                </div>');const t=e.querySelector("#routineDailyExtra"),n=e.querySelector("#routineDailyPrompt");t&&(t.innerHTML="",t.style.display="none"),n&&(n.textContent="Tap to expand translation & references â†“"),e.classList.add("active"),lockScroll(),setBottomNavActive("routine"),loadRoutineDailyDua();const a=e.querySelector(".etiquette-close");a&&a.focus(),recordInAppRoute(!0)},window.closeRoutine=function(){const e=document.querySelector(".routine-panel");e&&e.classList.remove("active"),unlockScroll(),setBottomNavActive("home"),recordInAppRoute(!1)},window.sharePage=function(){navigator.share?navigator.share({title:"Essential Duas by ÙÙ„Ø§Ø­",text:"63 Essential Islamic Duas from Quran & Sunnah â€” by Engineer Mohammad Falah",url:window.location.href}):navigator.clipboard.writeText(window.location.href).then(()=>{showToast("Link copied to clipboard")}).catch(()=>showToast("Failed to copy"))},window.shareDua=function(e){const t=document.querySelector(`.dua-card[data-id="${e}"]`);if(!t)return;const n=t.querySelector(".dua-title").textContent,a=`${n}\n\n${t.querySelector(".arabic-text").textContent}\n\nFrom: Essential Duas by ÙÙ„Ø§Ø­\n${window.location.href}`;navigator.share?navigator.share({title:n,text:a}):navigator.clipboard.writeText(a).then(()=>{showToast("Dua copied to clipboard")}).catch(()=>showToast("Failed to copy"))},window.updateStats=updateStats,window.showRandomDua=function(){const e=Array.from(els.cards).filter(e=>!e.classList.contains("hidden-card")&&"none"!==e.style.display);if(0===e.length)return void showToast("No duas available");const t=e[Math.floor(Math.random()*e.length)];els.cards.forEach(e=>{e.classList.remove("expanded");const t=e.querySelector(".card-header");t&&t.setAttribute("aria-expanded","false")}),t.classList.add("expanded");const n=t.querySelector(".card-header");n&&n.setAttribute("aria-expanded","true"),setTimeout(()=>{t.scrollIntoView({behavior:"smooth",block:"center"})},100),t.classList.add("random-glow"),t.style.borderColor="var(--emerald-light)",t.style.boxShadow="0 0 25px rgba(46, 196, 122, 0.2)",setTimeout(()=>{t.classList.remove("random-glow"),t.style.borderColor="",t.style.boxShadow=""},3e3);showToast(`ğŸ² Dua #${t.querySelector(".dua-number").textContent}: ${t.querySelector(".dua-title").textContent.substring(0,40)}...`)},window.toggleSection=function(e){const t=e.classList.toggle("collapsed"),n=e.getAttribute("data-section");e.setAttribute("aria-expanded",String(!t));const a=e.querySelector(".section-collapse-hint");a&&(a.textContent=t?"tap to expand":"tap to collapse");let r=e.nextElementSibling;for(;r&&!r.classList.contains("section-header");)r.classList.contains("dua-card")&&(t?r.style.display="none":(r.style.display="",r.classList.contains("visible")||setTimeout(()=>r.classList.add("visible"),50))),r=r.nextElementSibling;const o=JSON.parse(localStorage.getItem("crown_collapsed_sections")||"[]");if(t)o.includes(n)||o.push(n);else{const e=o.indexOf(n);-1!==e&&o.splice(e,1)}localStorage.setItem("crown_collapsed_sections",JSON.stringify(o)),showToast(t?`${e.querySelector(".section-title").textContent} â€” Collapsed`:`${e.querySelector(".section-title").textContent} â€” Expanded`)},window.handleBottomNav=function(e,t){runTabFadeTransition(document.getElementById("mainContainer")),document.querySelectorAll(".bottom-nav-item").forEach(e=>e.classList.remove("active")),t.classList.add("active");const n=document.querySelector(".tasbeeh-panel.active");n&&(n.classList.remove("active"),unlockScroll());const a=document.querySelector(".etiquette-panel.active");a&&(a.classList.remove("active"),unlockScroll());const r=document.querySelector(".routine-panel.active");r&&(r.classList.remove("active"),unlockScroll());const o=document.querySelector(".prayer-panel.active");o&&(o.classList.remove("active"),unlockScroll());const i=document.querySelector(".quran-panel.active");i&&(i.classList.remove("active"),unlockScroll());const s=document.getElementById("bookmarksPanel"),l=document.querySelector(".overlay");switch(s&&s.classList.contains("active")&&(s.classList.remove("active"),l&&l.classList.remove("active"),unlockScroll()),e){case"home":backToCategories();break;case"routine":setTimeout(()=>openRoutine(),50);break;case"tasbeeh":setTimeout(()=>openTasbeeh(),50);break;case"quran":setTimeout(()=>openQuran(),50);break;case"prayer":setTimeout(()=>openPrayer(),50)}},window.openProgress=function(){let e=document.querySelector(".progress-panel");e||(e=document.createElement("div"),e.className="progress-panel",e.setAttribute("onclick","if(event.target===this) closeProgress()"),e.innerHTML='\n                <button class="etiquette-close" onclick="closeProgress()">âœ•</button>\n                <div class="progress-panel-content" id="progressPanelContent"></div>',document.body.appendChild(e)),enhanceAccessibility(),renderProgressPanel(),e.classList.add("active"),lockScroll(),recordInAppRoute(!0)},window.closeProgress=function(){const e=document.querySelector(".progress-panel");e&&e.classList.remove("active"),unlockScroll(),recordInAppRoute(!1)},window.shareProgress=async function(){showToast("Generating image...");const e=STATE.read.length,t=Math.round(e/63*100),n=STATE.bookmarks.length,a=parseInt(localStorage.getItem("crown_streak")||"0"),r=(JSON.parse(localStorage.getItem("crown_activity")||"[]").length,[{name:"First Step",icon:"ğŸŒ±",req:1},{name:"Bookworm",icon:"ğŸ“–",req:5},{name:"On Fire",icon:"ğŸ”¥",req:10},{name:"Dedicated",icon:"â­",req:20},{name:"Explorer",icon:"ğŸŒ",req:30},{name:"Halfway",icon:"ğŸ’ª",req:28},{name:"Crown Master",icon:"ğŸ†",req:63},{name:"Scholar",icon:"ğŸ”®",req:63}].filter(t=>e>=t.req).map(e=>e.icon).join(" "));let o="";o=e>=63?"ğŸ† Completed the entire Crown Collection!":t>=40?"â­ Nearly there â€” a true seeker of knowledge!":t>=25?"ğŸ’ª Halfway hero â€” keep going!":t>=10?"ğŸŒ± Beautiful growth â€” 10+ duas learned!":e>=1?"âœ¨ Every journey starts with a single step.":"ğŸ“– Start your journey today!";const i=document.createElement("div");i.style.cssText="\n            position:fixed; left:-9999px; top:0;\n            width:500px; padding:40px 36px;\n            background: linear-gradient(145deg, #0c1a13, #142a20);\n            border-radius:24px; font-family:serif;\n            border: 1px solid rgba(46,196,122,0.2);\n        ",i.innerHTML=`\n            <div style="text-align:center;margin-bottom:20px;">\n                <div style="font-family:'Noto Naskh Arabic','Amiri',serif;font-size:16px;color:#2ec47a;margin-bottom:4px;">Ù</div>\n                <div style="font-family:'Playfair Display',serif;font-size:11px;letter-spacing:3px;text-transform:uppercase;color:#2ec47a;margin-bottom:6px;">Essential Duas by ÙÙ„Ø§Ø­</div>\n                <div style="font-family:'Playfair Display',serif;font-size:16px;letter-spacing:2px;text-transform:uppercase;color:#e0eccc;font-weight:600;">My Journey</div>\n            </div>\n            <div style="display:flex;gap:12px;margin-bottom:16px;">\n                <div style="flex:1;background:rgba(46,196,122,0.06);border:1px solid rgba(46,196,122,0.12);border-radius:14px;padding:16px;text-align:center;">\n                    <div style="font-family:'Playfair Display',serif;font-size:24px;color:#d4af37;">${e}<span style="font-size:14px;color:rgba(224,238,210,0.5);">/63</span></div>\n                    <div style="font-family:'Playfair Display',serif;font-size:8px;letter-spacing:2px;text-transform:uppercase;color:rgba(224,238,210,0.5);margin-top:4px;">Duas Read</div>\n                </div>\n                <div style="flex:1;background:rgba(46,196,122,0.06);border:1px solid rgba(46,196,122,0.12);border-radius:14px;padding:16px;text-align:center;">\n                    <div style="font-family:'Playfair Display',serif;font-size:24px;color:#d4af37;">${a}</div>\n                    <div style="font-family:'Playfair Display',serif;font-size:8px;letter-spacing:2px;text-transform:uppercase;color:rgba(224,238,210,0.5);margin-top:4px;">Day Streak</div>\n                </div>\n                <div style="flex:1;background:rgba(46,196,122,0.06);border:1px solid rgba(46,196,122,0.12);border-radius:14px;padding:16px;text-align:center;">\n                    <div style="font-family:'Playfair Display',serif;font-size:24px;color:#d4af37;">${n}</div>\n                    <div style="font-family:'Playfair Display',serif;font-size:8px;letter-spacing:2px;text-transform:uppercase;color:rgba(224,238,210,0.5);margin-top:4px;">Saved</div>\n                </div>\n            </div>\n            ${r?`<div style="text-align:center;font-size:1.4rem;margin-bottom:12px;letter-spacing:4px;">${r}</div>`:""}\n            <div style="text-align:center;font-family:'Playfair Display',serif;font-size:14px;color:rgba(224,238,210,0.85);margin-bottom:16px;">${o}</div>\n            <div style="display:flex;justify-content:space-between;padding-top:14px;border-top:1px solid rgba(46,196,122,0.1);">\n                <span style="font-family:'Playfair Display',serif;font-size:9px;letter-spacing:1px;text-transform:uppercase;color:rgba(160,210,180,0.55);">${t}% Complete</span>\n                <span style="font-family:'Playfair Display',serif;font-size:9px;letter-spacing:1px;text-transform:uppercase;color:rgba(160,210,180,0.35);">ÙÙ„Ø§Ø­ Â· mohhp.github.io/Essential-duas</span>\n            </div>\n        `,document.body.appendChild(i);try{if("undefined"==typeof html2canvas)return showToast("Image library loading, try again..."),void document.body.removeChild(i);const e=await html2canvas(i,{backgroundColor:"#0c1a13",scale:2,useCORS:!0,logging:!1});document.body.removeChild(i),e.toBlob(async e=>{if(!e)return void showToast("Failed to generate");if(navigator.canShare&&navigator.canShare({files:[new File([e],"progress.png",{type:"image/png"})]}))try{return await navigator.share({files:[new File([e],"progress.png",{type:"image/png"})],title:"My Dua Journey",text:"From Essential Duas by ÙÙ„Ø§Ø­"}),void showToast("Shared!")}catch(e){}const t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="my-dua-journey.png",n.click(),URL.revokeObjectURL(t),showToast("Image downloaded!")},"image/png")}catch(e){document.body.removeChild(i),showToast("Failed to generate image")}};const DUA_AUDIO_SOURCES={1:{ayahs:["1:1-7"]},2:{ayahs:["2:255"]},3:{ayahs:["21:87"]},4:{ayahs:["17:24"]},5:{ayahs:["2:285-286"]},6:{ayahs:["112:1-4","113:1-5","114:1-6"]},7:{ayahs:["2:201"]},8:{ayahs:["3:8"]},9:{ayahs:["7:23"]},10:{ayahs:["20:114"]},29:{ayahs:["20:25-28"]},30:{ayahs:["14:40"]},31:{ayahs:["27:19"]},32:{ayahs:["21:83"]},33:{ayahs:["3:38"]},35:{ayahs:["9:129"]},40:{ayahs:["14:41"]},50:{ayahs:["43:13-14"]},52:{ayahs:["3:147"]},62:{ayahs:["113:1-5"]},63:{ayahs:["18:39"]}},AYAH_AUDIO_CACHE=new Map;let activeAudioSession=null;function getAudioUiText(){const e=isPashtoMode();return{listen:e?"ğŸ”Š Ø§ÙˆØ±ÛØ¯Ù„":"ğŸ”Š Listen",play:e?"â–¶ ØºÚ–ÙˆÙ„":"â–¶ Play",pause:"â¸ Pause",loading:e?"â³ Ú†Ù…ØªÙˆ Ú©ÛÚ–ÙŠ...":"â³ Loading..."}}function setAudioPlayerState(e,t){if(!e)return;const n=e.querySelector(".audio-btn");if(!n)return;const a=getAudioUiText();e.dataset.state=t,n.classList.remove("playing","loading"),"loading"===t?(n.classList.add("loading"),n.textContent=a.loading):"playing"===t?(n.classList.add("playing"),n.textContent=a.pause):n.textContent="paused"===t?a.play:a.listen}function updateAudioProgress(e,t){const n=e?.querySelector(".audio-progress-fill");n&&(n.style.width=`${Math.max(0,Math.min(100,t))}%`)}function expandAyahSpecs(e){if(!Array.isArray(e))return[];const t=[];return e.forEach(e=>{if("string"!=typeof e)return;const n=e.trim();if(!n)return;const a=n.match(/^(\d+):(\d+)-(\d+)$/);if(a){const e=parseInt(a[1],10),n=parseInt(a[2],10),r=parseInt(a[3],10);if(!Number.isNaN(e)&&!Number.isNaN(n)&&!Number.isNaN(r)&&r>=n)for(let a=n;a<=r;a+=1)t.push(`${e}:${a}`);return}n.match(/^\d+:\d+$/)&&t.push(n)}),t}async function resolveAyahAudioUrl(e){if(AYAH_AUDIO_CACHE.has(e))return AYAH_AUDIO_CACHE.get(e);const t=await fetch(`https://api.alquran.cloud/v1/ayah/${e}/ar.alafasy`);if(!t.ok)throw new Error("Audio lookup failed");const n=await t.json(),a=n?.data?.audio;if(!a)throw new Error("Audio URL missing");return AYAH_AUDIO_CACHE.set(e,a),a}async function getPlaylistForDua(e){const t=DUA_AUDIO_SOURCES[e];if(!t)return[];const n=expandAyahSpecs(t.ayahs);if(!n.length)return[];return(await Promise.all(n.map(resolveAyahAudioUrl))).filter(Boolean)}function stopActiveAudio(){if(!activeAudioSession)return;const{audio:e,preloadedAudio:t,player:n}=activeAudioSession;e&&(e.pause(),e.src=""),t&&(t.pause(),t.src=""),updateAudioProgress(n,0),setAudioPlayerState(n,"idle"),activeAudioSession=null}async function playDuaAudio(e,t){const n=t?.querySelector(".audio-btn");if(n){if(activeAudioSession&&activeAudioSession.duaId===e&&activeAudioSession.player===t){const{audio:e}=activeAudioSession;return void(e.paused?(await e.play(),setAudioPlayerState(t,"playing")):(e.pause(),setAudioPlayerState(t,"paused")))}stopActiveAudio(),setAudioPlayerState(t,"loading"),updateAudioProgress(t,0);try{const n=await getPlaylistForDua(e);if(!n.length)return void t.remove();let a=new Audio,r=null,o=0;const i=n.length,s=e=>{const t=e+1;t>=i?r=null:(r=new Audio,r.preload="auto",r.src=n[t],r.load())},l=e=>{if(e>=i)return setAudioPlayerState(t,"idle"),updateAudioProgress(t,100),void(activeAudioSession=null);o=e,a.src=n[o],a.load(),s(o),a.play().then(()=>{setAudioPlayerState(t,"playing")}).catch(()=>{setAudioPlayerState(t,"idle"),showToast("Audio playback failed")})};a.addEventListener("timeupdate",()=>{const e=a.duration?a.currentTime/a.duration:0;updateAudioProgress(t,(o+e)/i*100)}),a.addEventListener("ended",()=>{const e=o+1;if(!(e>=i))return r&&r.readyState>=2?(a=r,o=e,s(o),a.addEventListener("timeupdate",()=>{const e=a.duration?a.currentTime/a.duration:0;updateAudioProgress(t,(o+e)/i*100)}),a.addEventListener("ended",()=>{const e=o+1;if(e>=i)return setAudioPlayerState(t,"idle"),updateAudioProgress(t,100),void(activeAudioSession=null);l(e)}),a.addEventListener("error",()=>{setAudioPlayerState(t,"idle"),showToast("Audio playback failed")}),void a.play().then(()=>{setAudioPlayerState(t,"playing")}).catch(()=>{l(e)})):void l(e);l(e)}),a.addEventListener("error",()=>{setAudioPlayerState(t,"idle"),showToast("Audio playback failed")}),activeAudioSession={duaId:e,player:t,get audio(){return a},get preloadedAudio(){return r}},l(0)}catch(e){setAudioPlayerState(t,"idle"),t.remove()}}}function injectAudioButtons(){document.querySelectorAll(".copy-row").forEach(e=>{const t=e.closest(".dua-card");if(!t)return;const n=parseInt(t.getAttribute("data-id"),10);if(!DUA_AUDIO_SOURCES[n])return;if(e.querySelector(".audio-player"))return;const a=document.createElement("div");a.className="audio-player",a.setAttribute("data-state","idle"),a.innerHTML='\n                <button class="action-btn audio-btn" type="button"></button>\n                <div class="audio-progress"><span class="audio-progress-fill"></span></div>\n            ';const r=a.querySelector(".audio-btn");setAudioPlayerState(a,"idle"),r.addEventListener("click",()=>playDuaAudio(n,a)),e.insertBefore(a,e.firstChild)})}window.refreshAudioButtonLanguage=function(){document.querySelectorAll(".audio-player").forEach(e=>{setAudioPlayerState(e,e.dataset.state||"idle")})};const TIME_DUA_MAP={fajr:{icon:"ğŸŒ…",label:"Fajr / Early Morning",period:"Start your day with these blessed supplications",ids:[12,14,16,23,34,35,36,38]},morning:{icon:"â˜€ï¸",label:"Morning Adhkar",period:"The Prophet ï·º never missed his morning remembrance",ids:[12,14,16,23,34,35,36]},dhuhr:{icon:"ğŸ•",label:"Midday Remembrance",period:"Take a moment to reconnect in the middle of your day",ids:[1,7,10,19,20,41]},asr:{icon:"ğŸŒ¤",label:"Afternoon Reflection",period:"The Prophet ï·º sought refuge from the trials of the day",ids:[13,25,27,29,42]},maghrib:{icon:"ğŸŒ†",label:"Evening Adhkar",period:"As the sun sets, renew your protection",ids:[12,14,16,23,34,35,36]},isha:{icon:"ğŸŒ™",label:"Night Supplications",period:"Prepare for sleep with these powerful duas",ids:[2,5,6,11,47,18]},latenight:{icon:"ğŸŒŒ",label:"Late Night / Tahajjud",period:"The last third of the night â€” when duas are answered",ids:[9,16,17,18,24,26,3]}};function getTimePeriod(){const e=(new Date).getHours();return e>=4&&e<6?"fajr":e>=6&&e<11?"morning":e>=11&&e<14?"dhuhr":e>=14&&e<16?"asr":e>=16&&e<19?"maghrib":e>=19&&e<22?"isha":"latenight"}function renderTimeBanner(){const e=document.getElementById("timeBanner");if(!e)return;const t=getTimePeriod(),n=TIME_DUA_MAP[t];if(!n)return;const a=n.ids.map(e=>{const t=document.querySelector(`.dua-card[data-id="${e}"]`);if(!t)return"";const n=t.querySelector(".dua-title")?.textContent?.split("â€”")[0]?.trim()||`Dua #${e}`;return`<span class="time-dua-chip" onclick="scrollToDua(${e})">#${e} ${n.length>30?n.substring(0,28)+"â€¦":n}</span>`}).join("");e.innerHTML=`\n            <div class="time-banner">\n                <div class="time-banner-header">\n                    <span class="time-banner-icon">${n.icon}</span>\n                    <span class="time-banner-title">Suggested Now â€” ${n.label}</span>\n                </div>\n                <div class="time-banner-period">${n.period}</div>\n                <div class="time-banner-duas">${a}</div>\n            </div>\n        `}function trackDailyActivity(){const e=(new Date).toISOString().slice(0,10);let t=JSON.parse(localStorage.getItem("crown_activity")||"[]");t.includes(e)||(t.push(e),t.length>90&&(t=t.slice(-90)),localStorage.setItem("crown_activity",JSON.stringify(t)))}function applyTheme(){const e=localStorage.getItem("crown_theme")||"dark",t=document.querySelector('meta[name="theme-color"]');"light"===e?(document.documentElement.setAttribute("data-theme","light"),t&&t.setAttribute("content","#faf7f2")):(document.documentElement.removeAttribute("data-theme"),t&&t.setAttribute("content","#1e2a3a"));const n=document.getElementById("themeToggle");n&&(n.innerHTML="light"===e?"ğŸŒ™":"â˜€")}function positionNavOverflowMenu(){const e=document.getElementById("navOverflowMenu");if(!e||!e.classList.contains("open"))return;e.style.left="",e.style.right="";let t=e.getBoundingClientRect();t.right>window.innerWidth-4&&(e.style.right="auto",e.style.left="0",t=e.getBoundingClientRect()),t.left<4&&(e.style.left="4px")}window.scrollToTop=function(){window.scrollTo({top:0,behavior:"smooth"})},window.scrollToDailyDua=function(){const e=Math.floor((new Date-new Date((new Date).getFullYear(),0,0))/1e3/60/60/24);scrollToDua(e%63+1)},window.toggleRoutineDailyDua=function(e){e&&(e.stopPropagation(),e.preventDefault());const t=Math.floor((new Date-new Date((new Date).getFullYear(),0,0))/1e3/60/60/24)%63+1,n=document.querySelector(`.dua-card[data-id="${t}"]`),a=document.getElementById("routineDailyExtra"),r=document.getElementById("routineDailyPrompt");if(a&&n)if(a.innerHTML.trim())a.innerHTML="",a.style.display="none",r&&(r.textContent="Tap to expand translation & references â†“");else{const e=n.querySelector(".translation")?.textContent?.trim()||"",t=n.querySelector(".reference .ref-text")?.textContent?.trim()||n.querySelector(".reference")?.textContent?.trim()||"";a.innerHTML="";const o=document.createElement("div");o.className="routine-extra-translation",o.style.cssText="font-family:var(--font-text);font-size:0.95rem;color:var(--text-muted);line-height:1.6;margin-bottom:8px;",o.textContent=e;const i=document.createElement("div");i.className="routine-extra-reference",i.style.cssText="font-size:0.85rem;color:var(--text-subtle);",i.textContent=t,a.appendChild(o),a.appendChild(i),a.style.display="block",r&&(r.textContent="Tap to hide details â†‘")}},window.shareDailyDua=function(){const e=Math.floor((new Date-new Date((new Date).getFullYear(),0,0))/1e3/60/60/24);shareAsImage(e%63+1)},window.toggleTheme=function(){const e="light"===document.documentElement.getAttribute("data-theme"),t=document.querySelector('meta[name="theme-color"]');e?(document.documentElement.removeAttribute("data-theme"),localStorage.setItem("crown_theme","dark"),t&&t.setAttribute("content","#1e2a3a")):(document.documentElement.setAttribute("data-theme","light"),localStorage.setItem("crown_theme","light"),t&&t.setAttribute("content","#faf7f2"));const n=document.getElementById("themeToggle");n&&(n.innerHTML=e?"â˜€":"ğŸŒ™"),showToast(e?"Dark Mode":"Light Mode")},window.toggleNavOverflow=function(e){e.stopPropagation();const t=document.getElementById("navOverflowMenu"),n=document.getElementById("navOverflowBtn"),a=t.classList.toggle("open");n.setAttribute("aria-expanded",a),a?requestAnimationFrame(positionNavOverflowMenu):(t.style.left="",t.style.right="")},window.closeNavOverflow=function(){const e=document.getElementById("navOverflowMenu"),t=document.getElementById("navOverflowBtn");e&&(e.classList.remove("open"),e.style.left="",e.style.right=""),t&&t.setAttribute("aria-expanded","false")},window.addEventListener("resize",positionNavOverflowMenu),window.addEventListener("orientationchange",positionNavOverflowMenu),document.addEventListener("click",function(e){const t=document.getElementById("navOverflowMenu"),n=document.getElementById("navOverflowBtn");t&&!t.contains(e.target)&&e.target!==n&&(t.classList.remove("open"),t.style.left="",t.style.right="",n&&n.setAttribute("aria-expanded","false"))});let flashcardQueue=[],flashcardIndex=0,flashcardFlipped=!1;function getFlashcardData(e){return{id:parseInt(e.getAttribute("data-id"),10),arabic:e.querySelector(".arabic-text")?.textContent?.trim()||"",transliteration:e.querySelector(".transliteration")?.textContent?.trim()||"",translation:e.querySelector(".translation")?.textContent?.trim()||"",reference:e.querySelector(".ref-text")?.textContent?.trim()||"",title:e.querySelector(".dua-title")?.textContent?.trim()||""}}function normalizeFlashcardIndex(e){return flashcardQueue.length?e<0?0:e>=flashcardQueue.length?flashcardQueue.length-1:e:0}function renderFlashcard(){const e=flashcardQueue[flashcardIndex];if(!e)return;const t=document.getElementById("flashcardArabic"),n=document.getElementById("flashcardTranslation"),a=document.getElementById("flashcardTransliteration"),r=document.getElementById("flashcardReference"),o=document.getElementById("memorizeProgressText"),i=document.getElementById("memorizeProgressFill"),s=document.getElementById("flashcard"),l=document.getElementById("flashcardRatingRow");t&&(t.textContent=e.arabic),n&&(n.textContent=e.translation),a&&(a.textContent=e.transliteration),r&&(r.textContent=e.reference||e.title);const d=isPashtoMode(),c=flashcardIndex+1,u=flashcardQueue.length;o&&(o.textContent=d?`${localizeDigits(c)} Ù„Ù‡ ${localizeDigits(u)}`:`Card ${c} of ${u}`),i&&(i.style.width=`${Math.round(c/u*100)}%`),flashcardFlipped=!1,s&&s.classList.remove("flipped"),l&&l.classList.remove("visible")}function bindFlashcardSwipe(){const e=document.getElementById("flashcardWrap");if(!e||"1"===e.dataset.boundSwipe)return;let t=0,n=0;e.addEventListener("touchstart",e=>{e.touches?.[0]&&(t=e.touches[0].clientX,n=e.touches[0].clientY)},{passive:!0}),e.addEventListener("touchend",e=>{if(!e.changedTouches?.[0])return;const a=e.changedTouches[0].clientX-t,r=e.changedTouches[0].clientY-n;Math.abs(a)<40||Math.abs(a)<1.2*Math.abs(r)||(a<0?nextFlashcard():prevFlashcard())},{passive:!0}),e.dataset.boundSwipe="1"}function getSRData(){try{return JSON.parse(localStorage.getItem("crown_sr")||"{}")}catch(e){return{}}}function saveSRData(e){localStorage.setItem("crown_sr",JSON.stringify(e))}function getDueCount(){const e=getSRData(),t=Date.now();return Object.values(e).filter(e=>e.nextReview<=t).length}function updateSRBadges(){const e=getSRData(),t=Date.now(),n=document.getElementById("memorizeToggle");if(n){const e=getDueCount();n.textContent=e>0?`ğŸ§  Memorize (${e} due)`:"ğŸ§  Memorize"}els.cards.forEach(n=>{const a=parseInt(n.getAttribute("data-id")),r=n.querySelector(".sr-review-badge");if(r&&r.remove(),e[a]&&e[a].nextReview<=t){const e=n.querySelector(".dua-title");if(e){const t=document.createElement("span");t.className="sr-review-badge",t.textContent="Review Due",e.appendChild(t)}}})}function injectShareImageButtons(){document.querySelectorAll(".copy-row").forEach(e=>{const t=e.closest(".dua-card");if(!t)return;const n=t.getAttribute("data-id"),a=document.createElement("button");a.className="action-btn",a.innerHTML="ğŸ–¼ Share Image",a.onclick=function(){shareAsImage(n)},e.appendChild(a)})}window.toggleMemorizeMode=function(){document.getElementById("memorizePanel")?.classList.contains("active")?closeMemorizeSession():openMemorizeSession()},window.openMemorizeSession=function(){const e=document.getElementById("memorizePanel"),t=document.getElementById("memorizeToggle");e&&t&&(flashcardQueue=Array.from(document.querySelectorAll(".dua-card")).map(getFlashcardData).filter(e=>e.arabic),flashcardIndex=0,t.classList.add("active"),e.classList.add("active"),lockScroll(),bindFlashcardSwipe(),renderFlashcard(),showToast(isPashtoMode()?"Ø¯ Ø­ÙØ¸ ÙÙ„Ø´Ú©Ø§Ø±Ú‰ Ø­Ø§Ù„Øª ÙØ¹Ø§Ù„ Ø´Ùˆ":"Flashcard memorization mode enabled"))},window.closeMemorizeSession=function(){const e=document.getElementById("memorizePanel"),t=document.getElementById("memorizeToggle");e&&e.classList.remove("active"),t&&t.classList.remove("active"),unlockScroll()},window.flipFlashcard=function(){const e=document.getElementById("flashcard"),t=document.getElementById("flashcardRatingRow");e&&t&&(flashcardFlipped=!flashcardFlipped,e.classList.toggle("flipped",flashcardFlipped),t.classList.toggle("visible",flashcardFlipped))},window.nextFlashcard=function(){flashcardIndex=normalizeFlashcardIndex(flashcardIndex+1),renderFlashcard()},window.prevFlashcard=function(){flashcardIndex=normalizeFlashcardIndex(flashcardIndex-1),renderFlashcard()},window.rateCurrentFlashcard=function(e){const t=flashcardQueue[flashcardIndex];t&&(rateSR(t.id,e),flashcardIndex<flashcardQueue.length-1?(flashcardIndex+=1,renderFlashcard()):(closeMemorizeSession(),showToast(isPashtoMode()?"Ø¯ Ù†Ù† ÙˆØ±ÚÛ Ø¯ ØªÚ©Ø±Ø§Ø± Ø³ÛŒØ´Ù† Ø¨Ø´Ù¾Ú“ Ø´Ùˆ":"Review session complete")))},window.rateSR=function(e,t,n=null){const a=getSRData(),r=a[e]||{interval:1,easeFactor:2,nextReview:0};if("easy"===t?(r.interval=Math.min(r.interval*r.easeFactor,365),r.easeFactor=Math.min(r.easeFactor+.1,3)):"good"===t?(r.interval=Math.min(Math.max(2,r.interval*(r.easeFactor-.15)),180),r.easeFactor=Math.min(r.easeFactor+.02,2.8)):(r.interval=1,r.easeFactor=Math.max(r.easeFactor-.2,1.3)),r.nextReview=Date.now()+864e5*r.interval,a[e]=r,saveSRData(a),n){const e=n.closest(".sr-rating-row");e&&(e.classList.remove("visible"),setTimeout(()=>e.remove(),300))}const o=Math.round(r.interval);showToast("hard"===t?"Will review again tomorrow":`Next review in ${o} day${o>1?"s":""}`),updateSRBadges()},document.addEventListener("DOMContentLoaded",()=>{setTimeout(updateSRBadges,1e3)}),window.shareAsImage=async function(e){const t=document.querySelector(`.dua-card[data-id="${e}"]`);if(!t)return;showToast("Generating image...");const n=(t.querySelector(".dua-title")?.textContent||"").replace(/\s+/g," ").trim(),a=(t.querySelector(".arabic-text")?.textContent||"").trim(),r=(t.querySelector(".translation")?.textContent||"").trim(),o=(t.querySelector(".ref-text")?.textContent||"").trim(),i=(t.querySelector(".auth-badge")?.textContent||"AUTHENTIC").replace(/\s+/g," ").trim(),s=document.getElementById("shareImageTemplate"),l=document.getElementById("shareImageFrame");if(!s||!l)return void showToast("Share template unavailable");const d="light"===document.documentElement.getAttribute("data-theme"),c=isPashtoMode();l.style.background=d?"linear-gradient(150deg, #f7ead0 0%, #f3ddaf 30%, #faefe0 100%)":"linear-gradient(155deg, #0f4b3a 0%, #1e2a3a 55%, #15283b 100%)";const u=document.getElementById("shareAuthTag"),m=document.getElementById("shareArabicText"),p=document.getElementById("shareTranslationText"),h=document.getElementById("shareReferenceText"),g=document.getElementById("shareBrandName");u&&(u.textContent=i),m&&(m.textContent=a),p&&(p.textContent=r),h&&(h.textContent=o||n),g&&(g.textContent=c?"Ù„Ø§Ø²Ù…ÙŠ Ø¯Ø¹Ø§Ú«Ø§Ù†Û":"Essential Duas");try{if("undefined"==typeof html2canvas)return void showToast("Image library loading, try again...");s.style.opacity="1";const t=await html2canvas(l,{backgroundColor:null,scale:Math.max(2,window.devicePixelRatio||2),useCORS:!0,logging:!1,width:1080,windowWidth:1200});s.style.opacity="0",t.toBlob(async t=>{if(!t)return void showToast("Failed to generate");if(navigator.canShare&&navigator.canShare({files:[new File([t],"dua.png",{type:"image/png"})]}))try{return await navigator.share({files:[new File([t],"dua.png",{type:"image/png"})],title:n,text:c?"Ù„Ù‡ Ù„Ø§Ø²Ù…ÙŠ Ø¯Ø¹Ø§Ú«Ø§Ù†Ùˆ Ú…Ø®Ù‡":"From Essential Duas"}),void showToast("Shared!")}catch(e){}const a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download=`dua-${e}.png`,r.click(),URL.revokeObjectURL(a),showToast("Image downloaded!")},"image/png")}catch(e){s.style.opacity="0",showToast("Failed to generate image")}};const ARABIC_DICT={"Ø§Ù„Ù„Ù‡":["Ø£ Ù„ Ù‡","Allah â€” God"],"Ø§Ù„Ù„Ù‡Ù…":["Ø£ Ù„ Ù‡","O Allah (invocation)"],"Ø§Ù„Ø±Ø­Ù…Ù†":["Ø± Ø­ Ù…","The Most Gracious"],"Ø§Ù„Ø±Ø­ÙŠÙ…":["Ø± Ø­ Ù…","The Most Merciful"],"Ø§Ù„ØµÙ…Ø¯":["Øµ Ù… Ø¯","The Eternal Refuge"],"Ø§Ù„Ø§Ø­Ø¯":["Ùˆ Ø­ Ø¯","The One, Unique"],"Ø§Ø­Ø¯":["Ùˆ Ø­ Ø¯","one / anyone"],"Ø§Ù„Ø´Ø§ÙÙŠ":["Ø´ Ù ÙŠ","The Healer"],"Ø§Ù„Ø­ÙŠ":["Ø­ ÙŠ ÙŠ","The Ever-Living"],"Ø§Ù„Ù‚ÙŠÙˆÙ…":["Ù‚ Ùˆ Ù…","The Sustainer of All"],"Ø§Ù„Ø­Ù„ÙŠÙ…":["Ø­ Ù„ Ù…","The Forbearing"],"Ø§Ù„Ø¹Ø¸ÙŠÙ…":["Ø¹ Ø¸ Ù…","The Magnificent"],"Ø§Ù„Ø¹Ù„ÙŠÙ…":["Ø¹ Ù„ Ù…","The All-Knowing"],"Ø§Ù„Ø¹Ù„ÙŠ":["Ø¹ Ù„ Ùˆ","The Most High"],"Ø§Ù„Ø³Ù…ÙŠØ¹":["Ø³ Ù… Ø¹","The All-Hearing"],"Ø§Ù„Ø¸Ø§Ù‡Ø±":["Ø¸ Ù‡ Ø±","The Manifest"],"Ø§Ù„Ø¨Ø§Ø·Ù†":["Ø¨ Ø· Ù†","The Hidden"],"Ø§Ù„Ø§Ø®Ø±":["Ø£ Ø® Ø±","The Last"],"Ø§Ù„Ø§ÙˆÙ„":["Ø£ Ùˆ Ù„","The First"],"Ø§Ù„ÙˆÙ‡Ø§Ø¨":["Ùˆ Ù‡ Ø¨","The Bestower"],"Ø§Ù„Ù…Ù†Ø§Ù†":["Ù… Ù† Ù†","The Gracious Giver"],"Ø§Ù„Ù…Ù‚Ø¯Ù…":["Ù‚ Ø¯ Ù…","The Expediter"],"Ø§Ù„Ù…Ø¤Ø®Ø±":["Ø£ Ø® Ø±","The Delayer"],"Ø¹ÙÙˆ":["Ø¹ Ù Ùˆ","Pardoning; The Pardoner"],"Ø­Ù…ÙŠØ¯":["Ø­ Ù… Ø¯","Praiseworthy"],"Ù…Ø¬ÙŠØ¯":["Ù… Ø¬ Ø¯","Glorious"],"Ù‚Ø¯ÙŠØ±":["Ù‚ Ø¯ Ø±","All-Powerful"],"Ø³Ù…ÙŠØ¹":["Ø³ Ù… Ø¹","All-Hearing"],"Ø¹Ø¯Ù„":["Ø¹ Ø¯ Ù„","Just / Justice"],"Ø§Ù„ÙƒØ±ÙŠÙ…":["Ùƒ Ø± Ù…","The Most Generous"],"Ø¨Ø¯ÙŠØ¹":["Ø¨ Ø¯ Ø¹","Originator"],"Ø¨Ø³Ù…":["Ø³ Ù… Ùˆ","in the name of"],"Ø§Ù„Ø­Ù…Ø¯":["Ø­ Ù… Ø¯","all praise"],"Ø­Ù…Ø¯Ø§":["Ø­ Ù… Ø¯","praise (n.)"],"Ø±Ø¨":["Ø± Ø¨ Ø¨","Lord / Sustainer"],"Ø±Ø¨ÙŠ":["Ø± Ø¨ Ø¨","my Lord"],"Ø±Ø¨Ù†Ø§":["Ø± Ø¨ Ø¨","our Lord"],"Ø±Ø¨Ù‡":["Ø± Ø¨ Ø¨","his Lord"],"Ø±Ø¨Ùƒ":["Ø± Ø¨ Ø¨","your Lord"],"Ø±Ø¨Ø§":["Ø± Ø¨ Ø¨","as a Lord"],"Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠÙ†":["Ø¹ Ù„ Ù…","the worlds / all creation"],"Ù…Ø§Ù„Ùƒ":["Ù… Ù„ Ùƒ","Master / Owner"],"Ù…Ù„Ùƒ":["Ù… Ù„ Ùƒ","King / Sovereign"],"Ø§Ù„Ù…Ù„Ùƒ":["Ù… Ù„ Ùƒ","the Dominion / Kingdom"],"ÙŠÙˆÙ…":["ÙŠ Ùˆ Ù…","day"],"ÙŠÙˆÙ…Ø§":["ÙŠ Ùˆ Ù…","a day"],"Ø§Ù„Ø¯ÙŠÙ†":["Ø¯ ÙŠ Ù†","the religion / the Judgment"],"Ø¯ÙŠÙ†Ø§":["Ø¯ ÙŠ Ù†","as a religion"],"Ø¯ÙŠÙ†ÙŠ":["Ø¯ ÙŠ Ù†","my religion"],"Ø§ÙŠØ§Ùƒ":["Ø¥ ÙŠ ÙŠ","You alone"],"Ù†Ø¹Ø¨Ø¯":["Ø¹ Ø¨ Ø¯","we worship"],"Ù†Ø³ØªØ¹ÙŠÙ†":["Ø¹ Ùˆ Ù†","we seek help"],"Ø§Ù‡Ø¯Ù†Ø§":["Ù‡ Ø¯ ÙŠ","guide us"],"Ø§Ù„ØµØ±Ø§Ø·":["Øµ Ø± Ø·","the path"],"ØµØ±Ø§Ø·":["Øµ Ø± Ø·","path of"],"Ø§Ù„Ù…Ø³ØªÙ‚ÙŠÙ…":["Ù‚ Ùˆ Ù…","the straight"],"Ø§Ù„Ø°ÙŠÙ†":["â€”","those who"],"Ø§Ù„Ø°ÙŠ":["â€”","the one who / that which"],"Ø§Ù†Ø¹Ù…Øª":["Ù† Ø¹ Ù…","You have blessed"],"Ø¹Ù„ÙŠÙ‡Ù…":["Ø¹ Ù„ Ùˆ","upon them"],"ØºÙŠØ±":["Øº ÙŠ Ø±","other than / not"],"Ø§Ù„Ù…ØºØ¶ÙˆØ¨":["Øº Ø¶ Ø¨","those who earned wrath"],"Ø§Ù„Ø¶Ø§Ù„ÙŠÙ†":["Ø¶ Ù„ Ù„","those who went astray"],"Ø§Ù„Ø§Ù‡":["Ø£ Ù„ Ù‡","god / deity"],"Ø§Ù„Ø§":["â€”","except / but"],"Ù‡Ùˆ":["â€”","He"],"ØªØ§Ø®Ø°Ù‡":["Ø£ Ø® Ø°","overtakes Him"],"Ø³Ù†Ù‡":["Ùˆ Ø³ Ù†","slumber / drowsiness"],"Ù†ÙˆÙ…":["Ù† Ùˆ Ù…","sleep"],"Ø§Ù„Ø³Ù…Ø§ÙˆØ§Øª":["Ø³ Ù… Ùˆ","the heavens"],"Ø§Ù„Ø³Ù…Ø§Ø¡":["Ø³ Ù… Ùˆ","the sky / heaven"],"Ø§Ù„Ø§Ø±Ø¶":["Ø£ Ø± Ø¶","the earth"],"ÙŠØ´ÙØ¹":["Ø´ Ù Ø¹","intercedes"],"Ø¹Ù†Ø¯Ù‡":["Ø¹ Ù† Ø¯","with Him / in His presence"],"Ø¹Ù†Ø¯Ùƒ":["Ø¹ Ù† Ø¯","with You"],"Ø¨Ø§Ø°Ù†Ù‡":["Ø£ Ø° Ù†","by His permission"],"ÙŠØ¹Ù„Ù…":["Ø¹ Ù„ Ù…","He knows"],"Ø§ÙŠØ¯ÙŠÙ‡Ù…":["ÙŠ Ø¯ ÙŠ","their hands / before them"],"Ø®Ù„ÙÙ‡Ù…":["Ø® Ù„ Ù","behind them"],"ÙŠØ­ÙŠØ·ÙˆÙ†":["Ø­ Ùˆ Ø·","they encompass"],"Ø¨Ø´ÙŠØ¡":["Ø´ ÙŠ Ø£","anything / something"],"Ø´ÙŠØ¡":["Ø´ ÙŠ Ø£","a thing"],"Ø¹Ù„Ù…Ù‡":["Ø¹ Ù„ Ù…","His knowledge"],"Ø´Ø§Ø¡":["Ø´ ÙŠ Ø£","He willed"],"ÙˆØ³Ø¹":["Ùˆ Ø³ Ø¹","encompasses / extends over"],"ÙƒØ±Ø³ÙŠÙ‡":["Ùƒ Ø± Ø³","His Throne (Kursi)"],"ÙŠØ¤ÙˆØ¯Ù‡":["Ø£ Ùˆ Ø¯","burdens / tires Him"],"Ø­ÙØ¸Ù‡Ù…Ø§":["Ø­ Ù Ø¸","preserving them both"],"Ù‚Ù„":["Ù‚ Ùˆ Ù„","say"],"ÙŠÙ„Ø¯":["Ùˆ Ù„ Ø¯","He begets"],"ÙŠÙˆÙ„Ø¯":["Ùˆ Ù„ Ø¯","He was begotten"],"ÙŠÙƒÙ†":["Ùƒ Ùˆ Ù†","there is / was"],"ÙƒÙÙˆØ§":["Ùƒ Ù Ø£","equivalent / equal"],"Ø§Ø¹ÙˆØ°":["Ø¹ Ùˆ Ø°","I seek refuge"],"Ø¨Ø±Ø¨":["Ø± Ø¨ Ø¨","in the Lord of"],"Ø§Ù„ÙÙ„Ù‚":["Ù Ù„ Ù‚","the daybreak"],"Ø´Ø±":["Ø´ Ø± Ø±","evil / harm"],"Ø®Ù„Ù‚":["Ø® Ù„ Ù‚","He created / creation"],"ØºØ§Ø³Ù‚":["Øº Ø³ Ù‚","darkness"],"ÙˆÙ‚Ø¨":["Ùˆ Ù‚ Ø¨","when it settles"],"Ø§Ù„Ù†ÙØ§Ø«Ø§Øª":["Ù† Ù Ø«","the ones who blow"],"Ø§Ù„Ø¹Ù‚Ø¯":["Ø¹ Ù‚ Ø¯","the knots"],"Ø­Ø§Ø³Ø¯":["Ø­ Ø³ Ø¯","an envier"],"Ø­Ø³Ø¯":["Ø­ Ø³ Ø¯","envies"],"Ø§Ù„Ù†Ø§Ø³":["Ù† Ùˆ Ø³","mankind / the people"],"Ø§Ù„ÙˆØ³ÙˆØ§Ø³":["Ùˆ Ø³ Ùˆ Ø³","the whisperer"],"Ø§Ù„Ø®Ù†Ø§Ø³":["Ø® Ù† Ø³","the retreater (sneaky)"],"ÙŠÙˆØ³ÙˆØ³":["Ùˆ Ø³ Ùˆ Ø³","whispers"],"ØµØ¯ÙˆØ±":["Øµ Ø¯ Ø±","chests / hearts"],"Ø§Ù„Ø¬Ù†Ù‡":["Ø¬ Ù† Ù†","the jinn"],"Ø§Ø³Ø§Ù„Ùƒ":["Ø³ Ø£ Ù„","I ask You"],"Ø§ØºÙØ±":["Øº Ù Ø±","forgive"],"ÙØ§ØºÙØ±":["Øº Ù Ø±","so forgive"],"ÙŠØºÙØ±":["Øº Ù Ø±","forgives"],"ØªØºÙØ±":["Øº Ù Ø±","You forgive"],"ØºÙØ±Ø§Ù†Ùƒ":["Øº Ù Ø±","Your forgiveness"],"Ø§Ø±Ø­Ù…Ù‡Ù…Ø§":["Ø± Ø­ Ù…","have mercy on them both"],"Ø§Ø±Ø­Ù…Ù†Ø§":["Ø± Ø­ Ù…","have mercy on us"],"Ø±Ø­Ù…Ù‡":["Ø± Ø­ Ù…","mercy / a mercy"],"Ø±Ø­Ù…ØªÙƒ":["Ø± Ø­ Ù…","Your mercy"],"Ø¨Ø±Ø­Ù…ØªÙƒ":["Ø± Ø­ Ù…","by Your mercy"],"Ø§Ø±Ø­Ù…":["Ø± Ø­ Ù…","most merciful"],"Ø§Ù„Ø±Ø§Ø­Ù…ÙŠÙ†":["Ø± Ø­ Ù…","the most merciful ones"],"ÙˆÙ‚Ù†Ø§":["Ùˆ Ù‚ ÙŠ","and protect us"],"Ø¹Ø°Ø§Ø¨":["Ø¹ Ø° Ø¨","punishment / torment"],"Ø§Ù„Ù†Ø§Ø±":["Ù† Ùˆ Ø±","the Fire"],"Ø¬Ù‡Ù†Ù…":["Ø¬ Ù‡ Ù† Ù…","Hell / Jahannam"],"Ø§Ø´Ù":["Ø´ Ù ÙŠ","heal"],"Ø´Ø§ÙÙŠ":["Ø´ Ù ÙŠ","healer / curer"],"Ø´ÙØ§Ø¡":["Ø´ Ù ÙŠ","healing / cure"],"Ù‡Ø¨":["Ùˆ Ù‡ Ø¨","grant / bestow"],"Ø§Ø´Ø±Ø­":["Ø´ Ø± Ø­","expand / open"],"ÙŠØ³Ø±":["ÙŠ Ø³ Ø±","ease / make easy"],"ÙŠØ³Ø±Ù‡":["ÙŠ Ø³ Ø±","make it easy"],"Ø¨Ø§Ø±Ùƒ":["Ø¨ Ø± Ùƒ","bless"],"Ø¨Ø§Ø±ÙƒØª":["Ø¨ Ø± Ùƒ","You have blessed"],"Ø¨Ø±ÙƒÙ‡":["Ø¨ Ø± Ùƒ","blessing of"],"Ø«Ø¨Øª":["Ø« Ø¨ Øª","make firm / steady"],"Ø§ÙØªØ­":["Ù Øª Ø­","open"],"Ø§Ø­Ù„Ù„":["Ø­ Ù„ Ù„","untie / loosen"],"Ø§Ø¬Ø¹Ù„Ù†ÙŠ":["Ø¬ Ø¹ Ù„","make me"],"ØªØ¬Ø¹Ù„":["Ø¬ Ø¹ Ù„","You make"],"Ø¬Ø¹Ù„ØªÙ‡":["Ø¬ Ø¹ Ù„","You made it"],"Ø§ÙƒÙÙ†ÙŠ":["Ùƒ Ù ÙŠ","suffice me"],"ÙØ§Ø¹Ù":["Ø¹ Ù Ùˆ","so pardon"],"Ø§Ù„Ø¹ÙÙˆ":["Ø¹ Ù Ùˆ","pardon / forgiveness"],"ØªØ­Ø¨":["Ø­ Ø¨ Ø¨","You love"],"Ø§Ù‚Ø¶":["Ù‚ Ø¶ ÙŠ","settle / decree"],"ÙØ§Ù†ØµØ±Ù†Ø§":["Ù† Øµ Ø±","so grant us victory"],"ØµÙ„":["Øµ Ù„ Ùˆ","send blessings upon"],"ØµÙ„Ù‰":["Øµ Ù„ Ùˆ","sent blessings"],"ØµÙ„ÙŠØª":["Øµ Ù„ Ùˆ","You sent blessings"],"Ø³Ù„Ù…":["Ø³ Ù„ Ù…","peace / bestow peace"],"Ù†ÙØ³Ø§":["Ù† Ù Ø³","a soul"],"Ù†ÙØ³ÙŠ":["Ù† Ù Ø³","my soul / myself"],"Ø§Ù†ÙØ³Ù†Ø§":["Ù† Ù Ø³","ourselves"],"Ù‚Ù„Ø¨ÙŠ":["Ù‚ Ù„ Ø¨","my heart"],"Ù‚Ù„Ø¨":["Ù‚ Ù„ Ø¨","a heart"],"Ù‚Ù„ÙˆØ¨Ù†Ø§":["Ù‚ Ù„ Ø¨","our hearts"],"Ø§Ù„Ù‚Ù„ÙˆØ¨":["Ù‚ Ù„ Ø¨","the hearts"],"Ù…Ù‚Ù„Ø¨":["Ù‚ Ù„ Ø¨","Turner of"],"Ø§Ù„Ø§Ø¨ØµØ§Ø±":["Ø¨ Øµ Ø±","the eyes / sight"],"Ø¹Ù„Ù…Ø§":["Ø¹ Ù„ Ù…","knowledge"],"Ø¹Ù„Ù…":["Ø¹ Ù„ Ù…","knowledge"],"Ø¨Ø¹Ù„Ù…Ùƒ":["Ø¹ Ù„ Ù…","by Your knowledge"],"Ø¹Ù„Ø§Ù…":["Ø¹ Ù„ Ù…","Knower of"],"Ø¹Ù„Ù…ØªÙ‡":["Ø¹ Ù„ Ù…","You taught someone"],"Ø§Ù„ØºÙŠÙˆØ¨":["Øº ÙŠ Ø¨","the unseen things"],"Ø§Ù„ØºÙŠØ¨":["Øº ÙŠ Ø¨","the unseen"],"Ø°Ù†Ø¨ÙŠ":["Ø° Ù† Ø¨","my sin"],"Ø¨Ø°Ù†Ø¨ÙŠ":["Ø° Ù† Ø¨","my sin"],"Ø°Ù†ÙˆØ¨Ù†Ø§":["Ø° Ù† Ø¨","our sins"],"Ø§Ù„Ø°Ù†ÙˆØ¨":["Ø° Ù† Ø¨","the sins"],"ØµØ¯Ø±ÙŠ":["Øµ Ø¯ Ø±","my chest / heart"],"Ù„Ø³Ø§Ù†ÙŠ":["Ù„ Ø³ Ù†","my tongue"],"Ø¹Ù‚Ø¯Ù‡":["Ø¹ Ù‚ Ø¯","a knot"],"Ø§Ù„ØµÙ„Ø§Ù‡":["Øµ Ù„ Ùˆ","the prayer"],"Ø§Ù„ØµÙ„ÙˆÙ‡":["Øµ Ù„ Ùˆ","the prayer"],"Ø§Ù„Ø¯Ù†ÙŠØ§":["Ø¯ Ù† Ùˆ","this worldly life"],"Ø§Ù„Ø§Ø®Ø±Ù‡":["Ø£ Ø® Ø±","the Hereafter"],"Ø­Ø³Ù†Ù‡":["Ø­ Ø³ Ù†","goodness / a good deed"],"Ø®ÙŠØ±Ø§":["Ø® ÙŠ Ø±","good / goodness"],"Ø®ÙŠØ±":["Ø® ÙŠ Ø±","best / good"],"Ø§Ù…Ø±ÙŠ":["Ø£ Ù… Ø±","my affair"],"Ø§Ù„Ø§Ù…Ø±":["Ø£ Ù… Ø±","the matter / affair"],"Ø¹Ø¨Ø¯Ùƒ":["Ø¹ Ø¨ Ø¯","Your servant"],"Ø¹Ø¨Ø§Ø¯Ùƒ":["Ø¹ Ø¨ Ø¯","Your servants"],"Ø§Ø¨Ù†":["Ø¨ Ù† Ùˆ","son of"],"Ø§Ù…ØªÙƒ":["Ø£ Ù… Ùˆ","Your female servant"],"Ù†Ø§ØµÙŠØªÙŠ":["Ù† Øµ ÙŠ","my forelock"],"Ø¨Ù†Ø§ØµÙŠØªÙ‡":["Ù† Øµ ÙŠ","by his forelock"],"Ø¨ÙŠØ¯Ùƒ":["ÙŠ Ø¯ ÙŠ","in Your hand"],"Ø§Ù„Ø¬Ù†Ù‡":["Ø¬ Ù† Ù†","Paradise"],"Ø§Ù„Ø¬Ù„Ø§Ù„":["Ø¬ Ù„ Ù„","Majesty"],"Ø§Ù„Ø§ÙƒØ±Ø§Ù…":["Ùƒ Ø± Ù…","Honor / Generosity"],"Ø§Ù„Ø¹Ø±Ø´":["Ø¹ Ø± Ø´","the Throne"],"Ø§Ù„Ù‚Ø±Ø§Ù†":["Ù‚ Ø± Ø£","the Quran"],"Ø±Ø¨ÙŠØ¹":["Ø± Ø¨ Ø¹","spring / delight"],"Ù†ÙˆØ±":["Ù† Ùˆ Ø±","light"],"Ø¨Ù†ÙˆØ±":["Ù† Ùˆ Ø±","by the light of"],"Ù…Ù„Ø§Ø¡":["Ù… Ù„ Ø£","filling / fullness"],"Ø¯Ø¹Ø§Ø¡":["Ø¯ Ø¹ Ùˆ","supplication"],"Ø¯Ø¹ÙˆÙ‡":["Ø¯ Ø¹ Ùˆ","a supplication"],"Ø°Ø±ÙŠÙ‡":["Ø° Ø± Ø±","offspring / progeny"],"Ø°Ø±ÙŠØªÙŠ":["Ø° Ø± Ø±","my offspring"],"Ø·ÙŠØ¨Ù‡":["Ø· ÙŠ Ø¨","good / pure"],"ÙˆØ§Ù„Ø¯ÙŠ":["Ùˆ Ù„ Ø¯","my parents"],"Ø±Ø¨ÙŠØ§Ù†ÙŠ":["Ø± Ø¨ Ùˆ","they raised me"],"ØµØºÙŠØ±Ø§":["Øµ Øº Ø±","when I was small"],"ÙÙŠ":["â€”","in / within"],"Ù…Ù†":["â€”","from / of"],"Ø¹Ù†":["â€”","from / about"],"Ø¹Ù„Ù‰":["â€”","upon / on"],"Ø§Ù„Ù‰":["â€”","to / toward"],"Ø§Ù„ÙŠÙƒ":["â€”","to You"],"Ø§Ù„ÙŠÙ‡":["â€”","to him / it"],"Ø¨ÙŠÙ†":["â€”","between"],"Ø¨Ø¹Ø¯":["â€”","after"],"Ù‚Ø¨Ù„":["â€”","before"],"Ø¹Ù†Ø¯":["â€”","at / with"],"ÙÙˆÙ‚Ùƒ":["â€”","above You"],"Ø¯ÙˆÙ†Ùƒ":["â€”","besides You"],"Ù…Ø¹":["â€”","with"],"Ø¨Ù…Ø§":["â€”","with what / by what"],"Ù„Ù‡Ø§":["â€”","for it (f.)"],"Ù„Ù‡":["â€”","for him / to Him"],"Ù„Ù†Ø§":["â€”","for us"],"Ù„ÙŠ":["â€”","for me"],"Ù„Ùƒ":["â€”","for You / to You"],"Ø¨Ùƒ":["â€”","in You / by You"],"Ø¨Ù‡":["â€”","in it / by it"],"ÙÙŠÙ‡":["â€”","in it"],"ÙÙŠ":["â€”","in / concerning"],"Ø¹Ù„ÙŠÙ‡Ø§":["â€”","upon it (f.)"],"Ø¹Ù„ÙŠÙ†Ø§":["â€”","upon us"],"Ø¹Ù„ÙŠ":["â€”","upon me"],"Ø¹Ù†Ø§":["â€”","from us"],"Ø¹Ù†ÙŠ":["â€”","from me"],"Ø¹Ù†Ù‡":["â€”","from him / it"],"Ù…Ù†Ù‡":["â€”","from him / from it"],"Ø¨ÙŠ":["â€”","in me / with me"],"Ù„Ø§":["â€”","no / not"],"Ù„Ù…":["â€”","did not (past negation)"],"Ø§Ù†":["â€”","that / indeed"],"Ø§Ù†Ùƒ":["â€”","indeed You"],"Ø§Ù†ÙŠ":["â€”","indeed I"],"Ø§Ù†Ù‡":["â€”","indeed it / he"],"Ø¨Ø§Ù†":["â€”","because / that"],"Ø§Ø°Ø§":["â€”","when / if"],"Ø§Ø°":["â€”","when (past)"],"ÙƒÙ…Ø§":["â€”","just as / as"],"Ø§Ùˆ":["â€”","or"],"Ø«Ù…":["â€”","then"],"Ù…Ø§":["â€”","what / that which"],"Ù…Ù†":["â€”","who / whoever"],"Ø§Ù†Øª":["â€”","You (God)"],"Ø§Ù†Ø§":["â€”","I / me"],"Ù‡Ø°Ø§":["â€”","this"],"ÙƒÙ†Øª":["Ùƒ Ùˆ Ù†","I was / You were"],"ÙƒÙ†Ø§":["Ùƒ Ùˆ Ù†","we were"],"Ø§Ù„Ù‡Ù…":["Ù‡ Ù… Ù…","worry / anxiety"],"Ø§Ù„Ø­Ø²Ù†":["Ø­ Ø² Ù†","sadness / grief"],"Ø­Ø²Ù†ÙŠ":["Ø­ Ø² Ù†","my grief"],"Ù‡Ù…ÙŠ":["Ù‡ Ù… Ù…","my worry"],"Ø§Ù„Ø¹Ø¬Ø²":["Ø¹ Ø¬ Ø²","inability"],"Ø§Ù„ÙƒØ³Ù„":["Ùƒ Ø³ Ù„","laziness"],"Ø§Ù„Ø¨Ø®Ù„":["Ø¨ Ø® Ù„","stinginess"],"Ø§Ù„Ø¬Ø¨Ù†":["Ø¬ Ø¨ Ù†","cowardice"],"Ø§Ù„Ø¯ÙŠÙ†":["Ø¯ ÙŠ Ù†","the debt / religion"],"Ø¶Ù„Ø¹":["Ø¶ Ù„ Ø¹","burden of"],"ØºÙ„Ø¨Ù‡":["Øº Ù„ Ø¨","domination of / being overcome by"],"Ø§Ù„Ø±Ø¬Ø§Ù„":["Ø± Ø¬ Ù„","men / people"],"Ø§Ù„ÙÙ‚Ø±":["Ù Ù‚ Ø±","poverty"],"Ø·Ø§Ø¹ØªÙƒ":["Ø· Ùˆ Ø¹","Your obedience"],"Ø§Ù„Ù…Ø¹Ø§ØµÙŠ":["Ø¹ Øµ ÙŠ","sins / disobedience"],"ØªÙ‚ÙˆØ§Ù‡Ø§":["Ùˆ Ù‚ ÙŠ","its piety"],"Ø²ÙƒÙ‡Ø§":["Ø² Ùƒ Ùˆ","purify it"],"Ø²ÙƒØ§Ù‡Ø§":["Ø² Ùƒ Ùˆ","purified it"],"ÙˆÙ„ÙŠÙ‡Ø§":["Ùˆ Ù„ ÙŠ","its Guardian"],"Ù…ÙˆÙ„Ø§Ù‡Ø§":["Ùˆ Ù„ ÙŠ","its Protector"],"Ø§Ù„Ø¹Ø§ÙÙŠÙ‡":["Ø¹ Ù Ùˆ","wellbeing / safety"],"Ø§Ù„Ù…Ø¹Ø§ÙØ§Ù‡":["Ø¹ Ù Ùˆ","lasting wellbeing"],"Ø§Ù„Ø¯Ø§Ø¦Ù…Ù‡":["Ø¯ Ùˆ Ù…","the lasting / permanent"],"Ø§ØµØ¨Ø­Ù†Ø§":["Øµ Ø¨ Ø­","we have entered the morning"],"Ø§ØµØ¨Ø­":["Øµ Ø¨ Ø­","has entered the morning"],"Ø­Ø³Ø¨ÙŠ":["Ø­ Ø³ Ø¨","sufficient for me"],"ØªÙˆÙƒÙ„Øª":["Ùˆ Ùƒ Ù„","I have placed my trust"],"Ø§Ø³Ù„Ù…Øª":["Ø³ Ù„ Ù…","I have submitted"],"Ø§Ù…Ù†Øª":["Ø£ Ù… Ù†","I have believed"],"Ø§Ù†Ø¨Øª":["Ù† Ùˆ Ø¨","I have turned in repentance"],"Ø®Ø§ØµÙ…Øª":["Ø® Øµ Ù…","I have disputed"],"Ø­Ø§ÙƒÙ…Øª":["Ø­ Ùƒ Ù…","I have sought judgment"],"Ø±Ø¶ÙŠØª":["Ø± Ø¶ ÙŠ","I am pleased / I accept"],"Ø¨Ø§Ù„Ø§Ø³Ù„Ø§Ù…":["Ø³ Ù„ Ù…","with Islam"],"Ù…Ø­Ù…Ø¯":["Ø­ Ù… Ø¯","Muhammad ï·º"],"Ù†Ø¨ÙŠØ§":["Ù† Ø¨ Ø£","as a Prophet"],"Ø§Ù„":["â€”","family of"],"Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ…":["â€”","Ibrahim (Abraham)"],"Ø§Ù„Ø±Ø³ÙˆÙ„":["Ø± Ø³ Ù„","the Messenger"],"Ø±Ø³Ù„Ù‡":["Ø± Ø³ Ù„","His messengers"],"Ø§Ù„Ù…Ø¤Ù…Ù†ÙˆÙ†":["Ø£ Ù… Ù†","the believers"],"Ø§Ù„Ù…Ø¤Ù…Ù†ÙŠÙ†":["Ø£ Ù… Ù†","the believers"],"Ø³Ù…Ø¹Ù†Ø§":["Ø³ Ù… Ø¹","we hear / we heard"],"Ø§Ø·Ø¹Ù†Ø§":["Ø· Ùˆ Ø¹","we obey / we obeyed"],"Ø§Ù„Ù…ØµÙŠØ±":["Øµ ÙŠ Ø±","the destination / return"],"ÙŠÙƒÙ„Ù":["Ùƒ Ù„ Ù","burdens / charges"],"ÙˆØ³Ø¹Ù‡Ø§":["Ùˆ Ø³ Ø¹","its capacity"],"ÙƒØ³Ø¨Øª":["Ùƒ Ø³ Ø¨","it earned"],"Ø§ÙƒØªØ³Ø¨Øª":["Ùƒ Ø³ Ø¨","it has earned"],"ØªØ¤Ø§Ø®Ø°Ù†Ø§":["Ø£ Ø® Ø°","hold us accountable"],"Ù†Ø³ÙŠÙ†Ø§":["Ù† Ø³ ÙŠ","we forgot"],"Ø§Ø®Ø·Ø§Ù†Ø§":["Ø® Ø· Ø£","we erred"],"ØªØ­Ù…Ù„":["Ø­ Ù… Ù„","place / burden"],"Ø§ØµØ±Ø§":["Ø£ Øµ Ø±","a burden / hardship"],"Ø­Ù…Ù„ØªÙ‡":["Ø­ Ù… Ù„","You placed it"],"Ù‚Ø¨Ù„Ù†Ø§":["Ù‚ Ø¨ Ù„","before us"],"Ø·Ø§Ù‚Ù‡":["Ø· Ùˆ Ù‚","power / ability"],"Ø§Ø³ØªØ®ÙŠØ±Ùƒ":["Ø® ÙŠ Ø±","I seek Your guidance"],"Ø§Ø³ØªÙ‚Ø¯Ø±Ùƒ":["Ù‚ Ø¯ Ø±","I seek Your power"],"Ø¨Ù‚Ø¯Ø±ØªÙƒ":["Ù‚ Ø¯ Ø±","by Your power"],"ÙØ¶Ù„Ùƒ":["Ù Ø¶ Ù„","Your bounty"],"ØªÙ‚Ø¯Ø±":["Ù‚ Ø¯ Ø±","You have power"],"Ø§Ù‚Ø¯Ø±":["Ù‚ Ø¯ Ø±","I do not have power"],"ØªØ¹Ù„Ù…":["Ø¹ Ù„ Ù…","You know"],"Ø§Ø¹Ù„Ù…":["Ø¹ Ù„ Ù…","I know"],"Ù…Ø¹Ø§Ø´ÙŠ":["Ø¹ ÙŠ Ø´","my livelihood"],"Ø¹Ø§Ù‚Ø¨Ù‡":["Ø¹ Ù‚ Ø¨","consequence / end"],"ÙØ§Ù‚Ø¯Ø±Ù‡":["Ù‚ Ø¯ Ø±","then decree it"],"ÙØ§ØµØ±ÙÙ‡":["Øµ Ø± Ù","then turn it away"],"Ø§ØµØ±ÙÙ†ÙŠ":["Øµ Ø± Ù","turn me away"],"Ø®Ù„Ù‚ØªÙ†ÙŠ":["Ø® Ù„ Ù‚","You created me"],"Ø¹Ø¨Ø¯Ùƒ":["Ø¹ Ø¨ Ø¯","Your servant"],"Ø¹Ù‡Ø¯Ùƒ":["Ø¹ Ù‡ Ø¯","Your covenant"],"ÙˆØ¹Ø¯Ùƒ":["Ùˆ Ø¹ Ø¯","Your promise"],"Ø§Ø³ØªØ·Ø¹Øª":["Ø· Ùˆ Ø¹","I am able"],"ØµÙ†Ø¹Øª":["Øµ Ù† Ø¹","I have done"],"Ø§Ø¨ÙˆØ¡":["Ø¨ Ùˆ Ø£","I acknowledge"],"Ø¨Ù†Ø¹Ù…ØªÙƒ":["Ù† Ø¹ Ù…","Your favor / blessings"],"Ø¨ÙƒÙ„Ù…Ø§Øª":["Ùƒ Ù„ Ù…","by the words of"],"Ø§Ù„ØªØ§Ù…Ø§Øª":["Øª Ù… Ù…","the perfect (words)"],"ÙŠØ¶Ø±":["Ø¶ Ø± Ø±","harms"],"Ø§Ø³Ù…Ù‡":["Ø³ Ù… Ùˆ","His name"],"Ø§Ø³Ù…":["Ø³ Ù… Ùˆ","a name"],"Ø³Ù…ÙŠØª":["Ø³ Ù… Ùˆ","You named"],"ÙØªÙ†Ù‡":["Ù Øª Ù†","trial / tribulation"],"Ø§Ù„Ù…Ø­ÙŠØ§":["Ø­ ÙŠ ÙŠ","life"],"Ø§Ù„Ù…Ù…Ø§Øª":["Ù… Ùˆ Øª","death"],"Ø§Ù„Ù…Ø³ÙŠØ­":["Ù… Ø³ Ø­","the Messiah"],"Ø§Ù„Ø¯Ø¬Ø§Ù„":["Ø¯ Ø¬ Ù„","the Antichrist (Dajjal)"],"Ø§Ù„Ù‚Ø¨Ø±":["Ù‚ Ø¨ Ø±","the grave"],"Ø§Ù„Ø®Ø¨Ø«":["Ø® Ø¨ Ø«","male evil (jinn)"],"Ø§Ù„Ø®Ø¨Ø§Ø¦Ø«":["Ø® Ø¨ Ø«","female evil (jinn)"],"Ù…Ø­Ù…Ø¯":["Ø­ Ù… Ø¯","Muhammad ï·º"],"Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ…":["â€”","Ibrahim (Abraham) ï·º"],"Ø§Ù„Ø³Ø¨Ø¹":["Ø³ Ø¨ Ø¹","the seven"],"Ø§Ù„ØªÙˆØ±Ø§Ù‡":["â€”","the Torah"],"Ø§Ù„Ø§Ù†Ø¬ÙŠÙ„":["â€”","the Gospel (Injeel)"],"Ø§Ù„ÙØ±Ù‚Ø§Ù†":["Ù Ø± Ù‚","the Criterion (Quran)"],"ÙØ§Ù„Ù‚":["Ù Ù„ Ù‚","Splitter / Cleaver of"],"Ø§Ù„Ø­Ø¨":["Ø­ Ø¨ Ø¨","the seed"],"Ø§Ù„Ù†ÙˆÙ‰":["Ù† Ùˆ ÙŠ","the date-stone"],"Ø³Ø¨Ø­Ø§Ù†Ùƒ":["Ø³ Ø¨ Ø­","Glory be to You"],"Ø³Ø¨Ø­Ø§Ù†":["Ø³ Ø¨ Ø­","Glory be to"],"Ø§Ù„Ø¸Ø§Ù„Ù…ÙŠÙ†":["Ø¸ Ù„ Ù…","the wrongdoers"],"Ø¸Ù„Ù…Ù†Ø§":["Ø¸ Ù„ Ù…","we have wronged"],"Ø²Ø¯Ù†ÙŠ":["Ø² ÙŠ Ø¯","increase me"],"Ù†Ø§ÙØ¹Ø§":["Ù† Ù Ø¹","beneficial"],"ÙŠÙ†ÙØ¹":["Ù† Ù Ø¹","benefits"],"ÙŠØ®Ø´Ø¹":["Ø® Ø´ Ø¹","is humbled"],"ØªØ´Ø¨Ø¹":["Ø´ Ø¨ Ø¹","is satisfied"],"ÙŠØ³ØªØ¬Ø§Ø¨":["Ø¬ Ùˆ Ø¨","is answered"],"Ø±Ø²Ù‚Ø§":["Ø± Ø² Ù‚","provision"],"Ø·ÙŠØ¨Ø§":["Ø· ÙŠ Ø¨","good / pure"],"Ø¹Ù…Ù„Ø§":["Ø¹ Ù… Ù„","a deed"],"Ù…ØªÙ‚Ø¨Ù„Ø§":["Ù‚ Ø¨ Ù„","accepted"],"Ù…Ù‚ÙŠÙ…":["Ù‚ Ùˆ Ù…","establisher of"],"ØªÙ‚Ø¨Ù„":["Ù‚ Ø¨ Ù„","accept"],"ØµØ§Ù„Ø­Ø§":["Øµ Ù„ Ø­","righteous (deed)"],"Ø§Ù„ØµØ§Ù„Ø­ÙŠÙ†":["Øµ Ù„ Ø­","the righteous"],"ØªØ±Ø¶Ø§Ù‡":["Ø± Ø¶ ÙŠ","that pleases You"],"Ø§Ø¯Ø®Ù„Ù†ÙŠ":["Ø¯ Ø® Ù„","admit me"],"Ø§ÙˆØ²Ø¹Ù†ÙŠ":["Ùˆ Ø² Ø¹","inspire me"],"Ø§Ø´ÙƒØ±":["Ø´ Ùƒ Ø±","to be grateful"],"Ù†Ø¹Ù…ØªÙƒ":["Ù† Ø¹ Ù…","Your blessing"],"Ø§Ù„Ø¶Ø±":["Ø¶ Ø± Ø±","the affliction / harm"],"Ù…Ø³Ù†ÙŠ":["Ù… Ø³ Ø³","has afflicted me"],"Ø³Ù‚Ù…Ø§":["Ø³ Ù‚ Ù…","sickness"],"ÙŠØºØ§Ø¯Ø±":["Øº Ø¯ Ø±","leaves behind"],"Ù…Ø°Ù‡Ø¨":["Ø° Ù‡ Ø¨","Remover of"],"Ø§Ù„Ø¨Ø§Ø³":["Ø¨ Ø£ Ø³","the suffering / hardship"],"ÙŠÙÙ‚Ù‡ÙˆØ§":["Ù Ù‚ Ù‡","they understand"],"Ù‚ÙˆÙ„ÙŠ":["Ù‚ Ùˆ Ù„","my speech"],"Ù‚ÙˆÙ„":["Ù‚ Ùˆ Ù„","a saying / word"],"Ø¹Ù…Ù„":["Ø¹ Ù… Ù„","a deed"],"Ø­Ø³Ù†Øª":["Ø­ Ø³ Ù†","You have made good"],"Ø®Ù„Ù‚ÙŠ":["Ø® Ù„ Ù‚","my creation / form"],"ÙØ­Ø³Ù†":["Ø­ Ø³ Ù†","so make good"],"Ø®Ù„Ù‚ÙŠ":["Ø® Ù„ Ù‚","my character"],"Ø¨Ø­Ù„Ø§Ù„Ùƒ":["Ø­ Ù„ Ù„","with Your lawful"],"Ø­Ø±Ø§Ù…Ùƒ":["Ø­ Ø± Ù…","Your unlawful"],"Ø§ØºÙ†Ù†ÙŠ":["Øº Ù† ÙŠ","enrich me / make me free of need"],"Ø³ÙˆØ§Ùƒ":["Ø³ Ùˆ ÙŠ","other than You"],"Ø³Ù‡Ù„Ø§":["Ø³ Ù‡ Ù„","easy"],"Ø³Ù‡Ù„":["Ø³ Ù‡ Ù„","easy / there is no ease"],"Ø´Ø¦Øª":["Ø´ ÙŠ Ø£","You will / wish"],"ÙˆØ­Ø¯Ù‡":["Ùˆ Ø­ Ø¯","alone / uniquely"],"Ø´Ø±ÙŠÙƒ":["Ø´ Ø± Ùƒ","partner"],"ÙƒÙ„":["Ùƒ Ù„ Ù„","every / all"],"ÙƒÙ„Ù‡":["Ùƒ Ù„ Ù„","all of it"],"Ø¯Ù‚Ù‡":["Ø¯ Ù‚ Ù‚","its minor"],"Ø¬Ù„Ù‡":["Ø¬ Ù„ Ù„","its major"],"Ø§ÙˆÙ„Ù‡":["Ø£ Ùˆ Ù„","its first"],"Ø§Ø®Ø±Ù‡":["Ø£ Ø® Ø±","its last"],"Ø¹Ù„Ø§Ù†ÙŠØªÙ‡":["Ø¹ Ù„ Ù†","its open / public"],"Ø³Ø±Ù‡":["Ø³ Ø± Ø±","its secret"],"Ù‚Ø¯Ù…Øª":["Ù‚ Ø¯ Ù…","I have put forward"],"Ø§Ø®Ø±Øª":["Ø£ Ø® Ø±","I delayed"],"Ø§Ø³Ø±Ø±Øª":["Ø³ Ø± Ø±","I concealed"],"Ø§Ø¹Ù„Ù†Øª":["Ø¹ Ù„ Ù†","I declared"],"Ø§Ø´Ù‡Ø¯":["Ø´ Ù‡ Ø¯","I testify / bear witness"],"ÙƒØªØ§Ø¨Ùƒ":["Ùƒ Øª Ø¨","Your Book"],"ÙƒØªØ¨Ù‡":["Ùƒ Øª Ø¨","His books"],"Ù…Ù„Ø§Ø¦ÙƒØªÙ‡":["Ù… Ù„ Ùƒ","His angels"],"Ù†ÙØ±Ù‚":["Ù Ø± Ù‚","we differentiate"],"ØªÙˆÙØ§Ù‡Ø§":["Ùˆ Ù ÙŠ","You take its soul"],"Ø§Ø­ÙŠÙŠØªÙ‡Ø§":["Ø­ ÙŠ ÙŠ","You give it life"],"ÙØ§Ø­ÙØ¸Ù‡Ø§":["Ø­ Ù Ø¸","then protect it"],"Ø§Ù…ØªÙ‡Ø§":["Ù… Ùˆ Øª","You cause it to die"],"Ù…Ù…Ø§ØªÙ‡Ø§":["Ù… Ùˆ Øª","its death"],"Ù…Ø­ÙŠØ§Ù‡Ø§":["Ø­ ÙŠ ÙŠ","its life"],"Ø®Ù„Ù‚Ùƒ":["Ø® Ù„ Ù‚","Your creation"],"Ø¨Ø§Ù‚ÙŠØªÙ†ÙŠ":["Ø¨ Ù‚ ÙŠ","You keep me alive"],"Ø§Ø¨Ù‚ÙŠØªÙ†ÙŠ":["Ø¨ Ù‚ ÙŠ","You keep me alive"],"Ø­ÙƒÙ…Ùƒ":["Ø­ Ùƒ Ù…","Your decree"],"Ù‚Ø¶Ø§Ø¤Ùƒ":["Ù‚ Ø¶ ÙŠ","Your judgment"],"Ù…Ø§Ø¶":["Ù… Ø¶ ÙŠ","executed / enacted"],"Ø§Ø³ØªØ§Ø«Ø±Øª":["Ø£ Ø« Ø±","You kept exclusively"],"Ø§Ù†Ø²Ù„ØªÙ‡":["Ù† Ø² Ù„","You revealed it"],"Ø§Ù†Ø²Ù„":["Ù† Ø² Ù„","was revealed"],"Ø¬Ù„Ø§Ø¡":["Ø¬ Ù„ Ùˆ","removal / departure of"],"Ø°Ù‡Ø§Ø¨":["Ø° Ù‡ Ø¨","going away of"],"Ù…ÙˆÙ„Ø§Ù†Ø§":["Ùˆ Ù„ ÙŠ","our Protector"],"Ø§Ù‚Ø¯Ø§Ù…Ù†Ø§":["Ù‚ Ø¯ Ù…","our feet"],"Ø§Ù„ÙƒØ§ÙØ±ÙŠÙ†":["Ùƒ Ù Ø±","the disbelievers"],"Ø§Ù„Ù‚ÙˆÙ…":["Ù‚ Ùˆ Ù…","the people"],"Ø§Ù„Ù…Ø³ØªØ¶Ø¹ÙÙŠÙ†":["Ø¶ Ø¹ Ù","the oppressed / weak"],"Ù„Ù…Ù†Ù‚Ù„Ø¨ÙˆÙ†":["Ù‚ Ù„ Ø¨","surely returning"],"ØªÙƒÙ„Ù†ÙŠ":["Ùˆ Ùƒ Ù„","leave me to"],"Ø·Ø±ÙÙ‡":["Ø· Ø± Ù","blink of"],"Ø¹ÙŠÙ†":["Ø¹ ÙŠ Ù†","an eye"],"Ø´Ø§Ù†ÙŠ":["Ø´ Ø£ Ù†","my affairs / condition"],"Ø§ØµÙ„Ø­":["Øµ Ù„ Ø­","rectify / set right"],"ÙŠØ¹Ù†ÙŠÙ†ÙŠ":["Ø¹ Ù† ÙŠ","concerns me"],"Ø­Ø³Ù†":["Ø­ Ø³ Ù†","excellence / beauty of"],"Ø³Ø®Ø·Ùƒ":["Ø³ Ø® Ø·","Your displeasure"],"ØºØ¶Ø¨Ùƒ":["Øº Ø¶ Ø¨","Your anger"],"Ø¹Ø§ÙÙŠØªÙƒ":["Ø¹ Ù Ùˆ","Your protection"],"Ø¹Ù‚ÙˆØ¨ØªÙƒ":["Ø¹ Ù‚ Ø¨","Your punishment"],"Ø§Ù„Ø¹ØªØ¨Ù‰":["Ø¹ Øª Ø¨","appeasement / making amends"],"Ø§Ø­ØµÙŠ":["Ø­ Øµ ÙŠ","enumerate / count"],"Ø«Ù†Ø§Ø¡":["Ø« Ù† ÙŠ","praise"],"Ø§Ø«Ù†ÙŠ":["Ø« Ù† ÙŠ","I praise"],"ÙˆÙ‡Ùˆ":["â€”","and He is"],"ÙØ§Ù†Ù‡":["â€”","for indeed it"],"ÙØ§Ù†Ùƒ":["â€”","for indeed You"]};function stripDiacritics(e){return e.replace(/[\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06ED\uFE70-\uFE7F]/g,"").replace(/\u0671/g,"Ø§").replace(/Ù°/g,"").replace(/Ù‰/g,"ÙŠ").replace(/Ø©/g,"Ù‡").replace(/Ø¤/g,"Ùˆ").replace(/Ø¦/g,"ÙŠ").replace(/Ø£|Ø¥|Ø¢/g,"Ø§").trim()}function lookupWord(e){const t=e.replace(/[ÛÛšÛ–Û—ØŒ,\.]/g,"").trim();if(!t)return null;const n=stripDiacritics(t);if(ARABIC_DICT[n])return{word:t,root:ARABIC_DICT[n][0],meaning:ARABIC_DICT[n][1]};if(n.startsWith("Ùˆ")&&n.length>2){const e=n.slice(1);if(ARABIC_DICT[e])return{word:t,root:ARABIC_DICT[e][0],meaning:"and "+ARABIC_DICT[e][1]}}if(n.startsWith("Ù")&&n.length>2){const e=n.slice(1);if(ARABIC_DICT[e])return{word:t,root:ARABIC_DICT[e][0],meaning:"so "+ARABIC_DICT[e][1]}}for(const e of["Ø¨Ø§Ù„","ÙˆØ§Ù„","Ù„Ù„","Ø§Ù„","Ø¨","Ù„","Ùƒ"])if(n.startsWith(e)&&n.length>e.length+1){const a=n.slice(e.length);if(ARABIC_DICT[a]){let n="Ø¨"===e?"by/with ":"Ù„"===e?"for/to ":"Ùƒ"===e?"like ":"";return{word:t,root:ARABIC_DICT[a][0],meaning:n+ARABIC_DICT[a][1]}}}return{word:t,root:null,meaning:null}}let wordPopup=null,activeWordSpan=null;function createWordPopup(){wordPopup=document.createElement("div"),wordPopup.className="word-popup",wordPopup.innerHTML='\n            <div class="word-popup-arrow arrow-bottom"></div>\n            <div class="word-popup-arabic"></div>\n            <div class="word-popup-divider"></div>\n            <div class="word-popup-root-label">ROOT LETTERS</div>\n            <div class="word-popup-root"></div>\n            <div class="word-popup-divider"></div>\n            <div class="word-popup-meaning"></div>\n        ',document.body.appendChild(wordPopup)}function showWordPopup(e,t){wordPopup||createWordPopup(),activeWordSpan&&activeWordSpan.classList.remove("active-word"),activeWordSpan=e,e.classList.add("active-word");const n=wordPopup.querySelector(".word-popup-arabic"),a=wordPopup.querySelector(".word-popup-root"),r=wordPopup.querySelector(".word-popup-root-label"),o=wordPopup.querySelector(".word-popup-meaning"),i=wordPopup.querySelector(".word-popup-arrow");n.textContent=t.word,t.root&&"â€”"!==t.root?(r.style.display="",a.style.display="",a.textContent=t.root,a.previousElementSibling.style.display=""):(r.style.display="none",a.style.display="none",a.previousElementSibling.style.display="none"),t.meaning?(o.style.display="",o.textContent=t.meaning,o.previousElementSibling.style.display=""):(o.style.display="none",o.previousElementSibling.style.display="none"),wordPopup.classList.remove("visible"),wordPopup.style.left="0",wordPopup.style.top="0",wordPopup.style.display="block",requestAnimationFrame(()=>{const t=e.getBoundingClientRect(),n=wordPopup.getBoundingClientRect(),a=window.innerWidth;window.innerHeight;let r=t.left+t.width/2-n.width/2;r=Math.max(8,Math.min(r,a-n.width-8));let o=t.top-n.height-10,s=!1;o<8&&(o=t.bottom+10,s=!0),i.className=s?"word-popup-arrow arrow-top":"word-popup-arrow arrow-bottom";const l=t.left+t.width/2-r;i.style.left=Math.max(16,Math.min(l,n.width-16))+"px",wordPopup.style.left=r+"px",wordPopup.style.top=o+"px",wordPopup.classList.add("visible")})}function dismissWordPopup(){wordPopup&&wordPopup.classList.remove("visible"),activeWordSpan&&(activeWordSpan.classList.remove("active-word"),activeWordSpan=null)}function wrapArabicWords(){document.querySelectorAll(".arabic-text").forEach(e=>{if(e.hasAttribute("lang")||e.setAttribute("lang","ar"),e.hasAttribute("dir")||e.setAttribute("dir","rtl"),e.dataset.wordsWrapped)return;const t=e.textContent.split(/(\s+)/);e.innerHTML="",t.forEach(t=>{if(/^\s+$/.test(t))return void e.appendChild(document.createTextNode(t));if(!t.replace(/[ÛÛšÛ–Û—]/g,"").trim())return void e.appendChild(document.createTextNode(t));const n=document.createElement("span");n.className="arabic-word",n.textContent=t,n.addEventListener("click",function(e){e.stopPropagation();const t=lookupWord(this.textContent);t&&showWordPopup(this,t)}),e.appendChild(n)}),e.dataset.wordsWrapped="1"})}document.addEventListener("click",function(e){!wordPopup||wordPopup.contains(e.target)||e.target.classList.contains("arabic-word")||dismissWordPopup()}),window.addEventListener("scroll",dismissWordPopup,{passive:!0});const PRAYER_NAMES=["fajr","sunrise","dhuhr","asr","maghrib","isha"],REMINDER_PRAYERS=["fajr","dhuhr","asr","maghrib","isha"],REMINDER_AUDIO_FILES={adhan:"audio/adhan-alert.wav",tone:"audio/notification-tone.wav"},REMINDER_SOUND_OPTIONS=[{id:"adhan_mishary",labelEn:"Full Adhan â€” Mishary Rashid Alafasy",labelPs:"Ø¨Ø´Ù¾Ú“ Ø§Ø°Ø§Ù† â€” Ù…Ø´Ø§Ø±ÙŠ Ø±Ø§Ø´Ø¯ Ø§Ù„Ø¹ÙØ§Ø³ÙŠ",file:"audio/reminders/adhan-mishary.mp3"},{id:"adhan_abdulbasit",labelEn:"Full Adhan â€” Abdul Basit",labelPs:"Ø¨Ø´Ù¾Ú“ Ø§Ø°Ø§Ù† â€” Ø¹Ø¨Ø¯Ø§Ù„Ø¨Ø§Ø³Ø·",file:"audio/reminders/adhan-abdulbasit.mp3"},{id:"adhan_short",labelEn:"Short Adhan â€” Allahu Akbar",labelPs:"Ù„Ù†Ú‰ Ø§Ø°Ø§Ù† â€” Ø§Ù„Ù„Ù‡ Ø§Ú©Ø¨Ø±",file:"audio/reminders/adhan-short.mp3"},{id:"takbeer",labelEn:"Takbeer â€” Allahu Akbar repeat",labelPs:"ØªÚ©Ø¨ÛŒØ± â€” Ø§Ù„Ù„Ù‡ Ø§Ú©Ø¨Ø± ØªÚ©Ø±Ø§Ø±",file:"audio/reminders/takbeer.mp3"},{id:"nasheed_soft",labelEn:"Soft Islamic Nasheed tone",labelPs:"Ù†Ø±Ù… Ø§Ø³Ù„Ø§Ù…ÙŠ Ù†Ø´ÛŒØ¯ ØºÚ–",file:"audio/reminders/nasheed-soft.mp3"},{id:"bell_chime",labelEn:"Simple Bell / Chime",labelPs:"Ø³Ø§Ø¯Ù‡ Ø²Ù†Ú« / Ú†Ø§ÛŒÙ…",file:"audio/reminders/bell-chime.mp3"},{id:"soft_ding",labelEn:"Soft Ding",labelPs:"Ù†Ø±Ù… Ú‰ÛŒÙ†Ú«",file:"audio/reminders/soft-ding.mp3"},{id:"silent",labelEn:"Silent â€” notification only",labelPs:"Ø¨Û ØºÚ–Ù‡ â€” ÛŒÙˆØ§Ø²Û Ø®Ø¨Ø±ØªÛŒØ§",file:null}],PRAYER_LABELS_EN={fajr:"Fajr",sunrise:"Sunrise",dhuhr:"Dhuhr",asr:"Asr",maghrib:"Maghrib",isha:"Isha"},PRAYER_LABELS_PS={fajr:"Ø³Ù‡Ø§Ø±",sunrise:"Ù„Ù…Ø± Ø®ØªÙ„",dhuhr:"ØºØ±Ù…Ù‡",asr:"Ù…Ø§Ø²Ø¯ÙŠÚ«Ø±",maghrib:"Ù…Ø§ÚšØ§Ù…",isha:"Ù…Ø§Ø®Ø³ØªÙ†"},PRAYER_ICONS={fajr:"ğŸŒ…",sunrise:"â˜€ï¸",dhuhr:"ğŸ•›",asr:"ğŸŒ¤",maghrib:"ğŸŒ‡",isha:"ğŸŒ™"},KAABA_LAT=21.4225,KAABA_LNG=39.8262,AFGHAN_CITIES=[{key:"kabul",en:"Kabul",ps:"Ú©Ø§Ø¨Ù„",lat:34.5553,lng:69.2075},{key:"kandahar",en:"Kandahar",ps:"Ú©Ù†Ø¯Ù‡Ø§Ø±",lat:31.6133,lng:65.7101},{key:"herat",en:"Herat",ps:"Ù‡Ø±Ø§Øª",lat:34.3529,lng:62.204},{key:"mazar-i-sharif",en:"Mazar-i-Sharif",ps:"Ù…Ø²Ø§Ø± Ø´Ø±ÛŒÙ",lat:36.7069,lng:67.1104},{key:"jalalabad",en:"Jalalabad",ps:"Ø¬Ù„Ø§Ù„ Ø¢Ø¨Ø§Ø¯",lat:34.4253,lng:70.4528},{key:"kunduz",en:"Kunduz",ps:"Ú©Ù†Ø¯Ø²",lat:36.728,lng:68.868},{key:"lashkar-gah",en:"Lashkar Gah",ps:"Ù„ÚšÚ©Ø±Ú«Ø§Ù‡",lat:31.593,lng:64.37},{key:"ghazni",en:"Ghazni",ps:"ØºØ²Ù†ÙŠ",lat:33.5536,lng:68.427},{key:"khost",en:"Khost",ps:"Ø®ÙˆØ³Øª",lat:33.3386,lng:69.9203},{key:"gardez",en:"Gardez",ps:"Ú«Ø±Ø¯ÛØ²",lat:33.5973,lng:69.2215},{key:"faizabad",en:"Faizabad",ps:"ÙÛŒØ¶ Ø¢Ø¨Ø§Ø¯",lat:37.1164,lng:70.5787},{key:"pul-e-khumri",en:"Pul-e-Khumri",ps:"Ù¾Ù„Ø®Ù…Ø±ÙŠ",lat:35.9486,lng:68.7139},{key:"sheberghan",en:"Sheberghan",ps:"Ø´Ø¨Ø±ØºØ§Ù†",lat:36.6675,lng:65.7541},{key:"taloqan",en:"Taloqan",ps:"ØªØ§Ù„Ù‚Ø§Ù†",lat:36.736,lng:69.5345},{key:"zaranj",en:"Zaranj",ps:"Ø²Ø±Ù†Ø¬",lat:30.96,lng:61.861},{key:"bamyan",en:"Bamyan",ps:"Ø¨Ø§Ù…ÛŒØ§Ù†",lat:34.821,lng:67.831},{key:"mehtarlam",en:"Mehtarlam",ps:"Ù…Ù‡ØªØ±Ù„Ø§Ù…",lat:34.6531,lng:70.2097},{key:"asadabad",en:"Asadabad",ps:"Ø§Ø³Ø¹Ø¯ Ø¢Ø¨Ø§Ø¯",lat:34.866,lng:71.1497},{key:"charikar",en:"Charikar",ps:"Ú†Ø§Ø±ÛŒÚ©Ø§Ø±",lat:35.0146,lng:69.1723},{key:"farah",en:"Farah",ps:"ÙØ±Ø§Ù‡",lat:32.3735,lng:62.1116},{key:"samangan",en:"Samangan",ps:"Ø³Ù…Ù†Ú¯Ø§Ù†",lat:36.3165,lng:68.0196},{key:"nili",en:"Nili",ps:"Ù†ÛŒÙ„ÙŠ",lat:33.7222,lng:66.1308},{key:"tarinkot",en:"Tarinkot",ps:"ØªØ±ÛŒÙ†Ú©ÙˆÙ¼",lat:32.6271,lng:65.8783},{key:"maidan-wardak",en:"Maidan Wardak",ps:"Ù…ÙŠØ¯Ø§Ù† ÙˆØ±Ø¯Ú«",lat:34.3955,lng:68.353}],CITY_META={kabul:{provinceEn:"Kabul",provincePs:"Ú©Ø§Ø¨Ù„",regionEn:"Central",regionPs:"Ù…Ø±Ú©Ø²ÙŠ"},kandahar:{provinceEn:"Kandahar",provincePs:"Ú©Ù†Ø¯Ù‡Ø§Ø±",regionEn:"South",regionPs:"Ø³ÙˆÛÙ„"},herat:{provinceEn:"Herat",provincePs:"Ù‡Ø±Ø§Øª",regionEn:"West",regionPs:"Ù„ÙˆÛØ¯ÛŒÚ"},"mazar-i-sharif":{provinceEn:"Balkh",provincePs:"Ø¨Ù„Ø®",regionEn:"North",regionPs:"Ø´Ù…Ø§Ù„"},jalalabad:{provinceEn:"Nangarhar",provincePs:"Ù†Ù†Ú«Ø±Ù‡Ø§Ø±",regionEn:"East",regionPs:"Ø®ØªÛŒÚ"},kunduz:{provinceEn:"Kunduz",provincePs:"Ú©Ù†Ø¯Ø²",regionEn:"North",regionPs:"Ø´Ù…Ø§Ù„"},"lashkar-gah":{provinceEn:"Helmand",provincePs:"Ù‡Ù„Ù…Ù†Ø¯",regionEn:"Southwest",regionPs:"Ø³ÙˆÛÙ„ Ù„ÙˆÛØ¯ÛŒÚ"},ghazni:{provinceEn:"Ghazni",provincePs:"ØºØ²Ù†ÙŠ",regionEn:"Southeast",regionPs:"Ø³ÙˆÛÙ„ Ø®ØªÛŒÚ"},khost:{provinceEn:"Khost",provincePs:"Ø®ÙˆØ³Øª",regionEn:"Southeast",regionPs:"Ø³ÙˆÛÙ„ Ø®ØªÛŒÚ"},gardez:{provinceEn:"Paktia",provincePs:"Ù¾Ú©ØªÛŒØ§",regionEn:"Southeast",regionPs:"Ø³ÙˆÛÙ„ Ø®ØªÛŒÚ"},faizabad:{provinceEn:"Badakhshan",provincePs:"Ø¨Ø¯Ø®Ø´Ø§Ù†",regionEn:"Northeast",regionPs:"Ø´Ù…Ø§Ù„ Ø®ØªÛŒÚ"},"pul-e-khumri":{provinceEn:"Baghlan",provincePs:"Ø¨ØºÙ„Ø§Ù†",regionEn:"North",regionPs:"Ø´Ù…Ø§Ù„"},sheberghan:{provinceEn:"Jawzjan",provincePs:"Ø¬ÙˆØ²Ø¬Ø§Ù†",regionEn:"Northwest",regionPs:"Ø´Ù…Ø§Ù„ Ù„ÙˆÛØ¯ÛŒÚ"},taloqan:{provinceEn:"Takhar",provincePs:"ØªØ®Ø§Ø±",regionEn:"Northeast",regionPs:"Ø´Ù…Ø§Ù„ Ø®ØªÛŒÚ"},zaranj:{provinceEn:"Nimruz",provincePs:"Ù†ÛŒÙ…Ø±ÙˆØ²",regionEn:"Southwest",regionPs:"Ø³ÙˆÛÙ„ Ù„ÙˆÛØ¯ÛŒÚ"},bamyan:{provinceEn:"Bamyan",provincePs:"Ø¨Ø§Ù…ÛŒØ§Ù†",regionEn:"Central Highlands",regionPs:"Ù…Ø±Ú©Ø²ÙŠ Ù„ÙˆÚ“Û Ø³ÛŒÙ…Û"},mehtarlam:{provinceEn:"Laghman",provincePs:"Ù„ØºÙ…Ø§Ù†",regionEn:"East",regionPs:"Ø®ØªÛŒÚ"},asadabad:{provinceEn:"Kunar",provincePs:"Ú©Ù†Ú“",regionEn:"East",regionPs:"Ø®ØªÛŒÚ"},charikar:{provinceEn:"Parwan",provincePs:"Ù¾Ø±ÙˆØ§Ù†",regionEn:"Central",regionPs:"Ù…Ø±Ú©Ø²ÙŠ"},farah:{provinceEn:"Farah",provincePs:"ÙØ±Ø§Ù‡",regionEn:"West",regionPs:"Ù„ÙˆÛØ¯ÛŒÚ"},samangan:{provinceEn:"Samangan",provincePs:"Ø³Ù…Ù†Ú¯Ø§Ù†",regionEn:"North",regionPs:"Ø´Ù…Ø§Ù„"},nili:{provinceEn:"Daykundi",provincePs:"Ø¯Ø§ÛŒÚ©Ù†Ø¯ÙŠ",regionEn:"Central Highlands",regionPs:"Ù…Ø±Ú©Ø²ÙŠ Ù„ÙˆÚ“Û Ø³ÛŒÙ…Û"},tarinkot:{provinceEn:"Uruzgan",provincePs:"Ø§Ø±ÙˆØ²Ú«Ø§Ù†",regionEn:"South",regionPs:"Ø³ÙˆÛÙ„"},"maidan-wardak":{provinceEn:"Maidan Wardak",provincePs:"Ù…ÛŒØ¯Ø§Ù† ÙˆØ±Ø¯Ú«",regionEn:"Central",regionPs:"Ù…Ø±Ú©Ø²ÙŠ"}};let prayerTimesData=null,countdownInterval=null,compassWatchId=null,userQibla=null,reminderSettings=null,reminderAudio={},reminderPreviewAudio=null,reminderPreviewButton=null,reminderMidnightTimer=null,dailyReminderRescheduleTimeout=null,isGpsResolving=!1,detectedGpsCityKey=null,compassEventTimer=null,latestCompassHeading=null,currentNeedleRotation=0;function escapeHtml(e){return String(e||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function normalizeCityText(e){return String(e||"").toLowerCase().replace(/[-_]/g," ").replace(/\s+/g," ").trim()}function getCityMeta(e){const t={provinceEn:e.en,provincePs:e.ps||e.en,regionEn:"Afghanistan",regionPs:"Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†"};return CITY_META[e.key]||t}function highlightMatch(e,t){const n=String(e||""),a=String(t||"").trim();if(!a)return escapeHtml(n);const r=n.toLowerCase(),o=a.toLowerCase(),i=r.indexOf(o);if(-1===i)return escapeHtml(n);return`${escapeHtml(n.slice(0,i))}<mark class="city-match">${escapeHtml(n.slice(i,i+a.length))}</mark>${escapeHtml(n.slice(i+a.length))}`}function findCityMatches(e){const t=normalizeCityText(e);return t?AFGHAN_CITIES.map(e=>{const n=getCityMeta(e);return{city:e,score:[normalizeCityText(e.en),normalizeCityText(e.ps),normalizeCityText(e.key),normalizeCityText(n.provinceEn),normalizeCityText(n.provincePs),normalizeCityText(n.regionEn),normalizeCityText(n.regionPs)].map(e=>{if(e===t)return 0;if(e.startsWith(t))return 1;const n=e.indexOf(t);return n>=0?2+n/100:Number.POSITIVE_INFINITY}).sort((e,t)=>e-t)[0]}}).filter(e=>Number.isFinite(e.score)).sort((e,t)=>e.score-t.score).map(e=>e.city):AFGHAN_CITIES.slice()}function preloadPrayerReminderAudio(){REMINDER_SOUND_OPTIONS.forEach(e=>{if(!e.file||reminderAudio[e.id])return;const t=new Audio(e.file);t.preload="metadata",reminderAudio[e.id]=t}),window.reminderAudio=reminderAudio}function playReminderAudioOption(e,{isPreview:t=!1}={}){const n=getReminderSoundOption(e);if(!n||!n.file||"silent"===n.id)return null;if(t){const e=new Audio(n.file);return e.preload="auto",e.currentTime=0,e.play().catch(e=>{console.error("[ReminderAudio] preview play failed",{soundId:n.id,isPreview:t,error:e})}),e}reminderAudio[n.id]||(reminderAudio[n.id]=new Audio(n.file),reminderAudio[n.id].preload="auto");const a=reminderAudio[n.id];try{a.currentTime=0;const e=a.play();return e&&"function"==typeof e.catch&&e.catch(e=>{console.error("[ReminderAudio] play failed",{soundId:n.id,isPreview:t,error:e})}),a}catch(e){return console.error("[ReminderAudio] play failed (sync)",{soundId:n.id,isPreview:t,error:e}),null}}function getReminderSoundOption(e){return REMINDER_SOUND_OPTIONS.find(t=>t.id===e)||REMINDER_SOUND_OPTIONS[0]}function getReminderSoundLabel(e){const t=getReminderSoundOption(e);return isPashtoMode()?t.labelPs:t.labelEn}function renderReminderSoundCards(){const e=document.getElementById("reminderSoundCards");if(!e)return;const t=loadReminderSettings();e.innerHTML=REMINDER_SOUND_OPTIONS.map(e=>`\n                <div class="reminder-sound-card ${t.soundId===e.id?"active":""}" data-sound-id="${e.id}" role="button" tabindex="0" aria-label="${escapeHtml(getReminderSoundLabel(e.id))}" onclick="selectReminderSoundOption('${e.id}')">\n                    <span class="reminder-sound-radio" aria-hidden="true"></span>\n                    <span class="reminder-sound-name">${escapeHtml(getReminderSoundLabel(e.id))}</span>\n                    <button type="button" class="reminder-sound-preview" data-preview-sound="${e.id}" ${e.file?"":"disabled"} onclick="event.stopPropagation(); previewReminderSoundOption('${e.id}', this)">${e.file?"â–¶":"â€”"}</button>\n                </div>\n            `).join(""),e.querySelectorAll(".reminder-sound-card").forEach(e=>{const t=e.getAttribute("data-sound-id");e.addEventListener("click",e=>{if(e.target.closest(".reminder-sound-preview"))return;loadReminderSettings().soundId=t,saveReminderSettings(),renderReminderSoundCards(),showToast(getPrayerUiText().reminderSaved)}),e.addEventListener("keydown",e=>{if("Enter"!==e.key&&" "!==e.key)return;e.preventDefault();loadReminderSettings().soundId=t,saveReminderSettings(),renderReminderSoundCards(),showToast(getPrayerUiText().reminderSaved)})}),e.querySelectorAll(".reminder-sound-preview").forEach(e=>{const t=e.getAttribute("data-preview-sound"),n=(n,a=!1)=>{n&&(n.stopPropagation(),a&&n.preventDefault()),e.classList.add("is-playing"),previewReminderSound(t,e)};e.addEventListener("touchstart",e=>n(e,!0),{passive:!1}),e.addEventListener("click",e=>n(e,!1))})}function renderPerPrayerSoundSelectors(){const e=document.getElementById("perPrayerSoundWrap");if(!e)return;const t=loadReminderSettings();if(e.classList.toggle("active",!t.sameSoundForAll),t.sameSoundForAll)return void(e.innerHTML="");const n=REMINDER_SOUND_OPTIONS.map(e=>`<option value="${e.id}">${escapeHtml(getReminderSoundLabel(e.id))}</option>`).join("");e.innerHTML=REMINDER_PRAYERS.map(e=>`\n            <div class="per-prayer-sound-row">\n                <label for="perPrayerSound-${e}">${escapeHtml(getPrayerLabel(e))}</label>\n                <select id="perPrayerSound-${e}" data-prayer-sound="${e}" class="prayer-reminder-select">${n}</select>\n            </div>\n        `).join(""),e.querySelectorAll("[data-prayer-sound]").forEach(e=>{const n=e.getAttribute("data-prayer-sound");e.value=t.prayerSounds[n]||t.soundId,e.addEventListener("change",()=>{loadReminderSettings().prayerSounds[n]=e.value,saveReminderSettings(),showToast(getPrayerUiText().reminderSaved)})})}function previewReminderSound(e,t){getReminderSoundOption(e).file&&(reminderPreviewAudio&&(reminderPreviewAudio.pause(),reminderPreviewAudio.currentTime=0),reminderPreviewButton&&(reminderPreviewButton.classList.remove("is-playing"),reminderPreviewButton.textContent="â–¶"),reminderPreviewAudio=playReminderAudioOption(e,{isPreview:!0}),window.reminderPreviewAudio=reminderPreviewAudio,reminderPreviewAudio?t&&(reminderPreviewButton=t,t.textContent="â¸",reminderPreviewAudio.addEventListener("ended",()=>{t.classList.remove("is-playing"),t.textContent="â–¶",reminderPreviewButton=null},{once:!0})):t&&(t.classList.remove("is-playing"),t.textContent="â–¶"))}function getPrayerLabel(e){return isPashtoMode()?PRAYER_LABELS_PS[e]||PRAYER_LABELS_EN[e]:PRAYER_LABELS_EN[e]||e}function getPrayerUiText(){const e="undefined"!=typeof PS_UI?PS_UI:null,t=isPashtoMode();return{nextPrayer:t?e?.nextPrayer||"Ø±Ø§ØªÙ„ÙˆÙ†Ú©ÛŒ Ù„Ù…ÙˆÙ†Ú":"Next Prayer",detectingLocation:t?e?.detectingLocation||"ÚØ§ÛŒ Ù¾ÛŒÚ˜Ù†Ø¯Ù„ Ú©ÛÚ–ÙŠ...":"Detecting location...",locationDenied:t?e?.locationDenied||"ÚØ§ÛŒ Ø±Ø¯ Ø´Ùˆ â€” Ø¯ Ø¨ÛŒØ§ Ù‡Ú…Û Ù„Ù¾Ø§Ø±Ù‡ â†» Ù¼Ú© ÙˆÚ©Ú“Ø¦":"Location denied â€” tap â†» to retry",enableLocation:t?"Ø¯ Ù„Ù…Ø§Ù†ÚÙ‡ ÙˆØ®ØªÙˆÙ†Ùˆ Ù„Ù¾Ø§Ø±Ù‡ ÚØ§ÛŒ ÙØ¹Ø§Ù„ Ú©Ú“Ø¦.":"Enable location to load prayer times.",searchPlaceholder:t?"Ø¯ Ø§ÙØºØ§Ù†Ø³ØªØ§Ù† ÚšØ§Ø± ÙˆÙ„Ù¼ÙˆØ¦...":"Search Afghan city...",searchPlaceholderDual:t?"ÚšØ§Ø± ÙˆÙ„Ù¼ÙˆØ¦... / Search city...":"Search city... / ÚšØ§Ø± ÙˆÙ„Ù¼ÙˆØ¦...",countryLabel:t?"ğŸ‡¦ğŸ‡« Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†":"ğŸ‡¦ğŸ‡« Afghanistan",gpsOption:t?"ğŸ“ Ø²Ù…Ø§ Ù…ÙˆÙ‚Ø¹ÛŒØª ÙˆÚ©Ø§Ø±ÙˆØ¦":"ğŸ“ Use My Location",gpsDetecting:t?"Ø³ØªØ§Ø³Û Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ø¹Ù„ÙˆÙ…ÛÚ–ÙŠ...":"Detecting your location...",gpsDetected:t?"GPS ÙˆÙ…ÙˆÙ†Ø¯Ù„ Ø´Ùˆ":"GPS detected",noMatches:t?"Ø¨Ø±Ø§Ø¨Ø± ÚšØ§Ø± ÙˆÙ†Ù‡ Ù…ÙˆÙ†Ø¯Ù„ Ø´Ùˆ":"No matches",now:t?e?.now||"Ø§ÙˆØ³":"NOW",next:t?e?.next||"Ø¨Ù„":"NEXT",changeLocationTitle:t?"Ø¯ Ù„Ù…Ø§Ù†ÚÙ‡ ÚØ§ÛŒ Ø¨Ø¯Ù„ Ú©Ú“Ø¦":"Change prayer location",amToken:t?e?.amToken||"Øº.Ù…":"AM",pmToken:t?e?.pmToken||"Øº.Ùˆ":"PM",reminderSettingsTitle:t?e?.reminderSettingsTitle||"Ø¯ Ù„Ù…ÙˆÙ†Ú ÛŒØ§Ø¯ÙˆÙ†Û":"Prayer reminders",reminderMaster:t?e?.reminderMaster||"ğŸ”” Ø¯ Ù„Ù…ÙˆÙ†Ú Ø®Ø¨Ø±ØªÛŒØ§ÙˆÛ":"ğŸ”” Prayer alerts",reminderSound:t?e?.reminderSound||"ØºÚ–":"Sound",reminderBefore:t?e?.reminderBefore||"Ù„Ù‡ ÙˆØ®Øª Ù…Ø®Ú©Û":"Remind me",reminderAtTime:t?e?.reminderAtTime||"Ù¾Ø± ÙˆØ®Øª":"At time",reminder5:t?e?.reminder5||"Ûµ Ø¯Ù‚ÛŒÙ‚Û Ù…Ø®Ú©Û":"5 min before",reminder10:t?e?.reminder10||"Û±Û° Ø¯Ù‚ÛŒÙ‚Û Ù…Ø®Ú©Û":"10 min before",reminder15:t?e?.reminder15||"Û±Ûµ Ø¯Ù‚ÛŒÙ‚Û Ù…Ø®Ú©Û":"15 min before",soundAdhan:t?e?.soundAdhan||"Ø¨Ø´Ù¾Ú“ Ø§Ø°Ø§Ù†":"Full Adhan",soundTone:t?e?.soundTone||"Ù„Ù†Ú‰ Ø²Ù†Ú«":"Short tone",soundSilent:t?e?.soundSilent||"Ø¨Û ØºÚ–Ù‡":"Silent",testReminder:t?e?.testReminder||"Ø¯ ÛŒØ§Ø¯ÙˆÙ†Û Ø§Ø²Ù…ÙˆÙŠÚšØª":"Test Reminder",testReminderBody:t?e?.testReminderBody||"Ø¯Ø§ Ø¯ {prayer} Ù„Ù¾Ø§Ø±Ù‡ Ø§Ø²Ù…ÙˆÛŒÚšØªÙŠ ÛŒØ§Ø¯ÙˆÙ†Ù‡ Ø¯Ù‡":"This is a sample reminder for {prayer}",preReminderBody:t?e?.preReminderBody||"Ø¯ {prayer} Ù„Ù…ÙˆÙ†Ú Ø¨Ù‡ Ù¾Ù‡ {minutes} Ø¯Ù‚ÛŒÙ‚Ùˆ Ú©Û ÙˆÙŠ":"{minutes} min until {prayer} prayer",atTimeBody:t?e?.atTimeBody||"Ø¯ {prayer} Ù„Ù…Ø§Ù†ÚÙ‡ ÙˆØ®Øª Ø´Ùˆ":"It's time for {prayer} prayer",alertsEnabled:t?e?.alertsEnabled||"Ø¯ Ù„Ù…ÙˆÙ†Ú Ø®Ø¨Ø±ØªÛŒØ§ÙˆÛ ÙØ¹Ø§Ù„Û Ø´ÙˆÛ":"Prayer alerts enabled",alertsDisabled:t?e?.alertsDisabled||"Ø¯ Ù„Ù…ÙˆÙ†Ú Ø®Ø¨Ø±ØªÛŒØ§ÙˆÛ ØºÛŒØ± ÙØ¹Ø§Ù„Û Ø´ÙˆÛ":"Prayer alerts disabled",alertsPermissionDenied:t?e?.alertsPermissionDenied||"Ø¯ Ø®Ø¨Ø±ØªÛŒØ§ Ø§Ø¬Ø§Ø²Ù‡ Ø±Ø¯ Ø´ÙˆÙ‡":"Notification permission denied",alertsUnsupported:t?e?.alertsUnsupported||"Ø®Ø¨Ø±ØªÛŒØ§ÙˆÛ Ù†Ù‡ Ù…Ù„Ø§ØªÚ“ Ú©ÙˆÙŠ":"Notifications not supported",reminderSet:t?"ÛŒØ§Ø¯ÙˆÙ†Ù‡ ÙˆÙ¼Ø§Ú©Ù„ Ø´ÙˆÙ‡: {prayer} {time}":"Reminder set for {prayer} at {time}",reminderSaved:t?"Ø¯ ÛŒØ§Ø¯ÙˆÙ†Û ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø®ÙˆÙ†Ø¯ÙŠ Ø´ÙˆÙ„":"Reminder settings saved",inAppPrayerAlert:t?"Ø¯ {prayer} Ù„Ù…Ø§Ù†ÚÙ‡ ÙˆØ®Øª Ø´Ùˆ":"It is time for {prayer}",qiblaFacing:t?"Ù…Ø§Ø´Ø§Ø¡Ø§Ù„Ù„Ù‡! ØªØ§Ø³Ùˆ Ù‚Ø¨Ù„Û ØªÙ‡ Ø¨Ø±Ø§Ø¨Ø± ÛŒØ§Ø³Øª.":"MashaAllah! You are facing Qibla.",qiblaAlmost:t?"Ù†Ú–Ø¯Û ÛŒØ§Ø³Øª â€” {delta}Â° ØªÙˆÙ¾ÛŒØ±":"Almost there â€” {delta}Â° off",qiblaRotateHint:t?"Ù…ÙˆØ¨Ø§ÛŒÙ„ ÙˆÚ…Ø±Ø®ÙˆØ¦ â€” Ø³ØªÙ†Ù‡ Ø¯ Ù‚Ø¨Ù„Û Ù†ÚšÛ ØªÙ‡ Ø¨Ø±Ø§Ø¨Ø±Ù‡ Ú©Ú“Ø¦":"Rotate phone until needle aligns with Qibla marker",qiblaNeedleHint:t?"Ù…ÙˆØ¨Ø§ÛŒÙ„ Ù…Ùˆ Ù‡ÙˆØ§Ø± ÙˆÙ†ÛŒØ³Ø¦ Ø§Ùˆ ÙˆØ±Ùˆ ÛŒÛ ÙˆÚ…Ø±Ø®ÙˆØ¦":"Hold your phone flat and rotate gently",change:t?"Ø¨Ø¯Ù„":"Change",noCitySelected:t?"ÚšØ§Ø± Ù†Ù‡ Ø¯ÛŒ Ù¼Ø§Ú©Ù„ Ø´ÙˆÛŒ":"No city selected"}}function setCitySearchVisibility(e){const t=document.getElementById("citySearchShell");t&&(t.style.display=e?"":"none",e||closeCityDropdown())}function localizeDigits(e){const t=String(e);return isPashtoMode()&&"function"==typeof toPashtoDigits?toPashtoDigits(t):t}function getReminderDefaults(){return{enabled:!1,mode:"tone",soundId:"adhan_mishary",sameSoundForAll:!0,prayerSounds:{fajr:"adhan_mishary",dhuhr:"adhan_short",asr:"adhan_short",maghrib:"takbeer",isha:"nasheed_soft"},offsetMinutes:0,prayers:{fajr:!0,dhuhr:!0,asr:!0,maghrib:!0,isha:!0}}}function loadReminderSettings(){if(reminderSettings)return reminderSettings;const e=getReminderDefaults(),t=REMINDER_SOUND_OPTIONS.map(e=>e.id);try{const n=JSON.parse(localStorage.getItem("crown_prayer_reminders")||"null");reminderSettings={enabled:!!n?.enabled,mode:["adhan","tone","silent"].includes(n?.mode)?n.mode:e.mode,soundId:t.includes(n?.soundId)?n.soundId:e.soundId,sameSoundForAll:"boolean"==typeof n?.sameSoundForAll?n.sameSoundForAll:e.sameSoundForAll,prayerSounds:{...e.prayerSounds,...Object.fromEntries(Object.entries(n?.prayerSounds||{}).filter(([e,n])=>REMINDER_PRAYERS.includes(e)&&t.includes(n)))},offsetMinutes:[0,5,10,15].includes(Number(n?.offsetMinutes))?Number(n.offsetMinutes):e.offsetMinutes,prayers:{...e.prayers,...n?.prayers||{}}}}catch(t){reminderSettings=e}return reminderSettings}function saveReminderSettings(){reminderSettings&&localStorage.setItem("crown_prayer_reminders",JSON.stringify(reminderSettings))}function syncReminderUi(){const e=loadReminderSettings(),t=document.getElementById("notifyToggle");t&&(t.checked=!!e.enabled),REMINDER_PRAYERS.forEach(t=>{const n=document.getElementById(`remPrayer-${t}`),a=n?.closest(".prayer-reminder-item");n&&(n.checked=!!e.prayers[t]),a&&a.classList.toggle("active",!!e.enabled&&!!e.prayers[t])});const n=document.getElementById("reminderSoundMode");n&&(n.value=e.mode);const a=document.getElementById("sameSoundForAllToggle");a&&(a.checked=!!e.sameSoundForAll),renderReminderSoundCards(),renderPerPrayerSoundSelectors();const r=document.getElementById("reminderBefore");r&&(r.value=String(e.offsetMinutes))}function refreshReminderControlLanguage(){const e=getPrayerUiText(),t=document.getElementById("reminderSettingsTitle"),n=document.getElementById("reminderMasterLabel"),a=document.getElementById("reminderSoundLabel"),r=document.getElementById("sameSoundAllLabel"),o=document.getElementById("reminderBeforeLabel"),i=document.getElementById("reminderTestBtn");t&&(t.textContent=e.reminderSettingsTitle),n&&(n.textContent=e.reminderMaster),a&&(a.textContent=e.reminderSound),r&&(r.textContent=isPashtoMode()?"Ø¯ Ù¼ÙˆÙ„Ùˆ Ù„Ù…ÙˆÙ†ÚÙˆÙ†Ùˆ Ù„Ù¾Ø§Ø±Ù‡ ÛŒÙˆ ØºÚ–":"Same sound for all prayers"),o&&(o.textContent=e.reminderBefore),i&&(i.textContent=e.testReminder);const s=document.getElementById("reminderSoundMode");if(s){const t=s.querySelector('option[value="adhan"]'),n=s.querySelector('option[value="tone"]'),a=s.querySelector('option[value="silent"]');t&&(t.textContent=e.soundAdhan),n&&(n.textContent=e.soundTone),a&&(a.textContent=e.soundSilent)}const l=document.getElementById("reminderBefore");if(l){const t=l.querySelector('option[value="0"]'),n=l.querySelector('option[value="5"]'),a=l.querySelector('option[value="10"]'),r=l.querySelector('option[value="15"]');t&&(t.textContent=e.reminderAtTime),n&&(n.textContent=e.reminder5),a&&(a.textContent=e.reminder10),r&&(r.textContent=e.reminder15)}REMINDER_PRAYERS.forEach(e=>{const t=document.getElementById(`remPrayerLabel-${e}`);t&&(t.textContent=getPrayerLabel(e))}),renderReminderSoundCards(),renderPerPrayerSoundSelectors();const d=document.getElementById("qiblaInstruction");d&&(d.textContent=getPrayerUiText().qiblaNeedleHint);Object.entries({n:{en:"N",ps:"Ø´"},s:{en:"S",ps:"Ø¬"},e:{en:"E",ps:"Ø®Øª"},w:{en:"W",ps:"Ù„Ùˆ"}}).forEach(([e,t])=>{const n=document.querySelector(`.qibla-compass .compass-${e}`);if(!n)return;const a=n.querySelector("span"),r=n.querySelector("small");a&&(a.textContent=t.en),r&&(r.textContent=t.ps)})}function initReminderControls(){const e=document.getElementById("prayerReminderSettings");if(!e||"1"===e.dataset.boundReminder)return refreshReminderControlLanguage(),void syncReminderUi();const t=document.getElementById("notifyToggle");t&&t.addEventListener("change",()=>{window.togglePrayerNotifications(t.checked)}),REMINDER_PRAYERS.forEach(e=>{const t=document.getElementById(`remPrayer-${e}`);t&&t.addEventListener("change",()=>{const n=loadReminderSettings();n.prayers[e]=t.checked,saveReminderSettings(),t.checked&&requestNotificationPermissionIfNeeded(),n.enabled?requestNotificationPermissionIfNeeded().then(t=>{t&&(schedulePrayerNotifications(),showReminderSetConfirmation(e))}):showToast(getPrayerUiText().reminderSaved),syncReminderUi()})});const n=document.getElementById("reminderSoundMode");n&&n.addEventListener("change",()=>{loadReminderSettings().mode=n.value,saveReminderSettings(),showToast(getPrayerUiText().reminderSaved)});const a=document.getElementById("sameSoundForAllToggle");a&&a.addEventListener("change",()=>{loadReminderSettings().sameSoundForAll=!!a.checked,saveReminderSettings(),renderPerPrayerSoundSelectors(),showToast(getPrayerUiText().reminderSaved)});const r=document.getElementById("reminderBefore");r&&r.addEventListener("change",()=>{const e=loadReminderSettings();e.offsetMinutes=Number(r.value)||0,saveReminderSettings(),e.enabled?(schedulePrayerNotifications(),showFirstEnabledReminderConfirmation()):showToast(getPrayerUiText().reminderSaved)});const o=document.getElementById("reminderTestBtn");o&&(o.addEventListener("touchstart",e=>{e.preventDefault(),runReminderTest()},{passive:!1}),o.addEventListener("click",()=>{runReminderTest()})),e.dataset.boundReminder="1",refreshReminderControlLanguage(),syncReminderUi()}function getCityDisplayName(e){return e?isPashtoMode()&&e.ps||e.en:""}function getCitySecondaryName(e){return e?isPashtoMode()?e.en:e.ps||e.en:""}function setSelectedCityChip(e,t=!1){const n=document.getElementById("selectedCityText"),a=document.getElementById("selectedCityChange"),r=getPrayerUiText();n&&(t?n.innerHTML=e:n.textContent=e),a&&(a.textContent=r.change)}function updateCityInputFromLocation(e){const t=document.getElementById("citySearchInput");if(!t)return;const n=getPrayerUiText();if(e?.cityKey){const a=AFGHAN_CITIES.find(t=>t.key===e.cityKey);if(a){t.value=getCityDisplayName(a);const e=getCityMeta(a),r=isPashtoMode()?e.provincePs:e.provinceEn;return setSelectedCityChip(`${getCityDisplayName(a)} Â· ${r}`),t.title=n.changeLocationTitle,void setCitySearchVisibility(!1)}}const a=e?.city||("number"==typeof e?.lat&&"number"==typeof e?.lng?`${e.lat.toFixed(2)}Â°, ${e.lng.toFixed(2)}Â°`:n.noCitySelected);t.value=a,setSelectedCityChip(a),t.title=n.changeLocationTitle,setCitySearchVisibility(!e?.city&&!e?.cityKey)}function renderCityDropdown(e=""){const t=document.getElementById("cityDropdown"),n=document.getElementById("citySearchShell");if(!t)return;const a=findCityMatches(e);n&&n.setAttribute("aria-expanded","true");const r=getPrayerUiText(),o=new Map;a.forEach(e=>{const t=getCityMeta(e),n=isPashtoMode()?t.regionPs:t.regionEn;o.has(n)||o.set(n,[]),o.get(n).push(e)});const i=Array.from(o.entries()).map(([t,n])=>{const a=n.map(t=>{const n=getCityMeta(t),a=getCityDisplayName(t),r=getCitySecondaryName(t),o=isPashtoMode()?n.provincePs:n.provinceEn,i=isPashtoMode()?n.provinceEn:n.provincePs,s=highlightMatch(a,e),l=highlightMatch(r,e);return`\n                    <button class="city-option" type="button" data-city-key="${t.key}" role="option">\n                        <span>\n                            <span class="city-name">${s}</span>\n                            <span class="city-subline">${l}</span>\n                        </span>\n                        <span class="city-coords">${o} Â· ${i}</span>\n                    </button>\n                `}).join("");return`\n                <div class="city-region-head">${escapeHtml(t)}</div>\n                ${a}\n            `}).join(""),s=isGpsResolving?`<span class="gps-loading" aria-hidden="true"></span><span>${r.gpsDetecting}</span>`:`<span>ğŸ“</span><span>${r.gpsOption}</span>`,l=detectedGpsCityKey?(()=>{const e=AFGHAN_CITIES.find(e=>e.key===detectedGpsCityKey);return e?`<div class="city-country-head">âœ… ${r.gpsDetected}: ${escapeHtml(getCityDisplayName(e))}</div>`:""})():"";t.innerHTML=`\n            <button class="city-option gps-option" type="button" data-city-key="__gps__" role="option">${s}</button>\n            <div class="city-country-head">${r.countryLabel}</div>\n            ${l}\n            <div class="city-options-wrap" role="listbox">${i||`<div class="city-empty">${r.noMatches}</div>`}</div>\n        `}function openCityDropdown(){const e=document.getElementById("cityDropdown"),t=document.getElementById("citySearchShell");e&&(e.classList.add("open"),t&&t.setAttribute("aria-expanded","true"))}function closeCityDropdown(){const e=document.getElementById("cityDropdown"),t=document.getElementById("citySearchShell");e&&(e.classList.remove("open"),t&&t.setAttribute("aria-expanded","false"))}function selectAfghanCity(e){if(!e)return;const t={lat:e.lat,lng:e.lng,city:e.en,cityKey:e.key,country:"Afghanistan"};localStorage.setItem("crown_location",JSON.stringify(t)),closeCityDropdown(),onLocationReady(t.lat,t.lng,t.city)}function initCitySelector(){const e=document.getElementById("citySearchInput"),t=document.getElementById("cityDropdown"),n=document.getElementById("selectedCityChange");if(!e||!t||"1"===e.dataset.boundCitySelector)return;const a=getPrayerUiText();e.placeholder=a.searchPlaceholderDual,n&&n.addEventListener("click",()=>{window.showPrayerCitySearch()}),e.addEventListener("focus",()=>{renderCityDropdown(e.value||""),openCityDropdown()}),e.addEventListener("input",()=>{renderCityDropdown(e.value||""),openCityDropdown()}),e.addEventListener("blur",()=>{setTimeout(closeCityDropdown,130)}),t.addEventListener("mousedown",e=>{e.preventDefault();const t=e.target.closest(".city-option");if(!t)return;const n=t.getAttribute("data-city-key");if("__gps__"===n)return closeCityDropdown(),void requestLocation();const a=AFGHAN_CITIES.find(e=>e.key===n);a&&selectAfghanCity(a)}),e.dataset.boundCitySelector="1"}function renderPrayerSkeleton(){const e=document.getElementById("prayerTimesGrid"),t=document.getElementById("prayerCountdown"),n=document.getElementById("prayerLocationBar"),a=document.getElementById("citySearchInput");if(n&&n.classList.add("loading"),a&&a.classList.add("skeleton"),t){t.classList.add("loading");const e=document.getElementById("nextPrayerName"),n=document.getElementById("nextPrayerCountdown");e&&e.classList.add("skeleton"),n&&n.classList.add("skeleton")}e&&(e.innerHTML='\n                <div class="prayer-skeleton-row skeleton"></div>\n                <div class="prayer-skeleton-row skeleton"></div>\n                <div class="prayer-skeleton-row skeleton"></div>\n                <div class="prayer-skeleton-row skeleton"></div>\n                <div class="prayer-skeleton-row skeleton"></div>')}function clearPrayerSkeleton(){const e=document.getElementById("prayerCountdown"),t=document.getElementById("prayerLocationBar"),n=document.getElementById("citySearchInput"),a=document.getElementById("nextPrayerName"),r=document.getElementById("nextPrayerCountdown");t&&t.classList.remove("loading"),n&&n.classList.remove("skeleton"),e&&e.classList.remove("loading"),a&&a.classList.remove("skeleton"),r&&r.classList.remove("skeleton")}function onLocationReady(e,t,n){clearPrayerSkeleton();const a=localStorage.getItem("crown_location");updateCityInputFromLocation(a?JSON.parse(a):{lat:e,lng:t,city:n}),isGpsResolving=!1,calculateAndRenderPrayers(e,t),calculateQibla(e,t),initCompass(),loadReminderSettings(),syncReminderUi(),loadReminderSettings().enabled&&schedulePrayerNotifications()}function calculateAndRenderPrayers(e,t){if("undefined"==typeof adhan){if(calculateAndRenderPrayers._retries||(calculateAndRenderPrayers._retries=0),calculateAndRenderPrayers._retries++>10){const e=document.getElementById("prayerTimesGrid");return void(e&&(e.innerHTML='<div style="text-align:center;padding:20px;opacity:0.6;">Prayer library failed to load. Please refresh.</div>'))}return renderPrayerSkeleton(),void setTimeout(()=>calculateAndRenderPrayers(e,t),500)}calculateAndRenderPrayers._retries=0;const n=new adhan.Coordinates(e,t),a=adhan.CalculationMethod.MuslimWorldLeague();a.madhab=adhan.Madhab.Hanafi;const r=new Date,o=new adhan.PrayerTimes(n,r,a);prayerTimesData={fajr:o.fajr,sunrise:o.sunrise,dhuhr:o.dhuhr,asr:o.asr,maghrib:o.maghrib,isha:o.isha},clearPrayerSkeleton(),renderPrayerGrid(),startCountdown()}function renderPrayerGrid(){const e=document.getElementById("prayerTimesGrid");if(!e||!prayerTimesData)return;const t=new Date,n=getCurrentPrayer(t),a=getNextPrayer(t);e.innerHTML=PRAYER_NAMES.map(e=>{const t=formatTime(prayerTimesData[e]),r=n===e,o=a===e,i=r?" current-prayer":o?" next-prayer":"",s=getPrayerUiText();return`<div class="prayer-time-row${i}">\n                <span class="prayer-time-icon">${PRAYER_ICONS[e]}</span>\n                <span class="prayer-time-name">${getPrayerLabel(e)}</span>\n                <span class="prayer-time-value">${t}</span>\n                ${r?`<span class="prayer-now-badge">${s.now}</span>`:""}\n                ${o?`<span class="prayer-next-badge">${s.next}</span>`:""}\n            </div>`}).join("")}function getCurrentPrayer(e){if(!prayerTimesData)return null;for(let t=PRAYER_NAMES.length-1;t>=0;t--)if(e>=prayerTimesData[PRAYER_NAMES[t]])return PRAYER_NAMES[t];return null}function getNextPrayer(e){if(!prayerTimesData)return null;for(let t=0;t<PRAYER_NAMES.length;t++)if(e<prayerTimesData[PRAYER_NAMES[t]])return PRAYER_NAMES[t];return"fajr"}function startCountdown(){countdownInterval&&clearInterval(countdownInterval),updateCountdown(),countdownInterval=setInterval(updateCountdown,1e3)}function updateCountdown(){if(!prayerTimesData)return;const e=new Date,t=getNextPrayer(e),n=document.getElementById("nextPrayerName"),a=document.getElementById("nextPrayerCountdown");if(!n||!a)return;n.textContent=getPrayerLabel(t)||"--";let r=prayerTimesData[t];if(!r||e>=r){const t=new Date(e);t.setDate(t.getDate()+1);const n=localStorage.getItem("crown_location");if(!n||"undefined"==typeof adhan)return void(a.textContent="--:--:--");{const e=JSON.parse(n),a=new adhan.Coordinates(e.lat,e.lng),o=adhan.CalculationMethod.MuslimWorldLeague();o.madhab=adhan.Madhab.Hanafi;r=new adhan.PrayerTimes(a,t,o).fajr}}const o=r-e;if(o<=0){const e=localStorage.getItem("crown_location");if(e){const t=JSON.parse(e);calculateAndRenderPrayers(t.lat,t.lng)}return}const i=Math.floor(o/36e5),s=Math.floor(o%36e5/6e4),l=Math.floor(o%6e4/1e3),d=localizeDigits(String(i).padStart(2,"0")),c=localizeDigits(String(s).padStart(2,"0")),u=localizeDigits(String(l).padStart(2,"0"));a.textContent=`${d}:${c}:${u}`;const m=getCurrentPrayer(new Date),p=getNextPrayer(new Date);m===_lastCurrentPrayer&&p===_lastNextPrayer||(_lastCurrentPrayer=m,_lastNextPrayer=p,renderPrayerGrid())}function formatTime(e){if(!e)return"--:--";let t=e.getHours();const n=String(e.getMinutes()).padStart(2,"0"),a=getPrayerUiText(),r=t>=12?a.pmToken:a.amToken;t=t%12||12;return`${localizeDigits(t)}:${localizeDigits(n)} ${r}`}window.selectReminderSoundOption=function(e){loadReminderSettings().soundId=e,saveReminderSettings(),renderReminderSoundCards(),renderPerPrayerSoundSelectors(),showToast(getPrayerUiText().reminderSaved)},window.previewReminderSoundOption=function(e,t){previewReminderSound(e,t||null)},window.showPrayerCitySearch=function(){const e=document.getElementById("citySearchInput");setCitySearchVisibility(!0),e&&(e.focus(),renderCityDropdown(e.value||""),openCityDropdown())},window.refreshCitySelectorLanguage=function(){const e=document.getElementById("citySearchInput");if(!e)return;const t=getPrayerUiText();e.placeholder=t.searchPlaceholderDual,localStorage.getItem("crown_location")||(setSelectedCityChip(t.noCitySelected),setCitySearchVisibility(!0));const n=localStorage.getItem("crown_location");if(n){updateCityInputFromLocation(JSON.parse(n))}else setCitySearchVisibility(!0);document.getElementById("cityDropdown")?.classList.contains("open")&&renderCityDropdown(e.value||"")},window.refreshPrayerLanguage=function(){const e=getPrayerUiText(),t=document.querySelector(".prayer-countdown-label");t&&(t.textContent=e.nextPrayer);const n=document.querySelector(".prayer-panel-content h2");n&&(n.textContent=isPashtoMode()?"undefined"!=typeof PS_UI&&PS_UI.prayerTimesTitle?PS_UI.prayerTimesTitle:"Ø¯ Ù„Ù…ÙˆÙ†Ú ÙˆØ®ØªÙˆÙ†Ù‡":"Prayer Times"),renderPrayerGrid(),updateCountdown(),refreshReminderControlLanguage(),syncReminderUi();const a=document.getElementById("qiblaDegreeRing");a&&(a.dataset.built="0"),buildQiblaDegreeRing(),"function"==typeof window.refreshCitySelectorLanguage&&window.refreshCitySelectorLanguage()},window.openPrayer=function(){const e=document.querySelector(".prayer-panel");e&&e.classList.add("active"),lockScroll(),setBottomNavActive("prayer");const t=e?.querySelector(".etiquette-close");t&&t.focus(),initReminderControls(),initCitySelector(),preloadPrayerReminderAudio(),"function"==typeof window.refreshPrayerLanguage&&window.refreshPrayerLanguage(),renderPrayerSkeleton();const n=localStorage.getItem("crown_location");if(n){const e=JSON.parse(n);onLocationReady(e.lat,e.lng,e.city||"")}else setSelectedCityChip(getPrayerUiText().noCitySelected),requestLocation();recordInAppRoute(!0)},window.closePrayer=function(){const e=document.querySelector(".prayer-panel");e&&e.classList.remove("active"),unlockScroll(),setBottomNavActive("home"),countdownInterval&&(clearInterval(countdownInterval),countdownInterval=null),recordInAppRoute(!1)},window.requestLocation=function(){const e=document.getElementById("citySearchInput"),t=getPrayerUiText();if(isGpsResolving=!0,detectedGpsCityKey=null,e&&(e.value=t.detectingLocation),setSelectedCityChip(t.gpsDetecting),document.getElementById("cityDropdown")?.classList.contains("open")&&renderCityDropdown(e?.value||""),renderPrayerSkeleton(),!navigator.geolocation)return e&&(e.value="Geolocation not supported"),void(isGpsResolving=!1);navigator.geolocation.getCurrentPosition(async t=>{const n=t.coords.latitude,a=t.coords.longitude;let r="",o=null;try{const e=await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${n}&lon=${a}&format=json&zoom=10`);o=await e.json(),r=o.address?.city||o.address?.town||o.address?.village||o.address?.state||""}catch(e){}const i=AFGHAN_CITIES.reduce((e,t)=>{const r=e?Math.hypot(e.lat-n,e.lng-a):1/0;return Math.hypot(t.lat-n,t.lng-a)<r?t:e},null),s=/(Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†|afghanistan)/i.test(o?.address?.country||"")&&i?i:null,l={lat:n,lng:a,city:s?s.en:r,cityKey:s?s.key:null,country:o?.address?.country||""};isGpsResolving=!1,detectedGpsCityKey=s?s.key:null,localStorage.setItem("crown_location",JSON.stringify(l)),onLocationReady(n,a,r),document.getElementById("cityDropdown")?.classList.contains("open")&&renderCityDropdown(e?.value||"")},n=>{isGpsResolving=!1,clearPrayerSkeleton(),e&&(e.value=t.locationDenied),setSelectedCityChip(t.locationDenied);const a=document.getElementById("prayerTimesGrid");a&&(a.innerHTML=`<div style="text-align:center;padding:14px;opacity:0.7;">${t.enableLocation}</div>`)},{enableHighAccuracy:!1,timeout:1e4,maximumAge:6e5})},window.promptLocation=function(){const e=document.getElementById("citySearchInput");e&&(e.focus(),renderCityDropdown(e.value||""),openCityDropdown())};let _lastCurrentPrayer=null,_lastNextPrayer=null;function getTimePeriodFromPrayers(){if(!prayerTimesData)return null;const e=new Date;if(e<prayerTimesData.fajr)return"latenight";if(e<prayerTimesData.sunrise)return"fajr";if(e<prayerTimesData.dhuhr)return"morning";if(e<prayerTimesData.asr)return"dhuhr";if(e<prayerTimesData.maghrib)return"asr";if(e<prayerTimesData.isha)return"maghrib";const t=new Date(prayerTimesData.isha);return t.setHours(t.getHours()+2),e<t?"isha":"latenight"}function normalizeDegrees(e){let t=e%360;return t<0&&(t+=360),t}function shortestAngleDelta(e,t){return(t-e+540)%360-180}function setNeedleRotation(e){const t=document.getElementById("qiblaArrow");if(!t)return;const n=normalizeDegrees(e),a=shortestAngleDelta(currentNeedleRotation,n);currentNeedleRotation=normalizeDegrees(currentNeedleRotation+a),t.style.transform=`rotate(${currentNeedleRotation}deg)`}function buildQiblaDegreeRing(){const e=document.getElementById("qiblaDegreeRing");if(!e||"1"===e.dataset.built)return;const t=[];for(let e=0;e<360;e+=30)t.push(`<span class="qibla-tick" style="transform: rotate(${e}deg) translate(-50%, -100%);"></span>`),t.push(`<span class="qibla-tick-label" style="transform: rotate(${e}deg) translate(-50%, -100%);">${localizeDigits(e)}</span>`);e.innerHTML=t.join(""),e.dataset.built="1"}function calculateQibla(e,t){const n=e*Math.PI/180,a=t*Math.PI/180,r=21.4225*Math.PI/180,o=39.8262*Math.PI/180-a,i=Math.sin(o),s=Math.cos(n)*Math.tan(r)-Math.sin(n)*Math.cos(o);let l=180*Math.atan2(i,s)/Math.PI;l<0&&(l+=360),userQibla=l,buildQiblaDegreeRing();const d=document.getElementById("qiblaDegree"),c=document.getElementById("qiblaStatus"),u=Math.round(l),m=getPrayerUiText();d&&(d.textContent=isPashtoMode()?`${localizeDigits(u)}Â° Ù„Ù‡ Ø´Ù…Ø§Ù„Ù‡ Ø¯ Ù‚Ø¨Ù„Û Ù„ÙˆØ±ÛŒ`:`Qibla bearing: ${u}Â° from North`),c&&(c.textContent=m.qiblaRotateHint);const p=document.getElementById("qiblaMarker");p&&(p.style.transform=`rotate(${l}deg)`),setNeedleRotation(l)}function initCompass(){if(buildQiblaDegreeRing(),window.removeEventListener("deviceorientationabsolute",handleCompass,!0),window.removeEventListener("deviceorientation",handleCompass,!0),"undefined"!=typeof DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission){const e=document.getElementById("qiblaStatus");e&&!sessionStorage.getItem("compass_requested")&&(e.innerHTML='<button class="selected-city-change" onclick="requestCompassPermission()">Enable Compass</button>')}else"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",handleCompass,!0):"ondeviceorientation"in window&&window.addEventListener("deviceorientation",handleCompass,!0)}function processCompassHeading(){if(null==latestCompassHeading||null==userQibla)return;const e=document.getElementById("qiblaSection"),t=document.getElementById("qiblaStatus"),n=getPrayerUiText();setNeedleRotation(normalizeDegrees(userQibla-latestCompassHeading));const a=Math.abs(shortestAngleDelta(latestCompassHeading,userQibla)),r=a<=5;e&&e.classList.toggle("aligned",r),t&&(t.textContent=r?n.qiblaFacing:n.qiblaAlmost.replace("{delta}",localizeDigits(Math.round(a))))}function queueCompassUpdate(e){latestCompassHeading=normalizeDegrees(e),compassEventTimer||(compassEventTimer=setTimeout(()=>{compassEventTimer=null,processCompassHeading()},80))}function handleCompass(e){let t=e.webkitCompassHeading||(null!=e.alpha?360-e.alpha:null);null!=t&&null!=userQibla&&queueCompassUpdate(t)}window.requestCompassPermission=function(){sessionStorage.setItem("compass_requested","true"),DeviceOrientationEvent.requestPermission().then(e=>{if("granted"===e){window.addEventListener("deviceorientation",handleCompass,!0);const e=document.getElementById("qiblaStatus");e&&(e.textContent=getPrayerUiText().qiblaNeedleHint)}}).catch(()=>{})};let notificationTimeouts=[],dailyDuaReminderTimer=null;function requestNotificationPermissionIfNeeded(){const e=getPrayerUiText();return"Notification"in window?"granted"===Notification.permission?Promise.resolve(!0):"denied"===Notification.permission?(showToast(e.alertsPermissionDenied),Promise.resolve(!1)):Notification.requestPermission().then(t=>"granted"===t||(showToast(e.alertsPermissionDenied),!1)).catch(()=>(showToast(e.alertsPermissionDenied),!1)):(showToast(e.alertsUnsupported),Promise.resolve(!1))}function sendSystemNotification(e,t){"Notification"in window&&"granted"===Notification.permission&&(navigator.serviceWorker?.controller?navigator.serviceWorker.ready.then(n=>n&&"function"==typeof n.showNotification?n.showNotification(e,t):new Notification(e,t)).catch(()=>{new Notification(e,t)}):new Notification(e,t))}function resolveReminderSoundId(e=null){const t=loadReminderSettings();return"silent"===t.mode?"silent":t.sameSoundForAll||!e?t.soundId||"adhan_mishary":t.prayerSounds?.[e]||t.soundId||"adhan_mishary"}function playReminderSound(e){playReminderAudioOption(e,{isPreview:!1})}function getPrayerCoordinates(){try{const e=JSON.parse(localStorage.getItem("crown_location")||"null");return e&&"number"==typeof e.lat&&"number"==typeof e.lng?{lat:e.lat,lng:e.lng}:null}catch(e){return null}}function getPrayerTimeForDate(e,t){const n=getPrayerCoordinates();if(!n||"undefined"==typeof adhan)return null;const a=new adhan.Coordinates(n.lat,n.lng),r=adhan.CalculationMethod.MuslimWorldLeague();r.madhab=adhan.Madhab.Hanafi;return new adhan.PrayerTimes(a,t,r)[e]||null}function getNextReminderDate(e,t,n){const a=prayerTimesData?.[e]||getPrayerTimeForDate(e,n);if(a){const e=new Date(a);if(e.setMinutes(e.getMinutes()-t),e>n)return e}const r=new Date(n);r.setDate(r.getDate()+1);const o=getPrayerTimeForDate(e,r);if(!o)return null;const i=new Date(o);return i.setMinutes(i.getMinutes()-t),i>n?i:null}function showReminderSetConfirmation(e){const t=loadReminderSettings();if(!t.enabled||!t.prayers[e])return;const n=getNextReminderDate(e,t.offsetMinutes,new Date);if(!n)return;showToast(getPrayerUiText().reminderSet.replace("{prayer}",getPrayerLabel(e)).replace("{time}",formatTime(n)))}function showFirstEnabledReminderConfirmation(){const e=loadReminderSettings(),t=REMINDER_PRAYERS.find(t=>e.prayers[t]);t?showReminderSetConfirmation(t):showToast(getPrayerUiText().reminderSaved)}function firePrayerReminder(e,t,n){console.log("[PrayerReminder] Timer fired",{prayerName:e,isPreReminder:t,minutesBefore:n,at:(new Date).toISOString()});const a=getPrayerUiText(),r=getPrayerLabel(e),o=t?a.preReminderBody.replace("{prayer}",r).replace("{minutes}",localizeDigits(n)):a.atTimeBody.replace("{prayer}",r);sendSystemNotification(`${PRAYER_ICONS[e]} ${r}`,{body:o,icon:"icon-192.png",badge:"icon-192.png",tag:`prayer-${e}-${t?"before":"now"}`,renotify:!0,requireInteraction:!1}),playReminderSound(resolveReminderSoundId(e)),document.hidden||showToast(a.inAppPrayerAlert.replace("{prayer}",r))}function runReminderTest(){const e=getPrayerUiText(),t=getNextPrayer(new Date)||"fajr",n=getPrayerLabel(t),a=e.testReminderBody.replace("{prayer}",n);playReminderSound(resolveReminderSoundId(t)),requestNotificationPermissionIfNeeded().then(n=>{n&&sendSystemNotification(`${PRAYER_ICONS[t]} ${e.testReminder}`,{body:a,icon:"icon-192.png",badge:"icon-192.png",tag:"prayer-test-reminder",renotify:!0})})}function scheduleReminderMidnightRefresh(){reminderMidnightTimer&&(clearTimeout(reminderMidnightTimer),reminderMidnightTimer=null);if(!loadReminderSettings().enabled)return;const e=new Date,t=new Date(e);t.setHours(24,0,2,0);const n=Math.max(1e3,t-e);reminderMidnightTimer=setTimeout(()=>{const e=getPrayerCoordinates();e&&calculateAndRenderPrayers(e.lat,e.lng),schedulePrayerNotifications()},n)}function schedulePrayerNotifications(){clearPrayerNotifications();const e=loadReminderSettings();if(!e.enabled)return;const t=new Date;console.log("[PrayerReminder] Scheduling start",{now:t.toISOString(),offset:e.offsetMinutes,mode:e.mode}),REMINDER_PRAYERS.forEach(n=>{if(!e.prayers[n])return;const a=getNextReminderDate(n,e.offsetMinutes,t);if(!a)return;const r=a.getTime()-t.getTime();if(r<=0||r>1728e5)return;console.log("[PrayerReminder] Scheduled",{prayer:n,reminderAt:a.toISOString(),delayMs:r});const o=setTimeout(()=>{firePrayerReminder(n,e.offsetMinutes>0,e.offsetMinutes),schedulePrayerNotifications()},r);notificationTimeouts.push(o)}),scheduleReminderMidnightRefresh()}function clearPrayerNotifications(){notificationTimeouts.forEach(e=>clearTimeout(e)),notificationTimeouts=[],reminderMidnightTimer&&(clearTimeout(reminderMidnightTimer),reminderMidnightTimer=null)}function getTodayDuaSummary(){const e=Math.floor((new Date-new Date((new Date).getFullYear(),0,0))/1e3/60/60/24)%63+1,t=document.querySelector(`.dua-card[data-id="${e}"]`);return{title:t?.querySelector(".dua-title")?.textContent?.trim()||`Dua #${e}`,duaIndex:e}}function clearDailyDuaReminder(){dailyDuaReminderTimer&&(clearTimeout(dailyDuaReminderTimer),dailyDuaReminderTimer=null)}function scheduleDailyDuaReminder(){if(clearDailyDuaReminder(),"true"!==localStorage.getItem("crown_notifications"))return;if(!("Notification"in window)||"granted"!==Notification.permission)return;const e=new Date,t=new Date(e);t.setHours(9,0,0,0),t<=e&&t.setDate(t.getDate()+1);dailyDuaReminderTimer=setTimeout(()=>{const{title:e}=getTodayDuaSummary();new Notification("ğŸ“– Daily Dua Reminder",{body:`Todayâ€™s focus: ${e}`,icon:"icon-192.png",tag:"daily-dua-reminder",renotify:!1}),scheduleDailyDuaReminder()},t-e)}window.togglePrayerNotifications=function(e){const t=loadReminderSettings();t.enabled=!!e,localStorage.setItem("crown_notifications",t.enabled?"true":"false"),saveReminderSettings(),syncReminderUi();const n=getPrayerUiText();e?requestNotificationPermissionIfNeeded().then(e=>{if(!e)return t.enabled=!1,localStorage.setItem("crown_notifications","false"),saveReminderSettings(),syncReminderUi(),clearPrayerNotifications(),void clearDailyDuaReminder();schedulePrayerNotifications(),scheduleDailyDuaReminder(),showToast(n.alertsEnabled),showFirstEnabledReminderConfirmation()}):(clearPrayerNotifications(),clearDailyDuaReminder(),showToast(n.alertsDisabled)),initDailyReminderPrompt()},document.addEventListener("visibilitychange",()=>{!document.hidden&&"true"===localStorage.getItem("crown_notifications")&&prayerTimesData&&(loadReminderSettings(),syncReminderUi(),schedulePrayerNotifications(),scheduleDailyDuaReminder())}),document.addEventListener("DOMContentLoaded",function(){const e=localStorage.getItem("crown_location");if(e&&"undefined"!=typeof adhan){const t=JSON.parse(e),n=new adhan.Coordinates(t.lat,t.lng),a=adhan.CalculationMethod.MuslimWorldLeague();a.madhab=adhan.Madhab.Hanafi;const r=new adhan.PrayerTimes(n,new Date,a);prayerTimesData={fajr:r.fajr,sunrise:r.sunrise,dhuhr:r.dhuhr,asr:r.asr,maghrib:r.maghrib,isha:r.isha},"true"===localStorage.getItem("crown_notifications")&&(loadReminderSettings(),schedulePrayerNotifications(),scheduleDailyDuaReminder())}});const QURAN_API_BASE="https://api.alquran.cloud/v1",QURAN_CACHE_PREFIX="crown_quran_surah_",QURAN_META_KEY="crown_quran_meta",QURAN_LAST_READ_KEY="crown_quran_last_read",QURAN_RECENT_KEY="crown_quran_recent",QURAN_BOOKMARKS_KEY="crown_quran_bookmarks",QURAN_OFFLINE_KEY="crown_quran_offline_surahs",QURAN_SETTINGS_KEY="crown_quran_settings",QURAN_AUDIO_CACHE="crown-quran-audio-v1",QURAN_RECITERS=[{id:"ar.alafasy",name:"Mishary Rashid Alafasy"},{id:"ar.abdulbasitmurattal",name:"Abdul Basit Abdul Samad"},{id:"ar.abdurrahmansudais",name:"Abdul Rahman Al-Sudais"},{id:"ar.husary",name:"Mahmoud Khalil Al-Hussary"},{id:"ar.shuraim",name:"Saud Al-Shuraim"}],QURAN_TRANSLATION_MODES=["all","ar-ps","ar-en","ar"],QURAN_AUDIO_SPEEDS=[.75,1,1.25],quranState={initialized:!1,meta:null,view:"surah",search:"",currentSurah:null,currentSurahData:null,renderedAyahs:0,chunkSize:36,audio:null,audioObjectUrl:null,audioAyah:null,audioRate:1,audioPlayAll:!1,audioPausedManually:!1,loadingReader:!1,loadingList:!1};function getQuranDefaults(){return{reciter:"ar.alafasy",translationMode:"all",arabicSize:2,autoScrollAudio:!0,mushafMode:!1,pashtoEdition:"ps.abdulwali"}}function getQuranUiText(){const e=isPashtoMode();return{panelTitle:e?"Ù‚Ø±Ø¢Ù† Ú©Ø±ÛŒÙ…":"Quran",readingMode:e?"Ø¯ Ù…Ø·Ø§Ù„Ø¹Û Ø­Ø§Ù„Øª":"Reading Mode",readingModeOn:e?"Ø¯ Ù…Ø·Ø§Ù„Ø¹Û Ø­Ø§Ù„Øª ÙØ¹Ø§Ù„ Ø´Ùˆ":"Reading mode enabled",readingModeOff:e?"Ø¯ Ù…Ø·Ø§Ù„Ø¹Û Ø­Ø§Ù„Øª Ø¨Ù†Ø¯ Ø´Ùˆ":"Reading mode disabled",tabSurah:e?"Ø³ÙˆØ±ØªÙˆÙ†Ù‡":"Surahs",tabJuz:e?"Ø¬Ø² / Ù¾Ø§Ø±Ù‡":"Juz / Para",tabBookmarks:e?"Ù†ÚšÙ‡ Ø´ÙˆÛ Ø¢ÛŒØªÙˆÙ†Ù‡":"Bookmarks",tabSettings:e?"ØªÙ†Ø¸ÛŒÙ…Ø§Øª":"Settings",searchPlaceholder:e?"Ø³ÙˆØ±Øª ÙˆÙ„Ù¼ÙˆØ¦ (Ø´Ù…ÛØ±Ù‡ØŒ Ø¹Ø±Ø¨ÙŠØŒ Ø§Ù†Ú«Ù„ÛŒØ³ÙŠ)...":"Search Surah (number, Arabic, English)...",continueReading:e?"Ù…Ø·Ø§Ù„Ø¹Ù‡ Ø¯ÙˆØ§Ù… ÙˆØ±Ú©Ú“Ø¦":"Continue Reading",continue:e?"Ø¯ÙˆØ§Ù…":"Continue",recentlyRead:e?"ÙˆØ±ÙˆØ³ØªÙŠ Ù„ÙˆØ³ØªÙ„ Ø´ÙˆÙŠ":"Recently Read",ayahs:e?"Ø¢ÛŒØªÙˆÙ†Ù‡":"Ayahs",makki:e?"Ù…Ú©ÙŠ":"Makki",madani:e?"Ù…Ø¯Ù†ÙŠ":"Madani",meccan:e?"Ù…Ú©ÙŠ":"Makki",medinan:e?"Ù…Ø¯Ù†ÙŠ":"Madani",open:e?"Ø®Ù„Ø§Øµ":"Open",downloadOffline:e?"Ø¢ÙÙ„Ø§ÛŒÙ† ØªÙ‡ ÚšÚ©ØªÙ‡ Ú©Ú“Ø¦":"Download for Offline",downloading:e?"Ú©ÚšØªÙ‡ Ú©ÛÚ–ÙŠ...":"Downloading...",downloaded:e?"Ø¢ÙÙ„Ø§ÛŒÙ† Ø®ÙˆÙ†Ø¯ÙŠ Ø´Ùˆ":"Saved offline",noData:e?"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙˆÙ†Ù‡ Ù…ÙˆÙ†Ø¯Ù„ Ø´ÙˆÙ„":"No data found",noBookmarks:e?"ØªØ± Ø§ÙˆØ³Ù‡ Ù†ÚšÙ‡ Ø´ÙˆÛŒ Ø¢ÛŒØª Ù†Ø´ØªÙ‡":"No bookmarked ayahs yet",noRecent:e?"ØªØ± Ø§ÙˆØ³Ù‡ Ù‡ÛŒÚ… Ø³ÙˆØ±Øª Ù†Ù‡ Ø¯ÛŒ Ù„ÙˆØ³ØªÙ„ Ø´ÙˆÛŒ":"No surahs read yet",loading:e?"Ø¨Ø§Ø±ÛÚ–ÙŠ...":"Loading...",bismillah:"Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„Ù‘Ù°Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…Ù°Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ’Ù…Ù",arabicOnly:e?"ÛŒÙˆØ§Ø²Û Ø¹Ø±Ø¨ÙŠ":"Arabic only",defaultReciter:e?"Ø§ØµÙ„ÙŠ Ù‚Ø§Ø±ÙŠ":"Default reciter",translationMode:e?"Ø¯ Ú˜Ø¨Ø§Ú“Û Ø­Ø§Ù„Øª":"Translation display",arabicFontSize:e?"Ø¯ Ø¹Ø±Ø¨ÙŠ Ù„ÛŒÚ© Ú©Ú†Ù‡":"Arabic font size",autoScroll:e?"Ø¯ ØºÚ– Ù¾Ø± Ù…Ù‡Ø§Ù„ Ø§ØªÙˆÙ…Ø§Øª Ø³Ú©Ø±ÙˆÙ„":"Auto-scroll during audio",mushafMode:e?"Ù…ØµØ­Ù Ø­Ø§Ù„Øª (ÛŒÙˆØ§Ø²Û Ø¹Ø±Ø¨ÙŠ)":"Mushaf mode (Arabic only)",saveSettings:e?"ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø®ÙˆÙ†Ø¯ÙŠ Ø´ÙˆÙ„":"Settings saved",notPlaying:e?"Ø§ÙˆØ³ ØºÚ– Ù†Ù‡ Ø´ØªÙ‡":"Not playing",playAll:e?"Ù¼ÙˆÙ„ Ù¾Ù„ÛŒ":"Play All",pause:e?"Ø¯Ø±ÙˆÙ„":"Pause",play:e?"Ù¾Ù„ÛŒ":"Play",juzLabel:e?"Ø¬Ø²":"Juz",openReader:e?"Ø¯ Ø³ÙˆØ±Øª Ù„ÙˆØ³ØªÙˆÙ†Ú©ÛŒ":"Surah Reader",cached:e?"Ø¢ÙÙ„Ø§ÛŒÙ†":"Cached",bookmark:e?"Ù†ÚšÙ‡":"Bookmark",bookmarked:e?"Ù†ÚšÙ‡ Ø´ÙˆÛŒ":"Bookmarked",removedBookmark:e?"Ù†ÚšÙ‡ Ù„Ø±Û Ø´ÙˆÙ‡":"Bookmark removed",noPashtoFound:e?"Ø¯ Ù¾ÚšØªÙˆ Ú˜Ø¨Ø§Ú“Û API ÙˆÙ†Ù‡ Ù…ÙˆÙ†Ø¯Ù„ Ø´Ùˆ":"Pashto translation API edition not found",pashtoEditionFound:e?"Ø¯ Ù¾ÚšØªÙˆ Ú˜Ø¨Ø§Ú“Ù‡ ÙØ¹Ø§Ù„Ù‡ Ø´ÙˆÙ‡":"Pashto translation enabled"}}function getQuranSettings(){const e=getQuranDefaults();try{const t=JSON.parse(localStorage.getItem(QURAN_SETTINGS_KEY)||"null"),n={...e,...t||{}};return QURAN_RECITERS.find(e=>e.id===n.reciter)||(n.reciter=e.reciter),QURAN_TRANSLATION_MODES.includes(n.translationMode)||(n.translationMode=e.translationMode),n.arabicSize=Math.max(1.4,Math.min(2.8,Number(n.arabicSize)||e.arabicSize)),n.autoScrollAudio=!!n.autoScrollAudio,n.mushafMode=!!n.mushafMode,n.pashtoEdition=n.pashtoEdition||e.pashtoEdition,n}catch(t){return e}}function saveQuranSettings(e){localStorage.setItem(QURAN_SETTINGS_KEY,JSON.stringify(e))}function getQuranLastRead(){try{return JSON.parse(localStorage.getItem(QURAN_LAST_READ_KEY)||"null")}catch(e){return null}}function setQuranLastRead(e){localStorage.setItem(QURAN_LAST_READ_KEY,JSON.stringify({...e,ts:Date.now()}))}function getQuranRecent(){try{return JSON.parse(localStorage.getItem(QURAN_RECENT_KEY)||"[]")}catch(e){return[]}}function pushQuranRecent(e){const t=getQuranRecent().filter(t=>t.surahNumber!==e.surahNumber);t.unshift({...e,ts:Date.now()}),localStorage.setItem(QURAN_RECENT_KEY,JSON.stringify(t.slice(0,5)))}function getQuranBookmarks(){try{return JSON.parse(localStorage.getItem(QURAN_BOOKMARKS_KEY)||"[]")}catch(e){return[]}}function saveQuranBookmarks(e){localStorage.setItem(QURAN_BOOKMARKS_KEY,JSON.stringify(e))}function getOfflineSurahs(){try{return JSON.parse(localStorage.getItem(QURAN_OFFLINE_KEY)||"[]")}catch(e){return[]}}function markSurahOffline(e){const t=new Set(getOfflineSurahs());t.add(Number(e)),localStorage.setItem(QURAN_OFFLINE_KEY,JSON.stringify(Array.from(t).sort((e,t)=>e-t)))}function getSurahCacheKey(e){return`${QURAN_CACHE_PREFIX}${e}`}function getCachedSurahData(e){try{const t=localStorage.getItem(getSurahCacheKey(e));return t?JSON.parse(t):null}catch(e){return null}}function saveCachedSurahData(e,t){localStorage.setItem(getSurahCacheKey(e),JSON.stringify({savedAt:Date.now(),data:t})),markSurahOffline(e)}async function fetchQuranMeta(){if(quranState.meta)return quranState.meta;const e=localStorage.getItem(QURAN_META_KEY);if(e)try{return quranState.meta=JSON.parse(e),quranState.meta}catch(e){}const t=await fetch(`${QURAN_API_BASE}/meta`),n=await t.json();if(200!==n?.code||!n?.data?.surahs?.references)throw new Error("Failed to load Quran metadata");return quranState.meta=n.data,localStorage.setItem(QURAN_META_KEY,JSON.stringify(quranState.meta)),quranState.meta}function localizeQuranNumber(e){return isPashtoMode()?localizeDigits(e):String(e)}function cleanSurahArabicName(e){return String(e||"").replace(/^Ø³ÙÙˆØ±ÙØ©Ù\s*/u,"").replace(/^Ø³ÙˆØ±Ø©\s*/u,"").trim()}function normalizeLatinSearchText(e){let t=String(e||"").toLowerCase().normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/['â€™`\-_.]+/g," ").replace(/\s+/g," ").trim();t=t.replace(/^(al|as|ar|an)\s+/i,"");const n=t.replace(/\s+/g,""),a=n.replace(/([aeiou])\1+/g,"$1"),r=a.replace(/[aeiou]/g,"");return{compact:n,slimVowels:a,consonantSkeleton:r}}function normalizeArabicSearchText(e){const t=String(e||"").replace(/[\u064B-\u065F\u0670\u06D6-\u06ED]/g,"").replace(/[\u0640]/g,"").replace(/[Ø£Ø¥Ø¢Ù±]/g,"Ø§").replace(/Ù‰/g,"ÙŠ").replace(/Ø¤/g,"Ùˆ").replace(/Ø¦/g,"ÙŠ").replace(/Ø©/g,"Ù‡").replace(/[\s\-Ù€'â€™`_.]+/g,"").trim();return{value:t,noArticle:t.replace(/^Ø§Ù„+/,"")}}function includesFuzzyLatin(e,t){const n=normalizeLatinSearchText(e),a=normalizeLatinSearchText(t);return!a.compact||(!!n.compact.includes(a.compact)||(!!n.slimVowels.includes(a.slimVowels)||!!a.consonantSkeleton&&n.consonantSkeleton.includes(a.consonantSkeleton)))}function includesFuzzyArabic(e,t){const n=normalizeArabicSearchText(e),a=normalizeArabicSearchText(t);return!a.value||(n.value.includes(a.value)||n.noArticle.includes(a.value)||n.value.includes(a.noArticle)||n.noArticle.includes(a.noArticle))}function getRevelationMeta(e){const t=getQuranUiText(),n=String(e||"").toLowerCase();return n.includes("meccan")||n.includes("makki")||n.includes("makkah")?{label:t.makki,icon:"ğŸ•‹"}:{label:t.madani,icon:"ğŸ•Œ"}}function getCurrentSurahMetaByNumber(e){let t=quranState.meta?.surahs?.references||[];if(!t.length)try{const e=JSON.parse(localStorage.getItem(QURAN_META_KEY)||"null");t=e?.surahs?.references||[],t.length&&!quranState.meta&&(quranState.meta=e)}catch(e){}return t.find(t=>Number(t.number)===Number(e))||null}async function ensurePashtoEdition(){const e=getQuranSettings();if(e.pashtoEdition&&e.pashtoEdition.startsWith("ps."))return e.pashtoEdition;try{const t=await fetch(`${QURAN_API_BASE}/edition/language/ps`),n=await t.json();if(200===n?.code&&Array.isArray(n.data)&&n.data[0]?.identifier)return e.pashtoEdition=n.data[0].identifier,saveQuranSettings(e),e.pashtoEdition}catch(e){}return null}function getTranslationModeEffective(){const e=getQuranSettings();return e.mushafMode?"ar":e.translationMode}function applyQuranArabicFontSize(){const e=getQuranSettings();document.documentElement.style.setProperty("--quran-ar-size",`${e.arabicSize}rem`)}function buildQuranSurahList(e=""){const t=quranState.meta?.surahs?.references||[],n=String(e||"").trim();if(!n)return t;const a=/[\u0600-\u06FF]/.test(n);return t.filter(e=>{const t=String(e.number),r=cleanSurahArabicName(e.name),o=String(e.englishName||""),i=String(e.englishNameTranslation||"");return!!t.includes(n)||(a?includesFuzzyArabic(r,n):includesFuzzyLatin(o,n)||includesFuzzyLatin(i,n)||includesFuzzyArabic(r,n))})}function renderQuranContinueCard(){const e=document.getElementById("quranContinueCard");if(!e)return;const t=getQuranUiText(),n=getQuranLastRead();if(!n||!n.surahNumber)return void(e.innerHTML="");const a=getCurrentSurahMetaByNumber(n.surahNumber);if(!a)return void(e.innerHTML="");const r=isPashtoMode()?cleanSurahArabicName(a.name):a.englishName;e.innerHTML=`\n            <div class="quran-continue-inner">\n                <div style="font-family:var(--font-title);font-size:0.68rem;letter-spacing:1px;color:var(--emerald-light);text-transform:uppercase;margin-bottom:6px;">${t.continueReading}</div>\n                <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;">\n                    <div>\n                        <div style="font-size:0.88rem;color:var(--text-primary);">${r}</div>\n                        <div style="font-size:0.68rem;color:var(--text-subtle);">${t.juzLabel,""}${isPashtoMode()?"Ø¢ÛŒØª":"Ayah"} ${localizeQuranNumber(n.ayahNumber||1)}</div>\n                    </div>\n                    <button class="quran-row-btn" type="button" onclick="resumeQuranReading()">${t.continue}</button>\n                </div>\n            </div>`}function renderQuranRecentSection(){const e=document.getElementById("quranRecentWrap");if(!e)return;const t=getQuranUiText(),n=getQuranRecent();n.length?e.innerHTML=`\n            <div style="font-family:var(--font-title);font-size:0.68rem;letter-spacing:1px;color:var(--gold-mid);text-transform:uppercase;margin-bottom:6px;">${t.recentlyRead}</div>\n            ${n.slice(0,5).map(e=>{const t=getCurrentSurahMetaByNumber(e.surahNumber),n=t?isPashtoMode()?cleanSurahArabicName(t.name):t.englishName:`#${e.surahNumber}`;return`<div class="quran-recent-item" onclick="openQuranSurah(${e.surahNumber}, ${e.ayahNumber||1})" role="button">${n} â€¢ ${isPashtoMode()?"Ø¢ÛŒØª":"Ayah"} ${localizeQuranNumber(e.ayahNumber||1)}</div>`}).join("")}\n        `:e.innerHTML=""}function setQuranView(e){quranState.view=e,document.querySelectorAll(".quran-view-tab").forEach(t=>{t.classList.toggle("active",t.getAttribute("data-qview")===e)});const t=document.getElementById("quranListScreen"),n=document.getElementById("quranList"),a=document.querySelector(".quran-search-shell"),r=document.getElementById("quranReaderScreen");t&&(t.style.display=""),n&&(n.style.display=""),r&&r.classList.remove("active"),a&&(a.style.display="surah"===e?"":"none"),n&&("surah"===e?(renderQuranContinueCard(),renderQuranRecentSection(),renderQuranSurahRows()):"juz"===e?renderQuranJuzRows():"bookmarks"===e?renderQuranBookmarksSection():"settings"===e&&renderQuranSettingsSection(),updateInAppFabVisibility(),document.querySelector(".quran-panel.active")&&recordInAppRoute(!1))}function renderQuranSurahRows(){const e=document.getElementById("quranList");if(!e)return;const t=getQuranUiText(),n=buildQuranSurahList(quranState.search),a=new Set(getOfflineSurahs().map(Number));e.innerHTML=n.map(e=>{const n=getRevelationMeta(e.revelationType),r=cleanSurahArabicName(e.name),o=e.englishName,i=isPashtoMode()?r:o,s=isPashtoMode()?o:r,l=a.has(Number(e.number));return`\n                <div class="quran-surah-row" onclick="openQuranSurah(${e.number})">\n                    <div class="quran-surah-num">${localizeQuranNumber(e.number)}</div>\n                    <div class="quran-surah-main">\n                        <div class="quran-surah-ar" dir="rtl">${escapeHtml(i)}</div>\n                        <div class="quran-surah-en">${escapeHtml(s)}</div>\n                    </div>\n                    <div class="quran-surah-meta">\n                        <span class="quran-revelation-badge">${n.icon} ${n.label}</span>\n                        <span class="quran-surah-ayahs">${localizeQuranNumber(e.numberOfAyahs)} ${t.ayahs}</span>\n                        ${l?`<span class="quran-cached" title="${t.cached}">â¬‡</span>`:""}\n                    </div>\n                    <div class="quran-surah-actions" onclick="event.stopPropagation()">\n                        <button class="quran-row-btn" type="button" onclick="downloadQuranSurahOffline(${e.number})">${t.downloadOffline}</button>\n                    </div>\n                </div>\n            `}).join("")||`<div class="quran-settings-card">${t.noData}</div>`}function renderQuranJuzRows(){const e=document.getElementById("quranList");if(!e)return;const t=getQuranUiText();e.innerHTML=Array.from({length:30}).map((e,n)=>{const a=n+1;return`\n                <div class="quran-juz-item" onclick="openQuranJuz(${a})" role="button">\n                    <div style="display:flex;align-items:center;justify-content:space-between;gap:8px;">\n                        <strong>${t.juzLabel} ${localizeQuranNumber(a)}</strong>\n                        <button class="quran-row-btn" type="button">${t.open}</button>\n                    </div>\n                </div>\n            `}).join("")}async function openQuranJuz(e){const t=document.getElementById("quranList");if(!t)return;const n=getQuranUiText();t.innerHTML=`<div class="quran-settings-card">${n.loading}</div>`;try{const a=await fetch(`${QURAN_API_BASE}/juz/${e}/quran-uthmani`),r=await a.json(),o=r?.data?.ayahs||[],i=Array.from(new Set(o.map(e=>Number(e?.surah?.number)).filter(Boolean))).sort((e,t)=>e-t),s=quranState.meta?.surahs?.references||[],l=i.map(e=>s.find(t=>Number(t.number)===e)).filter(Boolean);t.innerHTML=l.map(e=>{const t=getRevelationMeta(e.revelationType),a=isPashtoMode()?cleanSurahArabicName(e.name):e.englishName,r=isPashtoMode()?e.englishName:cleanSurahArabicName(e.name);return`\n                    <div class="quran-surah-row" onclick="openQuranSurah(${e.number})">\n                        <div class="quran-surah-num">${localizeQuranNumber(e.number)}</div>\n                        <div class="quran-surah-main">\n                            <div class="quran-surah-ar" dir="rtl">${escapeHtml(a)}</div>\n                            <div class="quran-surah-en">${escapeHtml(r)}</div>\n                        </div>\n                        <div class="quran-surah-meta">\n                            <span class="quran-revelation-badge">${t.icon} ${t.label}</span>\n                            <span class="quran-surah-ayahs">${localizeQuranNumber(e.numberOfAyahs)} ${n.ayahs}</span>\n                        </div>\n                    </div>\n                `}).join("")||`<div class="quran-settings-card">${n.noData}</div>`}catch(e){t.innerHTML=`<div class="quran-settings-card">${n.noData}</div>`}}function renderQuranBookmarksSection(){const e=document.getElementById("quranList");if(!e)return;const t=getQuranUiText(),n=getQuranBookmarks();n.length?e.innerHTML=n.sort((e,t)=>t.ts-e.ts).map(e=>`\n                <div class="quran-bookmark-item">\n                    <div style="display:flex;align-items:center;justify-content:space-between;gap:8px;">\n                        <div>\n                            <div style="font-size:0.82rem;color:var(--text-primary)">${escapeHtml(e.surahLabel||`Surah ${e.surahNumber}`)}</div>\n                            <div style="font-size:0.66rem;color:var(--text-subtle)">${isPashtoMode()?"Ø¢ÛŒØª":"Ayah"} ${localizeQuranNumber(e.ayahNumber)}</div>\n                            <div style="font-size:0.76rem;color:var(--gold-light);margin-top:3px;direction:rtl;text-align:right;">${escapeHtml(e.preview||"")}</div>\n                        </div>\n                        <div style="display:flex;gap:6px;">\n                            <button class="quran-row-btn" type="button" onclick="openQuranSurah(${e.surahNumber}, ${e.ayahNumber})">${t.open}</button>\n                            <button class="quran-row-btn" type="button" onclick="removeQuranBookmark(${e.surahNumber}, ${e.ayahNumber})">âœ•</button>\n                        </div>\n                    </div>\n                </div>\n            `).join(""):e.innerHTML=`<div class="quran-settings-card">${t.noBookmarks}</div>`}function renderQuranSettingsSection(){const e=document.getElementById("quranList");if(!e)return;const t=getQuranUiText(),n=getQuranSettings();e.innerHTML=`\n            <div class="quran-settings-card">\n                <div class="quran-settings-grid">\n                    <div>\n                        <label for="quranReciterSelect">${t.defaultReciter}</label>\n                        <select id="quranReciterSelect" class="prayer-reminder-select">\n                            ${QURAN_RECITERS.map(e=>`<option value="${e.id}" ${n.reciter===e.id?"selected":""}>${e.name}</option>`).join("")}\n                        </select>\n                    </div>\n                    <div>\n                        <label for="quranTranslationModeSelect">${t.translationMode}</label>\n                        <select id="quranTranslationModeSelect" class="prayer-reminder-select">\n                            <option value="all" ${"all"===n.translationMode?"selected":""}>AR + PS + EN</option>\n                            <option value="ar-ps" ${"ar-ps"===n.translationMode?"selected":""}>AR + PS</option>\n                            <option value="ar-en" ${"ar-en"===n.translationMode?"selected":""}>AR + EN</option>\n                            <option value="ar" ${"ar"===n.translationMode?"selected":""}>${t.arabicOnly}</option>\n                        </select>\n                    </div>\n                    <div>\n                        <label for="quranArabicFontRange">${t.arabicFontSize}: <span id="quranArabicFontValue">${n.arabicSize.toFixed(2)}rem</span></label>\n                        <input id="quranArabicFontRange" type="range" min="1.4" max="2.8" step="0.05" value="${n.arabicSize}">\n                    </div>\n                    <label style="display:flex;align-items:center;justify-content:space-between;gap:8px;">\n                        <span>${t.autoScroll}</span>\n                        <input id="quranAutoScrollToggle" type="checkbox" ${n.autoScrollAudio?"checked":""}>\n                    </label>\n                    <label style="display:flex;align-items:center;justify-content:space-between;gap:8px;">\n                        <span>${t.mushafMode}</span>\n                        <input id="quranMushafToggle" type="checkbox" ${n.mushafMode?"checked":""}>\n                    </label>\n                </div>\n            </div>\n        `;const a=document.getElementById("quranReciterSelect"),r=document.getElementById("quranTranslationModeSelect"),o=document.getElementById("quranArabicFontRange"),i=document.getElementById("quranArabicFontValue"),s=document.getElementById("quranAutoScrollToggle"),l=document.getElementById("quranMushafToggle"),d=()=>{const e=getQuranSettings();a&&(e.reciter=a.value),r&&(e.translationMode=r.value),o&&(e.arabicSize=Number(o.value)),s&&(e.autoScrollAudio=s.checked),l&&(e.mushafMode=l.checked),saveQuranSettings(e),applyQuranArabicFontSize(),refreshQuranTranslationModeButtons(),i&&(i.textContent=`${e.arabicSize.toFixed(2)}rem`),showToast(t.saveSettings),quranState.currentSurahData&&renderQuranAyahChunk(!0)};a&&a.addEventListener("change",d),r&&r.addEventListener("change",d),o&&o.addEventListener("input",d),s&&s.addEventListener("change",d),l&&l.addEventListener("change",d)}function showQuranSkeleton(e){const t=document.getElementById("quranSkeletonList");t&&(e?(t.classList.add("visible"),t.innerHTML='<div class="quran-skeleton-item"></div><div class="quran-skeleton-item"></div><div class="quran-skeleton-item"></div>'):(t.classList.remove("visible"),t.innerHTML=""))}async function fetchSurahBundle(e,t=!1){if(!t){const t=getCachedSurahData(e);if(t?.data?.ayahs?.length)return t.data}const n=getQuranSettings(),a=await ensurePashtoEdition();a&&n.pashtoEdition!==a&&(n.pashtoEdition=a,saveQuranSettings(n));const r=["quran-uthmani","en.sahih",n.pashtoEdition||"ps.abdulwali"],o=await fetch(`${QURAN_API_BASE}/surah/${e}/editions/${r.join(",")}`),i=await o.json(),s=i?.data||[];if(!Array.isArray(s)||!s.length)throw new Error("Failed to fetch surah data");const l=s.find(e=>"quran-uthmani"===e.edition?.identifier)||s[0],d=s.find(e=>"en.sahih"===e.edition?.identifier)||null,c=s.find(e=>"ps"===e.edition?.language)||null,u=(l.ayahs||[]).map((e,t)=>({numberInSurah:e.numberInSurah,number:e.number,juz:e.juz,arabic:e.text,english:d?.ayahs?.[t]?.text||"",pashto:c?.ayahs?.[t]?.text||""})),m={surahNumber:e,name:l.name,englishName:l.englishName,englishNameTranslation:l.englishNameTranslation,revelationType:l.revelationType,numberOfAyahs:l.numberOfAyahs,ayahs:u};return saveCachedSurahData(e,m),m}function renderQuranReaderHeader(e){const t=document.getElementById("quranReaderHeader");if(!t||!e)return;const n=getQuranUiText(),a=getRevelationMeta(e.revelationType);t.innerHTML=`\n            <div class="quran-surah-frame">\n                <div style="font-family:var(--font-arabic);font-size:1.3rem;color:var(--gold-light);direction:rtl;">${escapeHtml(cleanSurahArabicName(e.name))}</div>\n                <div style="font-family:var(--font-title);font-size:0.7rem;color:var(--text-subtle);margin-top:2px;">${escapeHtml(e.englishName)} â€¢ ${localizeQuranNumber(e.numberOfAyahs)} ${n.ayahs}</div>\n                <div style="margin-top:4px;font-size:0.62rem;color:var(--text-subtle);">${a.icon} ${a.label}</div>\n            </div>\n            ${9===Number(e.surahNumber)?"":`<div style="font-family:var(--font-arabic);font-size:1.2rem;line-height:2;color:var(--gold-light);margin-top:8px;">${n.bismillah}</div>`}\n        `,requestAnimationFrame(()=>syncQuranReaderStickyOffsets())}function syncQuranReaderStickyOffsets(){const e=document.getElementById("quranReaderScreen"),t=document.getElementById("quranReaderHeader"),n=document.querySelector(".quran-reader-tools"),a=document.getElementById("quranAyahList");if(!e||!t||!a)return;const r=Math.ceil(t.getBoundingClientRect().height||t.offsetHeight||0),o=!n||"none"===getComputedStyle(n).display?0:Math.ceil(n.getBoundingClientRect().height||n.offsetHeight||0),i=Math.max(16,r+o+16);a.style.paddingTop="8px",e.style.setProperty("--quran-reader-offset",`${i}px`)}function shouldShowTranslationBlock(e,t){return"ar"!==e&&("ps"===t?"all"===e||"ar-ps"===e:"en"===t&&("all"===e||"ar-en"===e))}function renderQuranAyahChunk(e=!1){if(!quranState.currentSurahData)return;const t=document.getElementById("quranAyahList"),n=document.getElementById("quranLoadMore");if(!t)return;e&&(quranState.renderedAyahs=0,t.innerHTML="");getQuranSettings();const a=getTranslationModeEffective(),r=quranState.currentSurahData.ayahs,o=Math.min(quranState.renderedAyahs+quranState.chunkSize,r.length),i=r.slice(quranState.renderedAyahs,o);t.insertAdjacentHTML("beforeend",i.map(e=>{const t=`${quranState.currentSurah}:${e.numberInSurah}`,n=quranState.audioAyah===t,r=getQuranBookmarks().some(t=>Number(t.surahNumber)===Number(quranState.currentSurah)&&Number(t.ayahNumber)===Number(e.numberInSurah));return`\n                <div class="quran-ayah-card ${n?"playing":""}" data-ayah-no="${e.numberInSurah}" id="quranAyah-${t}">\n                    <div class="quran-ayah-head">\n                        <span class="quran-ayah-num">${localizeQuranNumber(e.numberInSurah)}</span>\n                    </div>\n                    <div class="quran-ayah-ar">${escapeHtml(e.arabic)}</div>\n                    ${shouldShowTranslationBlock(a,"ps")?`<div class="quran-ayah-ps">${escapeHtml(e.pashto||"")}</div>`:""}\n                    ${shouldShowTranslationBlock(a,"en")?`<div class="quran-ayah-en">${escapeHtml(e.english||"")}</div>`:""}\n                    <div class="quran-ayah-actions">\n                        <button type="button" class="quran-ayah-btn" data-ayah-action="play" data-surah="${quranState.currentSurah}" data-ayah="${e.numberInSurah}" onclick="playQuranAyah(${quranState.currentSurah}, ${e.numberInSurah}, false)" aria-label="Play ayah">â–¶</button>\n                        <button type="button" class="quran-ayah-btn" data-ayah-action="bookmark" data-surah="${quranState.currentSurah}" data-ayah="${e.numberInSurah}" onclick="toggleQuranAyahBookmark(${quranState.currentSurah}, ${e.numberInSurah})" aria-label="Bookmark ayah">${r?"â˜…":"â˜†"}</button>\n                    </div>\n                </div>\n            `}).join("")),quranState.renderedAyahs=o,n&&n.classList.toggle("visible",quranState.renderedAyahs<r.length)}function updateQuranReaderProgress(){const e=document.querySelector(".quran-panel"),t=document.getElementById("quranReaderScreen");if(!(e&&t&&t.classList.contains("active")&&quranState.currentSurahData))return;const n=Array.from(document.querySelectorAll("#quranAyahList .quran-ayah-card"));if(!n.length)return;let a=n[n.length-1];for(const e of n){if(e.getBoundingClientRect().top>=150){a=e;break}}const r=Number(a.getAttribute("data-ayah-no")||1),o=quranState.currentSurahData.numberOfAyahs||quranState.currentSurahData.ayahs.length||1,i=Math.max(0,Math.min(100,r/o*100)),s=document.getElementById("quranTopProgressFill");if(s&&(s.style.width=`${i}%`),setQuranLastRead({surahNumber:quranState.currentSurah,ayahNumber:r}),renderQuranContinueCard(),quranState.renderedAyahs<quranState.currentSurahData.ayahs.length){e.scrollTop+e.clientHeight>e.scrollHeight-260&&renderQuranAyahChunk(!1)}}function refreshQuranTranslationModeButtons(){const e=getTranslationModeEffective();document.querySelectorAll(".quran-tt-btn").forEach(t=>{t.classList.toggle("active",t.getAttribute("data-mode")===e)})}async function openQuranSurah(e,t=1){const n=document.getElementById("quranReaderScreen"),a=document.getElementById("quranList"),r=document.getElementById("quranLoadMore");if(n&&a){quranState.currentSurah=Number(e),quranState.loadingReader=!0,showQuranSkeleton(!0),a.style.display="none",n.classList.add("active"),r&&r.classList.remove("visible");try{const e=await fetchSurahBundle(quranState.currentSurah);quranState.currentSurahData=e,renderQuranReaderHeader(e),renderQuranAyahChunk(!0),refreshQuranTranslationModeButtons();if(!document.getElementById(`quranAyah-${quranState.currentSurah}:${t}`)&&t>quranState.renderedAyahs)for(;quranState.renderedAyahs<t&&quranState.renderedAyahs<e.ayahs.length;)renderQuranAyahChunk(!1);const n=document.getElementById(`quranAyah-${quranState.currentSurah}:${t}`);n&&n.scrollIntoView({behavior:"smooth",block:"start"}),setQuranLastRead({surahNumber:quranState.currentSurah,ayahNumber:Number(t)||1}),pushQuranRecent({surahNumber:quranState.currentSurah,ayahNumber:t,surahLabel:isPashtoMode()?cleanSurahArabicName(e.name):e.englishName}),markSurahOffline(quranState.currentSurah),renderQuranContinueCard(),renderQuranRecentSection(),syncQuranReaderStickyOffsets(),updateQuranReaderProgress(),recordInAppRoute(!0)}catch(e){showToast(getQuranUiText().noData),n.classList.remove("active"),a.style.display=""}finally{quranState.loadingReader=!1,showQuranSkeleton(!1)}}}function updateQuranMiniPlayerLabel(){const e=document.getElementById("quranNowPlayingLabel"),t=document.getElementById("quranReciterName"),n=getQuranSettings(),a=getQuranUiText(),r=QURAN_RECITERS.find(e=>e.id===n.reciter);if(t&&(t.textContent=r?r.name:n.reciter),e)if(quranState.audioAyah){const[t,n]=quranState.audioAyah.split(":");e.textContent=`${isPashtoMode()?"Ø³ÙˆØ±Øª":"Surah"} ${localizeQuranNumber(t)} â€¢ ${isPashtoMode()?"Ø¢ÛŒØª":"Ayah"} ${localizeQuranNumber(n)}`}else e.textContent=a.notPlaying;const o=document.getElementById("quranPlayAll");o&&(o.textContent=a.playAll),updateQuranMiniPlayerVisibility()}function formatQuranTime(e){const t=Math.max(0,Math.floor(Number(e)||0));return`${Math.floor(t/60)}:${String(t%60).padStart(2,"0")}`}function updateQuranMiniTime(){const e=document.getElementById("quranMiniTime");e&&quranState.audio&&(e.textContent=`${formatQuranTime(quranState.audio.currentTime)} / ${formatQuranTime(quranState.audio.duration)}`)}function updateQuranMiniPlayerVisibility(){const e=document.getElementById("quranMiniPlayer");if(!e)return;const t=!(!quranState.audio||!quranState.audioAyah||quranState.audio.paused);e.classList.toggle("active",t)}function cycleQuranSpeed(){const e=document.getElementById("quranSpeedCycle"),t=QURAN_AUDIO_SPEEDS.indexOf(Number(quranState.audioRate||1)),n=QURAN_AUDIO_SPEEDS[(t+1+QURAN_AUDIO_SPEEDS.length)%QURAN_AUDIO_SPEEDS.length];quranState.audioRate=n,quranState.audio&&(quranState.audio.playbackRate=n),e&&(e.textContent=`${n}x`)}window.resumeQuranReading=function(){const e=getQuranLastRead();e?.surahNumber&&openQuranSurah(e.surahNumber,e.ayahNumber||1)};const quranTapLocks=new Map;function bindFastTap(e,t,n){if(!e||"1"===e.dataset.fastTapBound)return;const a=()=>{const a=Date.now(),r=t||e.id||"fast-tap";a-(quranTapLocks.get(r)||0)<220||(quranTapLocks.set(r,a),n())};e.addEventListener("touchstart",t=>{t.preventDefault(),e.classList.add("pressed"),setTimeout(()=>e.classList.remove("pressed"),90),a()},{passive:!1}),e.addEventListener("click",()=>{const n=quranTapLocks.get(t||e.id||"fast-tap")||0;Date.now()-n<320||a()}),e.dataset.fastTapBound="1"}function setQuranPlayButtonLoading(e){const t=document.getElementById("quranPlayPause");t&&(t.classList.toggle("is-loading",!!e),e||(quranState.audioAyah?t.textContent=quranState.audio&&!quranState.audio.paused?"â¸":"â–¶":t.textContent="â–¶"))}function stopQuranAudio(e=!0){if(!quranState.audio)return;quranState.audio.pause(),e&&(quranState.audio.currentTime=0),quranState.audioPlayAll=!1;const t=document.getElementById("quranMiniProgressFill");t&&e&&(t.style.width="0%");const n=document.getElementById("quranPlayPause");n&&(n.textContent="â–¶"),e&&(quranState.audioAyah=null,highlightPlayingAyah(),updateQuranMiniPlayerLabel()),updateQuranMiniTime(),updateQuranMiniPlayerVisibility(),setQuranPlayButtonLoading(!1)}async function getAyahGlobalNumber(e,t){const n=quranState.currentSurahData;if(n&&Number(quranState.currentSurah)===Number(e)){const e=n.ayahs?.find(e=>Number(e.numberInSurah)===Number(t));if(e?.number)return Number(e.number)}try{const n=await fetchSurahBundle(Number(e)),a=n?.ayahs?.find(e=>Number(e.numberInSurah)===Number(t));if(a?.number)return Number(a.number)}catch(e){}return null}async function fetchAyahAudioUrl(e,t,n){const a=await getAyahGlobalNumber(e,t);if(a)return`https://cdn.islamic.network/quran/audio/128/${n}/${a}.mp3`;try{const a=await fetch(`${QURAN_API_BASE}/ayah/${e}:${t}/${n}`),r=await a.json();if(r?.data?.audio)return r.data.audio}catch(e){}return null}async function getPlayableAudioSource(e){if(!e||!("caches"in window))return e;try{const t=await caches.open(QURAN_AUDIO_CACHE);let n=await t.match(e,{ignoreSearch:!0});if(!n){const a=await fetch(e,{mode:"no-cors",cache:"no-store"});a&&(a.ok||"opaque"===a.type)&&(await t.put(e,a.clone()),n=a)}if(n){if("opaque"===n.type)return e;const t=await n.blob();return t&&t.size?(quranState.audioObjectUrl&&URL.revokeObjectURL(quranState.audioObjectUrl),quranState.audioObjectUrl=URL.createObjectURL(t),quranState.audioObjectUrl):e}}catch(e){}return e}function highlightPlayingAyah(){if(document.querySelectorAll("#quranAyahList .quran-ayah-card").forEach(e=>e.classList.remove("playing")),!quranState.audioAyah)return;const e=document.getElementById(`quranAyah-${quranState.audioAyah}`);if(e){e.classList.add("playing");getQuranSettings().autoScrollAudio&&e.scrollIntoView({behavior:"smooth",block:"center"})}}async function playQuranAyahInternal(e,t,n=!1){console.log("[QuranAudio] play request",{surahNumber:e,ayahNumber:t,playAll:n}),quranState.currentSurahData&&Number(quranState.currentSurah)===Number(e)||await openQuranSurah(e,t);const a=getQuranSettings();setQuranPlayButtonLoading(!0),quranState.audio||(quranState.audio=new Audio,quranState.audio.preload="auto",quranState.audio.addEventListener("timeupdate",()=>{const e=document.getElementById("quranMiniProgressFill");if(!e||!quranState.audio)return;const t=quranState.audio.duration||1,n=Math.max(0,Math.min(100,quranState.audio.currentTime/t*100));e.style.width=`${n}%`,updateQuranMiniTime()}),quranState.audio.addEventListener("waiting",()=>setQuranPlayButtonLoading(!0)),quranState.audio.addEventListener("stalled",()=>setQuranPlayButtonLoading(!0)),quranState.audio.addEventListener("canplay",()=>setQuranPlayButtonLoading(!1)),quranState.audio.addEventListener("playing",()=>{setQuranPlayButtonLoading(!1),updateQuranMiniPlayerVisibility()}),quranState.audio.addEventListener("ended",()=>{if(!quranState.audioAyah)return;const[e,t]=quranState.audioAyah.split(":").map(Number);quranState.audioPlayAll&&quranState.currentSurahData&&t<quranState.currentSurahData.ayahs.length?playQuranAyahInternal(e,t+1,!0):stopQuranAudio(!0)})),quranState.audioPlayAll=!!n,quranState.audioAyah=`${e}:${t}`,highlightPlayingAyah(),updateQuranMiniPlayerLabel();const r=document.getElementById("quranPlayPause");r&&(r.textContent="â¸");const o=await fetchAyahAudioUrl(e,t,a.reciter);if(console.log("[QuranAudio] resolved audio URL",{hasAudioUrl:!!o,reciter:a.reciter}),!o)return showToast(getQuranUiText().noData),void setQuranPlayButtonLoading(!1);const i=await getPlayableAudioSource(o);quranState.audio.playbackRate=Number(quranState.audioRate||1),quranState.audio.src=i,quranState.audio.currentTime=0;try{await quranState.audio.play()}catch(e){return console.error("[QuranAudio] play() failed",e),showToast("Audio playback failed"),quranState.audioAyah=null,highlightPlayingAyah(),updateQuranMiniPlayerLabel(),void setQuranPlayButtonLoading(!1)}updateQuranMiniTime(),updateQuranMiniPlayerVisibility(),setQuranPlayButtonLoading(!1)}function toggleQuranPlayPause(){const e=document.getElementById("quranPlayPause");if(!quranState.audio)return;if(!(quranState.audioAyah||e&&"â¸"===e.textContent.trim()))return;if(quranState.audio.paused&&e&&"â¸"===e.textContent.trim())return stopQuranAudio(!1),void(e&&(e.textContent="â–¶"));quranState.audio.paused?(setQuranPlayButtonLoading(!0),quranState.audio.play().catch(()=>{setQuranPlayButtonLoading(!1)}),e&&(e.textContent="â¸"),updateQuranMiniPlayerVisibility()):(stopQuranAudio(!1),e&&(e.textContent="â–¶"))}function handleQuranAyahActionEvent(e,t=!1){const n=e.target&&e.target.closest?e.target.closest(".quran-ayah-btn[data-ayah-action]"):null;if(!n)return;t&&(e.preventDefault(),n.classList.add("pressed"),setTimeout(()=>n.classList.remove("pressed"),90));const a=n.getAttribute("data-ayah-action"),r=Number(n.getAttribute("data-surah")),o=Number(n.getAttribute("data-ayah"));if(!a||!r||!o)return;console.log("[QuranAudio] ayah action tapped",{action:a,surah:r,ayah:o,isTouch:t});const i=`ayah-${a}-${r}-${o}`,s=Date.now();s-(quranTapLocks.get(i)||0)<220||(quranTapLocks.set(i,s),"play"===a?(setQuranPlayButtonLoading(!0),playQuranAyahInternal(r,o,!1)):"bookmark"===a&&toggleQuranAyahBookmark(r,o))}function playRelativeAyah(e){if(!quranState.audioAyah)return;const[t,n]=quranState.audioAyah.split(":").map(Number),a=n+e;quranState.currentSurahData&&(a<1||a>quranState.currentSurahData.ayahs.length||playQuranAyahInternal(t,a,quranState.audioPlayAll))}async function cacheSurahAudioByReciter(e,t){const n=quranState.currentSurahData&&Number(quranState.currentSurah)===Number(e)?quranState.currentSurahData:await fetchSurahBundle(e);if(!n?.ayahs?.length)return;const a=await caches.open(QURAN_AUDIO_CACHE);for(const r of n.ayahs){const n=r?.number?`https://cdn.islamic.network/quran/audio/128/${t}/${r.number}.mp3`:await fetchAyahAudioUrl(e,r.numberInSurah,t);if(!n)continue;if(!await a.match(n,{ignoreSearch:!0}))try{const e=await fetch(n,{mode:"no-cors",cache:"no-store"});e&&(e.ok||"opaque"===e.type)&&await a.put(n,e.clone())}catch(e){}}}function bindQuranEvents(){const e=document.getElementById("quranSearchInput");e&&"1"!==e.dataset.bound&&(e.addEventListener("input",()=>{quranState.search=e.value||"","surah"===quranState.view&&renderQuranSurahRows()}),e.dataset.bound="1"),document.querySelectorAll(".quran-view-tab").forEach(e=>{"1"!==e.dataset.bound&&(e.addEventListener("click",()=>{setQuranView(e.getAttribute("data-qview"))}),e.dataset.bound="1")}),document.querySelectorAll(".quran-tt-btn").forEach(e=>{"1"!==e.dataset.bound&&(e.addEventListener("click",()=>{const t=getQuranSettings();t.translationMode=e.getAttribute("data-mode"),t.mushafMode="ar"===t.translationMode,saveQuranSettings(t),refreshQuranTranslationModeButtons(),quranState.currentSurahData&&renderQuranAyahChunk(!0)}),e.dataset.bound="1")});const t=document.getElementById("quranLoadMore");t&&"1"!==t.dataset.bound&&(t.addEventListener("click",()=>renderQuranAyahChunk(!1)),t.dataset.bound="1");const n=document.querySelector(".quran-panel");n&&"1"!==n.dataset.boundScroll&&(n.addEventListener("scroll",updateQuranReaderProgress,{passive:!0}),n.dataset.boundScroll="1");const a=document.getElementById("quranReadingModeBtn");a&&"1"!==a.dataset.bound&&(a.addEventListener("click",()=>{document.body.classList.toggle("quran-reading-mode"),showToast(document.body.classList.contains("quran-reading-mode")?getQuranUiText().readingModeOn:getQuranUiText().readingModeOff),requestAnimationFrame(()=>syncQuranReaderStickyOffsets())}),a.dataset.bound="1"),window.__quranStickyOffsetResizeBound||(window.addEventListener("resize",()=>syncQuranReaderStickyOffsets(),{passive:!0}),window.__quranStickyOffsetResizeBound=!0);const r=document.getElementById("quranPlayPause"),o=document.getElementById("quranPrevAyah"),i=document.getElementById("quranNextAyah"),s=document.getElementById("quranStopAyah"),l=document.getElementById("quranPlayAll"),d=document.getElementById("quranSpeedCycle"),c=document.getElementById("quranAyahList");r&&"1"!==r.dataset.bound&&(bindFastTap(r,"quran-play-pause",toggleQuranPlayPause),r.dataset.bound="1"),o&&"1"!==o.dataset.bound&&(bindFastTap(o,"quran-prev-ayah",()=>playRelativeAyah(-1)),o.dataset.bound="1"),i&&"1"!==i.dataset.bound&&(bindFastTap(i,"quran-next-ayah",()=>playRelativeAyah(1)),i.dataset.bound="1"),s&&"1"!==s.dataset.bound&&(bindFastTap(s,"quran-stop-ayah",()=>stopQuranAudio(!0)),s.dataset.bound="1"),l&&"1"!==l.dataset.bound&&(bindFastTap(l,"quran-play-all",()=>{quranState.currentSurahData&&quranState.currentSurah&&playQuranAyahInternal(quranState.currentSurah,1,!0)}),l.dataset.bound="1"),d&&"1"!==d.dataset.bound&&(bindFastTap(d,"quran-speed-cycle",cycleQuranSpeed),d.dataset.bound="1"),c&&"1"!==c.dataset.boundActions&&(c.addEventListener("touchstart",e=>handleQuranAyahActionEvent(e,!0),{passive:!1}),c.addEventListener("click",e=>handleQuranAyahActionEvent(e,!1)),c.dataset.boundActions="1")}function renderQuranTexts(){const e=getQuranUiText(),t=document.getElementById("quranPanelTitle"),n=document.getElementById("quranReadingModeBtn"),a=document.getElementById("quranSearchInput"),r=document.getElementById("quranTabSurah"),o=document.getElementById("quranTabJuz"),i=document.getElementById("quranTabBookmarks"),s=document.getElementById("quranTabSettings");t&&(t.textContent=e.panelTitle),n&&(n.textContent=e.readingMode),a&&(a.placeholder=e.searchPlaceholder),r&&(r.textContent=e.tabSurah),o&&(o.textContent=e.tabJuz),i&&(i.textContent=e.tabBookmarks),s&&(s.textContent=e.tabSettings);const l={all:"AR + PS + EN","ar-ps":"AR + PS","ar-en":"AR + EN",ar:e.arabicOnly};document.querySelectorAll(".quran-tt-btn").forEach(e=>{const t=e.getAttribute("data-mode");e.textContent=l[t]||t}),updateQuranMiniPlayerLabel();const d=document.getElementById("quranSpeedCycle");d&&(d.textContent=`${Number(quranState.audioRate||1)}x`),updateQuranMiniTime()}async function initQuran(){if(quranState.initialized)return;await fetchQuranMeta(),applyQuranArabicFontSize(),bindQuranEvents(),renderQuranTexts(),renderQuranContinueCard(),renderQuranRecentSection(),setQuranView("surah");showToast(await ensurePashtoEdition()?getQuranUiText().pashtoEditionFound:getQuranUiText().noPashtoFound),quranState.initialized=!0}window.playQuranAyah=function(e,t,n=!1){playQuranAyahInternal(Number(e),Number(t),!!n)},window.toggleQuranPlayPause=toggleQuranPlayPause,window.toggleQuranAyahBookmark=function(e,t){const n=quranState.currentSurahData;if(!n)return;const a=n.ayahs.find(e=>Number(e.numberInSurah)===Number(t));if(!a)return;const r=getQuranBookmarks(),o=r.findIndex(n=>Number(n.surahNumber)===Number(e)&&Number(n.ayahNumber)===Number(t));o>=0?(r.splice(o,1),showToast(getQuranUiText().removedBookmark)):(r.unshift({surahNumber:Number(e),ayahNumber:Number(t),surahLabel:isPashtoMode()?cleanSurahArabicName(n.name):n.englishName,preview:a.arabic,ts:Date.now()}),markSurahOffline(e),showToast(getQuranUiText().bookmarked)),saveQuranBookmarks(r.slice(0,500)),renderQuranAyahChunk(!0)},window.removeQuranBookmark=function(e,t){saveQuranBookmarks(getQuranBookmarks().filter(n=>!(Number(n.surahNumber)===Number(e)&&Number(n.ayahNumber)===Number(t)))),renderQuranBookmarksSection()},window.downloadQuranSurahOffline=async function(e){const t=getQuranUiText();showToast(t.downloading);try{await fetchSurahBundle(Number(e),!0);const n=getQuranSettings().reciter;await cacheSurahAudioByReciter(Number(e),n),markSurahOffline(Number(e)),showToast(`${t.downloaded}: ${isPashtoMode()?"Ø³ÙˆØ±Øª":"Surah"} ${localizeQuranNumber(e)}`),"surah"===quranState.view&&renderQuranSurahRows()}catch(e){showToast(t.noData)}},window.refreshQuranLanguage=function(){renderQuranTexts(),renderQuranContinueCard(),renderQuranRecentSection(),"surah"===quranState.view?renderQuranSurahRows():"juz"===quranState.view?renderQuranJuzRows():"bookmarks"===quranState.view?renderQuranBookmarksSection():"settings"===quranState.view&&renderQuranSettingsSection(),quranState.currentSurahData&&(renderQuranReaderHeader(quranState.currentSurahData),renderQuranAyahChunk(!0),syncQuranReaderStickyOffsets())},window.openQuran=async function(){const e=document.querySelector(".quran-panel");e&&(e.classList.add("active"),lockScroll(),setBottomNavActive("quran"),await initQuran(),renderQuranContinueCard(),renderQuranRecentSection(),"surah"===quranState.view&&renderQuranSurahRows(),recordInAppRoute(!0))},window.closeQuran=function(){const e=document.querySelector(".quran-panel");e&&e.classList.remove("active"),updateQuranMiniPlayerVisibility(),document.body.classList.remove("quran-reading-mode"),unlockScroll(),setBottomNavActive("home"),recordInAppRoute(!1)},window.openQuranSurah=openQuranSurah,window.openQuranJuz=openQuranJuz,"serviceWorker"in navigator&&(navigator.serviceWorker.register("sw.js").catch(()=>{}),navigator.serviceWorker.addEventListener("message",e=>{e.data&&"SW_UPDATED"===e.data.type&&showToast("App updated! Refresh for the latest version.")})),document.addEventListener("DOMContentLoaded",init);