<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#060d0a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="description" content="The Crown Collection — 55 essential Islamic duas from the Quran and Sunnah, with tasbeeh counter, bookmarks, daily routines, and scholarly authentication.">
    <title>Essential Duas by فلاح — The Crown Collection</title>

    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="apple-touch-icon" href="icon-192.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Cinzel:wght@400;500;600;700;800;900&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;0,800;1,400;1,500&family=Noto+Naskh+Arabic:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/adhan@4.4.3/lib/bundles/adhan.umd.min.js" defer></script>

    <style>
        /* ============================================ */
        /* ===== RESET & CSS VARIABLES ===== */
        /* ============================================ */
        *, *::before, *::after {
            margin: 0; padding: 0; box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --bg-dark: #0c1a13;
            --bg-card: rgba(18, 35, 26, 0.68);
            --bg-surface: #142a20;
            --bg-glass: rgba(22, 40, 30, 0.58);
            --gold-lightest: #f0f4e8;
            --gold-light: #dce8c8;
            --gold-mid: #c9a84c;
            --gold-dark: #8a6d2b;
            --gold-deep: #4a3a15;
            --gold-glow: rgba(201, 168, 76, 0.08);
            --emerald: #0a4d33;
            --emerald-light: #2ec47a;
            --emerald-glow: rgba(46, 196, 122, 0.06);
            --ruby: #7A2E3B;
            --sapphire: #1a3a5c;
            --teal: #1B6B6D;
            --purple: #4a1a7a;
            --green-lightest: #e8f5e9;
            --green-light: #81c784;
            --green-mid: #4cad52;
            --green-dark: #1b5e20;
            --green-deep: #0a3d0a;
            --text-primary: rgba(235, 245, 220, 0.96);
            --text-muted: rgba(200, 225, 210, 0.85);
            --text-subtle: rgba(180, 215, 195, 0.78);
            --text-faint: rgba(170, 210, 190, 0.70);
            --font-arabic: 'Noto Naskh Arabic', 'Amiri', serif;
            --font-amiri: 'Amiri', serif;
            --font-title: 'Cinzel', serif;
            --font-text: 'Playfair Display', serif;
            --radius-sm: 8px;
            --radius-md: 14px;
            --radius-lg: 20px;
            --radius-xl: 32px;
            --shadow-soft: 0 2px 16px rgba(0,0,0,0.18), 0 1px 4px rgba(0,0,0,0.12);
            --shadow-card: 0 4px 28px rgba(0,0,0,0.22), 0 1px 6px rgba(0,0,0,0.15);
            --shadow-elevated: 0 12px 48px rgba(0,0,0,0.35), 0 4px 12px rgba(0,0,0,0.2);
            --shadow-glow: 0 0 48px rgba(46, 196, 122, 0.05);
            --nav-height: 56px;
            --bottom-nav-height: 64px;
            --safe-top: env(safe-area-inset-top, 0px);
            --safe-bottom: env(safe-area-inset-bottom, 0px);
            --font-scale: 1;
            --transition-smooth: cubic-bezier(0.4, 0, 0.2, 1);
            --transition-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* ===== LIGHT MODE ===== */
        [data-theme="light"] {
            --bg-dark: #f7f5ef;
            --bg-card: rgba(255, 255, 255, 0.85);
            --bg-surface: #ede9df;
            --bg-glass: rgba(255, 255, 255, 0.7);
            --gold-lightest: #1a1a0e;
            --gold-light: #2d2d1a;
            --gold-mid: #8a6d2b;
            --gold-dark: #6b5420;
            --gold-glow: rgba(138, 109, 43, 0.08);
            --emerald: #e8f5e9;
            --emerald-light: #0d7b50;
            --emerald-glow: rgba(13, 123, 80, 0.06);
            --green-lightest: #0a3d0a;
            --green-light: #2e7d32;
            --green-mid: #1b5e20;
            --text-primary: rgba(15, 40, 28, 0.95);
            --text-muted: rgba(25, 60, 42, 0.82);
            --text-subtle: rgba(25, 60, 42, 0.7);
            --text-faint: rgba(25, 60, 42, 0.58);
            --shadow-soft: 0 2px 8px rgba(0,0,0,0.04), 0 1px 2px rgba(0,0,0,0.03);
            --shadow-card: 0 2px 16px rgba(0,0,0,0.06), 0 1px 4px rgba(0,0,0,0.04);
            --shadow-elevated: 0 8px 32px rgba(0,0,0,0.08), 0 2px 8px rgba(0,0,0,0.05);
            --shadow-glow: 0 0 24px rgba(13, 123, 80, 0.04);
        }
        [data-theme="light"] body::before {
            background:
                radial-gradient(ellipse at 20% 0%, rgba(13, 123, 80, 0.04) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 100%, rgba(201, 168, 76, 0.03) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(247, 245, 239, 0.95) 0%, var(--bg-dark) 70%);
        }
        [data-theme="light"] body::after { opacity: 0.02; }
        [data-theme="light"] .top-nav,
        [data-theme="light"] .bottom-nav { background: rgba(247, 245, 239, 0.88); backdrop-filter: blur(24px) saturate(200%); }
        [data-theme="light"] .top-nav.scrolled { background: rgba(247, 245, 239, 0.95); box-shadow: 0 1px 12px rgba(0,0,0,0.06); }
        [data-theme="light"] .search-input { background: rgba(255, 255, 255, 0.8); color: #2d2d1a; border-color: rgba(13, 123, 80, 0.12); }
        [data-theme="light"] .toast { background: rgba(255, 255, 255, 0.92); color: #2d2d1a; border-color: rgba(13, 123, 80, 0.15); backdrop-filter: blur(20px); }
        [data-theme="light"] .arabic-text { color: #1a1a0e; }
        [data-theme="light"] .translation { color: #333; }
        [data-theme="light"] .dua-card { background: var(--bg-card); border-color: rgba(13, 123, 80, 0.08); box-shadow: var(--shadow-card); }
        [data-theme="light"] .arabic-container { background: linear-gradient(135deg, rgba(13, 123, 80, 0.03), rgba(255,255,255,0.6)); border-color: rgba(13, 123, 80, 0.06); }
        [data-theme="light"] .etiquette-panel,
        [data-theme="light"] .routine-panel,
        [data-theme="light"] .tasbeeh-panel,
        [data-theme="light"] .prayer-panel { background: rgba(247, 245, 239, 0.97); }
        [data-theme="light"] .side-panel { background: #fff; }
        [data-theme="light"] .overlay { background: rgba(0,0,0,0.2); }
        [data-theme="light"] .nav-title {
            background: linear-gradient(135deg, #1b5e20, #2e7d32, #0d7b50);
            -webkit-background-clip: text; background-clip: text;
        }
        [data-theme="light"] .dua-card:hover { box-shadow: 0 4px 24px rgba(13, 123, 80, 0.08); }
        [data-theme="light"] .streak-banner,
        [data-theme="light"] .daily-dua-banner { background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(12px); }
        [data-theme="light"] .pill { background: rgba(255, 255, 255, 0.6); }
        [data-theme="light"] .toolbar-btn { background: rgba(255, 255, 255, 0.5); }
        [data-theme="light"] .font-controls { background: rgba(255, 255, 255, 0.5); }
        [data-theme="light"] .footer { background: transparent; }

        /* ===== COMPREHENSIVE LIGHT MODE OVERRIDES ===== */
        /* Critical: Text that would be invisible on light bg */
        [data-theme="light"] .etiquette-text { color: rgba(25, 60, 42, 0.85); }
        [data-theme="light"] .routine-desc { color: rgba(25, 60, 42, 0.72); }
        [data-theme="light"] .routine-desc .dua-ref { color: var(--gold-mid); }
        [data-theme="light"] .footer-text { color: rgba(25, 60, 42, 0.5); }
        [data-theme="light"] .footer-copyright { color: rgba(25, 60, 42, 0.35); }
        [data-theme="light"] .daily-label { color: var(--gold-mid); }

        /* Prayer panel light mode */
        [data-theme="light"] .prayer-location-bar { background: rgba(15, 80, 50, 0.08); border-color: rgba(15, 80, 50, 0.18); }
        [data-theme="light"] .prayer-location-bar .loc-text { color: var(--text-primary); }
        [data-theme="light"] .prayer-countdown-card { background: rgba(15, 80, 50, 0.06); border-color: rgba(15, 80, 50, 0.15); }
        [data-theme="light"] .prayer-countdown-label { color: var(--emerald-light); }
        [data-theme="light"] .prayer-countdown-name { color: var(--emerald-light); }
        [data-theme="light"] .prayer-countdown-time { color: var(--gold-light); }
        [data-theme="light"] .prayer-time-row { background: rgba(15, 80, 50, 0.05); border-color: rgba(15, 80, 50, 0.12); }
        [data-theme="light"] .prayer-time-row.active-prayer { background: rgba(15, 80, 50, 0.1); border-color: rgba(15, 80, 50, 0.25); }
        [data-theme="light"] .prayer-name { color: var(--text-primary); }
        [data-theme="light"] .prayer-time-val { color: var(--gold-light); }
        [data-theme="light"] .prayer-time-name { color: var(--text-primary); }
        [data-theme="light"] .prayer-time-value { color: var(--gold-light); }
        [data-theme="light"] .prayer-now-badge { background: rgba(13, 123, 80, 0.15); color: var(--emerald-light); border-color: rgba(13, 123, 80, 0.3); }
        [data-theme="light"] .prayer-next-badge { background: rgba(45, 45, 26, 0.1); color: var(--gold-light); border-color: rgba(45, 45, 26, 0.2); }
        [data-theme="light"] .qibla-section { background: rgba(15, 80, 50, 0.05); border-color: rgba(15, 80, 50, 0.15); }
        [data-theme="light"] .qibla-title { color: var(--emerald-light); }
        [data-theme="light"] .qibla-compass { border-color: rgba(15, 80, 50, 0.2); background: rgba(247, 245, 239, 0.8); }
        [data-theme="light"] .qibla-compass .compass-rose { color: var(--text-subtle); }
        [data-theme="light"] .qibla-compass .compass-n { color: var(--emerald-light); }
        [data-theme="light"] .qibla-compass .compass-s,
        [data-theme="light"] .qibla-compass .compass-e,
        [data-theme="light"] .qibla-compass .compass-w { color: var(--text-muted); }
        [data-theme="light"] .qibla-degree { color: var(--text-primary); }
        [data-theme="light"] .qibla-status { color: var(--text-muted); }
        [data-theme="light"] .prayer-notify-row { background: rgba(15, 80, 50, 0.06); border-color: rgba(15, 80, 50, 0.18); }
        [data-theme="light"] .prayer-notify-label { color: var(--text-primary); }
        [data-theme="light"] .toggle-slider { background: rgba(15, 80, 50, 0.15); }
        [data-theme="light"] .toggle-slider::before { background: rgba(15, 40, 28, 0.4); }
        [data-theme="light"] .toggle-switch input:checked + .toggle-slider { background: rgba(13, 123, 80, 0.4); }
        [data-theme="light"] .toggle-switch input:checked + .toggle-slider::before { background: var(--emerald-light); }
        [data-theme="light"] .etiquette-close { background: rgba(15, 80, 50, 0.08); border-color: rgba(15, 80, 50, 0.2); }

        /* Critical: Auth badges — darken neon colors for readability */
        [data-theme="light"] .badge-quran { background: rgba(106, 27, 128, 0.1); color: #6a1b80; border-color: rgba(106, 27, 128, 0.25); }
        [data-theme="light"] .badge-sahih { background: rgba(13, 123, 80, 0.08); color: #0d7b50; border-color: rgba(13, 123, 80, 0.2); }
        [data-theme="light"] .badge-jayyid { background: rgba(14, 107, 122, 0.1); color: #0e6b7a; border-color: rgba(14, 107, 122, 0.25); }
        [data-theme="light"] .badge-sirah { background: rgba(139, 32, 32, 0.08); color: #8b2020; border-color: rgba(139, 32, 32, 0.2); }
        [data-theme="light"] .badge-hasan { background: rgba(138, 109, 43, 0.1); color: #6b5420; border-color: rgba(138, 109, 43, 0.22); }

        /* Critical: Focus/interactive states with hardcoded dark backgrounds */
        [data-theme="light"] .search-input:focus { background: rgba(255, 255, 255, 0.95); border-color: rgba(13, 123, 80, 0.4); box-shadow: 0 0 0 3px rgba(13, 123, 80, 0.08), var(--shadow-card); }
        [data-theme="light"] .back-to-top { background: rgba(255, 255, 255, 0.9); border-color: rgba(13, 123, 80, 0.15); box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08); color: var(--emerald-light); }
        [data-theme="light"] .back-to-top:hover { background: rgba(255, 255, 255, 1); border-color: rgba(13, 123, 80, 0.3); }

        /* High: Buttons with poor contrast in light mode */
        [data-theme="light"] .memorize-btn { background: rgba(106, 27, 128, 0.06); border-color: rgba(106, 27, 128, 0.18); color: #5e35b1; }
        [data-theme="light"] .memorize-btn.memorized { background: rgba(106, 27, 128, 0.12); border-color: #7e57c2; color: #5e35b1; }
        [data-theme="light"] .progress-reset-btn { background: rgba(198, 40, 40, 0.05); border-color: rgba(198, 40, 40, 0.15); color: #c62828; }
        [data-theme="light"] .progress-reset-btn:hover { background: rgba(198, 40, 40, 0.1); border-color: rgba(198, 40, 40, 0.3); }

        /* High: Action buttons & interactive elements — boost visibility on light bg */
        [data-theme="light"] .action-btn { background: rgba(13, 123, 80, 0.05); border-color: rgba(13, 123, 80, 0.15); }
        [data-theme="light"] .action-btn:hover { background: rgba(13, 123, 80, 0.1); border-color: rgba(13, 123, 80, 0.25); }
        [data-theme="light"] .dua-number { background: linear-gradient(135deg, rgba(13, 123, 80, 0.08), rgba(13, 123, 80, 0.03)); border-color: rgba(13, 123, 80, 0.18); }
        [data-theme="light"] .section-toggle { background: rgba(13, 123, 80, 0.08); border-color: rgba(13, 123, 80, 0.2); }
        [data-theme="light"] .section-toggle.collapsed { background: rgba(13, 123, 80, 0.04); }

        /* High: Tasbeeh elements */
        [data-theme="light"] .tasbeeh-tap-btn { background: linear-gradient(135deg, rgba(13, 123, 80, 0.08), rgba(13, 123, 80, 0.03)); border-color: rgba(13, 123, 80, 0.25); box-shadow: 0 0 30px rgba(13, 123, 80, 0.06); }
        [data-theme="light"] .tasbeeh-tap-btn:active { background: linear-gradient(135deg, rgba(13, 123, 80, 0.15), rgba(13, 123, 80, 0.06)); }
        [data-theme="light"] .tasbeeh-ctrl-btn { background: rgba(13, 123, 80, 0.05); border-color: rgba(13, 123, 80, 0.15); }
        [data-theme="light"] .tasbeeh-ctrl-btn:hover { background: rgba(13, 123, 80, 0.1); color: var(--emerald-light); }
        [data-theme="light"] .tasbeeh-preset { background: rgba(13, 123, 80, 0.04); border-color: rgba(13, 123, 80, 0.12); }
        [data-theme="light"] .tasbeeh-preset:hover,
        [data-theme="light"] .tasbeeh-preset.active { background: rgba(13, 123, 80, 0.08); border-color: rgba(13, 123, 80, 0.25); }
        [data-theme="light"] .tasbeeh-count-display { text-shadow: none; }
        [data-theme="light"] .tasbeeh-target { color: rgba(13, 123, 80, 0.6); }

        /* Moderate: Surfaces & containers */
        [data-theme="light"] .how-to-box { background: rgba(13, 123, 80, 0.04); border-color: rgba(13, 123, 80, 0.1); }
        [data-theme="light"] .time-dua-chip { background: rgba(13, 123, 80, 0.04); border-color: rgba(13, 123, 80, 0.12); }
        [data-theme="light"] .progress-bar-visual { background: rgba(13, 123, 80, 0.1); }
        [data-theme="light"] .progress-stat-card { border-color: rgba(13, 123, 80, 0.12); }
        [data-theme="light"] .progress-day-cell { background: rgba(13, 123, 80, 0.03); }
        [data-theme="light"] .progress-day-cell.active { background: rgba(13, 123, 80, 0.1); border-color: rgba(13, 123, 80, 0.2); }
        [data-theme="light"] .progress-day-cell.today { border-color: var(--emerald-light); }

        html { scroll-behavior: smooth; overflow-x: hidden; font-size: 16px; }

        body {
            font-family: var(--font-text);
            background: var(--bg-dark);
            color: var(--gold-light);
            line-height: 1.85;
            min-height: 100vh; min-height: 100dvh;
            overflow-x: hidden;
            padding-bottom: calc(var(--bottom-nav-height) + var(--safe-bottom) + 24px);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }

        body.panel-open {
            overflow: hidden;
            position: fixed;
            width: 100%;
        }

        /* ===== BACKGROUND PATTERN ===== */
        body::before {
            content: '';
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 15% 0%, rgba(46, 196, 122, 0.07) 0%, transparent 45%),
                radial-gradient(ellipse at 85% 100%, rgba(201, 168, 76, 0.04) 0%, transparent 45%),
                radial-gradient(ellipse at 50% 40%, rgba(20, 42, 30, 0.6) 0%, var(--bg-dark) 65%);
            z-index: -2; pointer-events: none;
        }

        body::after {
            content: '';
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            opacity: 0.008;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 0L60 30L30 60L0 30Z' fill='none' stroke='%232ec47a' stroke-width='0.3'/%3E%3Ccircle cx='30' cy='30' r='6' fill='none' stroke='%23c9a84c' stroke-width='0.15'/%3E%3C/svg%3E");
            z-index: -1; pointer-events: none;
        }

        /* ============================================ */
        /* ===== TOP NAVIGATION ===== */
        /* ============================================ */

        /* ===== FALLAH LOGO ===== */
        .fallah-logo {
            display: flex; align-items: center; gap: 10px;
            text-decoration: none; cursor: pointer;
        }
        .fallah-mark {
            position: relative; width: 36px; height: 36px;
            display: flex; align-items: center; justify-content: center;
        }
        .fallah-crescent {
            position: absolute; width: 30px; height: 30px;
            border: 1.5px solid transparent;
            border-radius: 50%;
            background: conic-gradient(from 200deg, var(--emerald-light), var(--gold-mid), var(--emerald-light)) border-box;
            -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0.6;
        }
        .fallah-fa {
            font-family: var(--font-arabic); font-size: 1.25rem;
            color: var(--emerald-light); font-weight: 700;
            position: relative; z-index: 1; line-height: 1;
            text-shadow: 0 0 14px rgba(46, 196, 122, 0.25);
        }
        .fallah-text {
            display: flex; flex-direction: column;
        }
        .fallah-brand {
            font-family: var(--font-title); font-size: 0.62rem;
            letter-spacing: 2px;
            background: linear-gradient(135deg, #2ec47a, #81c784, #c9a84c);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text; font-weight: 700; text-transform: uppercase;
        }
        .fallah-sub {
            font-family: var(--font-arabic); font-size: 0.5rem;
            color: var(--gold-mid); opacity: 0.7; margin-top: -1px;
        }

        /* ===== SPLASH SCREEN ===== */
        .splash-screen {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(ellipse at center, #122b1e 0%, #0c1a13 70%);
            z-index: 10000;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            transition: opacity 1s ease, visibility 1s ease;
        }
        .splash-screen.hidden {
            opacity: 0; visibility: hidden; pointer-events: none;
        }
        .splash-logo-large {
            position: relative; width: 90px; height: 90px;
            display: flex; align-items: center; justify-content: center;
            animation: splashPulse 2.5s ease-in-out infinite;
        }
        .splash-crescent-lg {
            position: absolute; width: 80px; height: 80px;
            border: 2px solid transparent;
            border-radius: 50%;
            background: conic-gradient(from 200deg, var(--emerald-light), var(--gold-mid), var(--emerald-light)) border-box;
            -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            animation: splashRingSpin 4s linear infinite;
        }
        .splash-fa-lg {
            font-family: var(--font-arabic); font-size: 3rem;
            color: var(--emerald-light); font-weight: 700;
            position: relative; z-index: 1;
            text-shadow: 0 0 35px rgba(46, 196, 122, 0.3);
            opacity: 0; animation: splashFadeIn 0.8s ease-out 0.3s forwards;
        }
        .splash-title {
            font-family: var(--font-title); font-size: 0.7rem;
            letter-spacing: 5px; text-transform: uppercase;
            color: var(--emerald-light); margin-top: 28px;
            opacity: 0; animation: splashFadeIn 0.8s ease-out 0.6s forwards;
        }
        .splash-subtitle {
            font-family: var(--font-text); font-size: 0.82rem;
            color: var(--gold-mid); opacity: 0; font-style: italic;
            animation: splashFadeIn 0.8s ease-out 0.9s forwards;
            margin-top: 6px;
        }
        .splash-credit {
            font-family: var(--font-arabic); font-size: 0.72rem;
            color: var(--text-subtle); opacity: 0;
            animation: splashFadeIn 0.8s ease-out 1.2s forwards;
            margin-top: 22px;
        }
        @keyframes splashPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }
        @keyframes splashRingSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        @keyframes splashFadeIn {
            from { opacity: 0; transform: translateY(12px); }
            to { opacity: 1; transform: translateY(0); }
        }
        [data-theme="light"] .splash-screen {
            background: radial-gradient(ellipse at center, #ede9df 0%, #f7f5ef 70%);
        }

        /* ===== FOOTER BRAND ===== */
        .footer-brand-row {
            display: flex; align-items: center; justify-content: center;
            gap: 10px; margin-top: 16px; margin-bottom: 4px;
        }
        .footer-logo-mini {
            position: relative; width: 28px; height: 28px;
            display: flex; align-items: center; justify-content: center;
        }
        .footer-crescent {
            position: absolute; width: 22px; height: 22px;
            border: 1px solid transparent; border-radius: 50%;
            background: conic-gradient(from 200deg, var(--emerald-light), var(--gold-mid), var(--emerald-light)) border-box;
            -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor; mask-composite: exclude;
            opacity: 0.4;
        }
        .footer-fa-mini {
            font-family: var(--font-arabic); font-size: 0.85rem;
            color: var(--emerald-light); font-weight: 700;
            position: relative; z-index: 1; opacity: 0.5;
        }
        .footer-credit-text {
            font-family: var(--font-title); font-size: 0.55rem;
            letter-spacing: 2px; text-transform: uppercase;
            color: var(--text-subtle);
        }
        .footer-copyright {
            font-family: var(--font-title); font-size: 0.5rem;
            letter-spacing: 1.5px; color: rgba(170, 210, 190, 0.4);
            margin-top: 8px;
        }

        .top-nav {
            position: fixed; top: 0; left: 0; right: 0;
            height: calc(var(--nav-height) + var(--safe-top));
            padding-top: var(--safe-top);
            background: rgba(12, 26, 19, 0.75);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border-bottom: 1px solid rgba(46, 196, 122, 0.08);
            z-index: 1000;
            display: flex; align-items: center; justify-content: space-between;
            padding-left: 16px; padding-right: 16px;
            transition: transform 0.4s var(--transition-smooth), background 0.3s ease, box-shadow 0.3s ease;
        }
        .top-nav.hidden { transform: translateY(-100%); }
        .top-nav.scrolled {
            background: rgba(12, 26, 19, 0.92);
            box-shadow: 0 1px 20px rgba(0,0,0,0.3);
            border-bottom-color: rgba(46, 196, 122, 0.12);
        }

        .nav-title {
            font-family: var(--font-title); font-size: 0.72rem;
            letter-spacing: 2px;
            background: linear-gradient(135deg, #2ec47a, #81c784, #c9a84c);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text; font-weight: 700; text-transform: uppercase;
        }

        .nav-btn {
            background: rgba(46, 196, 122, 0.04); border: 1px solid rgba(46, 196, 122, 0.12);
            color: var(--text-muted); width: 34px; height: 34px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.3s var(--transition-smooth); font-size: 0.9rem;
        }
        .nav-btn:hover, .nav-btn:active {
            background: rgba(46, 196, 122, 0.1);
            border-color: rgba(46, 196, 122, 0.3); color: var(--emerald-light);
            transform: scale(1.08);
        }
        .nav-actions { display: flex; gap: 4px; align-items: center; }

        /* ===== FONT SIZE CONTROLS ===== */
        .font-controls {
            display: flex; align-items: center; gap: 0;
            background: rgba(46, 196, 122, 0.04);
            border: 1px solid rgba(46, 196, 122, 0.1);
            border-radius: 50px; padding: 2px;
        }
        .font-btn {
            background: none; border: none;
            color: var(--text-muted); width: 36px; height: 36px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-family: var(--font-title); font-size: 0.7rem;
            font-weight: 700; transition: all 0.25s var(--transition-smooth);
        }
        .font-btn:hover { background: rgba(46, 196, 122, 0.1); color: var(--emerald-light); }
        .font-btn:active { transform: scale(0.88); }

        /* ============================================ */
        /* ===== PROGRESS BAR ===== */
        /* ============================================ */
        .progress-bar {
            position: fixed;
            top: calc(var(--nav-height) + var(--safe-top));
            left: 0; right: 0; height: 2px;
            background: rgba(46, 196, 122, 0.04);
            z-index: 999;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--green-dark), var(--emerald-light), var(--green-light), var(--emerald-light));
            background-size: 200% 100%;
            width: 0%; transition: width 0.2s ease-out;
            border-radius: 0 2px 2px 0;
            box-shadow: 0 0 12px rgba(46, 196, 122, 0.3);
            animation: progressShimmer 3s ease-in-out infinite;
        }
        @keyframes progressShimmer {
            0%, 100% { background-position: 0% center; }
            50% { background-position: 100% center; }
        }

        /* ============================================ */
        /* ===== BOTTOM NAVIGATION ===== */
        /* ============================================ */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; right: 0;
            height: calc(var(--bottom-nav-height) + var(--safe-bottom));
            padding-bottom: var(--safe-bottom);
            background: rgba(12, 26, 19, 0.88);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border-top: 1px solid rgba(46, 196, 122, 0.08);
            z-index: 1000;
            display: flex; align-items: center; justify-content: space-around;
            padding: 0 8px;
        }
        .bottom-nav-item {
            display: flex; flex-direction: column; align-items: center; gap: 4px;
            padding: 8px 10px; border-radius: var(--radius-md); cursor: pointer;
            transition: all 0.3s var(--transition-smooth); border: none; background: none;
            color: var(--text-subtle); font-size: 0.63rem;
            font-family: var(--font-title); letter-spacing: 0.5px;
            position: relative;
        }
        .bottom-nav-item.active {
            color: var(--emerald-light);
            background: rgba(46, 196, 122, 0.08);
        }
        .bottom-nav-item.active::before {
            content: ''; position: absolute; top: -1px; left: 50%;
            transform: translateX(-50%); width: 20px; height: 2px;
            background: var(--emerald-light); border-radius: 2px;
        }
        .bottom-nav-item .icon { font-size: 1.2rem; line-height: 1; transition: transform 0.25s var(--transition-spring); }
        .bottom-nav-item:active .icon { transform: scale(0.9); }
        .bottom-nav-item.active .icon {
            filter: drop-shadow(0 0 6px rgba(46, 196, 122, 0.35));
        }

        /* ============================================ */
        /* ===== MAIN CONTAINER ===== */
        /* ============================================ */
        .container {
            max-width: 660px; margin: 0 auto;
            padding: calc(var(--nav-height) + var(--safe-top) + 6px) 16px 2rem;
        }

        /* ============================================ */
        /* ===== SHIMMER / GOLD TEXT ===== */
        /* ============================================ */
        .gold-text {
            background: linear-gradient(135deg, #2ec47a 0%, #81c784 20%, #c9a84c 50%, #a5d6a7 75%, #2ec47a 100%);
            background-size: 300% auto;
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text; animation: shimmer 8s ease-in-out infinite;
        }
        @keyframes shimmer {
            0%, 100% { background-position: 0% center; }
            50% { background-position: 300% center; }
        }

        /* ============================================ */
        /* ===== HERO SECTION ===== */
        /* ============================================ */
        .hero {
            text-align: center; padding: 2.5rem 1rem 1.8rem;
            position: relative; overflow: hidden;
        }
        .hero::before {
            content: ''; position: absolute;
            top: -60%; left: -60%; right: -60%; bottom: -60%;
            background: radial-gradient(ellipse at center, rgba(46, 196, 122, 0.03) 0%, transparent 55%);
            animation: heroGlow 10s ease-in-out infinite;
        }
        @keyframes heroGlow {
            0%, 100% { opacity: 0.4; transform: scale(1) rotate(0deg); }
            50% { opacity: 1; transform: scale(1.15) rotate(2deg); }
        }
        .hero-content { position: relative; z-index: 1; }

        .bismillah {
            font-family: var(--font-arabic);
            font-size: calc(2rem * var(--font-scale));
            color: var(--gold-mid); margin-bottom: 1.2rem;
            text-shadow: 0 0 24px rgba(201, 168, 76, 0.12);
            line-height: 2.4; letter-spacing: 1px;
        }

        .hero-ornament {
            display: flex; align-items: center; justify-content: center; gap: 14px;
            margin: 0.8rem 0; color: var(--emerald-light); font-size: 0.7rem; opacity: 0.55;
        }
        .hero-ornament .line {
            width: 60px; height: 1px;
            background: linear-gradient(to right, transparent, rgba(46, 196, 122, 0.5));
        }
        .hero-ornament .line:last-child {
            background: linear-gradient(to left, transparent, rgba(46, 196, 122, 0.5));
        }

        h1 {
            font-family: var(--font-title); font-size: 1.7rem; font-weight: 800;
            letter-spacing: 4px; text-transform: uppercase; line-height: 1.3;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            font-family: var(--font-title); font-size: 0.72rem; letter-spacing: 3px;
            color: var(--text-muted); text-transform: uppercase;
            margin-bottom: 1.5rem;
        }

        .intro-text {
            font-family: var(--font-text); font-size: 0.92rem;
            color: var(--text-muted); line-height: 1.9;
            max-width: 480px; margin: 0 auto 1.5rem;
            font-style: italic;
        }

        .stats-row {
            display: flex; justify-content: center; gap: 2rem;
            margin: 1.8rem 0;
        }
        .stat-item { text-align: center; }
        .stat-number {
            font-family: var(--font-title); font-size: 1.5rem;
            color: var(--emerald-light); font-weight: 700;
            letter-spacing: 0.5px;
        }
        .stat-label {
            font-family: var(--font-title); font-size: 0.62rem;
            letter-spacing: 2px; text-transform: uppercase;
            color: var(--text-subtle); margin-top: 4px;
        }

        /* Reading Progress Ring */
        .stat-progress {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .stat-progress svg {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) rotate(-90deg);
            width: 52px; height: 52px;
        }
        .stat-progress .progress-ring-bg {
            fill: none;
            stroke: rgba(46, 196, 122, 0.1);
            stroke-width: 3;
        }
        .stat-progress .progress-ring-fill {
            fill: none;
            stroke: var(--emerald-light);
            stroke-width: 3;
            stroke-linecap: round;
            stroke-dasharray: 138.23;
            stroke-dashoffset: 138.23;
            transition: stroke-dashoffset 1s ease;
        }

        /* ============================================ */
        /* ===== STREAK BANNER ===== */
        /* ============================================ */
        .streak-banner {
            display: flex; align-items: center; justify-content: center; gap: 12px;
            background: rgba(46, 196, 122, 0.04);
            border: 1px solid rgba(46, 196, 122, 0.08);
            border-radius: var(--radius-lg);
            padding: 10px 18px; margin: 0 0 1.2rem;
            font-family: var(--font-title); font-size: 0.7rem;
            letter-spacing: 1.5px; text-transform: uppercase;
            color: var(--text-subtle);
            backdrop-filter: blur(8px);
        }
        .streak-fire { font-size: 1.1rem; }
        .streak-count { color: var(--emerald-light); font-size: 1rem; font-weight: 700; }

        /* ============================================ */
        /* ===== DAILY DUA BANNER ===== */
        /* ============================================ */
        .daily-dua-banner {
            background: var(--bg-glass);
            border: 1px solid rgba(201, 168, 76, 0.1);
            border-radius: var(--radius-lg);
            padding: 1.5rem 1.2rem; margin: 1.2rem 0 2.2rem;
            text-align: center; position: relative; overflow: hidden;
            cursor: pointer;
            transition: all 0.4s var(--transition-smooth);
            backdrop-filter: blur(12px);
            box-shadow: var(--shadow-soft);
        }
        .daily-dua-banner:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-card);
            border-color: rgba(201, 168, 76, 0.2);
        }
        .daily-dua-banner::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
            background: linear-gradient(90deg, transparent, rgba(201, 168, 76, 0.3), transparent);
        }
        .daily-label {
            font-family: var(--font-title); font-size: 0.7rem;
            letter-spacing: 2.5px; text-transform: uppercase;
            color: rgba(201, 168, 76, 0.8); margin-bottom: 0.5rem;
        }
        .daily-label .sparkle { margin: 0 6px; }
        .daily-arabic {
            font-family: var(--font-arabic);
            font-size: calc(1.45rem * var(--font-scale));
            color: var(--gold-light); direction: rtl;
            line-height: 2.3; margin: 0.5rem 0;
        }
        .daily-translation {
            font-family: var(--font-text); font-size: 0.9rem;
            color: var(--text-muted); font-style: italic;
        }
        .daily-share-btn {
            display: inline-block; margin-top: 12px;
            font-family: var(--font-title); font-size: 0.68rem;
            letter-spacing: 1.5px; text-transform: uppercase;
            padding: 6px 18px; border-radius: 20px;
            border: 1px solid rgba(201, 168, 76, 0.35);
            background: rgba(201, 168, 76, 0.12);
            color: var(--gold-light); cursor: pointer;
            transition: all 0.3s;
        }
        .daily-share-btn:hover { background: rgba(201, 168, 76, 0.18); border-color: rgba(201, 168, 76, 0.45); }

        /* ============================================ */
        /* ===== SEARCH BAR ===== */
        /* ============================================ */
        .search-container { position: relative; margin: 1rem 0 1.4rem; }
        .search-input {
            width: 100%; padding: 14px 18px 14px 46px;
            background: var(--bg-glass);
            border: 1px solid rgba(46, 196, 122, 0.1);
            border-radius: var(--radius-xl);
            color: var(--gold-light); font-family: var(--font-text);
            font-size: 0.9rem; outline: none;
            transition: all 0.4s var(--transition-smooth);
            backdrop-filter: blur(12px);
            box-shadow: var(--shadow-soft);
        }
        .search-input::placeholder { color: var(--text-subtle); }
        .search-input:focus {
            border-color: rgba(46, 196, 122, 0.3);
            box-shadow: 0 0 0 3px rgba(46, 196, 122, 0.06), var(--shadow-card);
            background: rgba(22, 40, 30, 0.7);
        }
        .search-icon {
            position: absolute; left: 15px; top: 50%; transform: translateY(-50%);
            color: var(--text-subtle); font-size: 1rem;
        }
        .search-clear {
            position: absolute; right: 14px; top: 50%; transform: translateY(-50%);
            background: none; border: none; color: var(--text-subtle);
            cursor: pointer; font-size: 1rem; display: none;
            transition: color 0.25s;
        }
        .search-clear.visible { display: block; }
        .search-clear:hover { color: var(--emerald-light); }

        /* ============================================ */
        /* ===== TOOLBAR ROW ===== */
        /* ============================================ */
        .toolbar-row {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 12px; gap: 8px; flex-wrap: wrap;
        }
        .toolbar-btn {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 7px 14px; border-radius: 50px;
            background: rgba(46, 196, 122, 0.04);
            border: 1px solid rgba(46, 196, 122, 0.08);
            color: var(--text-subtle);
            font-family: var(--font-title); font-size: 0.7rem;
            letter-spacing: 1.5px; text-transform: uppercase;
            cursor: pointer; transition: all 0.3s var(--transition-smooth); white-space: nowrap;
        }
        .toolbar-btn:hover, .toolbar-btn.active {
            background: rgba(46, 196, 122, 0.1);
            border-color: rgba(46, 196, 122, 0.25); color: var(--emerald-light);
        }
        .toolbar-btn:active { transform: scale(0.95); }

        /* ============================================ */
        /* ===== CATEGORY PILLS ===== */
        /* ============================================ */
        .category-pills {
            display: flex; gap: 8px; overflow-x: auto;
            padding: 4px 0 14px; margin-bottom: 0.8rem;
            -ms-overflow-style: none; scrollbar-width: none;
        }
        .category-pills::-webkit-scrollbar { display: none; }
        .pill {
            flex-shrink: 0; padding: 10px 20px; border-radius: 50px;
            background: rgba(46, 196, 122, 0.04);
            border: 1px solid rgba(46, 196, 122, 0.08);
            color: var(--text-subtle);
            font-family: var(--font-title); font-size: 0.72rem;
            letter-spacing: 1.5px; text-transform: uppercase;
            cursor: pointer; transition: all 0.35s var(--transition-smooth); white-space: nowrap;
        }
        .pill:hover {
            background: rgba(46, 196, 122, 0.08);
            border-color: rgba(46, 196, 122, 0.2); color: var(--text-primary);
        }
        .pill:active { transform: scale(0.97); }
        .pill.active {
            background: linear-gradient(135deg, rgba(46, 196, 122, 0.12), rgba(46, 196, 122, 0.06));
            border-color: rgba(46, 196, 122, 0.3); color: var(--emerald-light);
            box-shadow: 0 0 16px rgba(46, 196, 122, 0.08);
        }
        .pill .count {
            display: inline-block; margin-left: 6px;
            background: rgba(46, 196, 122, 0.1);
            padding: 1px 7px; border-radius: 10px; font-size: 0.6rem;
        }

                /* ============================================ */
        /* ===== DUA CARDS ===== */
        /* ============================================ */
        .dua-card {
            background: var(--bg-glass);
            border: 1px solid rgba(46, 196, 122, 0.07);
            border-radius: var(--radius-lg);
            margin-bottom: 20px; overflow: hidden;
            transition: opacity 0.4s ease, transform 0.4s ease, border-color 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            box-shadow: var(--shadow-soft);
        }
        .dua-card.hidden-card { display: none; }
        .dua-card.read-card { border-left: 3px solid rgba(46, 196, 122, 0.4); }
        .dua-card.read-card .dua-number {
            background: linear-gradient(135deg, rgba(46, 196, 122, 0.2), rgba(46, 196, 122, 0.08));
            border-color: rgba(46, 196, 122, 0.35);
        }
        .dua-card.read-card .dua-number::after {
            content: '✓';
            position: absolute;
            bottom: -4px; right: -4px;
            width: 15px; height: 15px;
            background: var(--emerald-light);
            color: var(--bg-dark);
            border-radius: 50%;
            font-size: 0.45rem; font-weight: 700;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 2px 6px rgba(0,0,0,0.25);
            line-height: 1;
        }
        .dua-card.read-card .action-btn[onclick*="markRead"] {
            background: rgba(46, 196, 122, 0.12);
            border-color: rgba(46, 196, 122, 0.25);
            color: var(--emerald-light);
            pointer-events: none;
        }

        .dua-card:hover {
            border-color: rgba(46, 196, 122, 0.15);
            box-shadow: var(--shadow-card);
            transform: translateY(-1px);
        }

        .dua-card::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
            background: linear-gradient(90deg, transparent, rgba(46, 196, 122, 0.15), transparent);
        }

        .dua-card:focus-within {
            border-color: rgba(46, 196, 122, 0.25);
            box-shadow: 0 0 0 2px rgba(46, 196, 122, 0.08), var(--shadow-card);
        }

        /* ===== AUTHENTICATION BADGE ===== */
        .auth-badge {
            display: inline-block; font-family: var(--font-title);
            font-size: 0.55rem; font-weight: 700;
            padding: 3px 10px; border-radius: 50px;
            letter-spacing: 0.8px; text-transform: uppercase;
            vertical-align: middle; margin-left: 6px;
        }
        .badge-quran { background: rgba(74,26,122,0.12); color: #ce93d8; border: 1px solid rgba(74,26,122,0.25); }
        .badge-sahih { background: rgba(46,196,122,0.1); color: #69f0ae; border: 1px solid rgba(46,196,122,0.2); }
        .badge-hasan { background: rgba(201,168,76,0.12); color: var(--gold-mid); border: 1px solid rgba(201,168,76,0.25); }
        .badge-jayyid { background: rgba(27,107,109,0.12); color: #80deea; border: 1px solid rgba(27,107,109,0.25); }
        .badge-sirah { background: rgba(122,46,59,0.12); color: #ef9a9a; border: 1px solid rgba(122,46,59,0.25); }

        /* Card Header */
        .card-header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 16px 18px 14px; cursor: pointer; user-select: none;
        }
        .card-header-left { display: flex; align-items: center; gap: 12px; flex: 1; }

        .dua-number {
            width: 34px; height: 34px;
            background: linear-gradient(135deg, rgba(46, 196, 122, 0.1), rgba(46, 196, 122, 0.03));
            border: 1px solid rgba(46, 196, 122, 0.15);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-family: var(--font-title); font-size: 0.7rem; font-weight: 700;
            color: var(--emerald-light); flex-shrink: 0;
            position: relative;
            transition: all 0.3s var(--transition-smooth);
        }

        /* Read checkmark on dua number */
        .dua-card.read-card .dua-number {
            background: linear-gradient(135deg, rgba(46, 196, 122, 0.2), rgba(46, 196, 122, 0.08));
            border-color: rgba(46, 196, 122, 0.35);
        }
        .dua-card.read-card .dua-number::after {
            content: '✓';
            position: absolute;
            bottom: -4px; right: -4px;
            width: 15px; height: 15px;
            background: var(--emerald-light);
            color: var(--bg-dark);
            border-radius: 50%;
            font-size: 0.45rem; font-weight: 700;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 2px 6px rgba(0,0,0,0.25);
            line-height: 1;
        }

        /* Mark Read button state on reload */
        .dua-card.read-card .action-btn[onclick*="markRead"] {
            background: rgba(46, 196, 122, 0.12);
            border-color: rgba(46, 196, 122, 0.25);
            color: var(--emerald-light);
            pointer-events: none;
        }

        .card-title-group { flex: 1; min-width: 0; }
        .dua-title {
            font-family: var(--font-title); font-size: calc(0.82rem * var(--font-scale));
            letter-spacing: 1.5px; text-transform: uppercase;
            color: var(--gold-lightest); font-weight: 600; line-height: 1.5;
        }
        .dua-category-tag {
            font-family: var(--font-title); font-size: 0.6rem;
            letter-spacing: 1.2px; text-transform: uppercase;
            color: var(--text-subtle); margin-top: 3px;
        }


        .card-actions { display: flex; gap: 3px; align-items: center; }
        .card-action-btn {
            background: none; border: none;
            color: var(--text-subtle);
            width: 40px; height: 40px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.3s var(--transition-smooth);
            font-size: 0.85rem; position: relative;
        }
        .card-action-btn:hover {
            color: var(--emerald-light);
            background: rgba(46, 196, 122, 0.08);
        }
        .card-action-btn.bookmarked { color: var(--gold-mid); }

        .expand-icon {
            transition: transform 0.35s var(--transition-smooth);
            color: var(--text-subtle); font-size: 0.75rem;
        }
        .dua-card.expanded .expand-icon { transform: rotate(180deg); }

        .card-body-inner { padding: 0 18px 20px; }

        /* Ornamental divider */
        .ornament-divider {
            display: flex; align-items: center; justify-content: center; gap: 12px;
            margin: 6px 0 14px; opacity: 0.4;
        }
        .ornament-divider .line {
            flex: 1; height: 1px; max-width: 50px;
            background: linear-gradient(to right, transparent, var(--emerald-light));
        }
        .ornament-divider .line:last-child {
            background: linear-gradient(to left, transparent, var(--emerald-light));
        }
        .ornament-divider .diamond {
            width: 4px; height: 4px; background: var(--emerald-light);
            transform: rotate(45deg); border-radius: 1px;
        }

        /* Arabic Text */
        .arabic-container {
            background: linear-gradient(135deg, rgba(46, 196, 122, 0.05), rgba(12, 26, 19, 0.4));
            border: 1px solid rgba(46, 196, 122, 0.08);
            border-radius: var(--radius-md);
            padding: 26px 22px; margin-bottom: 14px;
            position: relative; overflow: hidden;
        }
        .arabic-container::before {
            content: '\275D'; position: absolute; top: 10px; right: 14px;
            font-size: 1.8rem; color: rgba(46, 196, 122, 0.05);
            font-family: serif; line-height: 1;
        }

        .arabic-text {
            font-family: var(--font-arabic);
            font-size: calc(1.5rem * var(--font-scale));
            line-height: 2.8; text-align: right; direction: rtl;
            color: var(--gold-lightest); font-weight: 500; word-spacing: 5px;
        }

        /* Word Popup — Tappable Arabic Words */
        .arabic-word {
            cursor: pointer; position: relative;
            border-radius: 4px; padding: 0 2px;
            transition: background 0.2s ease, color 0.2s ease;
            -webkit-tap-highlight-color: transparent;
        }
        .arabic-word:hover { background: rgba(46, 196, 122, 0.08); }
        .arabic-word.active-word { background: rgba(46, 196, 122, 0.15); color: var(--emerald-light); }

        .word-popup {
            position: fixed; z-index: 5000;
            background: var(--bg-surface);
            border: 1px solid rgba(46, 196, 122, 0.2);
            border-radius: var(--radius-md);
            padding: 16px 20px;
            min-width: 200px; max-width: 300px;
            box-shadow: var(--shadow-elevated);
            backdrop-filter: blur(24px) saturate(150%);
            opacity: 0; transform: translateY(8px) scale(0.95);
            transition: opacity 0.25s ease, transform 0.25s var(--transition-spring);
            pointer-events: none;
            text-align: center;
        }
        .word-popup.visible {
            opacity: 1; transform: translateY(0) scale(1);
            pointer-events: auto;
        }
        .word-popup-arabic {
            font-family: var(--font-arabic);
            font-size: calc(2rem * var(--font-scale));
            color: var(--gold-lightest); font-weight: 600;
            line-height: 1.6; margin-bottom: 8px;
            direction: rtl;
        }
        .word-popup-root {
            font-family: var(--font-arabic);
            font-size: 1rem; color: var(--emerald-light);
            margin-bottom: 6px; direction: rtl;
            letter-spacing: 4px;
        }
        .word-popup-root-label {
            font-family: var(--font-title);
            font-size: 0.55rem; letter-spacing: 1.5px;
            text-transform: uppercase; color: var(--text-faint);
            margin-bottom: 2px;
        }
        .word-popup-meaning {
            font-family: var(--font-text);
            font-size: 0.82rem; color: var(--text-muted);
            line-height: 1.5;
        }
        .word-popup-divider {
            width: 30px; height: 1px; margin: 8px auto;
            background: rgba(46, 196, 122, 0.2);
        }
        .word-popup-arrow {
            position: absolute; left: 50%;
            width: 12px; height: 12px; background: var(--bg-surface);
            border: 1px solid rgba(46, 196, 122, 0.2);
            border-top: none; border-left: none;
        }
        .word-popup-arrow.arrow-bottom {
            bottom: -7px;
            transform: translateX(-50%) rotate(45deg);
        }
        .word-popup-arrow.arrow-top {
            top: -7px;
            transform: translateX(-50%) rotate(-135deg);
        }
        [data-theme="light"] .word-popup { background: rgba(255, 255, 255, 0.97); border-color: rgba(13, 123, 80, 0.15); }
        [data-theme="light"] .word-popup-arabic { color: #1a1a0e; }
        [data-theme="light"] .word-popup-arrow { background: rgba(255, 255, 255, 0.97); border-color: rgba(13, 123, 80, 0.15); }
        [data-theme="light"] .arabic-word:hover { background: rgba(13, 123, 80, 0.06); }
        [data-theme="light"] .arabic-word.active-word { background: rgba(13, 123, 80, 0.12); color: #0d7b50; }

        /* Transliteration */
        .transliteration {
            font-family: var(--font-amiri);
            font-size: calc(0.9rem * var(--font-scale));
            color: var(--text-subtle); font-style: italic;
            line-height: 2.0; padding: 10px 0;
            border-bottom: 1px solid rgba(46, 196, 122, 0.05);
            margin-bottom: 10px;
        }

        /* Translation */
        .translation {
            font-family: var(--font-text);
            font-size: calc(0.93rem * var(--font-scale));
            color: var(--text-primary);
            line-height: 2.1; padding: 8px 0;
        }

        /* Source/Reference */
        .reference {
            display: flex; align-items: center; gap: 8px;
            margin-top: 14px; padding-top: 12px;
            border-top: 1px solid rgba(46, 196, 122, 0.05);
        }
        .ref-icon { font-size: 0.75rem; color: var(--text-subtle); }
        .ref-text {
            font-family: var(--font-title); font-size: calc(0.62rem * var(--font-scale));
            letter-spacing: 1px; text-transform: uppercase;
            color: var(--text-subtle);
        }

        /* Virtue/Benefit Tag */
        .virtue-tag {
            display: inline-flex; align-items: center; gap: 6px;
            background: linear-gradient(135deg, rgba(201, 168, 76, 0.06), rgba(201, 168, 76, 0.02));
            border: 1px solid rgba(201, 168, 76, 0.1);
            border-radius: 50px; padding: 7px 14px; margin-top: 10px;
            font-family: var(--font-text); font-size: 0.75rem;
            color: rgba(201, 168, 76, 0.8); font-style: italic;
        }
        .virtue-tag .gem { font-size: 0.65rem; }

        /* How-to box */
        .how-to-box {
            background: rgba(46, 196, 122, 0.03);
            border: 1px solid rgba(46, 196, 122, 0.06);
            border-radius: var(--radius-md);
            padding: 12px 14px; margin-top: 10px;
            font-family: var(--font-text); font-size: calc(0.85rem * var(--font-scale));
            color: var(--text-muted); line-height: 1.9;
        }
        .how-to-box strong { color: var(--emerald-light); }

        /* Action Buttons Row */
        .copy-row {
            display: flex; gap: 6px; margin-top: 12px; flex-wrap: wrap;
        }
        .action-btn {
            display: inline-flex; align-items: center; gap: 5px;
            padding: 9px 16px; border-radius: 50px;
            background: rgba(46, 196, 122, 0.04);
            border: 1px solid rgba(46, 196, 122, 0.1);
            color: var(--text-subtle);
            font-family: var(--font-title); font-size: 0.62rem;
            letter-spacing: 1.2px; text-transform: uppercase;
            cursor: pointer; transition: all 0.3s var(--transition-smooth);
        }
        .action-btn:hover {
            background: rgba(46, 196, 122, 0.1);
            color: var(--emerald-light); border-color: rgba(46, 196, 122, 0.25);
            transform: translateY(-1px);
        }
        .action-btn:active { transform: scale(0.95); }
        .action-btn.copied, .action-btn.read {
            background: rgba(201, 168, 76, 0.08);
            border-color: rgba(201, 168, 76, 0.18);
            color: rgba(201, 168, 76, 0.85);
        }

        /* ============================================ */
        /* ===== SECTION DIVIDERS ===== */
        /* ============================================ */
        .section-header {
            text-align: center; margin: 2.5rem 0 1.2rem;
            position: relative;
        }
        .section-header .section-ornament {
            display: flex; align-items: center; justify-content: center; gap: 16px;
            margin-bottom: 8px;
        }
        .section-header .orn-line {
            width: 40px; height: 1px;
            background: linear-gradient(to right, transparent, rgba(46, 196, 122, 0.25));
        }
        .section-header .orn-line:last-child {
            background: linear-gradient(to left, transparent, rgba(46, 196, 122, 0.25));
        }
        .section-header .orn-center {
            font-size: 1.1rem; color: var(--emerald-light); opacity: 0.5;
        }
        .section-title {
            font-family: var(--font-title); font-size: 0.75rem;
            letter-spacing: 3.5px; text-transform: uppercase;
            color: var(--emerald-light); font-weight: 600;
        }
        .section-subtitle {
            font-family: var(--font-text); font-size: 0.78rem;
            color: var(--text-muted); font-style: italic;
            margin-top: 4px;
        }

        /* ============================================ */
        /* ===== PANELS & OVERLAYS ===== */
        /* ============================================ */

        /* Etiquette Panel */
        .etiquette-panel {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(12, 26, 19, 0.96);
            z-index: 2000; overflow-y: auto;
            padding: calc(var(--safe-top) + 20px) 20px calc(var(--safe-bottom) + 20px);
            backdrop-filter: blur(24px) saturate(150%);
            opacity: 0; visibility: hidden; transform: translateY(20px);
            pointer-events: none;
            transition: opacity 0.45s ease, visibility 0.45s ease, transform 0.45s var(--transition-smooth);
        }
        .etiquette-panel.active { opacity: 1; visibility: visible; transform: translateY(0); pointer-events: auto; }
        .etiquette-close {
            position: fixed; top: calc(var(--safe-top) + 16px); right: 16px;
            background: rgba(46, 196, 122, 0.12); border: 1px solid rgba(46, 196, 122, 0.25);
            color: var(--emerald-light); width: 40px; height: 40px;
            border-radius: 50%; font-size: 1.1rem;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            z-index: 2001; transition: all 0.3s var(--transition-smooth);
        }
        .etiquette-close:hover { background: rgba(46, 196, 122, 0.2); transform: scale(1.08); }
        .etiquette-content {
            max-width: 500px; margin: 0 auto; padding-top: 20px;
        }
        .etiquette-content h2 {
            font-family: var(--font-title); font-size: 1rem;
            letter-spacing: 3px; text-transform: uppercase;
            color: var(--emerald-light); text-align: center; margin-bottom: 1.5rem;
        }
        .etiquette-item {
            display: flex; gap: 12px; margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(46, 196, 122, 0.08);
        }
        .etiquette-num {
            width: 26px; height: 26px; border-radius: 50%;
            background: rgba(46, 196, 122, 0.08);
            border: 1px solid rgba(46, 196, 122, 0.15);
            display: flex; align-items: center; justify-content: center;
            font-family: var(--font-title); font-size: 0.6rem;
            color: var(--emerald-light); flex-shrink: 0;
        }
        .etiquette-text {
            font-family: var(--font-text); font-size: calc(0.88rem * var(--font-scale));
            color: rgba(230, 242, 218, 0.88); line-height: 1.8;
        }
        .etiquette-text strong { color: var(--gold-light); }
        .etiquette-text .ref {
            font-size: 0.7rem; color: rgba(46, 196, 122, 0.6);
            font-style: italic;
        }

        /* Routine Panel */
        .routine-panel {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(12, 26, 19, 0.96);
            z-index: 2000; overflow-y: auto;
            padding: calc(var(--safe-top) + 20px) 20px calc(var(--safe-bottom) + 20px);
            backdrop-filter: blur(24px) saturate(150%);
            opacity: 0; visibility: hidden; transform: translateY(20px);
            pointer-events: none;
            transition: opacity 0.45s ease, visibility 0.45s ease, transform 0.45s var(--transition-smooth);
        }
        .routine-panel.active { opacity: 1; visibility: visible; transform: translateY(0); pointer-events: auto; }
        .routine-content {
            max-width: 500px; margin: 0 auto; padding-top: 20px;
        }
        .routine-content h2 {
            font-family: var(--font-title); font-size: 1rem;
            letter-spacing: 3px; text-transform: uppercase;
            color: var(--emerald-light); text-align: center; margin-bottom: 1.5rem;
        }
        .routine-item {
            padding: 12px 0;
            border-bottom: 1px solid rgba(46, 196, 122, 0.08);
        }
        .routine-time {
            font-family: var(--font-title); font-size: 0.65rem;
            letter-spacing: 1.5px; text-transform: uppercase;
            color: var(--emerald-light); margin-bottom: 4px;
        }
        .routine-desc {
            font-family: var(--font-text); font-size: 0.85rem;
            color: rgba(224, 238, 210, 0.75); line-height: 1.8;
        }
        .routine-desc .dua-ref {
            color: rgba(201, 168, 76, 0.6); font-size: 0.75rem;
            cursor: pointer; text-decoration: underline;
            text-decoration-color: rgba(201, 168, 76, 0.2);
        }
        .routine-desc .dua-ref:hover { color: var(--gold-mid); }

        /* Prayer Panel */
        .prayer-panel {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(12, 26, 19, 0.96);
            z-index: 2000; overflow-y: auto;
            padding: calc(var(--safe-top) + 20px) 20px calc(var(--safe-bottom) + 20px);
            backdrop-filter: blur(24px) saturate(150%);
            opacity: 0; visibility: hidden; transform: translateY(20px);
            pointer-events: none;
            transition: opacity 0.45s ease, visibility 0.45s ease, transform 0.45s var(--transition-smooth);
        }
        .prayer-panel.active { opacity: 1; visibility: visible; transform: translateY(0); pointer-events: auto; }
        .prayer-panel-content {
            max-width: 500px; margin: 0 auto; padding-top: 20px;
        }
        .prayer-panel-content h2 {
            font-family: var(--font-title); font-size: 1rem;
            letter-spacing: 3px; text-transform: uppercase;
            color: var(--emerald-light); text-align: center; margin-bottom: 1.5rem;
        }
        .prayer-location-bar {
            display: flex; align-items: center; justify-content: center; gap: 8px;
            margin-bottom: 1.2rem; padding: 12px 16px;
            background: rgba(46, 196, 122, 0.14);
            border: 1px solid rgba(46, 196, 122, 0.28);
            border-radius: var(--radius-md);
        }
        .prayer-location-bar .loc-icon { font-size: 1.1rem; }
        .prayer-location-bar .loc-text {
            font-family: var(--font-text); font-size: 0.92rem;
            color: rgba(235, 245, 220, 0.95);
        }
        .prayer-location-bar .loc-refresh {
            background: none; border: none; color: var(--emerald-light);
            cursor: pointer; font-size: 1.1rem; padding: 4px 8px;
            border-radius: var(--radius-sm); transition: all 0.3s;
        }
        .prayer-location-bar .loc-refresh:hover { background: rgba(46, 196, 122, 0.1); }
        .prayer-countdown-card {
            text-align: center; padding: 16px;
            background: rgba(46, 196, 122, 0.10);
            border: 1px solid rgba(46, 196, 122, 0.20);
            border-radius: var(--radius-lg); margin-bottom: 1.2rem;
        }
        .prayer-countdown-label {
            font-family: var(--font-title); font-size: 0.75rem;
            letter-spacing: 2px; text-transform: uppercase;
            color: rgba(46, 196, 122, 0.8); margin-bottom: 4px;
        }
        .prayer-countdown-name {
            font-family: var(--font-title); font-size: 1.1rem;
            color: var(--emerald-light); margin-bottom: 2px;
        }
        .prayer-countdown-time {
            font-family: var(--font-title); font-size: 1.8rem;
            color: var(--gold-light); letter-spacing: 2px;
        }
        .prayer-times-grid {
            display: flex; flex-direction: column; gap: 6px; margin-bottom: 1.5rem;
        }
        .prayer-time-row {
            display: flex; align-items: center; justify-content: space-between;
            padding: 12px 16px;
            background: rgba(46, 196, 122, 0.08);
            border: 1px solid rgba(46, 196, 122, 0.14);
            border-radius: var(--radius-md);
            transition: all 0.3s;
        }
        .prayer-time-row.active-prayer {
            background: rgba(46, 196, 122, 0.15);
            border-color: rgba(46, 196, 122, 0.35);
            box-shadow: 0 0 12px rgba(46, 196, 122, 0.08);
        }
        .prayer-time-row.active-prayer .prayer-name { color: var(--emerald-light); }
        .prayer-time-row.passed-prayer { opacity: 0.6; }
        .prayer-name {
            font-family: var(--font-title); font-size: 0.8rem;
            letter-spacing: 1px; text-transform: uppercase;
            color: rgba(224, 238, 210, 0.8);
        }
        .prayer-time-val {
            font-family: var(--font-title); font-size: 0.85rem;
            color: var(--gold-light); letter-spacing: 1px;
        }
        /* Qibla Compass */
        .qibla-section {
            text-align: center; margin-top: 1.5rem; margin-bottom: 1.5rem;
            padding: 20px;
            background: rgba(46, 196, 122, 0.08);
            border: 1px solid rgba(46, 196, 122, 0.18);
            border-radius: var(--radius-lg);
        }
        .qibla-title {
            font-family: var(--font-title); font-size: 0.72rem;
            letter-spacing: 2px; text-transform: uppercase;
            color: rgba(46, 196, 122, 0.8); margin-bottom: 16px;
        }
        .qibla-compass {
            width: 180px; height: 180px; margin: 0 auto 12px;
            position: relative;
            border-radius: 50%;
            border: 2px solid rgba(46, 196, 122, 0.25);
            background: rgba(12, 26, 19, 0.6);
        }
        .qibla-compass .compass-rose {
            position: absolute; inset: 0;
            display: flex; align-items: center; justify-content: center;
            font-family: var(--font-title); font-size: 0.65rem;
            color: rgba(224, 238, 210, 0.5); letter-spacing: 1px;
        }
        .qibla-compass .compass-n { position: absolute; top: 8px; left: 50%; transform: translateX(-50%); color: rgba(46, 196, 122, 0.8); font-size: 0.7rem; font-family: var(--font-title); }
        .qibla-compass .compass-s { position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%); color: rgba(224,238,210,0.55); font-size: 0.7rem; font-family: var(--font-title); }
        .qibla-compass .compass-e { position: absolute; right: 8px; top: 50%; transform: translateY(-50%); color: rgba(224,238,210,0.55); font-size: 0.7rem; font-family: var(--font-title); }
        .qibla-compass .compass-w { position: absolute; left: 8px; top: 50%; transform: translateY(-50%); color: rgba(224,238,210,0.55); font-size: 0.7rem; font-family: var(--font-title); }
        .qibla-arrow {
            position: absolute; top: 50%; left: 50%;
            width: 4px; height: 70px;
            margin-left: -2px; margin-top: -60px;
            background: linear-gradient(to bottom, var(--emerald-light), transparent);
            border-radius: 2px;
            transform-origin: bottom center;
            transition: transform 0.5s ease;
        }
        .qibla-arrow::before {
            content: '🕋'; position: absolute; top: -16px; left: 50%;
            transform: translateX(-50%); font-size: 1.1rem;
        }
        .qibla-degree {
            font-family: var(--font-title); font-size: 0.8rem;
            color: rgba(224, 238, 210, 0.8); letter-spacing: 1px;
        }
        .qibla-status {
            font-family: var(--font-text); font-size: 0.78rem;
            color: rgba(224, 238, 210, 0.75); margin-top: 6px;
        }
        /* Notification toggle */
        .prayer-notify-row {
            display: flex; align-items: center; justify-content: space-between;
            padding: 14px 16px; margin-top: 1rem;
            background: rgba(46, 196, 122, 0.14);
            border: 1px solid rgba(46, 196, 122, 0.28);
            border-radius: var(--radius-md);
        }
        .prayer-notify-label {
            font-family: var(--font-title); font-size: 0.85rem;
            letter-spacing: 1px; color: rgba(235, 245, 220, 0.95);
        }
        .toggle-switch {
            position: relative; width: 44px; height: 24px; cursor: pointer;
        }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider {
            position: absolute; inset: 0;
            background: rgba(46, 196, 122, 0.22);
            border-radius: 24px; transition: 0.3s;
        }
        .toggle-slider::before {
            content: ''; position: absolute; height: 18px; width: 18px;
            left: 3px; bottom: 3px; background: rgba(224,238,210,0.75);
            border-radius: 50%; transition: 0.3s;
        }
        .toggle-switch input:checked + .toggle-slider {
            background: rgba(46, 196, 122, 0.5);
        }
        .toggle-switch input:checked + .toggle-slider::before {
            transform: translateX(20px);
            background: var(--emerald-light);
        }
        /* Prayer grid dynamic classes */
        .prayer-time-icon { font-size: 1rem; width: 28px; }
        .prayer-time-name {
            font-family: var(--font-title); font-size: 0.75rem;
            letter-spacing: 1px; text-transform: uppercase;
            color: rgba(224, 238, 210, 0.8); flex: 1;
        }
        .prayer-time-value {
            font-family: var(--font-title); font-size: 0.85rem;
            color: var(--gold-light); letter-spacing: 1px;
        }
        .prayer-time-row.current-prayer {
            background: rgba(46, 196, 122, 0.12);
            border-color: rgba(46, 196, 122, 0.3);
            box-shadow: 0 0 16px rgba(46, 196, 122, 0.1);
        }
        .prayer-time-row.current-prayer .prayer-time-name { color: var(--emerald-light); font-weight: 600; }
        .prayer-time-row.next-prayer {
            background: rgba(46, 196, 122, 0.06);
            border-color: rgba(46, 196, 122, 0.15);
        }
        .prayer-now-badge, .prayer-next-badge {
            font-family: var(--font-title); font-size: 0.65rem;
            letter-spacing: 1px; padding: 3px 10px;
            border-radius: 20px; margin-left: 8px;
        }
        .prayer-now-badge {
            background: rgba(46, 196, 122, 0.25); color: var(--emerald-light);
            border: 1px solid rgba(46, 196, 122, 0.3);
        }
        .prayer-next-badge {
            background: rgba(212, 175, 55, 0.18); color: var(--gold-light);
            border: 1px solid rgba(212, 175, 55, 0.2);
        }

        /* Tasbeeh Panel */
        .tasbeeh-panel {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(12, 26, 19, 0.96);
            z-index: 2000;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            padding: 2rem; backdrop-filter: blur(24px) saturate(150%);
            opacity: 0; visibility: hidden; transform: scale(0.97);
            pointer-events: none;
            transition: opacity 0.45s ease, visibility 0.45s ease, transform 0.45s var(--transition-smooth);
        }
        .tasbeeh-panel.active { opacity: 1; visibility: visible; transform: scale(1); pointer-events: auto; }
        .tasbeeh-close {
            position: absolute; top: calc(var(--safe-top) + 16px); right: 16px;
            background: rgba(46, 196, 122, 0.06); border: 1px solid rgba(46, 196, 122, 0.15);
            color: var(--emerald-light); width: 40px; height: 40px;
            border-radius: 50%; font-size: 1.1rem;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: all 0.3s var(--transition-smooth);
        }
        .tasbeeh-close:hover { background: rgba(46, 196, 122, 0.12); transform: scale(1.08); }
        .tasbeeh-title {
            font-family: var(--font-title); font-size: 0.7rem;
            letter-spacing: 3px; text-transform: uppercase;
            color: rgba(46, 196, 122, 0.7); margin-bottom: 1rem;
        }
        .tasbeeh-arabic {
            font-family: var(--font-arabic);
            font-size: calc(1.6rem * var(--font-scale));
            color: var(--gold-light); direction: rtl;
            text-align: center; line-height: 2;
            margin-bottom: 2rem; max-width: 90%;
        }
        .tasbeeh-count-display {
            font-family: var(--font-title);
            font-size: 4.5rem; font-weight: 800;
            color: var(--emerald-light); line-height: 1;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 40px rgba(46, 196, 122, 0.25);
        }
        .tasbeeh-target {
            font-family: var(--font-title); font-size: 0.68rem;
            letter-spacing: 1.5px; text-transform: uppercase;
            color: rgba(46, 196, 122, 0.7); margin-bottom: 2rem;
        }
        .tasbeeh-tap-btn {
            width: 130px; height: 130px; border-radius: 50%;
            background: linear-gradient(135deg, rgba(46, 196, 122, 0.1), rgba(46, 196, 122, 0.03));
            border: 2px solid rgba(46, 196, 122, 0.25);
            color: var(--emerald-light); font-family: var(--font-title);
            font-size: 0.7rem; letter-spacing: 2px; text-transform: uppercase;
            cursor: pointer; transition: all 0.15s var(--transition-smooth);
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 40px rgba(46, 196, 122, 0.06);
            -webkit-user-select: none; user-select: none;
        }
        .tasbeeh-tap-btn:active {
            transform: scale(0.92);
            background: rgba(46, 196, 122, 0.18);
            box-shadow: 0 0 60px rgba(46, 196, 122, 0.15);
        }
        .tasbeeh-controls {
            display: flex; gap: 10px; margin-top: 1.5rem;
        }
        .tasbeeh-ctrl-btn {
            padding: 12px 22px; border-radius: 50px;
            background: rgba(46, 196, 122, 0.04);
            border: 1px solid rgba(46, 196, 122, 0.1);
            color: var(--text-subtle);
            font-family: var(--font-title); font-size: 0.65rem;
            letter-spacing: 1.5px; text-transform: uppercase;
            cursor: pointer; transition: all 0.3s var(--transition-smooth);
        }
        .tasbeeh-ctrl-btn:hover {
            background: rgba(46, 196, 122, 0.1); color: var(--emerald-light);
        }
        .tasbeeh-presets {
            display: flex; gap: 6px; margin-top: 1rem;
        }
        .tasbeeh-preset {
            padding: 10px 18px; border-radius: 50px;
            background: rgba(46, 196, 122, 0.04);
            border: 1px solid rgba(46, 196, 122, 0.08);
            color: var(--text-subtle);
            font-family: var(--font-title); font-size: 0.65rem;
            cursor: pointer; transition: all 0.25s var(--transition-smooth);
        }
        .tasbeeh-preset:hover, .tasbeeh-preset.active {
            border-color: rgba(46, 196, 122, 0.3); color: var(--emerald-light);
            background: rgba(46, 196, 122, 0.08);
        }

        /* Dhikr Selector */
        .dhikr-selector {
            display: flex; gap: 8px; overflow-x: auto;
            width: 100%; max-width: 400px;
            padding: 4px 2px 12px; margin-bottom: 1.2rem;
            scrollbar-width: none; -ms-overflow-style: none;
            scroll-snap-type: x mandatory;
        }
        .dhikr-selector::-webkit-scrollbar { display: none; }
        .dhikr-option {
            flex-shrink: 0; scroll-snap-align: center;
            display: flex; flex-direction: column; align-items: center;
            gap: 3px; padding: 10px 14px; border-radius: var(--radius-lg);
            background: rgba(46, 196, 122, 0.03);
            border: 1px solid rgba(46, 196, 122, 0.08);
            cursor: pointer; transition: all 0.3s var(--transition-smooth);
            min-width: 72px; text-align: center;
            -webkit-user-select: none; user-select: none;
        }
        .dhikr-option:active { transform: scale(0.96); }
        .dhikr-option.active {
            background: linear-gradient(135deg, rgba(46, 196, 122, 0.12), rgba(46, 196, 122, 0.05));
            border-color: rgba(46, 196, 122, 0.35);
            box-shadow: 0 0 20px rgba(46, 196, 122, 0.08);
        }
        .dhikr-option-ar {
            font-family: var(--font-arabic); font-size: 0.85rem;
            color: var(--gold-light); direction: rtl; line-height: 1.4;
            white-space: nowrap;
        }
        .dhikr-option.active .dhikr-option-ar { color: var(--emerald-light); }
        .dhikr-option-en {
            font-family: var(--font-title); font-size: 0.52rem;
            letter-spacing: 0.5px; text-transform: uppercase;
            color: var(--text-faint); white-space: nowrap;
        }
        .dhikr-option.active .dhikr-option-en { color: rgba(46, 196, 122, 0.55); }

        /* Dhikr virtue hint */
        .tasbeeh-virtue {
            font-family: var(--font-text); font-size: 0.75rem;
            color: var(--text-subtle); font-style: italic;
            text-align: center; max-width: 300px;
            margin-bottom: 1.5rem; line-height: 1.5;
            transition: opacity 0.3s ease;
        }

        /* Lifetime total */
        .tasbeeh-lifetime {
            font-family: var(--font-title); font-size: 0.5rem;
            letter-spacing: 1.5px; text-transform: uppercase;
            color: var(--text-subtle); margin-top: 1.2rem;
        }
        .tasbeeh-lifetime span { color: var(--gold-mid); }

        [data-theme="light"] .dhikr-option { background: rgba(13, 123, 80, 0.04); border-color: rgba(13, 123, 80, 0.1); }
        [data-theme="light"] .dhikr-option.active { background: rgba(13, 123, 80, 0.08); border-color: rgba(13, 123, 80, 0.25); }
        [data-theme="light"] .dhikr-option-ar { color: #2d2d1a; }
        [data-theme="light"] .dhikr-option.active .dhikr-option-ar { color: #1b5e20; }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(46, 196, 122, 0.25); }
            70% { box-shadow: 0 0 0 20px rgba(46, 196, 122, 0); }
            100% { box-shadow: 0 0 0 0 rgba(46, 196, 122, 0); }
        }
        .tasbeeh-tap-btn.pulse { animation: pulse 0.6s ease-out; }

        /* ============================================ */
        /* ===== BACK TO TOP ===== */
        /* ============================================ */
        .back-to-top {
            position: fixed;
            bottom: calc(var(--bottom-nav-height) + var(--safe-bottom) + 16px);
            right: 16px; width: 40px; height: 40px;
            background: rgba(12, 26, 19, 0.8);
            border: 1px solid rgba(46, 196, 122, 0.12);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            color: var(--emerald-light); font-size: 1rem;
            cursor: pointer; z-index: 500;
            opacity: 0; transform: translateY(20px);
            transition: all 0.35s var(--transition-smooth); backdrop-filter: blur(16px);
        }
        .back-to-top.visible { opacity: 1; transform: translateY(0); }
        .back-to-top:hover {
            background: rgba(46, 196, 122, 0.1);
            border-color: rgba(46, 196, 122, 0.3);
            transform: translateY(-2px);
        }

        /* ============================================ */
        /* ===== TOAST NOTIFICATION ===== */
        /* ============================================ */
        .toast {
            position: fixed;
            bottom: calc(var(--bottom-nav-height) + var(--safe-bottom) + 24px);
            left: 50%; transform: translateX(-50%) translateY(100px);
            background: rgba(12, 26, 19, 0.88);
            border: 1px solid rgba(46, 196, 122, 0.12);
            padding: 12px 26px; border-radius: 50px;
            color: var(--gold-light); font-family: var(--font-text);
            font-size: 0.84rem; z-index: 3000;
            backdrop-filter: blur(24px) saturate(180%);
            opacity: 0; transition: all 0.4s var(--transition-smooth);
            white-space: nowrap; box-shadow: var(--shadow-elevated);
        }
        .toast.show {
            transform: translateX(-50%) translateY(0); opacity: 1;
        }

        /* ============================================ */
        /* ===== OVERLAY & SIDE PANEL ===== */
        /* ============================================ */
        .overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5); z-index: 1500;
            opacity: 0; visibility: hidden;
            pointer-events: none;
            transition: opacity 0.4s ease, visibility 0.4s ease;
            -webkit-backdrop-filter: blur(4px);
            backdrop-filter: blur(4px);
        }
        .overlay.active { opacity: 1; visibility: visible; pointer-events: auto; }

        .side-panel {
            position: fixed; top: 0; right: 0; bottom: 0;
            width: 300px; max-width: 85vw;
            background: var(--bg-card);
            border-left: 1px solid rgba(46, 196, 122, 0.15);
            z-index: 1600; padding: 24px 16px;
            overflow-y: auto;
            transform: translateX(100%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .side-panel.active { transform: translateX(0); }

        .panel-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; padding-bottom: 12px;
            border-bottom: 1px solid rgba(46, 196, 122, 0.12);
        }
        .panel-title {
            font-family: var(--font-title); font-size: 0.75rem;
            letter-spacing: 2px; text-transform: uppercase;
            color: var(--emerald-light);
        }
        .panel-close {
            background: none; border: none; color: var(--emerald-light);
            font-size: 1.2rem; cursor: pointer; padding: 4px;
        }
        .panel-empty {
            text-align: center; padding: 3rem 1rem;
            color: rgba(224, 238, 210, 0.45);
            font-style: italic; font-size: 0.9rem;
        }
        .panel-item {
            padding: 12px; border-radius: var(--radius-md);
            border: 1px solid rgba(46, 196, 122, 0.1);
            margin-bottom: 8px; cursor: pointer;
            transition: all 0.3s ease;
        }
        .panel-item:hover {
            background: rgba(46, 196, 122, 0.06);
            border-color: rgba(46, 196, 122, 0.2);
        }
        .panel-item-title {
            font-family: var(--font-title); font-size: 0.65rem;
            letter-spacing: 1px; text-transform: uppercase;
            color: var(--gold-light); margin-bottom: 4px;
        }
        .panel-item-arabic {
            font-family: var(--font-arabic); font-size: 1rem;
            color: var(--gold-lightest); direction: rtl; text-align: right;
            line-height: 1.8; white-space: nowrap; overflow: hidden;
            text-overflow: ellipsis;
        }

        /* ============================================ */
        /* ===== FOOTER ===== */
        /* ============================================ */
        .footer {
            text-align: center; padding: 3rem 1rem 1rem;
            margin-top: 2rem;
        }
        .footer-ornament {
            display: flex; align-items: center; justify-content: center; gap: 12px;
            margin-bottom: 1.5rem; opacity: 0.3;
        }
        .footer-ornament .line {
            width: 50px; height: 1px;
            background: linear-gradient(to right, transparent, var(--emerald-light));
        }
        .footer-ornament .line:last-child {
            background: linear-gradient(to left, transparent, var(--emerald-light));
        }
        .footer-text {
            font-family: var(--font-title); font-size: 0.7rem;
            letter-spacing: 1.5px; text-transform: uppercase;
            color: rgba(224, 238, 210, 0.4); line-height: 2;
        }
        .footer-arabic {
            font-family: var(--font-arabic); font-size: 1.2rem;
            color: rgba(46, 196, 122, 0.3); margin-top: 12px;
            direction: rtl;
        }

        /* ===== NO RESULTS ===== */
        .no-results {
            text-align: center; padding: 3rem 1rem; display: none;
        }
        .no-results.visible { display: block; }
        .no-results-icon { font-size: 2.5rem; margin-bottom: 1rem; opacity: 0.3; }
        .no-results-text {
            font-family: var(--font-text); font-size: 0.95rem;
            color: rgba(224, 238, 210, 0.55); font-style: italic;
        }

                /* ============================================ */
        /* ===== RANDOM DUA BUTTON ===== */
        /* ============================================ */
        .random-glow {
            animation: randomGlow 1.5s ease;
        }
        @keyframes randomGlow {
            0% { box-shadow: 0 0 0 0 rgba(46, 196, 122, 0.4); }
            30% { box-shadow: 0 0 30px 5px rgba(46, 196, 122, 0.2); }
            100% { box-shadow: none; }
        }

        /* ============================================ */
        /* ===== COLLAPSIBLE SECTIONS ===== */
        /* ============================================ */
        .section-header {
            cursor: pointer;
            user-select: none;
            transition: opacity 0.3s ease;
        }
        .section-header:hover {
            opacity: 0.85;
        }
        .section-header:active {
            opacity: 0.7;
        }

        .section-toggle {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px; height: 32px;
            border-radius: 50%;
            background: rgba(46, 196, 122, 0.1);
            border: 1px solid rgba(46, 196, 122, 0.2);
            color: var(--emerald-light);
            font-size: 0.6rem;
            margin-top: 8px;
            transition: transform 0.3s ease, background 0.3s ease;
        }
        .section-header.collapsed .section-toggle {
            transform: rotate(-90deg);
            background: rgba(46, 196, 122, 0.05);
        }

        .section-collapse-hint {
            font-family: var(--font-title);
            font-size: 0.58rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--text-subtle);
            margin-top: 4px;
        }
        .section-header:hover .section-collapse-hint {
            color: rgba(46, 196, 122, 0.6);
        }

        /* ============================================ */
        /* ===== KEYBOARD & ACCESSIBILITY ===== */
        /* ============================================ */
        .card-header:focus-visible {
            outline: 2px solid rgba(46, 196, 122, 0.5);
            outline-offset: -2px;
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        }
        .card-action-btn:focus-visible,
        .nav-btn:focus-visible,
        .font-btn:focus-visible,
        .toolbar-btn:focus-visible,
        .pill:focus-visible,
        .action-btn:focus-visible,
        .bottom-nav-item:focus-visible,
        .tasbeeh-tap-btn:focus-visible,
        .tasbeeh-preset:focus-visible,
        .tasbeeh-ctrl-btn:focus-visible {
            outline: 2px solid rgba(46, 196, 122, 0.5);
            outline-offset: 2px;
        }

        .skip-link {
            position: absolute; top: -100px; left: 16px;
            background: var(--emerald-light); color: var(--bg-dark);
            padding: 8px 16px; border-radius: var(--radius-md);
            font-family: var(--font-title); font-size: 0.75rem;
            letter-spacing: 1px; text-transform: uppercase;
            z-index: 9999; transition: top 0.3s ease;
            text-decoration: none;
        }
        .skip-link:focus { top: calc(var(--safe-top) + 8px); }

        /* ============================================ */
        /* ===== MEMORIZATION MODE ===== */
        /* ============================================ */
        .memorize-btn {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 6px 14px; border-radius: 50px;
            background: rgba(74, 26, 122, 0.08);
            border: 1px solid rgba(74, 26, 122, 0.2);
            color: #b388ff;
            font-family: var(--font-title); font-size: 0.62rem;
            letter-spacing: 1px; text-transform: uppercase;
            cursor: pointer; transition: all 0.3s ease;
        }
        .memorize-btn:hover {
            background: rgba(74, 26, 122, 0.1);
            border-color: rgba(74, 26, 122, 0.3);
        }
        .memorize-btn.active {
            background: rgba(74, 26, 122, 0.2);
            border-color: #b388ff;
            color: #ce93d8;
        }
        .dua-card.memorize-mode .arabic-text {
            filter: blur(12px);
            transition: filter 0.4s ease;
            cursor: pointer;
        }
        .dua-card.memorize-mode .arabic-text:hover,
        .dua-card.memorize-mode .arabic-text.revealed {
            filter: blur(0);
        }
        .dua-card.memorize-mode .arabic-container::after {
            content: 'Tap to reveal';
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-family: var(--font-title); font-size: 0.6rem;
            letter-spacing: 2px; text-transform: uppercase;
            color: rgba(179, 136, 255, 0.7);
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 2;
        }
        .dua-card.memorize-mode .arabic-text.revealed ~ .arabic-container::after,
        .dua-card.memorize-mode .arabic-container:hover::after {
            opacity: 0;
        }
        .dua-card.memorize-mode .arabic-text.revealed + * {
            opacity: 1; /* sibling hint removed once revealed */
        }
        /* Spaced Repetition */
        .sr-rating-row {
            display: flex; gap: 8px; justify-content: center;
            margin-top: 8px; padding: 8px 0;
            opacity: 0; max-height: 0; overflow: hidden;
            transition: opacity 0.3s ease, max-height 0.3s ease;
        }
        .sr-rating-row.visible { opacity: 1; max-height: 60px; }
        .sr-rating-btn {
            font-family: var(--font-title); font-size: 0.6rem;
            letter-spacing: 1px; text-transform: uppercase;
            padding: 6px 20px; border-radius: 20px;
            border: 1px solid rgba(46, 196, 122, 0.25);
            background: rgba(46, 196, 122, 0.1);
            color: rgba(224, 238, 210, 0.85);
            cursor: pointer; transition: all 0.3s;
        }
        .sr-rating-btn:hover { background: rgba(46, 196, 122, 0.12); color: var(--emerald-light); }
        .sr-rating-btn.sr-easy { border-color: rgba(46, 196, 122, 0.2); }
        .sr-rating-btn.sr-hard { border-color: rgba(212, 175, 55, 0.2); }
        .sr-review-badge {
            font-family: var(--font-title); font-size: 0.62rem;
            letter-spacing: 1px; text-transform: uppercase;
            padding: 3px 10px; border-radius: 20px;
            background: rgba(212, 175, 55, 0.12); color: var(--gold-light);
            border: 1px solid rgba(212, 175, 55, 0.2);
            margin-left: 8px; vertical-align: middle;
        }

        /* ============================================ */
        /* ===== CARD ENTRANCE ANIMATIONS ===== */
        /* ============================================ */
        .dua-card {
            opacity: 0;
            transform: translateY(20px);
        }
        .dua-card.visible {
            opacity: 1;
            transform: translateY(0);
            transition: opacity 0.45s cubic-bezier(0.16, 1, 0.3, 1),
                        transform 0.45s cubic-bezier(0.16, 1, 0.3, 1),
                        border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .dua-card:nth-child(odd).visible { transition-delay: 0.05s; }
        .dua-card:nth-child(even).visible { transition-delay: 0.12s; }

        /* Expand body with spring-like easing */
        .card-body {
            max-height: 0; overflow: hidden;
            transition: max-height 0.45s cubic-bezier(0.33, 1, 0.68, 1);
        }
        .dua-card.expanded .card-body { max-height: 5000px; }
        .dua-card.expanded { border-color: rgba(46, 196, 122, 0.15); box-shadow: var(--shadow-card); }

        /* ===== PROGRESS PANEL ===== */
        .progress-panel {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(12, 26, 19, 0.96);
            z-index: 2000; overflow-y: auto;
            padding: calc(var(--safe-top) + 20px) 20px calc(var(--safe-bottom) + 20px);
            backdrop-filter: blur(24px) saturate(150%);
            opacity: 0; visibility: hidden; transform: translateY(20px);
            pointer-events: none;
            transition: opacity 0.45s ease, visibility 0.45s ease, transform 0.45s var(--transition-smooth);
        }
        .progress-panel.active { opacity: 1; visibility: visible; transform: translateY(0); pointer-events: auto; }
        [data-theme="light"] .progress-panel { background: rgba(247, 245, 239, 0.97); }
        .progress-panel-content {
            max-width: 500px; margin: 0 auto; padding-top: 20px;
        }
        .progress-panel-content h2 {
            font-family: var(--font-title); font-size: 1rem;
            letter-spacing: 3px; text-transform: uppercase;
            color: var(--emerald-light); text-align: center; margin-bottom: 1.5rem;
        }
        .progress-stat-card {
            background: var(--bg-glass);
            border: 1px solid rgba(46, 196, 122, 0.08);
            border-radius: var(--radius-lg);
            padding: 18px; margin-bottom: 10px;
            display: flex; align-items: center; gap: 14px;
            backdrop-filter: blur(12px);
            box-shadow: var(--shadow-soft);
        }
        .progress-stat-icon { font-size: 1.8rem; flex-shrink: 0; }
        .progress-stat-info { flex: 1; }
        .progress-stat-label {
            font-family: var(--font-title); font-size: 0.7rem;
            letter-spacing: 1.5px; text-transform: uppercase;
            color: var(--text-subtle); margin-bottom: 2px;
        }
        .progress-stat-value {
            font-family: var(--font-title); font-size: 1.4rem;
            color: var(--emerald-light); font-weight: 700;
        }
        .progress-stat-sub {
            font-family: var(--font-text); font-size: 0.75rem;
            color: var(--text-subtle); margin-top: 2px;
        }
        .progress-bar-visual {
            width: 100%; height: 6px; border-radius: 3px;
            background: rgba(46, 196, 122, 0.1); margin-top: 8px; overflow: hidden;
        }
        .progress-bar-fill {
            height: 100%; border-radius: 3px;
            background: linear-gradient(90deg, var(--green-dark), var(--emerald-light), var(--green-light));
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .progress-reset-btn {
            display: block; margin: 24px auto 0; padding: 10px 24px;
            border-radius: 50px; background: rgba(122, 46, 59, 0.06);
            border: 1px solid rgba(122, 46, 59, 0.12);
            color: #ef9a9a; font-family: var(--font-title);
            font-size: 0.62rem; letter-spacing: 1.5px; text-transform: uppercase;
            cursor: pointer; transition: all 0.3s var(--transition-smooth);
        }
        .progress-reset-btn:hover {
            background: rgba(122, 46, 59, 0.12);
            border-color: rgba(122, 46, 59, 0.25);
        }
        .progress-share-btn {
            display: block; margin: 12px auto 0; padding: 10px 24px;
            border-radius: 50px; background: rgba(46, 196, 122, 0.12);
            border: 1px solid rgba(46, 196, 122, 0.25);
            color: var(--emerald-light); font-family: var(--font-title);
            font-size: 0.7rem; letter-spacing: 1.5px; text-transform: uppercase;
            cursor: pointer; transition: all 0.3s var(--transition-smooth);
        }
        .progress-share-btn:hover {
            background: rgba(46, 196, 122, 0.18);
            border-color: rgba(46, 196, 122, 0.35);
        }

        /* ===== AUDIO RECITATION BUTTON ===== */
        .audio-btn {
            position: relative; overflow: hidden;
        }
        .audio-btn.playing {
            background: rgba(46, 196, 122, 0.12) !important;
            border-color: rgba(46, 196, 122, 0.3) !important;
            color: var(--emerald-light) !important;
        }
        .audio-btn.playing::after {
            content: ''; position: absolute; top: 50%; left: 50%;
            width: 120%; height: 120%; border-radius: 50%;
            background: rgba(46, 196, 122, 0.08);
            transform: translate(-50%, -50%) scale(0);
            animation: audioPulse 1.5s ease-in-out infinite;
        }
        @keyframes audioPulse {
            0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0.5; }
            100% { transform: translate(-50%, -50%) scale(1.4); opacity: 0; }
        }

        /* ===== TIME-BASED SUGGESTION BANNER ===== */
        .time-banner {
            background: var(--bg-glass);
            border: 1px solid rgba(46, 196, 122, 0.08);
            border-radius: var(--radius-lg); padding: 16px 18px;
            margin: 0 0 14px; cursor: pointer;
            transition: all 0.35s var(--transition-smooth);
            backdrop-filter: blur(12px);
            box-shadow: var(--shadow-soft);
        }
        .time-banner:hover { border-color: rgba(46, 196, 122, 0.2); transform: translateY(-2px); box-shadow: var(--shadow-card); }
        .time-banner-header {
            display: flex; align-items: center; gap: 10px; margin-bottom: 8px;
        }
        .time-banner-icon { font-size: 1.5rem; }
        .time-banner-title {
            font-family: var(--font-title); font-size: 0.72rem;
            letter-spacing: 1.5px; text-transform: uppercase;
            color: var(--emerald-light);
        }
        .time-banner-period {
            font-family: var(--font-text); font-size: 0.85rem;
            color: var(--gold-light); font-style: italic; margin-bottom: 10px;
        }
        .time-banner-duas {
            display: flex; flex-wrap: wrap; gap: 6px;
        }
        .time-dua-chip {
            display: inline-flex; align-items: center; gap: 4px;
            padding: 5px 12px; border-radius: 50px;
            background: rgba(46, 196, 122, 0.04);
            border: 1px solid rgba(46, 196, 122, 0.08);
            font-family: var(--font-text); font-size: 0.72rem;
            color: var(--text-faint); cursor: pointer;
            transition: all 0.25s var(--transition-smooth);
        }
        .time-dua-chip:hover {
            background: rgba(46, 196, 122, 0.1);
            border-color: rgba(46, 196, 122, 0.25); color: var(--emerald-light);
        }
        [data-theme="light"] .time-banner {
            background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(12px);
        }

        /* ===== ENHANCED DASHBOARD ===== */
        .progress-week-grid {
            display: grid; grid-template-columns: repeat(7, 1fr);
            gap: 4px; margin-top: 10px;
        }
        .progress-day-cell {
            aspect-ratio: 1; border-radius: 6px;
            background: rgba(46, 196, 122, 0.03);
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            font-family: var(--font-title); font-size: 0.52rem;
            letter-spacing: 0.5px; color: var(--text-faint);
            transition: all 0.3s var(--transition-smooth);
        }
        .progress-day-cell.active {
            background: rgba(46, 196, 122, 0.12);
            border: 1px solid rgba(46, 196, 122, 0.2);
            color: var(--emerald-light);
        }
        .progress-day-cell.today {
            border: 1px solid var(--emerald-light);
            box-shadow: 0 0 10px rgba(46, 196, 122, 0.15);
        }
        .progress-achievements {
            display: grid; grid-template-columns: 1fr 1fr; gap: 8px;
            margin-top: 12px;
        }
        .achievement-badge {
            background: rgba(46, 196, 122, 0.03);
            border: 1px solid rgba(46, 196, 122, 0.06);
            border-radius: var(--radius-md); padding: 12px;
            text-align: center; transition: all 0.3s var(--transition-smooth);
        }
        .achievement-badge.earned {
            background: rgba(46, 196, 122, 0.08);
            border-color: rgba(46, 196, 122, 0.18);
        }
        .achievement-badge.locked {
            opacity: 0.4; filter: grayscale(0.8);
        }
        .achievement-icon { font-size: 1.5rem; margin-bottom: 4px; }
        .achievement-name {
            font-family: var(--font-title); font-size: 0.6rem;
            letter-spacing: 1px; text-transform: uppercase;
            color: var(--text-muted);
        }
        .progress-category-bar {
            display: flex; align-items: center; gap: 8px;
            margin-bottom: 6px;
        }
        .progress-cat-label {
            font-family: var(--font-title); font-size: 0.55rem;
            letter-spacing: 0.5px; text-transform: uppercase;
            color: var(--text-subtle); width: 70px; flex-shrink: 0;
            text-align: right;
        }
        .progress-cat-bar {
            flex: 1; height: 4px; border-radius: 2px;
            background: rgba(46, 196, 122, 0.05); overflow: hidden;
        }
        .progress-cat-fill {
            height: 100%; border-radius: 3px;
            background: var(--emerald-light);
            transition: width 0.8s cubic-bezier(0.4,0,0.2,1);
        }
        .progress-cat-count {
            font-family: var(--font-title); font-size: 0.55rem;
            color: var(--text-faint); width: 28px;
        }

        /* ===== THEME TOGGLE IN NAV ===== */
        .theme-toggle {
            background: rgba(46, 196, 122, 0.04); border: 1px solid rgba(46, 196, 122, 0.12);
            color: var(--text-muted); width: 34px; height: 34px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.35s var(--transition-smooth); font-size: 0.95rem;
        }
        .theme-toggle:hover {
            background: rgba(46, 196, 122, 0.1);
            border-color: rgba(46, 196, 122, 0.3); color: var(--emerald-light); transform: scale(1.08);
        }
        /* ============================================ */
        @media (max-width: 420px) {
            h1 { font-size: 1.5rem; }
            .bismillah { font-size: calc(1.8rem * var(--font-scale)); }
            .arabic-text { font-size: calc(1.35rem * var(--font-scale)); }
            .dua-title { font-size: calc(0.72rem * var(--font-scale)); }
            .container { padding-left: 8px; padding-right: 8px; }
            .tasbeeh-count-display { font-size: 3.5rem; }
            .tasbeeh-tap-btn { width: 120px; height: 120px; }
        }

        @media (min-width: 768px) {
            h1 { font-size: 2.2rem; }
            .arabic-text { font-size: calc(1.75rem * var(--font-scale)); }
            .container { padding-left: 24px; padding-right: 24px; }
        }

        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            .dua-card.visible { transition: none; }
            .gold-text { animation: none; }
        }

        /* ===== PRINT ===== */
        @media print {
            .top-nav, .bottom-nav, .progress-bar, .back-to-top,
            .search-container, .category-pills, .card-actions, .copy-row,
            .toolbar-row, .streak-banner, .tasbeeh-panel, .etiquette-panel,
            .routine-panel { display: none !important; }
            body { background: white; color: black; padding: 0; }
            .dua-card {
                break-inside: avoid; border: 1px solid #ddd;
                margin-bottom: 16px; opacity: 1 !important;
            }
            .dua-card .card-body { max-height: none !important; }
            .arabic-text { color: #1a1a1a; }
            .translation { color: #333; }
        }

        /* ============================================ */
        /* ===== PASHTO / LANGUAGE TOGGLE ===== */
        /* ============================================ */

        /* --- Language toggle button --- */
        .lang-toggle {
            display: flex; align-items: center; gap: 0;
            background: rgba(46, 196, 122, 0.08);
            border: 1px solid rgba(46, 196, 122, 0.18);
            border-radius: 20px; overflow: hidden;
            font-size: 0.68rem; cursor: pointer;
            margin-right: 4px;
        }
        .lang-toggle span {
            padding: 5px 10px; transition: all 0.3s ease;
            color: var(--text-muted); font-weight: 500;
            white-space: nowrap;
        }
        .lang-toggle span.active-lang {
            background: var(--emerald-light); color: #fff;
            border-radius: 20px;
        }
        [data-theme="light"] .lang-toggle {
            background: rgba(13, 123, 80, 0.06);
            border-color: rgba(13, 123, 80, 0.15);
        }
        [data-theme="light"] .lang-toggle span.active-lang {
            background: var(--emerald-light); color: #fff;
        }

        /* --- Pashto translation element --- */
        .translation-ps {
            font-family: var(--font-arabic);
            font-size: calc(1rem * var(--font-scale));
            line-height: 2;
            color: var(--text-primary);
            direction: rtl;
            text-align: right;
            padding: 12px 0 4px;
        }

        .virtue-tag-ps {
            font-family: var(--font-arabic);
            font-size: calc(0.82rem * var(--font-scale));
            line-height: 1.9;
            color: var(--gold-mid);
            direction: rtl;
            text-align: right;
            padding: 6px 0 2px;
            font-style: italic;
        }
        .virtue-tag-ps .gem { font-style: normal; }

        /* --- Default: English mode — hide Pashto elements --- */
        .translation-ps,
        .virtue-tag-ps { display: none; }

        /* --- Pashto mode --- */
        .lang-ps .transliteration { display: none !important; }
        .lang-ps .translation { display: none !important; }
        .lang-ps .translation-ps { display: block; }
        .lang-ps .virtue-tag { display: none !important; }
        .lang-ps .virtue-tag-ps { display: flex; }

        /* RTL adjustments for Pashto mode */
        .lang-ps .section-title,
        .lang-ps .section-subtitle,
        .lang-ps .section-collapse-hint,
        .lang-ps .dua-title,
        .lang-ps .dua-category-tag {
            font-family: var(--font-arabic);
        }
    </style>
</head>

    <body>
<!-- ===== SPLASH SCREEN ===== -->
<div class="splash-screen" id="splashScreen">
    <div class="splash-logo-large">
        <div class="splash-crescent-lg"></div>
        <span class="splash-fa-lg">ف</span>
    </div>
    <div class="splash-title">Essential Duas</div>
    <div class="splash-subtitle">The Crown Collection</div>
    <div class="splash-credit">المهندس محمد فلاح</div>
</div>

<!-- Skip to content for accessibility -->
<a href="#mainContainer" class="skip-link">Skip to Duas</a>

<!-- ===== TOP NAVIGATION ===== -->
<nav class="top-nav" id="topNav">
    <div class="fallah-logo" onclick="scrollToTop()">
        <div class="fallah-mark">
            <div class="fallah-crescent"></div>
            <span class="fallah-fa">ف</span>
        </div>
        <div class="fallah-text">
            <span class="fallah-brand">Essential Duas</span>
            <span class="fallah-sub">فلاح</span>
        </div>
    </div>
    <div class="nav-actions">
        <div class="lang-toggle" id="langToggle" onclick="toggleLanguage()" title="Switch language" aria-label="Toggle language">
            <span id="langEN" class="active-lang">EN</span>
            <span id="langPS">پښتو</span>
        </div>
        <div class="font-controls">
            <button class="font-btn" onclick="adjustFontSize(-0.1)" title="Smaller text">A-</button>
            <button class="font-btn" onclick="adjustFontSize(0.1)" title="Larger text">A+</button>
        </div>
        <button class="theme-toggle" onclick="toggleTheme()" title="Toggle light/dark mode" aria-label="Toggle theme" id="themeToggle">☀</button>
        <button class="nav-btn" onclick="openEtiquette()" title="Dua Etiquette" aria-label="Etiquette of Dua">📖</button>
        <button class="nav-btn" onclick="openProgress()" title="Your Progress" aria-label="View progress stats">📊</button>
        <button class="nav-btn" onclick="toggleBookmarksPanel()" title="Bookmarks" aria-label="View bookmarks">★</button>
        <button class="nav-btn" onclick="sharePage()" title="Share" aria-label="Share this collection">↗</button>
    </div>
</nav>

<!-- ===== PROGRESS BAR ===== -->
<div class="progress-bar">
    <div class="progress-fill" id="progressFill"></div>
</div>

<!-- ===== MAIN CONTENT ===== -->
<div class="container" id="mainContainer">

    <!-- ===== HERO SECTION ===== -->
    <section class="hero">
        <div class="hero-content">
            <div class="bismillah">بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ</div>

            <div class="hero-ornament">
                <span class="line"></span>
                <span>✦</span>
                <span class="line"></span>
            </div>

            <h1 class="gold-text">Essential Duas</h1>
            <div class="subtitle">The Crown Collection from Quran & Sunnah</div>
            <div style="font-family:var(--font-text);font-size:0.78rem;color:var(--emerald-light);opacity:0.8;margin-top:6px;font-style:italic;">Share this with someone — it may be your Sadaqa Jariya</div>

            <p class="intro-text">
                A meticulously curated treasury of the most powerful supplications
                every Muslim should know — from the Quran and authentic Hadith,
                ordered by scholarly priority with full authentication.
            </p>

            <div class="stats-row">
                <div class="stat-item">
                    <div class="stat-number" id="totalCount">55</div>
                    <div class="stat-label">Duas</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">12</div>
                    <div class="stat-label">Categories</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="bookmarkCount">0</div>
                    <div class="stat-label">Saved</div>
                </div>
                <div class="stat-item">
                    <div class="stat-progress">
                        <svg viewBox="0 0 48 48">
                            <circle class="progress-ring-bg" cx="24" cy="24" r="22"/>
                            <circle class="progress-ring-fill" id="readProgressRing" cx="24" cy="24" r="22"/>
                        </svg>
                        <div class="stat-number" id="readCount">0</div>
                    </div>
                    <div class="stat-label">Read</div>
                </div>
            </div>
        </div>
    </section>

    <!-- ===== STREAK BANNER ===== -->
    <div class="streak-banner" id="streakBanner">
        <span class="streak-fire">🔥</span>
        <span>Streak: <span class="streak-count" id="streakCount">0</span> days</span>
        <span>•</span>
        <span>Last visit: <span id="lastVisit">Today</span></span>
    </div>

    <!-- ===== DAILY DUA ===== -->
    <div class="daily-dua-banner" id="dailyDua" onclick="scrollToDailyDua()">
        <div class="daily-label"><span class="sparkle">✦</span> Dua of the Day <span class="sparkle">✦</span></div>
        <div class="daily-arabic" id="dailyArabic"></div>
        <div class="daily-translation" id="dailyTranslation"></div>
        <button class="daily-share-btn" onclick="event.stopPropagation(); shareDailyDua()">↗ Share Today's Dua</button>
    </div>

    <!-- ===== TIME-BASED SUGGESTION ===== -->
    <div id="timeBanner"></div>

    <!-- ===== SEARCH ===== -->
    <div class="search-container">
        <span class="search-icon">🔍</span>
        <input type="text" class="search-input" id="searchInput"
               placeholder="Search duas by name, topic, keyword, or reference..."
               aria-label="Search duas">
        <button class="search-clear" id="searchClear" onclick="clearSearch()">✕</button>
    </div>

    <!-- ===== TOOLBAR ===== -->
        <div class="toolbar-row">
        <div style="display:flex;gap:6px;flex-wrap:wrap">
            <button class="toolbar-btn" onclick="toggleAllCards(true)">▾ Expand All</button>
            <button class="toolbar-btn" onclick="toggleAllCards(false)">▴ Collapse All</button>
            <button class="toolbar-btn" onclick="openTasbeeh()">📿 Tasbeeh</button>
            <button class="toolbar-btn" onclick="showRandomDua()">🎲 Random Dua</button>
            <button class="toolbar-btn memorize-btn" id="memorizeToggle" onclick="toggleMemorizeMode()">🧠 Memorize</button>
        </div>
    </div>

    <!-- ===== CATEGORY PILLS ===== -->
    <div class="category-pills" id="categoryPills">
        <button class="pill active" data-category="all" onclick="filterCategory('all', this)">All <span class="count" id="countAll">55</span></button>
        <button class="pill" data-category="quran" onclick="filterCategory('quran', this)">Quranic <span class="count">10</span></button>
        <button class="pill" data-category="protection" onclick="filterCategory('protection', this)">Protection <span class="count">7</span></button>
        <button class="pill" data-category="forgiveness" onclick="filterCategory('forgiveness', this)">Forgiveness <span class="count">6</span></button>
        <button class="pill" data-category="guidance" onclick="filterCategory('guidance', this)">Guidance <span class="count">5</span></button>
        <button class="pill" data-category="wellbeing" onclick="filterCategory('wellbeing', this)">Wellbeing <span class="count">6</span></button>
        <button class="pill" data-category="prophets" onclick="filterCategory('prophets', this)">Prophets <span class="count">5</span></button>
        <button class="pill" data-category="morning-evening" onclick="filterCategory('morning-evening', this)">Morning & Evening <span class="count">5</span></button>
        <button class="pill" data-category="provision" onclick="filterCategory('provision', this)">Provision <span class="count">4</span></button>
        <button class="pill" data-category="prayer" onclick="filterCategory('prayer', this)">Prayer <span class="count">4</span></button>
        <button class="pill" data-category="family" onclick="filterCategory('family', this)">Family <span class="count">3</span></button>
        <button class="pill" data-category="travel" onclick="filterCategory('travel', this)">Travel <span class="count">3</span></button>
        <button class="pill" data-category="scholars" onclick="filterCategory('scholars', this)">Scholars <span class="count">3</span></button>
    </div>

    <!-- ===== NO RESULTS ===== -->
    <div class="no-results" id="noResults">
        <div class="no-results-icon">🔮</div>
        <div class="no-results-text">No duas found matching your search.</div>
    </div>


    <!-- ══════════════════════════════════════════ -->
    <!-- ===== SECTION 1: QURANIC FOUNDATION ===== -->
    <!-- ══════════════════════════════════════════ -->
         <div class="section-header" data-section="quran" onclick="toggleSection(this)">
        <div class="section-ornament">
            <span class="orn-line"></span>
            <span class="orn-center">📖</span>
            <span class="orn-line"></span>
        </div>
        <div class="section-title">The Quranic Foundation</div>
        <div class="section-subtitle">The speech of Allah — the highest authority</div>
        <div class="section-toggle">▾</div>
        <div class="section-collapse-hint">tap to collapse</div>
    </div>

    <!-- DUA 1: Al-Fatiha -->
    <div class="dua-card" data-categories="quran,prayer" data-keywords="fatiha opening guidance path straight mother quran greatest surah worship help" data-id="1">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">1</div>
                <div class="card-title-group">
                    <div class="dua-title">Surah Al-Fatiha — The Mother of the Quran <span class="auth-badge badge-quran">QUR'AN</span></div>
                    <div class="dua-category-tag">The Dua of All Duas • Quran 1:1-7</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(1)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ ۞ الْحَمْدُ لِلَّهِ رَبِّ الْعَالَمِينَ ۞ الرَّحْمَٰنِ الرَّحِيمِ ۞ مَالِكِ يَوْمِ الدِّينِ ۞ إِيَّاكَ نَعْبُدُ وَإِيَّاكَ نَسْتَعِينُ ۞ اهْدِنَا الصِّرَاطَ الْمُسْتَقِيمَ ۞ صِرَاطَ الَّذِينَ أَنْعَمْتَ عَلَيْهِمْ غَيْرِ الْمَغْضُوبِ عَلَيْهِمْ وَلَا الضَّالِّينَ ۞</div>
                </div>
                <div class="transliteration">Bismillāhir-Raḥmānir-Raḥīm. Al-ḥamdu lillāhi Rabbil-'Ālamīn. Ar-Raḥmānir-Raḥīm. Māliki yawmid-dīn. Iyyāka na'budu wa iyyāka nasta'īn. Ihdinaṣ-ṣirāṭal-mustaqīm. Ṣirāṭal-ladhīna an'amta 'alayhim ghayril-maghḍūbi 'alayhim wa laḍ-ḍāllīn.</div>
                <div class="translation">"In the Name of Allah, the Most Gracious, the Most Merciful. All praise is due to Allah, Lord of all the worlds, the Most Gracious, the Most Merciful, Master of the Day of Judgement. You alone we worship, and You alone we ask for help. Guide us to the straight path — the path of those upon whom You have bestowed favour, not of those who have earned anger, nor of those who are astray."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Quran 1:1-7 · Tirmidhi 3124 · Muslim 395</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> "Nothing like it has ever been revealed." In the ḥadīth qudsī, Allah says: "I have divided the prayer between Myself and My servant… and he shall have what he asks for."</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ الْحَمْدُ لِلَّهِ رَبِّ الْعَالَمِينَ الرَّحْمَٰنِ الرَّحِيمِ مَالِكِ يَوْمِ الدِّينِ إِيَّاكَ نَعْبُدُ وَإِيَّاكَ نَسْتَعِينُ اهْدِنَا الصِّرَاطَ الْمُسْتَقِيمَ صِرَاطَ الَّذِينَ أَنْعَمْتَ عَلَيْهِمْ غَيْرِ الْمَغْضُوبِ عَلَيْهِمْ وَلَا الضَّالِّينَ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(1)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 1)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 2: Ayatul Kursi -->
    <div class="dua-card" data-categories="quran,protection" data-keywords="ayatul kursi throne verse greatest protection after prayer sleep" data-id="2">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">2</div>
                <div class="card-title-group">
                    <div class="dua-title">Ayat al-Kursi — The Greatest Verse <span class="auth-badge badge-quran">QUR'AN</span></div>
                    <div class="dua-category-tag">Protection • Quran 2:255</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(2)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">اللَّهُ لَا إِلَٰهَ إِلَّا هُوَ الْحَيُّ الْقَيُّومُ ۚ لَا تَأْخُذُهُ سِنَةٌ وَلَا نَوْمٌ ۚ لَهُ مَا فِي السَّمَاوَاتِ وَمَا فِي الْأَرْضِ ۗ مَنْ ذَا الَّذِي يَشْفَعُ عِنْدَهُ إِلَّا بِإِذْنِهِ ۚ يَعْلَمُ مَا بَيْنَ أَيْدِيهِمْ وَمَا خَلْفَهُمْ ۖ وَلَا يُحِيطُونَ بِشَيْءٍ مِنْ عِلْمِهِ إِلَّا بِمَا شَاءَ ۚ وَسِعَ كُرْسِيُّهُ السَّمَاوَاتِ وَالْأَرْضَ ۖ وَلَا يَئُودُهُ حِفْظُهُمَا ۚ وَهُوَ الْعَلِيُّ الْعَظِيمُ</div>
                </div>
                <div class="transliteration">Allāhu lā ilāha illā huwal-Ḥayyul-Qayyūm. Lā ta'khudhuhū sinatun wa lā nawm. Lahū mā fis-samāwāti wa mā fil-arḍ. Man dhal-ladhī yashfa'u 'indahū illā bi-idhnih. Ya'lamu mā bayna aydīhim wa mā khalfahum. Wa lā yuḥīṭūna bi-shay'in min 'ilmihī illā bi-mā shā'. Wasi'a kursiyyuhus-samāwāti wal-arḍ. Wa lā ya'ūduhū ḥifẓuhumā. Wa huwal-'Aliyyul-'Aẓīm.</div>
                <div class="translation">"Allah — there is no deity except Him, the Ever-Living, the Self-Sustaining. Neither drowsiness overtakes Him nor sleep. To Him belongs whatever is in the heavens and on the earth. Who can intercede with Him except by His permission? He knows what is before them and after them, and they encompass nothing of His knowledge except what He wills. His Kursī extends over the heavens and the earth, and their preservation tires Him not. He is the Most High, the Most Great."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Quran 2:255 · Nasā'ī (ṣaḥīḥ by al-Albānī) · Muslim 810</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> "Whoever recites it after every prayer, nothing prevents him from entering Paradise except death."</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'اللَّهُ لَا إِلَٰهَ إِلَّا هُوَ الْحَيُّ الْقَيُّومُ لَا تَأْخُذُهُ سِنَةٌ وَلَا نَوْمٌ لَهُ مَا فِي السَّمَاوَاتِ وَمَا فِي الْأَرْضِ مَنْ ذَا الَّذِي يَشْفَعُ عِنْدَهُ إِلَّا بِإِذْنِهِ يَعْلَمُ مَا بَيْنَ أَيْدِيهِمْ وَمَا خَلْفَهُمْ وَلَا يُحِيطُونَ بِشَيْءٍ مِنْ عِلْمِهِ إِلَّا بِمَا شَاءَ وَسِعَ كُرْسِيُّهُ السَّمَاوَاتِ وَالْأَرْضَ وَلَا يَئُودُهُ حِفْظُهُمَا وَهُوَ الْعَلِيُّ الْعَظِيمُ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(2)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 2)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 3: Dua of Yunus -->
    <div class="dua-card" data-categories="quran,wellbeing,prophets" data-keywords="yunus jonah whale distress darkness never rejected wrongdoers" data-id="3">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">3</div>
                <div class="card-title-group">
                    <div class="dua-title">Dua of Yunus عليه السلام — Never Rejected <span class="auth-badge badge-quran">QUR'AN</span></div>
                    <div class="dua-category-tag">From Inside the Whale • Quran 21:87</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(3)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">لَا إِلَٰهَ إِلَّا أَنتَ سُبْحَانَكَ إِنِّي كُنتُ مِنَ الظَّالِمِينَ</div>
                </div>
                <div class="transliteration">Lā ilāha illā anta subḥānaka innī kuntu minaẓ-ẓālimīn.</div>
                <div class="translation">"There is no deity except You; exalted are You. Indeed, I have been of the wrongdoers."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Quran 21:87 · Tirmidhi 3505 (ṣaḥīḥ) · Ahmad 1462</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> "No Muslim ever calls upon Allah with this regarding any matter except that Allah answers him." It is for Yunus and for every believer.</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'لَا إِلَٰهَ إِلَّا أَنتَ سُبْحَانَكَ إِنِّي كُنتُ مِنَ الظَّالِمِينَ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(3)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 3)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>


    <!-- DUA 4: Mercy for Parents -->
    <div class="dua-card" data-categories="quran,family" data-keywords="parents mercy mother father raised young compassion childhood" data-id="4">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">4</div>
                <div class="card-title-group">
                    <div class="dua-title">Mercy for Parents <span class="auth-badge badge-quran">QUR'AN</span></div>
                    <div class="dua-category-tag">The Quranic Dua of Mercy • Quran 17:24</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(4)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">رَّبِّ ارْحَمْهُمَا كَمَا رَبَّيَانِي صَغِيرًا</div>
                </div>
                <div class="transliteration">Rabbir-ḥamhumā kamā rabbayānī ṣaghīrā.</div>
                <div class="translation">"My Lord, have mercy upon them as they brought me up when I was small."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Quran 17:24 · Tirmidhi 3448 (ḥasan)</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> Allah commanded this dua in the Quran itself. "Three duas are never rejected: the dua of a parent, the fasting person, and the traveller."</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'رَّبِّ ارْحَمْهُمَا كَمَا رَبَّيَانِي صَغِيرًا')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(4)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 4)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 5: Last Two Verses of Al-Baqarah -->
    <div class="dua-card" data-categories="quran,protection" data-keywords="baqarah last two verses night suffice protection forgive burden" data-id="5">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">5</div>
                <div class="card-title-group">
                    <div class="dua-title">Last Two Verses of Al-Baqarah <span class="auth-badge badge-quran">QUR'AN</span></div>
                    <div class="dua-category-tag">The Verses That Suffice • Quran 2:285-286</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(5)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">آمَنَ الرَّسُولُ بِمَا أُنْزِلَ إِلَيْهِ مِنْ رَبِّهِ وَالْمُؤْمِنُونَ ۚ كُلٌّ آمَنَ بِاللَّهِ وَمَلَائِكَتِهِ وَكُتُبِهِ وَرُسُلِهِ لَا نُفَرِّقُ بَيْنَ أَحَدٍ مِنْ رُسُلِهِ ۚ وَقَالُوا سَمِعْنَا وَأَطَعْنَا ۖ غُفْرَانَكَ رَبَّنَا وَإِلَيْكَ الْمَصِيرُ ۞ لَا يُكَلِّفُ اللَّهُ نَفْسًا إِلَّا وُسْعَهَا ۚ لَهَا مَا كَسَبَتْ وَعَلَيْهَا مَا اكْتَسَبَتْ ۗ رَبَّنَا لَا تُؤَاخِذْنَا إِنْ نَسِينَا أَوْ أَخْطَأْنَا ۚ رَبَّنَا وَلَا تَحْمِلْ عَلَيْنَا إِصْرًا كَمَا حَمَلْتَهُ عَلَى الَّذِينَ مِنْ قَبْلِنَا ۚ رَبَّنَا وَلَا تُحَمِّلْنَا مَا لَا طَاقَةَ لَنَا بِهِ ۖ وَاعْفُ عَنَّا وَاغْفِرْ لَنَا وَارْحَمْنَا ۚ أَنْتَ مَوْلَانَا فَانْصُرْنَا عَلَى الْقَوْمِ الْكَافِرِينَ</div>
                </div>
                <div class="transliteration" style="font-size:calc(0.82rem * var(--font-scale))">Āmanar-Rasūlu bi-mā unzila ilayhi min Rabbihī wal-mu'minūn... Rabbanā lā tu'ākhidhnā in nasīnā aw akhṭa'nā. Rabbanā wa lā taḥmil 'alaynā iṣran kamā ḥamaltahū 'alal-ladhīna min qablinā. Rabbanā wa lā tuḥammilnā mā lā ṭāqata lanā bih. Wa'fu 'annā waghfir lanā warḥamnā. Anta Mawlānā fanṣurnā 'alal-qawmil-kāfirīn.</div>
                <div class="translation">"The Messenger has believed in what was revealed to him from his Lord, and so have the believers... Our Lord, do not impose blame upon us if we forget or err. Our Lord, lay not upon us a burden like that which You laid upon those before us. Our Lord, burden us not with that which we have no ability to bear. Pardon us, forgive us, and have mercy upon us. You are our Protector, so give us victory over the disbelieving people."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Quran 2:285-286 · Bukhari 5009 · Muslim 807, 126</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> "Whoever recites these at night, they suffice him." After each 'Rabbanā', Allah said: "I have granted it."</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'رَبَّنَا لَا تُؤَاخِذْنَا إِنْ نَسِينَا أَوْ أَخْطَأْنَا رَبَّنَا وَلَا تَحْمِلْ عَلَيْنَا إِصْرًا كَمَا حَمَلْتَهُ عَلَى الَّذِينَ مِنْ قَبْلِنَا رَبَّنَا وَلَا تُحَمِّلْنَا مَا لَا طَاقَةَ لَنَا بِهِ وَاعْفُ عَنَّا وَاغْفِرْ لَنَا وَارْحَمْنَا أَنْتَ مَوْلَانَا فَانْصُرْنَا عَلَى الْقَوْمِ الْكَافِرِينَ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(5)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 5)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 6: The Three Quls -->
    <div class="dua-card" data-categories="quran,protection" data-keywords="three quls ikhlas falaq nas nightly shield protection evil envy magic" data-id="6">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">6</div>
                <div class="card-title-group">
                    <div class="dua-title">The Three Quls — The Nightly Shield <span class="auth-badge badge-quran">QUR'AN</span></div>
                    <div class="dua-category-tag">Al-Ikhlas, Al-Falaq, Al-Nas • Quran 112-114</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(6)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ ۞ قُلْ هُوَ اللَّهُ أَحَدٌ ۞ اللَّهُ الصَّمَدُ ۞ لَمْ يَلِدْ وَلَمْ يُولَدْ ۞ وَلَمْ يَكُنْ لَهُ كُفُوًا أَحَدٌ ۞</div>
                </div>
                <div class="transliteration">Bismillāhir-Raḥmānir-Raḥīm. Qul huwallāhu Aḥad. Allāhuṣ-Ṣamad. Lam yalid wa lam yūlad. Wa lam yakun lahū kufuwan aḥad.</div>
                <div class="translation"><strong>Al-Ikhlas:</strong> "Say: He is Allah, the One. Allah, the Eternal Refuge. He neither begets nor is born. Nor is there to Him any equivalent."</div>
                <div class="arabic-container" style="margin-top:12px">
                    <div class="arabic-text">بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ ۞ قُلْ أَعُوذُ بِرَبِّ الْفَلَقِ ۞ مِنْ شَرِّ مَا خَلَقَ ۞ وَمِنْ شَرِّ غَاسِقٍ إِذَا وَقَبَ ۞ وَمِنْ شَرِّ النَّفَّاثَاتِ فِي الْعُقَدِ ۞ وَمِنْ شَرِّ حَاسِدٍ إِذَا حَسَدَ ۞</div>
                </div>
                <div class="translation"><strong>Al-Falaq:</strong> "Say: I seek refuge in the Lord of daybreak, from the evil of what He created, from the evil of darkness when it settles, from the evil of the blowers in knots, and from the evil of an envier when he envies."</div>
                <div class="arabic-container" style="margin-top:12px">
                    <div class="arabic-text">بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ ۞ قُلْ أَعُوذُ بِرَبِّ النَّاسِ ۞ مَلِكِ النَّاسِ ۞ إِلَٰهِ النَّاسِ ۞ مِنْ شَرِّ الْوَسْوَاسِ الْخَنَّاسِ ۞ الَّذِي يُوَسْوِسُ فِي صُدُورِ النَّاسِ ۞ مِنَ الْجِنَّةِ وَالنَّاسِ ۞</div>
                </div>
                <div class="translation"><strong>Al-Nas:</strong> "Say: I seek refuge in the Lord of mankind, the Sovereign of mankind, the God of mankind, from the evil of the retreating whisperer, who whispers evil into the breasts of mankind, from among the jinn and mankind."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Bukhari 5017 · Muslim 814 · Abu Dawud 5082</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> 'Ā'ishah رضي الله عنها: "Every night he ﷺ would cup his hands, blow into them, recite all three, then wipe over his body — three times." He ﷺ said: "You will never recite anything equal to them."</div>
                <div class="how-to-box">
                    <strong>How to use:</strong> Recite all three surahs together 3x every night before sleeping, blowing into cupped hands and wiping over your body. Also recite after every Fajr and Maghrib prayer.
                </div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'قُلْ هُوَ اللَّهُ أَحَدٌ اللَّهُ الصَّمَدُ لَمْ يَلِدْ وَلَمْ يُولَدْ وَلَمْ يَكُنْ لَهُ كُفُوًا أَحَدٌ')">📋 Al-Ikhlas</button>
                    <button class="action-btn" onclick="shareDua(6)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 6)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 7: Rabbana Atina -->
    <div class="dua-card" data-categories="quran,provision" data-keywords="rabbana atina good world hereafter fire hasanah comprehensive most frequent prophet" data-id="7">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">7</div>
                <div class="card-title-group">
                    <div class="dua-title">Rabbana Atina — The Prophet's ﷺ Most Frequent Dua <span class="auth-badge badge-quran">QUR'AN</span></div>
                    <div class="dua-category-tag">The Best of Both Worlds • Quran 2:201</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(7)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">رَبَّنَا آتِنَا فِي الدُّنْيَا حَسَنَةً وَفِي الْآخِرَةِ حَسَنَةً وَقِنَا عَذَابَ النَّارِ</div>
                </div>
                <div class="transliteration">Rabbanā ātinā fid-dunyā ḥasanatan wa fil-ākhirati ḥasanatan wa qinā 'adhāban-nār.</div>
                <div class="translation">"Our Lord, give us good in this world and good in the Hereafter, and protect us from the punishment of the Fire."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Quran 2:201 · Bukhari 6389 · Muslim 2690</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> Anas رضي الله عنه: "The dua most often made by the Prophet ﷺ." It encompasses every good of this world and the next in a single, perfect sentence.</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'رَبَّنَا آتِنَا فِي الدُّنْيَا حَسَنَةً وَفِي الْآخِرَةِ حَسَنَةً وَقِنَا عَذَابَ النَّارِ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(7)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 7)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 8: Do Not Let Hearts Deviate (3:8) -->
    <div class="dua-card" data-categories="quran,guidance" data-keywords="hearts deviate guided mercy bestower wahhab steadfast imam ahmad" data-id="8">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">8</div>
                <div class="card-title-group">
                    <div class="dua-title">Do Not Let Our Hearts Deviate <span class="auth-badge badge-quran">QUR'AN</span></div>
                    <div class="dua-category-tag">Guidance • Quran 3:8</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(8)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">رَبَّنَا لَا تُزِغْ قُلُوبَنَا بَعْدَ إِذْ هَدَيْتَنَا وَهَبْ لَنَا مِن لَّدُنكَ رَحْمَةً ۚ إِنَّكَ أَنتَ الْوَهَّابُ</div>
                </div>
                <div class="transliteration">Rabbanā lā tuzigh qulūbanā ba'da idh hadaytanā wa hab lanā min ladunka raḥmah, innaka antal-Wahhāb.</div>
                <div class="translation">"Our Lord, let not our hearts deviate after You have guided us and grant us from Yourself mercy. Indeed, You are the Bestower."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Quran 3:8 · Imam Ahmad repeated this until he died</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> One of the most important duas for maintaining faith. Imam Ahmad kept repeating this in his final illness until he passed away.</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'رَبَّنَا لَا تُزِغْ قُلُوبَنَا بَعْدَ إِذْ هَدَيْتَنَا وَهَبْ لَنَا مِن لَّدُنكَ رَحْمَةً إِنَّكَ أَنتَ الْوَهَّابُ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(8)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 8)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 9: Dua of Adam (7:23) -->
    <div class="dua-card" data-categories="quran,forgiveness" data-keywords="adam hawa wronged soul forgive mercy losers first repentance" data-id="9">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">9</div>
                <div class="card-title-group">
                    <div class="dua-title">Dua of Adam & Hawa عليهما السلام <span class="auth-badge badge-quran">QUR'AN</span></div>
                    <div class="dua-category-tag">First Repentance in History • Quran 7:23</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(9)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">رَبَّنَا ظَلَمْنَا أَنفُسَنَا وَإِن لَّمْ تَغْفِرْ لَنَا وَتَرْحَمْنَا لَنَكُونَنَّ مِنَ الْخَاسِرِينَ</div>
                </div>
                <div class="transliteration">Rabbanā ẓalamnā anfusanā wa in lam taghfir lanā wa tarḥamnā lanakūnanna minal-khāsirīn.</div>
                <div class="translation">"Our Lord, we have wronged ourselves, and if You do not forgive us and have mercy upon us, we will surely be among the losers."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Quran 7:23</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> The very first dua of repentance in human history — taught by Allah to Adam</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'رَبَّنَا ظَلَمْنَا أَنفُسَنَا وَإِن لَّمْ تَغْفِرْ لَنَا وَتَرْحَمْنَا لَنَكُونَنَّ مِنَ الْخَاسِرِينَ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(9)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 9)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 10: Increase in Knowledge (20:114) -->
    <div class="dua-card" data-categories="quran,guidance" data-keywords="knowledge increase learning study wisdom rabbi zidni only thing commanded more" data-id="10">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">10</div>
                <div class="card-title-group">
                    <div class="dua-title">Increase Me in Knowledge <span class="auth-badge badge-quran">QUR'AN</span></div>
                    <div class="dua-category-tag">The Only Thing Commanded to Ask More Of • Quran 20:114</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(10)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">رَّبِّ زِدْنِي عِلْمًا</div>
                </div>
                <div class="transliteration">Rabbi zidnī 'ilmā.</div>
                <div class="translation">"My Lord, increase me in knowledge."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Quran 20:114</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> The only thing Allah commanded His Prophet ﷺ to ask for more of — knowledge. Perfect for students, professionals, and seekers of truth.</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'رَّبِّ زِدْنِي عِلْمًا')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(10)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 10)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ══════════════════════════════════════════ -->
    <!-- ===== SECTION 2: PROTECTION & REFUGE ===== -->
    <!-- ══════════════════════════════════════════ -->
          <div class="section-header" data-section="protection" onclick="toggleSection(this)">
        <div class="section-ornament">
            <span class="orn-line"></span>
            <span class="orn-center">🛡</span>
            <span class="orn-line"></span>
        </div>
        <div class="section-title">Protection & Refuge</div>
        <div class="section-subtitle">Seeking Allah's shelter from all harm</div>
        <div class="section-toggle">▾</div>
        <div class="section-collapse-hint">tap to collapse</div>
    </div>

    <!-- DUA 11: Refuge in Perfect Words -->
    <div class="dua-card" data-categories="protection" data-keywords="perfect words refuge evil created night travel stay place" data-id="11">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">11</div>
                <div class="card-title-group">
                    <div class="dua-title">Refuge in Allah's Perfect Words <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">Protection • Muslim 2708</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(11)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">أَعُوذُ بِكَلِمَاتِ اللَّهِ التَّامَّاتِ مِنْ شَرِّ مَا خَلَقَ</div>
                </div>
                <div class="transliteration">A'ūdhu bi kalimātillāhit-tāmmāti min sharri mā khalaq.</div>
                <div class="translation">"I seek refuge in the perfect words of Allah from the evil of what He has created."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Sahih Muslim 2708</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> Whoever says this when staying somewhere — nothing will harm him until he leaves that place</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'أَعُوذُ بِكَلِمَاتِ اللَّهِ التَّامَّاتِ مِنْ شَرِّ مَا خَلَقَ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(11)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 11)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 12: Bismillah Protection (Morning/Evening) -->
    <div class="dua-card" data-categories="protection,morning-evening" data-keywords="bismillah name harm nothing earth heaven hearing knowing morning evening three times" data-id="12">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">12</div>
                <div class="card-title-group">
                    <div class="dua-title">In the Name of Allah — Nothing Can Harm <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">Morning-Evening • Abu Dawud 5088</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(12)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">بِسْمِ اللَّهِ الَّذِي لَا يَضُرُّ مَعَ اسْمِهِ شَيْءٌ فِي الْأَرْضِ وَلَا فِي السَّمَاءِ وَهُوَ السَّمِيعُ الْعَلِيمُ</div>
                </div>
                <div class="transliteration">Bismillāhil-ladhī lā yaḍurru ma'as-mihī shay'un fil-arḍi wa lā fis-samā'i wa huwas-Samī'ul-'Alīm.</div>
                <div class="translation">"In the name of Allah, with whose name nothing on earth or in heaven can cause harm, and He is the All-Hearing, the All-Knowing."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Abu Dawud 5088 · Tirmidhi 3388 (ṣaḥīḥ)</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> Said 3 times morning and evening — nothing will harm you that day/night</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'بِسْمِ اللَّهِ الَّذِي لَا يَضُرُّ مَعَ اسْمِهِ شَيْءٌ فِي الْأَرْضِ وَلَا فِي السَّمَاءِ وَهُوَ السَّمِيعُ الْعَلِيمُ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(12)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 12)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 13: Four Great Trials -->
    <div class="dua-card" data-categories="protection,prayer" data-keywords="refuge four trials hellfire grave life death dajjal tashahhud before salam commanded" data-id="13">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">13</div>
                <div class="card-title-group">
                    <div class="dua-title">The Four Refuges — Commanded in Every Prayer <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">Between Tashahhud & Salam • Muslim 588</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(13)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنْ عَذَابِ جَهَنَّمَ وَمِنْ عَذَابِ الْقَبْرِ وَمِنْ فِتْنَةِ الْمَحْيَا وَالْمَمَاتِ وَمِنْ شَرِّ فِتْنَةِ الْمَسِيحِ الدَّجَّالِ</div>
                </div>
                <div class="transliteration">Allāhumma innī a'ūdhu bika min 'adhābi jahannam, wa min 'adhābil-qabr, wa min fitnatil-maḥyā wal-mamāt, wa min sharri fitnatil-Masīḥid-Dajjāl.</div>
                <div class="translation">"O Allah, I seek refuge in You from the punishment of Hellfire, from the torment of the grave, from the trials of life and death, and from the evil trial of the False Messiah (Dajjal)."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Muslim 588 · Bukhari 1377 · Abu Dawud 983</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> This is a DIRECT PROPHETIC COMMAND for every single prayer — not optional. The most important daily dua, said 5 times a day.</div>
                <div class="how-to-box">
                    <strong>When to say it:</strong> After the final tashahhud, before giving salam to end the prayer. The Prophet ﷺ said: "When any of you finishes the last tashahhud, let him seek refuge in Allah from four things" — then he mentioned these four.
                </div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنْ عَذَابِ جَهَنَّمَ وَمِنْ عَذَابِ الْقَبْرِ وَمِنْ فِتْنَةِ الْمَحْيَا وَالْمَمَاتِ وَمِنْ شَرِّ فِتْنَةِ الْمَسِيحِ الدَّجَّالِ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(13)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 13)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 14: Contentment with Allah -->
    <div class="dua-card" data-categories="protection,morning-evening" data-keywords="pleased lord islam religion muhammad prophet contentment radhitu morning evening" data-id="14">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">14</div>
                <div class="card-title-group">
                    <div class="dua-title">Contentment with Allah as Lord <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">Morning-Evening • Abu Dawud 5072</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(14)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">رَضِيتُ بِاللَّهِ رَبًّا، وَبِالْإِسْلَامِ دِينًا، وَبِمُحَمَّدٍ صَلَّى اللَّهُ عَلَيْهِ وَسَلَّمَ نَبِيًّا</div>
                </div>
                <div class="transliteration">Raḍītu billāhi rabbā, wa bil-islāmi dīnā, wa bi Muḥammadin ṣallallāhu 'alayhi wa sallama nabiyyā.</div>
                <div class="translation">"I am pleased with Allah as my Lord, with Islam as my religion, and with Muhammad ﷺ as my Prophet."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Abu Dawud 5072 · Tirmidhi 3389</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> Whoever says this 3x morning and evening — it becomes a right upon Allah to please him on the Day of Judgement</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'رَضِيتُ بِاللَّهِ رَبًّا، وَبِالْإِسْلَامِ دِينًا، وَبِمُحَمَّدٍ صَلَّى اللَّهُ عَلَيْهِ وَسَلَّمَ نَبِيًّا')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(14)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 14)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 15: Entering the Restroom -->
    <div class="dua-card" data-categories="protection" data-keywords="bathroom toilet restroom entering evil devils jinn khubuthi" data-id="15">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">15</div>
                <div class="card-title-group">
                    <div class="dua-title">Entering the Restroom <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">Daily Protection • Bukhari 142</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(15)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنَ الْخُبُثِ وَالْخَبَائِثِ</div>
                </div>
                <div class="transliteration">Allāhumma innī a'ūdhu bika minal-khubuthi wal-khabā'ith.</div>
                <div class="translation">"O Allah, I seek refuge in You from the male and female evil beings (devils)."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Sahih al-Bukhari 142 · Muslim 375</span>
                </div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنَ الْخُبُثِ وَالْخَبَائِثِ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(15)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 15)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ══════════════════════════════════════════ -->
    <!-- ===== SECTION 3: FORGIVENESS ===== -->
    <!-- ══════════════════════════════════════════ -->
      <div class="section-header" data-section="forgiveness" onclick="toggleSection(this)">
        <div class="section-ornament">
            <span class="orn-line"></span>
            <span class="orn-center">🤲</span>
            <span class="orn-line"></span>
        </div>
        <div class="section-title">Forgiveness & Repentance</div>
        <div class="section-subtitle">Turning back to the Most Merciful</div>
        <div class="section-toggle">▾</div>
        <div class="section-collapse-hint">tap to collapse</div>
    </div>

    <!-- DUA 16: Sayyid al-Istighfar -->
    <div class="dua-card" data-categories="forgiveness,morning-evening" data-keywords="sayyid istighfar master forgiveness morning evening paradise guaranteed covenant promise" data-id="16">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">16</div>
                <div class="card-title-group">
                    <div class="dua-title">Sayyid al-Istighfar — Master of Forgiveness <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">Guaranteed Paradise • Bukhari 6306</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(16)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">اللَّهُمَّ أَنْتَ رَبِّي لَا إِلَٰهَ إِلَّا أَنْتَ خَلَقْتَنِي وَأَنَا عَبْدُكَ وَأَنَا عَلَىٰ عَهْدِكَ وَوَعْدِكَ مَا اسْتَطَعْتُ أَعُوذُ بِكَ مِنْ شَرِّ مَا صَنَعْتُ أَبُوءُ لَكَ بِنِعْمَتِكَ عَلَيَّ وَأَبُوءُ بِذَنْبِي فَاغْفِرْ لِي فَإِنَّهُ لَا يَغْفِرُ الذُّنُوبَ إِلَّا أَنْتَ</div>
                </div>
                <div class="transliteration">Allāhumma anta Rabbī lā ilāha illā anta khalaqtanī wa ana 'abduk, wa ana 'alā 'ahdika wa wa'dika mastaṭa'tu, a'ūdhu bika min sharri mā ṣana'tu, abū'u laka bi ni'matika 'alayya wa abū'u bi dhanbī faghfirlī fa innahū lā yaghfirudh-dhunūba illā ant.</div>
                <div class="translation">"O Allah, You are my Lord, there is no god but You. You created me and I am Your servant. I uphold Your covenant and promise as best I can. I seek refuge in You from the evil of what I have done. I acknowledge Your blessings upon me, and I acknowledge my sin — so forgive me, for none forgives sins except You."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Sahih al-Bukhari 6306</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> "Whoever says this with conviction in the morning and dies that day enters Paradise. In the evening and dies that night — Paradise."</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'اللَّهُمَّ أَنْتَ رَبِّي لَا إِلَٰهَ إِلَّا أَنْتَ خَلَقْتَنِي وَأَنَا عَبْدُكَ وَأَنَا عَلَىٰ عَهْدِكَ وَوَعْدِكَ مَا اسْتَطَعْتُ أَعُوذُ بِكَ مِنْ شَرِّ مَا صَنَعْتُ أَبُوءُ لَكَ بِنِعْمَتِكَ عَلَيَّ وَأَبُوءُ بِذَنْبِي فَاغْفِرْ لِي فَإِنَّهُ لَا يَغْفِرُ الذُّنُوبَ إِلَّا أَنْتَ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(16)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 16)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 17: Comprehensive Forgiveness -->
    <div class="dua-card" data-categories="forgiveness" data-keywords="forgiveness all sins first last open secret small great comprehensive complete" data-id="17">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">17</div>
                <div class="card-title-group">
                    <div class="dua-title">Comprehensive Forgiveness <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">Every Type of Sin Covered • Muslim 483</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(17)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">اللَّهُمَّ اغْفِرْ لِي ذَنْبِي كُلَّهُ، دِقَّهُ وَجِلَّهُ، وَأَوَّلَهُ وَآخِرَهُ، وَعَلَانِيَتَهُ وَسِرَّهُ</div>
                </div>
                <div class="transliteration">Allāhummaghfir lī dhanbī kullahu, diqqahū wa jillahū, wa awwalahū wa ākhirahū, wa 'alāniyatahū wa sirrahū.</div>
                <div class="translation">"O Allah, forgive me all my sins — the small and the great, the first and the last, the open and the secret."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Sahih Muslim 483</span>
                </div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'اللَّهُمَّ اغْفِرْ لِي ذَنْبِي كُلَّهُ، دِقَّهُ وَجِلَّهُ، وَأَوَّلَهُ وَآخِرَهُ، وَعَلَانِيَتَهُ وَسِرَّهُ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(17)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 17)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 18: Laylatul Qadr -->
    <div class="dua-card" data-categories="forgiveness" data-keywords="laylatul qadr night power decree pardon forgive love afuwwun ramadan aisha" data-id="18">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">18</div>
                <div class="card-title-group">
                    <div class="dua-title">Dua for Laylatul Qadr — Night of Decree <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">The Greatest Night • Tirmidhi 3513</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(18)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">اللَّهُمَّ إِنَّكَ عَفُوٌّ تُحِبُّ الْعَفْوَ فَاعْفُ عَنِّي</div>
                </div>
                <div class="transliteration">Allāhumma innaka 'Afuwwun tuḥibbul-'afwa fa'fu 'annī.</div>
                <div class="translation">"O Allah, You are Most Forgiving, and You love forgiveness — so forgive me."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Tirmidhi 3513 (ṣaḥīḥ) · Ibn Majah 3850</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> The Prophet ﷺ taught this specifically to 'Ā'ishah رضي الله عنها for the greatest night. 'Afw (عفو) means Allah wipes the sin entirely — as if it never existed — deeper than maghfirah.</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'اللَّهُمَّ إِنَّكَ عَفُوٌّ تُحِبُّ الْعَفْوَ فَاعْفُ عَنِّي')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(18)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 18)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>    <!-- ══════════════════════════════════════════ -->
    <!-- ===== SECTION 4: GUIDANCE & FAITH ===== -->
    <!-- ══════════════════════════════════════════ -->
       <div class="section-header" data-section="guidance" onclick="toggleSection(this)">
        <div class="section-ornament">
            <span class="orn-line"></span>
            <span class="orn-center">✨</span>
            <span class="orn-line"></span>
        </div>
        <div class="section-title">Guidance & Steadfastness</div>
        <div class="section-subtitle">Seeking light upon the path of truth</div>
        <div class="section-toggle">▾</div>
        <div class="section-collapse-hint">tap to collapse</div>
    </div>

    <!-- DUA 19: Turner of Hearts -->
    <div class="dua-card" data-categories="guidance" data-keywords="hearts turner steadfast firm faith religion muqallib most frequent dua prophet" data-id="19">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">19</div>
                <div class="card-title-group">
                    <div class="dua-title">O Turner of Hearts — Keep Us Firm <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">Most Frequent Dua of the Prophet ﷺ • Tirmidhi 2140</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(19)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">يَا مُقَلِّبَ الْقُلُوبِ وَالْأَبْصَارِ ثَبِّتْ قَلْبِي عَلَىٰ طَاعَتِكَ</div>
                </div>
                <div class="transliteration">Yā Muqallibal-qulūbi wal-abṣāri thabbit qalbī 'alā ṭā'atik.</div>
                <div class="translation">"O Turner of hearts and sights, make my heart firm upon Your obedience."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Tirmidhi 2140 (ṣaḥīḥ) · Muslim 2654</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> The most frequent dua of the Prophet ﷺ. Ibn Taymiyyah never prostrated without saying this for over 20 years.</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'يَا مُقَلِّبَ الْقُلُوبِ وَالْأَبْصَارِ ثَبِّتْ قَلْبِي عَلَىٰ طَاعَتِكَ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(19)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 19)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 20: Purification of the Soul -->
    <div class="dua-card" data-categories="guidance" data-keywords="taqwa purify soul best purifier protector guardian nafs tazkiyah" data-id="20">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">20</div>
                <div class="card-title-group">
                    <div class="dua-title">Taqwa & Purification of the Soul <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">Spiritual Excellence • Muslim 2722</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(20)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">اللَّهُمَّ آتِ نَفْسِي تَقْوَاهَا وَزَكِّهَا أَنْتَ خَيْرُ مَنْ زَكَّاهَا أَنْتَ وَلِيُّهَا وَمَوْلَاهَا</div>
                </div>
                <div class="transliteration">Allāhumma āti nafsī taqwāhā wa zakkihā anta khayru man zakkāhā, anta waliyyuhā wa mawlāhā.</div>
                <div class="translation">"O Allah, grant my soul its taqwa (righteousness) and purify it — You are the best to purify it. You are its Protector and Guardian."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Sahih Muslim 2722</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> One of the Prophet's ﷺ most beautiful personal supplications — asking for the very essence of spiritual success: taqwa and tazkiyah.</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'اللَّهُمَّ آتِ نَفْسِي تَقْوَاهَا وَزَكِّهَا أَنْتَ خَيْرُ مَنْ زَكَّاهَا أَنْتَ وَلِيُّهَا وَمَوْلَاهَا')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(20)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 20)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 21: Istikhara -->
    <div class="dua-card" data-categories="guidance" data-keywords="istikhara guidance decision choose best matter equated quran importance marriage job" data-id="21">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">21</div>
                <div class="card-title-group">
                    <div class="dua-title">Salat al-Istikhara — The Guidance Prayer <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">Equated with Learning Quran • Bukhari 6382</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(21)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">اللَّهُمَّ إِنِّي أَسْتَخِيرُكَ بِعِلْمِكَ وَأَسْتَقْدِرُكَ بِقُدْرَتِكَ وَأَسْأَلُكَ مِنْ فَضْلِكَ الْعَظِيمِ فَإِنَّكَ تَقْدِرُ وَلَا أَقْدِرُ وَتَعْلَمُ وَلَا أَعْلَمُ وَأَنْتَ عَلَّامُ الْغُيُوبِ اللَّهُمَّ إِنْ كُنْتَ تَعْلَمُ أَنَّ هَذَا الْأَمْرَ خَيْرٌ لِي فِي دِينِي وَمَعَاشِي وَعَاقِبَةِ أَمْرِي فَاقْدُرْهُ لِي وَيَسِّرْهُ لِي ثُمَّ بَارِكْ لِي فِيهِ وَإِنْ كُنْتَ تَعْلَمُ أَنَّ هَذَا الْأَمْرَ شَرٌّ لِي فِي دِينِي وَمَعَاشِي وَعَاقِبَةِ أَمْرِي فَاصْرِفْهُ عَنِّي وَاصْرِفْنِي عَنْهُ وَاقْدُرْ لِيَ الْخَيْرَ حَيْثُ كَانَ ثُمَّ أَرْضِنِي بِهِ</div>
                </div>
                <div class="transliteration" style="font-size:calc(0.82rem * var(--font-scale))">Allāhumma innī astakhīruka bi 'ilmik, wa astaqdiruka bi qudratik, wa as'aluka min faḍlikal-'aẓīm. Fa innaka taqdiru wa lā aqdir, wa ta'lamu wa lā a'lam, wa anta 'Allāmul-Ghuyūb. Allāhumma in kunta ta'lamu anna hādhal-amra khayrun lī fī dīnī wa ma'āshī wa 'āqibati amrī fāqdurhu lī wa yassirhu lī thumma bārik lī fīh. Wa in kunta ta'lamu anna hādhal-amra sharrun lī fī dīnī wa ma'āshī wa 'āqibati amrī faṣrifhu 'annī waṣrifnī 'anhu wāqdur liyal-khayra ḥaythu kāna thumma arḍinī bih.</div>
                <div class="translation">"O Allah, I seek Your counsel by Your knowledge, and I seek Your ability by Your power, and I ask You from Your immense bounty. For verily, You are able and I am not, You know and I do not, and You are the Knower of the unseen. O Allah, if You know that this matter is good for me in my religion, my livelihood and my final outcome, then decree it for me and make it easy for me, and bless me in it. And if You know that this matter is bad for me in my religion, my livelihood and my final outcome, then turn it away from me and turn me away from it, and decree for me the good wherever it may be, and make me content with it."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Sahih al-Bukhari 6382 — highest authentication</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> "I used to teach the companions the Istikhara in all matters as I taught them the surahs of the Quran." — The ONLY dua equated with learning Quran itself.</div>
                <div class="how-to-box">
                    <strong>How to perform:</strong> Pray two rak'āt of voluntary prayer (not obligatory), then recite this dua after the salām. At the words "hādhal-amr" (this matter), mention your specific need in your heart or aloud. Use for marriage, business, travel, and every major decision.
                </div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'اللَّهُمَّ إِنِّي أَسْتَخِيرُكَ بِعِلْمِكَ وَأَسْتَقْدِرُكَ بِقُدْرَتِكَ وَأَسْأَلُكَ مِنْ فَضْلِكَ الْعَظِيمِ فَإِنَّكَ تَقْدِرُ وَلَا أَقْدِرُ وَتَعْلَمُ وَلَا أَعْلَمُ وَأَنْتَ عَلَّامُ الْغُيُوبِ اللَّهُمَّ إِنْ كُنْتَ تَعْلَمُ أَنَّ هَذَا الْأَمْرَ خَيْرٌ لِي فِي دِينِي وَمَعَاشِي وَعَاقِبَةِ أَمْرِي فَاقْدُرْهُ لِي وَيَسِّرْهُ لِي ثُمَّ بَارِكْ لِي فِيهِ وَإِنْ كُنْتَ تَعْلَمُ أَنَّ هَذَا الْأَمْرَ شَرٌّ لِي فِي دِينِي وَمَعَاشِي وَعَاقِبَةِ أَمْرِي فَاصْرِفْهُ عَنِّي وَاصْرِفْنِي عَنْهُ وَاقْدُرْ لِيَ الْخَيْرَ حَيْثُ كَانَ ثُمَّ أَرْضِنِي بِهِ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(21)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 21)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 22: Perfect My Character -->
    <div class="dua-card" data-categories="guidance" data-keywords="character akhlaq perfected form outward beauty inward khuluq heaviest scale" data-id="22">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">22</div>
                <div class="card-title-group">
                    <div class="dua-title">Perfect My Character <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">Heaviest on the Scale • Ahmad 3823</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(22)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">اللَّهُمَّ كَمَا حَسَّنْتَ خَلْقِي فَحَسِّنْ خُلُقِي</div>
                </div>
                <div class="transliteration">Allāhumma kamā ḥassanta khalqī fa-ḥassin khuluqī.</div>
                <div class="translation">"O Allah, just as You have perfected my outward form, perfect my character."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Ahmad 3823 (ṣaḥīḥ by al-Albānī) · Ibn Ḥibbān 959</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> A masterpiece of brevity. "Nothing is heavier on the Scale on the Day of Judgement than good character." (Tirmidhi 2002)</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'اللَّهُمَّ كَمَا حَسَّنْتَ خَلْقِي فَحَسِّنْ خُلُقِي')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(22)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 22)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ══════════════════════════════════════════ -->
    <!-- ===== SECTION 5: WELLBEING & RELIEF ===== -->
    <!-- ══════════════════════════════════════════ -->
       <div class="section-header" data-section="wellbeing" onclick="toggleSection(this)">
        <div class="section-ornament">
            <span class="orn-line"></span>
            <span class="orn-center">🌿</span>
            <span class="orn-line"></span>
        </div>
        <div class="section-title">Wellbeing, Health & Relief</div>
        <div class="section-subtitle">Seeking ease, healing, and divine care</div>
        <div class="section-toggle">▾</div>
        <div class="section-collapse-hint">tap to collapse</div>
    </div>

    <!-- DUA 23: 'Afiyah -->
    <div class="dua-card" data-categories="wellbeing,morning-evening" data-keywords="afiyah wellbeing safety pardon permanent wellness religion world hereafter best gift" data-id="23">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">23</div>
                <div class="card-title-group">
                    <div class="dua-title">Asking for 'Afiyah — Permanent Wellbeing <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">Best Gift After Faith • Ibn Majah 3871</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(23)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">اللَّهُمَّ إِنِّي أَسْأَلُكَ الْعَفْوَ وَالْعَافِيَةَ وَالْمُعَافَاةَ الدَّائِمَةَ فِي الدِّينِ وَالدُّنْيَا وَالْآخِرَةِ</div>
                </div>
                <div class="transliteration">Allāhumma innī as'alukal-'afwa wal-'āfiyata wal-mu'āfātad-dā'imata fid-dīni wad-dunyā wal-ākhirah.</div>
                <div class="translation">"O Allah, I ask You for pardon, permanent wellness and complete safety in my religion, my worldly life and the Hereafter."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Ibn Majah 3871 · Tirmidhi (ṣaḥīḥ li-ghayrihi)</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> "After certainty of faith, no one has been given anything better than 'āfiyah." Say it every morning and evening.</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'اللَّهُمَّ إِنِّي أَسْأَلُكَ الْعَفْوَ وَالْعَافِيَةَ وَالْمُعَافَاةَ الدَّائِمَةَ فِي الدِّينِ وَالدُّنْيَا وَالْآخِرَةِ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(23)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 23)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 24: Anxiety & Distress -->
    <div class="dua-card" data-categories="wellbeing" data-keywords="anxiety worry sadness grief depression distress quran spring heart light chest joy replace" data-id="24">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">24</div>
                <div class="card-title-group">
                    <div class="dua-title">The Anxiety & Distress Dua <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">Allah Replaces Grief with Joy • Ahmad 3528</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(24)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">اللَّهُمَّ إِنِّي عَبْدُكَ ابْنُ عَبْدِكَ ابْنُ أَمَتِكَ نَاصِيَتِي بِيَدِكَ مَاضٍ فِيَّ حُكْمُكَ عَدْلٌ فِيَّ قَضَاؤُكَ أَسْأَلُكَ بِكُلِّ اسْمٍ هُوَ لَكَ سَمَّيْتَ بِهِ نَفْسَكَ أَوْ أَنْزَلْتَهُ فِي كِتَابِكَ أَوْ عَلَّمْتَهُ أَحَدًا مِنْ خَلْقِكَ أَوِ اسْتَأْثَرْتَ بِهِ فِي عِلْمِ الْغَيْبِ عِنْدَكَ أَنْ تَجْعَلَ الْقُرْآنَ رَبِيعَ قَلْبِي وَنُورَ صَدْرِي وَجَلَاءَ حُزْنِي وَذَهَابَ هَمِّي</div>
                </div>
                <div class="transliteration" style="font-size:calc(0.8rem * var(--font-scale))">Allāhumma innī 'abduka ibnu 'abdika ibnu amatik, nāṣiyatī bi-yadik, māḍin fiyya ḥukmuk, 'adlun fiyya qaḍā'uk, as'aluka bi-kulli ismin huwa lak, sammayta bihī nafsak, aw anzaltahū fī kitābik, aw 'allamtahū aḥadan min khalqik, aw ista'tharta bihī fī 'ilmil-ghaybi 'indak, an taj'alal-Qur'āna rabī'a qalbī wa nūra ṣadrī wa jalā'a ḥuznī wa dhahāba hammī.</div>
                <div class="translation">"O Allah, I am Your servant, son of Your servant, son of Your maidservant. My forelock is in Your hand, Your command over me is forever executed, Your decree over me is just. I ask You by every name belonging to You — which You named Yourself with, revealed in Your Book, taught to any of Your creation, or kept in the unseen — to make the Quran the spring of my heart, the light of my chest, the departure of my grief, and the banisher of my anxiety."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Ahmad 3528 — ṣaḥīḥ by al-Albānī (aṣ-Ṣaḥīḥah 199)</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> "No slave says this except Allah removes his grief and replaces it with joy." He ﷺ said: "Whoever hears it should learn it."</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'اللَّهُمَّ إِنِّي عَبْدُكَ ابْنُ عَبْدِكَ ابْنُ أَمَتِكَ نَاصِيَتِي بِيَدِكَ مَاضٍ فِيَّ حُكْمُكَ عَدْلٌ فِيَّ قَضَاؤُكَ أَسْأَلُكَ بِكُلِّ اسْمٍ هُوَ لَكَ سَمَّيْتَ بِهِ نَفْسَكَ أَوْ أَنْزَلْتَهُ فِي كِتَابِكَ أَوْ عَلَّمْتَهُ أَحَدًا مِنْ خَلْقِكَ أَوِ اسْتَأْثَرْتَ بِهِ فِي عِلْمِ الْغَيْبِ عِنْدَكَ أَنْ تَجْعَلَ الْقُرْآنَ رَبِيعَ قَلْبِي وَنُورَ صَدْرِي وَجَلَاءَ حُزْنِي وَذَهَابَ هَمِّي')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(24)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 24)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 25: Refuge from 8 Afflictions -->
    <div class="dua-card" data-categories="wellbeing" data-keywords="anxiety sorrow weakness laziness miserliness cowardice debt overpowered eight afflictions" data-id="25">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">25</div>
                <div class="card-title-group">
                    <div class="dua-title">Refuge from Eight Afflictions <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">Most Comprehensive Protection • Bukhari 6369</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(25)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنَ الْهَمِّ وَالْحَزَنِ وَالْعَجْزِ وَالْكَسَلِ وَالْبُخْلِ وَالْجُبْنِ وَضَلَعِ الدَّيْنِ وَغَلَبَةِ الرِّجَالِ</div>
                </div>
                <div class="transliteration">Allāhumma innī a'ūdhu bika minal-hammi wal-ḥazan, wal-'ajzi wal-kasal, wal-bukhli wal-jubn, wa ḍala'id-dayni wa ghalabatir-rijāl.</div>
                <div class="translation">"O Allah, I seek refuge in You from anxiety and sorrow, weakness and laziness, miserliness and cowardice, the burden of debts and from being overpowered by men."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Sahih al-Bukhari 6369</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> One of the most comprehensive duas — covers 8 afflictions at once. The Prophet ﷺ said this frequently.</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنَ الْهَمِّ وَالْحَزَنِ وَالْعَجْزِ وَالْكَسَلِ وَالْبُخْلِ وَالْجُبْنِ وَضَلَعِ الدَّيْنِ وَغَلَبَةِ الرِّجَالِ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(25)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 25)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 26: In Great Distress -->
    <div class="dua-card" data-categories="wellbeing" data-keywords="distress great affliction calamity la ilaha supreme forbearing throne magnificent" data-id="26">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">26</div>
                <div class="card-title-group">
                    <div class="dua-title">In Times of Great Distress <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">Emergency Dua • Bukhari 6346</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(26)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">لَا إِلَٰهَ إِلَّا اللَّهُ الْعَظِيمُ الْحَلِيمُ، لَا إِلَٰهَ إِلَّا اللَّهُ رَبُّ الْعَرْشِ الْعَظِيمِ، لَا إِلَٰهَ إِلَّا اللَّهُ رَبُّ السَّمَاوَاتِ وَرَبُّ الْأَرْضِ وَرَبُّ الْعَرْشِ الْكَرِيمِ</div>
                </div>
                <div class="transliteration">Lā ilāha illallāhul-'Aẓīmul-Ḥalīm. Lā ilāha illallāhu Rabbul-'Arshil-'Aẓīm. Lā ilāha illallāhu Rabbus-samāwāti wa Rabbul-arḍi wa Rabbul-'Arshil-Karīm.</div>
                <div class="translation">"There is no deity except Allah, the Supreme, the Forbearing. There is no deity except Allah, Lord of the Magnificent Throne. There is no deity except Allah, Lord of the heavens and Lord of the earth, and Lord of the Noble Throne."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Bukhari 6346 · Muslim 2730</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> The Prophet ﷺ would say this when in great distress — turn to it in your darkest moments.</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'لَا إِلَٰهَ إِلَّا اللَّهُ الْعَظِيمُ الْحَلِيمُ، لَا إِلَٰهَ إِلَّا اللَّهُ رَبُّ الْعَرْشِ الْعَظِيمِ، لَا إِلَٰهَ إِلَّا اللَّهُ رَبُّ السَّمَاوَاتِ وَرَبُّ الْأَرْضِ وَرَبُّ الْعَرْشِ الْكَرِيمِ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(26)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 26)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 27: La Sahla -->
    <div class="dua-card" data-categories="wellbeing" data-keywords="nothing easy except difficulty hardship grief exam impossible situation nawawi" data-id="27">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">27</div>
                <div class="card-title-group">
                    <div class="dua-title">Lā Sahla — Nothing Is Easy Except What You Make Easy <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">For Every Difficulty • Ibn Ḥibbān 974</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(27)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">اللَّهُمَّ لَا سَهْلَ إِلَّا مَا جَعَلْتَهُ سَهْلًا وَأَنْتَ تَجْعَلُ الْحَزْنَ إِذَا شِئْتَ سَهْلًا</div>
                </div>
                <div class="transliteration">Allāhumma lā sahla illā mā ja'altahu sahlā, wa anta taj'alul-ḥazna idhā shi'ta sahlā.</div>
                <div class="translation">"O Allah, there is nothing easy except what You make easy, and You make grief — when You will — easy."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Ibn Ḥibbān 974 (in his Ṣaḥīḥ) · Ibn as-Sunnī 351</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> Al-Nawawī included it in al-Adhkār as one of the most beloved daily supplications. The dua for every exam, every hardship, every impossible situation.</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'اللَّهُمَّ لَا سَهْلَ إِلَّا مَا جَعَلْتَهُ سَهْلًا وَأَنْتَ تَجْعَلُ الْحَزْنَ إِذَا شِئْتَ سَهْلًا')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(27)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 27)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 28: Jibril's Healing Dua -->
    <div class="dua-card" data-categories="wellbeing" data-keywords="healing sick illness cure shifa doctor hospital ruqyah jibril final illness" data-id="28">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">28</div>
                <div class="card-title-group">
                    <div class="dua-title">Jibril's Healing Dua <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">He ﷺ Repeated This Until His Soul Was Taken • Bukhari 5741</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(28)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">اللَّهُمَّ رَبَّ النَّاسِ مُذْهِبَ الْبَأْسِ اشْفِ أَنْتَ الشَّافِي لَا شَافِيَ إِلَّا أَنْتَ شِفَاءً لَا يُغَادِرُ سَقَمًا</div>
                </div>
                <div class="transliteration">Allāhumma Rabban-nāsi mudhhibal-ba's, ishfi antas-Shāfī lā shāfiya illā anta shifā'an lā yughādiru saqamā.</div>
                <div class="translation">"O Allah, Lord of mankind, Remover of hardship, heal — You are the Healer. No healer but You; a healing that leaves no ailment."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Bukhari 5741 · Muslim 2191</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> 'Ā'ishah رضي الله عنها: "He kept repeating this until his soul was taken." Use when visiting the sick or making ruqyah.</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'اللَّهُمَّ رَبَّ النَّاسِ مُذْهِبَ الْبَأْسِ اشْفِ أَنْتَ الشَّافِي لَا شَافِيَ إِلَّا أَنْتَ شِفَاءً لَا يُغَادِرُ سَقَمًا')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(28)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 28)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ══════════════════════════════════════════ -->
    <!-- ===== SECTION 6: PROPHETS' DUAS ===== -->
    <!-- ══════════════════════════════════════════ -->
      <div class="section-header" data-section="prophets" onclick="toggleSection(this)">
        <div class="section-ornament">
            <span class="orn-line"></span>
            <span class="orn-center">🌙</span>
            <span class="orn-line"></span>
        </div>
        <div class="section-title">Duas of the Prophets</div>
        <div class="section-subtitle">Treasured supplications from the chosen ones</div>
        <div class="section-toggle">▾</div>
        <div class="section-collapse-hint">tap to collapse</div>
    </div>

    <!-- DUA 29: Musa - Expand My Chest -->
    <div class="dua-card" data-categories="prophets,quran" data-keywords="musa moses expand chest ease task tongue speech exam presentation meeting" data-id="29">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">29</div>
                <div class="card-title-group">
                    <div class="dua-title">Dua of Musa عليه السلام — Expand My Chest <span class="auth-badge badge-quran">QUR'AN</span></div>
                    <div class="dua-category-tag">Before Any Important Task • Quran 20:25-28</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(29)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">رَبِّ اشْرَحْ لِي صَدْرِي ۞ وَيَسِّرْ لِي أَمْرِي ۞ وَاحْلُلْ عُقْدَةً مِّن لِّسَانِي ۞ يَفْقَهُوا قَوْلِي</div>
                </div>
                <div class="transliteration">Rabbish-raḥ lī ṣadrī, wa yassir lī amrī, waḥlul 'uqdatan min lisānī, yafqahū qawlī.</div>
                <div class="translation">"My Lord, expand for me my chest, ease for me my task, and untie the knot from my tongue, that they may understand my speech."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Quran 20:25-28</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> Perfect before speeches, exams, interviews, meetings, or any important communication.</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'رَبِّ اشْرَحْ لِي صَدْرِي وَيَسِّرْ لِي أَمْرِي وَاحْلُلْ عُقْدَةً مِّن لِّسَانِي يَفْقَهُوا قَوْلِي')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(29)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 29)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 30: Ibrahim - Establish Prayer -->
    <div class="dua-card" data-categories="prophets,quran,prayer" data-keywords="ibrahim abraham prayer offspring descendants accept dua establish salah" data-id="30">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">30</div>
                <div class="card-title-group">
                    <div class="dua-title">Dua of Ibrahim عليه السلام — Establish Prayer <span class="auth-badge badge-quran">QUR'AN</span></div>
                    <div class="dua-category-tag">For You & Your Children • Quran 14:40</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(30)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">رَبِّ اجْعَلْنِي مُقِيمَ الصَّلَاةِ وَمِن ذُرِّيَّتِي ۚ رَبَّنَا وَتَقَبَّلْ دُعَاءِ</div>
                </div>
                <div class="transliteration">Rabbij-'alnī muqīmaṣ-ṣalāti wa min dhurriyyatī, rabbanā wa taqabbal du'ā'.</div>
                <div class="translation">"My Lord, make me an establisher of prayer, and from my descendants. Our Lord, and accept my supplication."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Quran 14:40</span>
                </div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'رَبِّ اجْعَلْنِي مُقِيمَ الصَّلَاةِ وَمِن ذُرِّيَّتِي رَبَّنَا وَتَقَبَّلْ دُعَاءِ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(30)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 30)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 31: Sulaiman - Gratitude -->
    <div class="dua-card" data-categories="prophets,quran" data-keywords="sulaiman solomon gratitude parents righteous inspire favor blessings thankful" data-id="31">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">31</div>
                <div class="card-title-group">
                    <div class="dua-title">Dua of Sulaiman عليه السلام — Inspire Gratitude <span class="auth-badge badge-quran">QUR'AN</span></div>
                    <div class="dua-category-tag">Gratitude & Righteousness • Quran 27:19</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(31)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">رَبِّ أَوْزِعْنِي أَنْ أَشْكُرَ نِعْمَتَكَ الَّتِي أَنْعَمْتَ عَلَيَّ وَعَلَىٰ وَالِدَيَّ وَأَنْ أَعْمَلَ صَالِحًا تَرْضَاهُ وَأَدْخِلْنِي بِرَحْمَتِكَ فِي عِبَادِكَ الصَّالِحِينَ</div>
                </div>
                <div class="transliteration">Rabbi awzi'nī an ashkura ni'matakal-latī an'amta 'alayya wa 'alā wālidayya wa an a'mala ṣāliḥan tarḍāhu wa adkhilnī bi raḥmatika fī 'ibādikaṣ-ṣāliḥīn.</div>
                <div class="translation">"My Lord, inspire me to be grateful for Your favor which You have bestowed upon me and upon my parents, and to do righteousness of which You approve. And admit me by Your mercy into the ranks of Your righteous servants."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Quran 27:19</span>
                </div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'رَبِّ أَوْزِعْنِي أَنْ أَشْكُرَ نِعْمَتَكَ الَّتِي أَنْعَمْتَ عَلَيَّ وَعَلَىٰ وَالِدَيَّ وَأَنْ أَعْمَلَ صَالِحًا تَرْضَاهُ وَأَدْخِلْنِي بِرَحْمَتِكَ فِي عِبَادِكَ الصَّالِحِينَ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(31)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 31)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 32: Ayyub - In Affliction -->
    <div class="dua-card" data-categories="prophets,quran,wellbeing" data-keywords="ayyub job illness sickness harm affliction patience most merciful responded immediately" data-id="32">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">32</div>
                <div class="card-title-group">
                    <div class="dua-title">Dua of Ayyub عليه السلام — In Affliction <span class="auth-badge badge-quran">QUR'AN</span></div>
                    <div class="dua-category-tag">Allah Responded Immediately • Quran 21:83</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(32)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">أَنِّي مَسَّنِيَ الضُّرُّ وَأَنتَ أَرْحَمُ الرَّاحِمِينَ</div>
                </div>
                <div class="transliteration">Annī massaniyaḍ-ḍurru wa anta arḥamur-rāḥimīn.</div>
                <div class="translation">"Indeed, adversity has touched me, and You are the Most Merciful of the merciful."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Quran 21:83</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> Allah responded immediately: "So We answered him and removed what afflicted him" (21:84). A model of dignified supplication in suffering.</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'أَنِّي مَسَّنِيَ الضُّرُّ وَأَنتَ أَرْحَمُ الرَّاحِمِينَ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(32)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 32)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 33: Zakariyya - Righteous Offspring -->
    <div class="dua-card" data-categories="prophets,quran,family" data-keywords="zakariyya zechariah offspring child righteous heir good children hearer supplication" data-id="33">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">33</div>
                <div class="card-title-group">
                    <div class="dua-title">Dua of Zakariyya عليه السلام — Righteous Offspring <span class="auth-badge badge-quran">QUR'AN</span></div>
                    <div class="dua-category-tag">For Children • Quran 3:38</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(33)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">رَبِّ هَبْ لِي مِن لَّدُنكَ ذُرِّيَّةً طَيِّبَةً ۖ إِنَّكَ سَمِيعُ الدُّعَاءِ</div>
                </div>
                <div class="transliteration">Rabbi hab lī min ladunka dhurriyyatan ṭayyibah, innaka samī'ud-du'ā'.</div>
                <div class="translation">"My Lord, grant me from Yourself good offspring. Indeed, You are the Hearer of supplication."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Quran 3:38</span>
                </div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'رَبِّ هَبْ لِي مِن لَّدُنكَ ذُرِّيَّةً طَيِّبَةً إِنَّكَ سَمِيعُ الدُّعَاءِ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(33)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 33)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ══════════════════════════════════════════ -->
    <!-- ===== SECTION 7: MORNING & EVENING ===== -->
    <!-- ══════════════════════════════════════════ -->
       <div class="section-header" data-section="morning-evening" onclick="toggleSection(this)">
        <div class="section-ornament">
            <span class="orn-line"></span>
            <span class="orn-center">🌅</span>
            <span class="orn-line"></span>
        </div>
        <div class="section-title">Morning & Evening Adhkar</div>
        <div class="section-subtitle">Begin and end each day with remembrance</div>
        <div class="section-toggle">▾</div>
        <div class="section-collapse-hint">tap to collapse</div>
    </div>

    <!-- DUA 34: Morning Remembrance -->
    <div class="dua-card" data-categories="morning-evening" data-keywords="morning evening asbahna dominion praise sovereignty kingdom capable power" data-id="34">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">34</div>
                <div class="card-title-group">
                    <div class="dua-title">Morning & Evening Remembrance <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">Daily Foundation • Abu Dawud 5071</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(34)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">أَصْبَحْنَا وَأَصْبَحَ الْمُلْكُ لِلَّهِ، وَالْحَمْدُ لِلَّهِ، لَا إِلَٰهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ وَهُوَ عَلَىٰ كُلِّ شَيْءٍ قَدِيرٌ</div>
                </div>
                <div class="transliteration">Aṣbaḥnā wa aṣbaḥal-mulku lillāh, wal-ḥamdu lillāh, lā ilāha illallāhu waḥdahū lā sharīka lah, lahul-mulku wa lahul-ḥamdu wa huwa 'alā kulli shay'in qadīr.</div>
                <div class="translation">"We have reached the morning and the dominion belongs to Allah. All praise is for Allah. There is no god except Allah alone, with no partner. To Him belongs the dominion and all praise, and He is over all things capable."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Abu Dawud 5071</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> In the evening, replace "Aṣbaḥnā" with "Amsaynā" (We have reached the evening).</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'أَصْبَحْنَا وَأَصْبَحَ الْمُلْكُ لِلَّهِ، وَالْحَمْدُ لِلَّهِ، لَا إِلَٰهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ وَهُوَ عَلَىٰ كُلِّ شَيْءٍ قَدِيرٌ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(34)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 34)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 35: Hasbiyallah - Tawakkul -->
    <div class="dua-card" data-categories="morning-evening" data-keywords="hasbiyallah sufficient trust rely tawakkul throne great seven times" data-id="35">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">35</div>
                <div class="card-title-group">
                    <div class="dua-title">Ḥasbiyallāh — Placing Trust in Allah <span class="auth-badge badge-quran">QUR'AN</span></div>
                    <div class="dua-category-tag">7x Morning & Evening • Quran 9:129</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(35)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">حَسْبِيَ اللَّهُ لَا إِلَٰهَ إِلَّا هُوَ ۖ عَلَيْهِ تَوَكَّلْتُ ۖ وَهُوَ رَبُّ الْعَرْشِ الْعَظِيمِ</div>
                </div>
                <div class="transliteration">Ḥasbiyallāhu lā ilāha illā hū, 'alayhi tawakkaltu wa huwa Rabbul-'Arshil-'Aẓīm.</div>
                <div class="translation">"Allah is sufficient for me. There is no god except Him. Upon Him I rely, and He is the Lord of the Great Throne."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Quran 9:129 · Abu Dawud 5081</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> Said 7 times morning and evening — Allah will suffice you in all matters that concern you.</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'حَسْبِيَ اللَّهُ لَا إِلَٰهَ إِلَّا هُوَ عَلَيْهِ تَوَكَّلْتُ وَهُوَ رَبُّ الْعَرْشِ الْعَظِيمِ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(35)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 35)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 36: Tahlil 100x Daily -->
    <div class="dua-card" data-categories="morning-evening" data-keywords="tahlil la ilaha illallah 100 times daily slaves protection shaytan paradise sincerely" data-id="36">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">36</div>
                <div class="card-title-group">
                    <div class="dua-title">The Tahlīl of Paradise — 100x Daily <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">Once Sincerely = Jannah • Bukhari 6403</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(36)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">لَا إِلَٰهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ وَهُوَ عَلَىٰ كُلِّ شَيْءٍ قَدِيرٌ</div>
                </div>
                <div class="transliteration">Lā ilāha illallāhu waḥdahu lā sharīka lah, lahul-mulku wa lahul-ḥamdu wa huwa 'alā kulli shay'in qadīr.</div>
                <div class="translation">"There is no god except Allah, alone, without partner. To Him belongs the dominion and all praise, and He is over all things capable."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Bukhari 6403 · Muslim 2693</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> 100x daily: reward of freeing 10 slaves, 100 good deeds, 100 sins erased, protection from Shayṭān all day. Once sincerely: Paradise.</div>
                <div class="how-to-box">
                    <strong>Use the Tasbeeh counter:</strong> Tap the 📿 Tasbeeh button in the toolbar to count your 100 repetitions with the built-in digital counter.
                </div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'لَا إِلَٰهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ وَهُوَ عَلَىٰ كُلِّ شَيْءٍ قَدِيرٌ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="openTasbeehWith(36)">📿 Count 100x</button>
                    <button class="action-btn" onclick="shareDua(36)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 36)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ══════════════════════════════════════════ -->
    <!-- ===== SECTION 8: PROVISION ===== -->
    <!-- ══════════════════════════════════════════ -->
       <div class="section-header" data-section="provision" onclick="toggleSection(this)">
        <div class="section-ornament">
            <span class="orn-line"></span>
            <span class="orn-center">🌾</span>
            <span class="orn-line"></span>
        </div>
        <div class="section-title">Provision & Sustenance</div>
        <div class="section-subtitle">Asking the Provider for His bounty</div>
        <div class="section-toggle">▾</div>
        <div class="section-collapse-hint">tap to collapse</div>
    </div>

    <!-- DUA 37: Freedom from Debt -->
    <div class="dua-card" data-categories="provision" data-keywords="debt freedom halal haram provision wealth suffice independent bounty mountain" data-id="37">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">37</div>
                <div class="card-title-group">
                    <div class="dua-title">Freedom from Debt & Self-Sufficiency <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">Halal Over Haram • Tirmidhi 3563</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(37)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">اللَّهُمَّ اكْفِنِي بِحَلَالِكَ عَنْ حَرَامِكَ وَأَغْنِنِي بِفَضْلِكَ عَمَّنْ سِوَاكَ</div>
                </div>
                <div class="transliteration">Allāhummak-finī bi ḥalālika 'an ḥarāmik, wa aghninī bi faḍlika 'amman siwāk.</div>
                <div class="translation">"O Allah, suffice me with what You have permitted so that I have no need of that which You have forbidden, and make me independent of all besides You through Your bounty."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Tirmidhi 3563</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> If said, Allah will free you from debt even if it were as great as a mountain.</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'اللَّهُمَّ اكْفِنِي بِحَلَالِكَ عَنْ حَرَامِكَ وَأَغْنِنِي بِفَضْلِكَ عَمَّنْ سِوَاكَ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(37)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 37)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 38: Beneficial Knowledge -->
    <div class="dua-card" data-categories="provision" data-keywords="beneficial knowledge good provision accepted deeds after fajr morning useful rizq" data-id="38">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">38</div>
                <div class="card-title-group">
                    <div class="dua-title">Beneficial Knowledge, Good Provision & Accepted Deeds <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">After Fajr • Ibn Majah 925</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(38)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">اللَّهُمَّ إِنِّي أَسْأَلُكَ عِلْمًا نَافِعًا، وَرِزْقًا طَيِّبًا، وَعَمَلًا مُتَقَبَّلًا</div>
                </div>
                <div class="transliteration">Allāhumma innī as'aluka 'ilman nāfi'ā, wa rizqan ṭayyibā, wa 'amalan mutaqabbalā.</div>
                <div class="translation">"O Allah, I ask You for beneficial knowledge, good provision, and accepted deeds."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Ibn Majah 925</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> The Prophet ﷺ used to say this after the Fajr prayer — covering the three pillars of a successful life.</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'اللَّهُمَّ إِنِّي أَسْأَلُكَ عِلْمًا نَافِعًا، وَرِزْقًا طَيِّبًا، وَعَمَلًا مُتَقَبَّلًا')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(38)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 38)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 39: Before Eating -->
    <div class="dua-card" data-categories="provision" data-keywords="eating food meal before bismillah barakah blessings shaytan prevents sharing" data-id="39">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">39</div>
                <div class="card-title-group">
                    <div class="dua-title">Before Eating <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">Daily • Abu Dawud 3767</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(39)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">بِسْمِ اللَّهِ وَعَلَى بَرَكَةِ اللَّهِ</div>
                </div>
                <div class="transliteration">Bismillāhi wa 'alā barakatillāh.</div>
                <div class="translation">"In the name of Allah, and with the blessings of Allah."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Abu Dawud 3767 · Tirmidhi 1858</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> Saying Bismillah prevents Shayṭān from sharing in your food.</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'بِسْمِ اللَّهِ وَعَلَى بَرَكَةِ اللَّهِ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(39)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 39)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 40: Forgiveness for Parents & Believers -->
    <div class="dua-card" data-categories="family,forgiveness" data-keywords="forgiveness parents believers day account ibrahim dua offspring covering" data-id="40">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">40</div>
                <div class="card-title-group">
                    <div class="dua-title">Forgiveness for Self, Parents & All Believers <span class="auth-badge badge-quran">QUR'AN</span></div>
                    <div class="dua-category-tag">Dua of Ibrahim عليه السلام • Quran 14:41</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(40)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">رَبَّنَا اغْفِرْ لِي وَلِوَالِدَيَّ وَلِلْمُؤْمِنِينَ يَوْمَ يَقُومُ الْحِسَابُ</div>
                </div>
                <div class="transliteration">Rabbanāghfir lī wa liwālidayya wa lil-mu'minīna yawma yaqūmul-ḥisāb.</div>
                <div class="translation">"Our Lord, forgive me and my parents and the believers on the Day the account is established."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Quran 14:41</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> Dua of Prophet Ibrahim عليه السلام — covers parents, self, and all believers in one beautiful supplication.</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'رَبَّنَا اغْفِرْ لِي وَلِوَالِدَيَّ وَلِلْمُؤْمِنِينَ يَوْمَ يَقُومُ الْحِسَابُ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(40)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 40)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>    <!-- ══════════════════════════════════════════ -->
    <!-- ===== SECTION 9: THE GREATEST NAMES ===== -->
    <!-- ══════════════════════════════════════════ -->
       <div class="section-header" data-section="prayer" onclick="toggleSection(this)">
        <div class="section-ornament">
            <span class="orn-line"></span>
            <span class="orn-center">🕌</span>
            <span class="orn-line"></span>
        </div>
        <div class="section-title">Prayer, Worship & The Greatest Names</div>
        <div class="section-subtitle">Keys that unlock the heavens</div>
        <div class="section-toggle">▾</div>
        <div class="section-collapse-hint">tap to collapse</div>
    </div>

    <!-- DUA 41: Ism al-A'zam — The Greatest Name of Allah -->
    <div class="dua-card" data-categories="prayer,scholars" data-keywords="ism azam greatest name allah gives answers mannaan badi jalal ikram hayy qayyum" data-id="41">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">41</div>
                <div class="card-title-group">
                    <div class="dua-title">Ism Allāh al-Aʿẓam — The Greatest Name of Allah <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">When Asked by It, He Gives • Tirmidhi 3544</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(41)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">اللَّهُمَّ إِنِّي أَسْأَلُكَ بِأَنَّ لَكَ الْحَمْدَ لَا إِلَٰهَ إِلَّا أَنْتَ الْمَنَّانُ بَدِيعُ السَّمَاوَاتِ وَالْأَرْضِ يَا ذَا الْجَلَالِ وَالْإِكْرَامِ يَا حَيُّ يَا قَيُّومُ</div>
                </div>
                <div class="transliteration">Allāhumma innī as'aluka bi-anna lakal-ḥamda lā ilāha illā antal-Mannān, Badīʿus-samāwāti wal-arḍ, yā Dhal-Jalāli wal-Ikrām, yā Ḥayyu yā Qayyūm.</div>
                <div class="translation">"O Allah, I ask You by the fact that all praise is Yours, none has the right to be worshipped except You, the Bestower, Originator of the heavens and the earth, O Possessor of Majesty and Honor, O Ever-Living, O Self-Subsisting."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Tirmidhi 3544 · Nasā'ī 991 · Ibn Majah 3857 — ṣaḥīḥ by al-Albānī</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> The Prophet ﷺ heard a man supplicating with these words and said: "He has asked Allah by His Greatest Name — by which if He is asked, He gives, and if He is called upon, He answers."</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'اللَّهُمَّ إِنِّي أَسْأَلُكَ بِأَنَّ لَكَ الْحَمْدَ لَا إِلَٰهَ إِلَّا أَنْتَ الْمَنَّانُ بَدِيعُ السَّمَاوَاتِ وَالْأَرْضِ يَا ذَا الْجَلَالِ وَالْإِكْرَامِ يَا حَيُّ يَا قَيُّومُ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(41)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 41)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 42: Ism al-A'zam with Surah al-Ikhlas -->
    <div class="dua-card" data-categories="prayer,scholars" data-keywords="ism azam greatest name ikhlas ahad samad testify witness" data-id="42">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">42</div>
                <div class="card-title-group">
                    <div class="dua-title">The Ultimate Ism al-Aʿẓam — With Sūrah al-Ikhlāṣ <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">The Greatest Name • Abu Dawud 1493</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(42)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">اللَّهُمَّ إِنِّي أَسْأَلُكَ بِأَنِّي أَشْهَدُ أَنَّكَ أَنْتَ اللَّهُ لَا إِلَٰهَ إِلَّا أَنْتَ الْأَحَدُ الصَّمَدُ الَّذِي لَمْ يَلِدْ وَلَمْ يُولَدْ وَلَمْ يَكُنْ لَهُ كُفُوًا أَحَدٌ</div>
                </div>
                <div class="transliteration">Allāhumma innī as'aluka bi-annī ashhadu annaka antallāhu lā ilāha illā antal-Aḥadus-Ṣamad, alladhī lam yalid wa lam yūlad wa lam yakun lahu kufuwan aḥad.</div>
                <div class="translation">"O Allah, I ask You by my testifying that You are Allah, there is no god except You, the One, the Self-Sufficient Master, Who has not begotten and was not begotten, and to Whom there is none comparable."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Abu Dawud 1493 · Tirmidhi 3475 — ṣaḥīḥ by al-Albānī</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> "He has asked Allah by His Greatest Name — by which if He is asked, He gives, and if He is called upon, He answers."</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'اللَّهُمَّ إِنِّي أَسْأَلُكَ بِأَنِّي أَشْهَدُ أَنَّكَ أَنْتَ اللَّهُ لَا إِلَٰهَ إِلَّا أَنْتَ الْأَحَدُ الصَّمَدُ الَّذِي لَمْ يَلِدْ وَلَمْ يُولَدْ وَلَمْ يَكُنْ لَهُ كُفُوًا أَحَدٌ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(42)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 42)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 43: Praise That Fills the Heavens -->
    <div class="dua-card" data-categories="prayer" data-keywords="praise fills heavens earth ruku rising angels competed record abundant pure blessed" data-id="43">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">43</div>
                <div class="card-title-group">
                    <div class="dua-title">The Praise That Fills the Heavens <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">30 Angels Raced to Record It • Muslim 486</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(43)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">اللَّهُمَّ لَكَ الْحَمْدُ حَمْدًا كَثِيرًا طَيِّبًا مُبَارَكًا فِيهِ مَلْءَ السَّمَاوَاتِ وَمَلْءَ الْأَرْضِ وَمَلْءَ مَا بَيْنَهُمَا وَمَلْءَ مَا شِئْتَ مِنْ شَيْءٍ بَعْدُ</div>
                </div>
                <div class="transliteration">Allāhumma lakal-ḥamdu ḥamdan kathīran ṭayyiban mubārakan fīhi mil'as-samāwāti wa mil'al-arḍi wa mil'a mā baynahumā wa mil'a mā shi'ta min shay'in ba'd.</div>
                <div class="translation">"O Allah, for You is all praise — abundant, pure and blessed praise that fills the heavens and the earth and whatever lies between them, and that fills whatever You will after that."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Sahih Muslim 486</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> A man said this after rising from rukūʿ, and the Prophet ﷺ said: "I saw over thirty angels racing to see which of them would record it first."</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'اللَّهُمَّ لَكَ الْحَمْدُ حَمْدًا كَثِيرًا طَيِّبًا مُبَارَكًا فِيهِ مَلْءَ السَّمَاوَاتِ وَمَلْءَ الْأَرْضِ وَمَلْءَ مَا بَيْنَهُمَا وَمَلْءَ مَا شِئْتَ مِنْ شَيْءٍ بَعْدُ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(43)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 43)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 44: Dua of Tawhid — Ibn Taymiyyah's Lifelong Sujud Dua -->
    <div class="dua-card" data-categories="prayer,scholars" data-keywords="tawhid sujud prostration ibn taymiyyah submitted believed relied forgive advanced delayed secret open" data-id="44">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">44</div>
                <div class="card-title-group">
                    <div class="dua-title">The Dua of Tawḥīd — Ibn Taymiyyah's Sujūd Dua <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">20 Years Without Missing It • Bukhari 7446</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(44)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">اللَّهُمَّ لَكَ أَسْلَمْتُ وَبِكَ آمَنْتُ وَعَلَيْكَ تَوَكَّلْتُ وَإِلَيْكَ أَنَبْتُ وَبِكَ خَاصَمْتُ وَإِلَيْكَ حَاكَمْتُ فَاغْفِرْ لِي مَا قَدَّمْتُ وَمَا أَخَّرْتُ وَمَا أَسْرَرْتُ وَمَا أَعْلَنْتُ أَنْتَ الْمُقَدِّمُ وَأَنْتَ الْمُؤَخِّرُ لَا إِلَٰهَ إِلَّا أَنْتَ</div>
                </div>
                <div class="transliteration">Allāhumma laka aslamtu wa bika āmantu wa ʿalayka tawakkaltu wa ilayka anabtu wa bika khāṣamtu wa ilayka ḥākamtu faghfirlī mā qaddamtu wa mā akhkhartu wa mā asrartu wa mā a'lantu antal-Muqaddimu wa antal-Mu'akhkhiru lā ilāha illā ant.</div>
                <div class="translation">"O Allah, to You I have submitted, in You I have believed, upon You I have relied, to You I have turned, by You I have disputed, and to You I have referred for judgement. So forgive me for what I have done before and after, what I have concealed and what I have declared. You are the One who brings forward and the One who delays. There is no god except You."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Bukhari 7446, 6310 · Muslim 2717</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> Ibn Taymiyyah: "I never prostrated except I made this dua for over 20 years."</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'اللَّهُمَّ لَكَ أَسْلَمْتُ وَبِكَ آمَنْتُ وَعَلَيْكَ تَوَكَّلْتُ وَإِلَيْكَ أَنَبْتُ وَبِكَ خَاصَمْتُ وَإِلَيْكَ حَاكَمْتُ فَاغْفِرْ لِي مَا قَدَّمْتُ وَمَا أَخَّرْتُ وَمَا أَسْرَرْتُ وَمَا أَعْلَنْتُ أَنْتَ الْمُقَدِّمُ وَأَنْتَ الْمُؤَخِّرُ لَا إِلَٰهَ إِلَّا أَنْتَ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(44)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 44)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 45: The Mother of All Duas -->
    <div class="dua-card" data-categories="prayer" data-keywords="jannah paradise fire ask best decree good every speech deed aisha comprehensive mother" data-id="45">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">45</div>
                <div class="card-title-group">
                    <div class="dua-title">The Mother of All Duas — Every Decree Becomes Good <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">Comprehensive • Ahmad 25138</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(45)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">اللَّهُمَّ إِنِّي أَسْأَلُكَ الْجَنَّةَ وَمَا قَرَّبَ إِلَيْهَا مِنْ قَوْلٍ أَوْ عَمَلٍ وَأَعُوذُ بِكَ مِنَ النَّارِ وَمَا قَرَّبَ إِلَيْهَا مِنْ قَوْلٍ أَوْ عَمَلٍ وَأَسْأَلُكَ أَنْ تَجْعَلَ كُلَّ قَضَاءٍ قَضَيْتَهُ لِي خَيْرًا</div>
                </div>
                <div class="transliteration">Allāhumma innī as'alukal-jannata wa mā qarraba ilayhā min qawlin aw ʿamal, wa aʿūdhu bika minan-nāri wa mā qarraba ilayhā min qawlin aw ʿamal, wa as'aluka an tajʿala kulla qaḍā'in qaḍaytahu lī khayrā.</div>
                <div class="translation">"O Allah, I ask You for Paradise and whatever brings me closer to it of speech or deed, I seek refuge from the Fire and whatever brings closer to it, and I ask You to make every decree You have decreed for me good."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Ahmad 25138 — ṣaḥīḥ by al-Albānī (aṣ-Ṣaḥīḥah 1542)</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> The last phrase — "make every decree for me good" — is among the most powerful expressions of tawakkul ever taught.</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'اللَّهُمَّ إِنِّي أَسْأَلُكَ الْجَنَّةَ وَمَا قَرَّبَ إِلَيْهَا مِنْ قَوْلٍ أَوْ عَمَلٍ وَأَعُوذُ بِكَ مِنَ النَّارِ وَمَا قَرَّبَ إِلَيْهَا مِنْ قَوْلٍ أَوْ عَمَلٍ وَأَسْأَلُكَ أَنْ تَجْعَلَ كُلَّ قَضَاءٍ قَضَيْتَهُ لِي خَيْرًا')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(45)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 45)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 46: Ibrahimic Salawat -->
    <div class="dua-card" data-categories="prayer" data-keywords="salawat blessings prophet muhammad ibrahim prayer tashahhud key dua ascend" data-id="46">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">46</div>
                <div class="card-title-group">
                    <div class="dua-title">The Ibrahīmic Ṣalawāt — The Key That Makes Dua Ascend <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">Opens & Closes Every Dua • Bukhari 3370</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(46)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">اللَّهُمَّ صَلِّ عَلَىٰ مُحَمَّدٍ وَعَلَىٰ آلِ مُحَمَّدٍ كَمَا صَلَّيْتَ عَلَىٰ إِبْرَاهِيمَ وَعَلَىٰ آلِ إِبْرَاهِيمَ إِنَّكَ حَمِيدٌ مَجِيدٌ اللَّهُمَّ بَارِكْ عَلَىٰ مُحَمَّدٍ وَعَلَىٰ آلِ مُحَمَّدٍ كَمَا بَارَكْتَ عَلَىٰ إِبْرَاهِيمَ وَعَلَىٰ آلِ إِبْرَاهِيمَ إِنَّكَ حَمِيدٌ مَجِيدٌ</div>
                </div>
                <div class="transliteration">Allāhumma ṣalli ʿalā Muḥammadin wa ʿalā āli Muḥammad, kamā ṣallayta ʿalā Ibrāhīma wa ʿalā āli Ibrāhīm, innaka Ḥamīdun Majīd. Allāhumma bārik ʿalā Muḥammadin wa ʿalā āli Muḥammad, kamā bārakta ʿalā Ibrāhīma wa ʿalā āli Ibrāhīm, innaka Ḥamīdun Majīd.</div>
                <div class="translation">"O Allah, send prayers upon Muḥammad and his family, as You sent prayers upon Ibrāhīm and his family — You are Praiseworthy, Glorious. O Allah, bless Muḥammad and his family, as You blessed Ibrāhīm and his family — You are Praiseworthy, Glorious."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Bukhari 3370 · Muslim 405</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> "Whoever sends one ṣalawāt upon me, Allah sends ten upon him." (Muslim 384). Open and close every dua with this.</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'اللَّهُمَّ صَلِّ عَلَىٰ مُحَمَّدٍ وَعَلَىٰ آلِ مُحَمَّدٍ كَمَا صَلَّيْتَ عَلَىٰ إِبْرَاهِيمَ وَعَلَىٰ آلِ إِبْرَاهِيمَ إِنَّكَ حَمِيدٌ مَجِيدٌ اللَّهُمَّ بَارِكْ عَلَىٰ مُحَمَّدٍ وَعَلَىٰ آلِ مُحَمَّدٍ كَمَا بَارَكْتَ عَلَىٰ إِبْرَاهِيمَ وَعَلَىٰ آلِ إِبْرَاهِيمَ إِنَّكَ حَمِيدٌ مَجِيدٌ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(46)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 46)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 47: Ali & Fatimah's Night Dua -->
    <div class="dua-card" data-categories="prayer,protection" data-keywords="ali fatimah night dua awwal akhir zahir batin debt poverty seven heavens throne better servant" data-id="47">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">47</div>
                <div class="card-title-group">
                    <div class="dua-title">The Night Dua of ʿAlī & Fāṭimah رضي الله عنهما <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">Better Than a Servant • Bukhari 6316</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(47)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">اللَّهُمَّ رَبَّ السَّمَاوَاتِ السَّبْعِ وَرَبَّ الْعَرْشِ الْعَظِيمِ رَبَّنَا وَرَبَّ كُلِّ شَيْءٍ فَالِقَ الْحَبِّ وَالنَّوَىٰ وَمُنْزِلَ التَّوْرَاةِ وَالْإِنْجِيلِ وَالْفُرْقَانِ أَعُوذُ بِكَ مِنْ شَرِّ كُلِّ شَيْءٍ أَنْتَ آخِذٌ بِنَاصِيَتِهِ اللَّهُمَّ أَنْتَ الْأَوَّلُ فَلَيْسَ قَبْلَكَ شَيْءٌ وَأَنْتَ الْآخِرُ فَلَيْسَ بَعْدَكَ شَيْءٌ وَأَنْتَ الظَّاهِرُ فَلَيْسَ فَوْقَكَ شَيْءٌ وَأَنْتَ الْبَاطِنُ فَلَيْسَ دُونَكَ شَيْءٌ اقْضِ عَنَّا الدَّيْنَ وَأَغْنِنَا مِنَ الْفَقْرِ</div>
                </div>
                <div class="transliteration" style="font-size:calc(0.82rem * var(--font-scale))">Allāhumma Rabbas-samāwātis-sabʿi wa Rabbal-ʿArshil-ʿAẓīm, Rabbanā wa Rabba kulli shay', Fāliqal-ḥabbi wan-nawā, wa Munzilat-Tawrāti wal-Injīli wal-Furqān. Aʿūdhu bika min sharri kulli shay'in anta ākhidhun bi-nāṣiyatih. Allāhumma antal-Awwalu falaysa qablaka shay', wa antal-Ākhiru falaysa baʿdaka shay', wa antaẓ-Ẓāhiru falaysa fawqaka shay', wa antal-Bāṭinu falaysa dūnaka shay'. Iqḍi ʿannad-dayna wa aghninā minal-faqr.</div>
                <div class="translation">"O Allah, Lord of the seven heavens and the Magnificent Throne, our Lord and Lord of all things, Splitter of the grain and the seed, Revealer of the Torah, the Gospel and the Criterion. I seek refuge in You from the evil of everything whose forelock You hold. You are the First — nothing before You; the Last — nothing after You; the Manifest — nothing above You; the Hidden — nothing beyond You. Settle our debts and free us from poverty."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Bukhari 6316 · Muslim 2720</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> The Prophet ﷺ taught this to both ʿAlī and Fāṭimah together. He ﷺ said: "This is better for you than a servant."</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'اللَّهُمَّ رَبَّ السَّمَاوَاتِ السَّبْعِ وَرَبَّ الْعَرْشِ الْعَظِيمِ رَبَّنَا وَرَبَّ كُلِّ شَيْءٍ فَالِقَ الْحَبِّ وَالنَّوَىٰ وَمُنْزِلَ التَّوْرَاةِ وَالْإِنْجِيلِ وَالْفُرْقَانِ أَعُوذُ بِكَ مِنْ شَرِّ كُلِّ شَيْءٍ أَنْتَ آخِذٌ بِنَاصِيَتِهِ اللَّهُمَّ أَنْتَ الْأَوَّلُ فَلَيْسَ قَبْلَكَ شَيْءٌ وَأَنْتَ الْآخِرُ فَلَيْسَ بَعْدَكَ شَيْءٌ وَأَنْتَ الظَّاهِرُ فَلَيْسَ فَوْقَكَ شَيْءٌ وَأَنْتَ الْبَاطِنُ فَلَيْسَ دُونَكَ شَيْءٌ اقْضِ عَنَّا الدَّيْنَ وَأَغْنِنَا مِنَ الْفَقْرِ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(47)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 47)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 48: Four Evils -->
    <div class="dua-card" data-categories="prayer,guidance" data-keywords="four evils knowledge benefit heart humble soul satisfied dua answered roots corruption" data-id="48">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">48</div>
                <div class="card-title-group">
                    <div class="dua-title">Protection from the Four Evils <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">Roots of All Corruption • Muslim 2722</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(48)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنْ عِلْمٍ لَا يَنْفَعُ وَمِنْ قَلْبٍ لَا يَخْشَعُ وَمِنْ نَفْسٍ لَا تَشْبَعُ وَمِنْ دَعْوَةٍ لَا يُسْتَجَابُ لَهَا</div>
                </div>
                <div class="transliteration">Allāhumma innī aʿūdhu bika min ʿilmin lā yanfaʿ, wa min qalbin lā yakhshaʿ, wa min nafsin lā tashbaʿ, wa min daʿwatin lā yustajābu lahā.</div>
                <div class="translation">"O Allah, I seek refuge in You from knowledge that does not benefit, a heart that does not humble itself, a soul that is never satisfied, and a dua that is not answered."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Muslim 2722 · Nasā'ī 5442 · Ibn Majah 250</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> The Prophet ﷺ sought refuge from these four in every prayer. Ibn al-Qayyim: "These four are the roots of all corruption."</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنْ عِلْمٍ لَا يَنْفَعُ وَمِنْ قَلْبٍ لَا يَخْشَعُ وَمِنْ نَفْسٍ لَا تَشْبَعُ وَمِنْ دَعْوَةٍ لَا يُسْتَجَابُ لَهَا')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(48)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 48)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ══════════════════════════════════════════ -->
    <!-- ===== SECTION 10: TRAVEL & KNOWLEDGE ===== -->
    <!-- ══════════════════════════════════════════ -->
     <div class="section-header" data-section="travel" onclick="toggleSection(this)">
        <div class="section-ornament">
            <span class="orn-line"></span>
            <span class="orn-center">✈</span>
            <span class="orn-line"></span>
        </div>
        <div class="section-title">Travel, Mosque & Special Occasions</div>
        <div class="section-subtitle">For life's special moments</div>
        <div class="section-toggle">▾</div>
        <div class="section-collapse-hint">tap to collapse</div>
    </div>

    <!-- DUA 49: Before Sleeping (Full Version) -->
    <div class="dua-card" data-categories="travel,protection" data-keywords="sleep night before bed rest fitrah die protect forgive soul created" data-id="49">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">49</div>
                <div class="card-title-group">
                    <div class="dua-title">Before Sleeping — Full Prophetic Version <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">Dies Upon the Fiṭrah • Muslim 2712</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(49)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">اللَّهُمَّ إِنَّكَ خَلَقْتَ نَفْسِي وَأَنْتَ تَوَفَّاهَا لَكَ مَمَاتُهَا وَمَحْيَاهَا إِنْ أَحْيَيْتَهَا فَاحْفَظْهَا وَإِنْ أَمَتَّهَا فَاغْفِرْ لَهَا اللَّهُمَّ إِنِّي أَسْأَلُكَ الْعَافِيَةَ</div>
                </div>
                <div class="transliteration">Allāhumma innaka khalaqta nafsī wa anta tawaffāhā, laka mamātuhā wa maḥyāhā, in aḥyaytahā faḥfaẓhā wa in amattahā faghfir lahā. Allāhumma innī as'alukal-ʿāfiyah.</div>
                <div class="translation">"O Allah, You created my soul and You will take it back. Its death and life belong to You. If You keep it alive, protect it; if You cause it to die, forgive it. O Allah, I ask You for wellbeing."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Bukhari 6324 · Muslim 2712</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> The Prophet ﷺ: "If he dies that night, he dies upon the fiṭrah (natural state of purity)."</div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'اللَّهُمَّ إِنَّكَ خَلَقْتَ نَفْسِي وَأَنْتَ تَوَفَّاهَا لَكَ مَمَاتُهَا وَمَحْيَاهَا إِنْ أَحْيَيْتَهَا فَاحْفَظْهَا وَإِنْ أَمَتَّهَا فَاغْفِرْ لَهَا اللَّهُمَّ إِنِّي أَسْأَلُكَ الْعَافِيَةَ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(49)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 49)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 50: Dua for Travel -->
    <div class="dua-card" data-categories="travel" data-keywords="travel journey ride transport vehicle subhana subjected return lord" data-id="50">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">50</div>
                <div class="card-title-group">
                    <div class="dua-title">Dua for Travel <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">Every Journey • Muslim 1342</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(50)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">سُبْحَانَ الَّذِي سَخَّرَ لَنَا هَٰذَا وَمَا كُنَّا لَهُ مُقْرِنِينَ وَإِنَّا إِلَىٰ رَبِّنَا لَمُنقَلِبُونَ</div>
                </div>
                <div class="transliteration">Subḥānal-ladhī sakh-khara lanā hādhā wa mā kunnā lahū muqrinīn, wa innā ilā rabbinā lamunqalibūn.</div>
                <div class="translation">"Glory to Him who has subjected this to us, and we could not have done it by ourselves. And indeed, to our Lord we will return."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Quran 43:13-14 · Muslim 1342</span>
                </div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'سُبْحَانَ الَّذِي سَخَّرَ لَنَا هَٰذَا وَمَا كُنَّا لَهُ مُقْرِنِينَ وَإِنَّا إِلَىٰ رَبِّنَا لَمُنقَلِبُونَ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(50)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 50)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 51: Entering the Masjid -->
    <div class="dua-card" data-categories="travel" data-keywords="masjid mosque entering doors mercy open" data-id="51">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">51</div>
                <div class="card-title-group">
                    <div class="dua-title">Entering the Masjid <span class="auth-badge badge-sahih">SAHIH</span></div>
                    <div class="dua-category-tag">Daily • Muslim 713</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(51)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">اللَّهُمَّ افْتَحْ لِي أَبْوَابَ رَحْمَتِكَ</div>
                </div>
                <div class="transliteration">Allāhummaf-taḥ lī abwāba raḥmatik.</div>
                <div class="translation">"O Allah, open for me the doors of Your mercy."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Sahih Muslim 713</span>
                </div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'اللَّهُمَّ افْتَحْ لِي أَبْوَابَ رَحْمَتِكَ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(51)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 51)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 52: Extravagance in Sin (3:147) -->
    <div class="dua-card" data-categories="forgiveness,quran" data-keywords="forgiveness excess extravagant sins steady feet victory firm" data-id="52">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">52</div>
                <div class="card-title-group">
                    <div class="dua-title">For Those Who Have Been Extravagant in Sin <span class="auth-badge badge-quran">QUR'AN</span></div>
                    <div class="dua-category-tag">Forgiveness & Steadfastness • Quran 3:147</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(52)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">رَبَّنَا اغْفِرْ لَنَا ذُنُوبَنَا وَإِسْرَافَنَا فِي أَمْرِنَا وَثَبِّتْ أَقْدَامَنَا وَانصُرْنَا عَلَى الْقَوْمِ الْكَافِرِينَ</div>
                </div>
                <div class="transliteration">Rabbanāghfir lanā dhunūbanā wa isrāfanā fī amrinā wa thabbit aqdāmanā wanṣurnā ʿalal-qawmil-kāfirīn.</div>
                <div class="translation">"Our Lord, forgive us our sins and the excess committed in our affairs, plant our feet firmly, and give us victory over the disbelieving people."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Quran 3:147</span>
                </div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'رَبَّنَا اغْفِرْ لَنَا ذُنُوبَنَا وَإِسْرَافَنَا فِي أَمْرِنَا وَثَبِّتْ أَقْدَامَنَا وَانصُرْنَا عَلَى الْقَوْمِ الْكَافِرِينَ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(52)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 52)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ══════════════════════════════════════════ -->
    <!-- ===== SECTION 11: SCHOLARS' TREASURES ===== -->
    <!-- ══════════════════════════════════════════ -->
    <div class="section-header" data-section="scholars" onclick="toggleSection(this)">
        <div class="section-ornament">
            <span class="orn-line"></span>
            <span class="orn-center">📜</span>
            <span class="orn-line"></span>
        </div>
        <div class="section-title">Treasures of the Scholars</div>
        <div class="section-subtitle">Gems with honest, transparent authentication</div>
        <div class="section-toggle">▾</div>
        <div class="section-collapse-hint">tap to collapse</div>
    </div>
    <!-- DUA 53: Dua of al-Khadir -->
    <div class="dua-card" data-categories="scholars" data-keywords="khadir khidr green prophet abandon sins mercy concern discernment pleases awliya" data-id="53">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">53</div>
                <div class="card-title-group">
                    <div class="dua-title">The Dua of al-Khaḍir عليه السلام <span class="auth-badge badge-jayyid">JAYYID</span></div>
                    <div class="dua-category-tag">The Green Prophet • al-Ṭabarānī</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(53)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">اللَّهُمَّ ارْحَمْنِي بِتَرْكِ الْمَعَاصِي أَبَدًا مَا أَبْقَيْتَنِي وَارْحَمْنِي أَنْ أَتَكَلَّفَ مَا لَا يَعْنِينِي وَارْزُقْنِي حُسْنَ النَّظَرِ فِيمَا يُرْضِيكَ عَنِّي</div>
                </div>
                <div class="transliteration">Allāhumma irḥamnī bi-tarkil-maʿāṣī abadan mā abqaytanī, warḥamnī an atakallafa mā lā yaʿnīnī, warzuqnī ḥusnan-naẓari fīmā yurḍīka ʿannī.</div>
                <div class="translation">"O Allah, have mercy on me by enabling me to abandon sins forever as long as You keep me alive, have mercy on me from concerning myself with what does not concern me, and grant me good discernment in what will please You."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Ahmad, az-Zuhd · al-Ṭabarānī · al-Bayhaqī, Shuʿab al-Īmān — chain jayyid</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> Attributed to al-Khaḍir عليه السلام. The greatest awliyā' never abandoned it. Content aligns perfectly with Qur'ānic principles.</div>
                <div class="how-to-box">
                    <strong>Note:</strong> Athar narration. Chain graded jayyid (good), not ṣaḥīḥ. Content aligns with Qur'ānic principles of leaving sin, avoiding what doesn't concern you, and seeking Allah's pleasure.
                </div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'اللَّهُمَّ ارْحَمْنِي بِتَرْكِ الْمَعَاصِي أَبَدًا مَا أَبْقَيْتَنِي وَارْحَمْنِي أَنْ أَتَكَلَّفَ مَا لَا يَعْنِينِي وَارْزُقْنِي حُسْنَ النَّظَرِ فِيمَا يُرْضِيكَ عَنِّي')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(53)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 53)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 54: Dua of Ta'if -->
    <div class="dua-card" data-categories="scholars" data-keywords="taif weakness complaint humiliation strength resources mercy merciful weak lord entrust angry wrath refuge light face tawakkul" data-id="54">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">54</div>
                <div class="card-title-group">
                    <div class="dua-title">The Dua of Ṭā'if — Greatest Expression of Tawakkul <span class="auth-badge badge-sirah">SĪRAH</span></div>
                    <div class="dua-category-tag">Made Once, Bleeding & Rejected • Ibn Isḥāq</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(54)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">اللَّهُمَّ إِلَيْكَ أَشْكُو ضَعْفَ قُوَّتِي وَقِلَّةَ حِيلَتِي وَهَوَانِي عَلَى النَّاسِ يَا أَرْحَمَ الرَّاحِمِينَ أَنْتَ رَبُّ الْمُسْتَضْعَفِينَ وَأَنْتَ رَبِّي إِلَىٰ مَنْ تَكِلُنِي؟ إِلَىٰ بَعِيدٍ يَتَجَهَّمُنِي أَمْ إِلَىٰ عَدُوٍّ مَلَّكْتَهُ أَمْرِي؟ إِنْ لَمْ يَكُنْ بِكَ عَلَيَّ غَضَبٌ فَلَا أُبَالِي وَلَٰكِنَّ عَافِيَتَكَ هِيَ أَوْسَعُ لِي أَعُوذُ بِنُورِ وَجْهِكَ الَّذِي أَشْرَقَتْ لَهُ الظُّلُمَاتُ وَصَلَحَ عَلَيْهِ أَمْرُ الدُّنْيَا وَالْآخِرَةِ مِنْ أَنْ يَنْزِلَ بِي غَضَبُكَ أَوْ يَحِلَّ عَلَيَّ سَخَطُكَ لَكَ الْعُتْبَىٰ حَتَّىٰ تَرْضَىٰ وَلَا حَوْلَ وَلَا قُوَّةَ إِلَّا بِكَ</div>
                </div>
                <div class="transliteration" style="font-size:calc(0.8rem * var(--font-scale))">Allāhumma ilayka ashkū ḍaʿfa quwwatī wa qillata ḥīlatī wa hawānī ʿalan-nās. Yā Arḥamar-Rāḥimīn, anta Rabbul-mustaḍʿafīn wa anta Rabbī. Ilā man takilunī? Ilā baʿīdin yatajahhamunī am ilā ʿaduwwin mallaktahu amrī? In lam yakun bika ʿalayya ghaḍabun falā ubālī, wa lākinna ʿāfiyataka hiya awsaʿu lī. Aʿūdhu bi-nūri wajhikal-ladhī ashraqat lahuz-ẓulumātu wa ṣalaḥa ʿalayhi amrud-dunyā wal-ākhirati min an yanzila bī ghaḍabuka aw yaḥilla ʿalayya sakhaṭuk. Lakal-ʿutbā ḥattā tarḍā, wa lā ḥawla wa lā quwwata illā bik.</div>
                <div class="translation">"O Allah, to You I complain of my weakness, my lack of resources and my humiliation before the people. O Most Merciful, You are the Lord of the weak and You are my Lord. To whom do You entrust me? To a distant person who will treat me harshly? Or to an enemy whom You have given control over my affair? If You are not angry with me, then I do not care — but Your protection would be more encompassing for me. I seek refuge in the light of Your Face, by which all darkness is illuminated and the affairs of this world and the Hereafter are set right, from Your anger descending upon me or Your wrath befalling me. Yours is the right to admonish until You are pleased, and there is no power nor strength except with You."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Ibn Isḥāq, al-Sīrah al-Nabawiyyah · Ibn Hishām · al-Ṭabarī</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> Made only once — bleeding and rejected at Ṭā'if. Accepted by Ibn Taymiyyah, Ibn al-Qayyim and many scholars as among the greatest expressions of tawakkul ever recorded.</div>
                <div class="how-to-box">
                    <strong>Note:</strong> Sīrah source with a weak isnād (contains an unknown narrator). However, its content has been universally accepted by scholars for its alignment with Qur'ānic themes of tawakkul and submission to Allah.
                </div>
                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'اللَّهُمَّ إِلَيْكَ أَشْكُو ضَعْفَ قُوَّتِي وَقِلَّةَ حِيلَتِي وَهَوَانِي عَلَى النَّاسِ يَا أَرْحَمَ الرَّاحِمِينَ أَنْتَ رَبُّ الْمُسْتَضْعَفِينَ وَأَنْتَ رَبِّي إِلَىٰ مَنْ تَكِلُنِي إِلَىٰ بَعِيدٍ يَتَجَهَّمُنِي أَمْ إِلَىٰ عَدُوٍّ مَلَّكْتَهُ أَمْرِي إِنْ لَمْ يَكُنْ بِكَ عَلَيَّ غَضَبٌ فَلَا أُبَالِي وَلَٰكِنَّ عَافِيَتَكَ هِيَ أَوْسَعُ لِي أَعُوذُ بِنُورِ وَجْهِكَ الَّذِي أَشْرَقَتْ لَهُ الظُّلُمَاتُ وَصَلَحَ عَلَيْهِ أَمْرُ الدُّنْيَا وَالْآخِرَةِ مِنْ أَنْ يَنْزِلَ بِي غَضَبُكَ أَوْ يَحِلَّ عَلَيَّ سَخَطُكَ لَكَ الْعُتْبَىٰ حَتَّىٰ تَرْضَىٰ وَلَا حَوْلَ وَلَا قُوَّةَ إِلَّا بِكَ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(54)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 54)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DUA 55: The Master Key Dua -->
    <div class="dua-card" data-categories="scholars,prayer" data-keywords="master key comprehensive catch-all every good prophet asked refuge evil sought encompasses entire lifetime ibn majah hasan" data-id="55">
        <div class="card-header" onclick="toggleCard(this)" tabindex="0" role="button" aria-expanded="false">
            <div class="card-header-left">
                <div class="dua-number">55</div>
                <div class="card-title-group">
                    <div class="dua-title">The Master Key Dua — Encompasses Every Dua ﷺ Ever Made <span class="auth-badge badge-hasan">HASAN</span></div>
                    <div class="dua-category-tag">The Ultimate Catch-All • Ibn Majah 3846</div>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-action-btn bookmark-btn" onclick="event.stopPropagation(); toggleBookmark(55)" title="Bookmark">☆</button>
                <span class="expand-icon">▾</span>
            </div>
        </div>
        <div class="card-body">
            <div class="card-body-inner">
                <div class="ornament-divider"><span class="line"></span><span class="diamond"></span><span class="line"></span></div>
                <div class="arabic-container">
                    <div class="arabic-text">اللَّهُمَّ إِنِّي أَسْأَلُكَ مِنْ خَيْرِ مَا سَأَلَكَ عَبْدُكَ وَنَبِيُّكَ مُحَمَّدٌ صَلَّى اللَّهُ عَلَيْهِ وَسَلَّمَ وَأَعُوذُ بِكَ مِنْ شَرِّ مَا عَاذَ مِنْهُ عَبْدُكَ وَنَبِيُّكَ مُحَمَّدٌ صَلَّى اللَّهُ عَلَيْهِ وَسَلَّمَ</div>
                </div>
                <div class="transliteration">Allāhumma innī as'aluka min khayri mā sa'alaka ʿabduka wa nabiyyuka Muḥammadun ṣallallāhu ʿalayhi wa sallam, wa aʿūdhu bika min sharri mā ʿādha minhu ʿabduka wa nabiyyuka Muḥammadun ṣallallāhu ʿalayhi wa sallam.</div>
                <div class="translation">"O Allah, I ask You for the best of what Your servant and Prophet Muḥammad ﷺ asked You for, and I seek refuge in You from the worst of what Your servant and Prophet Muḥammad ﷺ sought refuge from."</div>
                <div class="reference">
                    <span class="ref-icon">📖</span>
                    <span class="ref-text">Ibn Majah 3846 — graded ḥasan by al-Albānī</span>
                </div>
                <div class="virtue-tag"><span class="gem">💎</span> With this single supplication, you ask Allah for EVERY good thing the Prophet ﷺ ever requested across his entire lifetime — and seek refuge from EVERY evil he ever sought protection from. The dua of all duas in one sentence.</div>
                <div class="how-to-box">
                    <strong>Why this is extraordinary:</strong> Even if you cannot memorize all 55 duas in this collection, this one sentence covers them all — because every dua Muḥammad ﷺ ever made is included in its scope. Ibn al-Qayyim: "The servant who makes this dua has gathered every good and repelled every evil."
                </div>
                                <div class="copy-row">
                    <button class="action-btn" onclick="copyText(this, 'اللَّهُمَّ إِنِّي أَسْأَلُكَ مِنْ خَيْرِ مَا سَأَلَكَ عَبْدُكَ وَنَبِيُّكَ مُحَمَّدٌ صَلَّى اللَّهُ عَلَيْهِ وَسَلَّمَ وَأَعُوذُ بِكَ مِنْ شَرِّ مَا عَاذَ مِنْهُ عَبْدُكَ وَنَبِيُّكَ مُحَمَّدٌ صَلَّى اللَّهُ عَلَيْهِ وَسَلَّمَ')">📋 Copy Arabic</button>
                    <button class="action-btn" onclick="shareDua(55)">↗ Share</button>
                    <button class="action-btn" onclick="markRead(this, 55)">✓ Mark Read</button>
                </div>
            </div>
        </div>
    </div> <!-- end dua card 55 -->

</div> <!-- ===== END .container ===== -->

<!-- ===== PASHTO LANGUAGE SUPPORT ===== -->
<script src="pashto.js"></script>

<!-- ══════════════════════════════════════════ -->
<!-- ===== JAVASCRIPT ENGINE ===== -->
<!-- ══════════════════════════════════════════ -->
<script>
    // ===== STATE MANAGEMENT =====
    const STATE = {
        bookmarks: JSON.parse(localStorage.getItem('crown_bookmarks')) || [],
        read: JSON.parse(localStorage.getItem('crown_read')) || [],
        streak: parseInt(localStorage.getItem('crown_streak')) || 0,
        lastVisit: localStorage.getItem('crown_last_visit') || null,
        fontSize: parseFloat(localStorage.getItem('crown_font_size')) || 1
    };

    // ===== DOM ELEMENTS =====
    const els = {
        cards: document.querySelectorAll('.dua-card'),
        searchInput: document.getElementById('searchInput'),
        searchClear: document.getElementById('searchClear'),
        noResults: document.getElementById('noResults'),
        pills: document.querySelectorAll('.pill'),
        bookmarkCount: document.getElementById('bookmarkCount'),
        readCount: document.getElementById('readCount'),
        streakCount: document.getElementById('streakCount'),
        lastVisit: document.getElementById('lastVisit'),
        progressBar: document.getElementById('progressFill'),
        toast: document.getElementById('toast'),
        dailyArabic: document.getElementById('dailyArabic'),
        dailyTranslation: document.getElementById('dailyTranslation'),
        nav: document.getElementById('topNav')
    };

    // ===== INITIALIZATION =====
    function init() {
        // Dismiss splash screen
        const splash = document.getElementById('splashScreen');
        if (splash) {
            setTimeout(() => {
                splash.classList.add('hidden');
                setTimeout(() => splash.remove(), 1000);
            }, 2200);
        }

        updateStats();
        checkStreak();
        loadDailyDua();
        applyFontSize(STATE.fontSize);
        applyTheme();
        injectShareImageButtons();
        injectAudioButtons();
        renderTimeBanner();
        trackDailyActivity();
        renderBookmarksPanel();
        wrapArabicWords();

        // Apply saved language preference
        if (typeof applyLanguage === 'function') applyLanguage();

        // Search listener
        if (els.searchInput) {
            els.searchInput.addEventListener('input', (e) => filterDuas(e.target.value));
        }

        // Scroll listener
        window.addEventListener('scroll', () => {
            const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
            const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const scrolled = (winScroll / height) * 100;
            if (els.progressBar) els.progressBar.style.width = scrolled + "%";

            const backBtn = document.querySelector('.back-to-top');
            if (backBtn) backBtn.classList.toggle('visible', winScroll > 500);

            if (els.nav) {
                if (winScroll > 50) els.nav.classList.add('scrolled');
                else els.nav.classList.remove('scrolled');
            }
        });

        // Restore bookmarks UI
        STATE.bookmarks.forEach(id => {
            const btn = document.querySelector(`.dua-card[data-id="${id}"] .bookmark-btn`);
            if (btn) { btn.classList.add('bookmarked'); btn.innerHTML = '★'; }
        });

        // Restore read UI
        STATE.read.forEach(id => {
            const card = document.querySelector(`.dua-card[data-id="${id}"]`);
            if (card) {
                card.classList.add('read-card');
                const readBtn = card.querySelector('.action-btn[onclick*="markRead"]');
                if (readBtn) {
                    readBtn.classList.add('read');
                    readBtn.innerHTML = '✓ Read';
                }
            }
        });

        // Restore collapsed sections
        const collapsedSections = JSON.parse(localStorage.getItem('crown_collapsed_sections') || '[]');
        collapsedSections.forEach(sectionName => {
            const header = document.querySelector(`.section-header[data-section="${sectionName}"]`);
            if (header) {
                header.classList.add('collapsed');
                const hint = header.querySelector('.section-collapse-hint');
                if (hint) hint.textContent = 'tap to expand';

                let nextElement = header.nextElementSibling;
                while (nextElement) {
                    if (nextElement.classList.contains('section-header')) break;
                    if (nextElement.classList.contains('dua-card')) {
                        nextElement.style.display = 'none';
                    }
                    nextElement = nextElement.nextElementSibling;
                }
            }
        });

        // --- Intersection Observer for Card Animations ---
    
        if ('IntersectionObserver' in window) {
            const observerOptions = {
                root: null,
                rootMargin: '0px',
                threshold: 0.05
            };

            const cardObserver = new IntersectionObserver((entries) => {
                entries.forEach((entry) => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                        cardObserver.unobserve(entry.target);
                    }
                });
            }, observerOptions);

            els.cards.forEach(card => {
                cardObserver.observe(card);
            });
        }

        // --- Keyboard Accessibility ---
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const pp = document.querySelector('.progress-panel.active');
                if (pp) { closeProgress(); return; }

                const tp = document.querySelector('.tasbeeh-panel.active');
                if (tp) { closeTasbeeh(); return; }

                const ep = document.querySelector('.etiquette-panel.active');
                if (ep) { closeEtiquette(); return; }

                const rp = document.querySelector('.routine-panel.active');
                if (rp) { closeRoutine(); return; }

                const prayerp = document.querySelector('.prayer-panel.active');
                if (prayerp) { closePrayer(); return; }

                const bp = document.getElementById('bookmarksPanel');
                if (bp && bp.classList.contains('active')) { toggleBookmarksPanel(); return; }

                if (els.searchInput && els.searchInput.value) {
                    clearSearch();
                    els.searchInput.blur();
                    return;
                }
            }
        });

        // Keyboard support for card headers
        document.addEventListener('keydown', function(e) {
            const target = e.target;
            if (target.classList.contains('card-header')) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    toggleCard(target);
                }
            }
        });

        // Handle hash-based deep links (manifest shortcuts)
        setTimeout(() => {
            const hash = window.location.hash;
            if (hash === '#daily') scrollToDailyDua();
            else if (hash === '#tasbeeh') openTasbeeh();
            else if (hash === '#routine') openRoutine();
            else if (hash === '#prayer') openPrayer();
            window.location.hash = '';
        }, 2500); // After splash screen
    }

    // ===== CARD TOGGLE =====
    window.toggleCard = function(header) {
        const card = header.closest('.dua-card');
        const isExpanded = card.classList.toggle('expanded');
        header.setAttribute('aria-expanded', isExpanded);
        if (isExpanded) wrapArabicWords();
    };

    window.toggleAllCards = function(expand) {
        els.cards.forEach(card => {
            if (expand) card.classList.add('expanded');
            else card.classList.remove('expanded');
            const header = card.querySelector('.card-header');
            if (header) header.setAttribute('aria-expanded', expand);
        });
        showToast(expand ? 'All Expanded' : 'All Collapsed');
    };

    // ===== FONT SIZE =====
    window.adjustFontSize = function(delta) {
        let newSize = Math.max(0.8, Math.min(1.6, STATE.fontSize + delta));
        STATE.fontSize = newSize;
        localStorage.setItem('crown_font_size', newSize);
        applyFontSize(newSize);
    };

    function applyFontSize(size) {
        document.documentElement.style.setProperty('--font-scale', size);
    }

    // ===== SCROLL LOCK =====
    let scrollPosition = 0;

    function lockScroll() {
        scrollPosition = window.pageYOffset;
        document.body.classList.add('panel-open');
        document.body.style.top = `-${scrollPosition}px`;
    }

    function unlockScroll() {
        document.body.classList.remove('panel-open');
        document.body.style.top = '';
        window.scrollTo(0, scrollPosition);
    }

    // ===== BOTTOM NAV STATE =====
    function setBottomNavActive(navName) {
        document.querySelectorAll('.bottom-nav-item').forEach(b => b.classList.remove('active'));
        const target = document.querySelector(`.bottom-nav-item[data-nav="${navName}"]`);
        if (target) target.classList.add('active');
    }

    // ===== BOOKMARKING =====
    window.toggleBookmark = function(id) {
        const index = STATE.bookmarks.indexOf(id);
        const btn = document.querySelector(`.dua-card[data-id="${id}"] .bookmark-btn`);
        if (index === -1) {
            STATE.bookmarks.push(id);
            if (btn) { btn.classList.add('bookmarked'); btn.innerHTML = '★'; }
            showToast('Added to Bookmarks');
        } else {
            STATE.bookmarks.splice(index, 1);
            if (btn) { btn.classList.remove('bookmarked'); btn.innerHTML = '☆'; }
            showToast('Removed from Bookmarks');
        }
        localStorage.setItem('crown_bookmarks', JSON.stringify(STATE.bookmarks));
        updateStats();
        renderBookmarksPanel();
    };

    // ===== MARK READ =====
    window.markRead = function(btn, id) {
        if (!STATE.read.includes(id)) {
            STATE.read.push(id);
            localStorage.setItem('crown_read', JSON.stringify(STATE.read));
            const card = document.querySelector(`.dua-card[data-id="${id}"]`);
            if (card) card.classList.add('read-card');
            if (btn) { btn.classList.add('read'); btn.innerHTML = '✓ Read'; }
            updateStats();
            showToast(`Marked as Read (${STATE.read.length}/55)`);
        } else {
            showToast('Already marked as read');
        }
    };

    // ===== COPY TEXT =====
    window.copyText = function(btn, text) {
        navigator.clipboard.writeText(text).then(() => {
            if (btn) {
                const originalText = btn.innerHTML;
                btn.innerHTML = '✓ Copied!';
                btn.classList.add('copied');
                setTimeout(() => { btn.innerHTML = originalText; btn.classList.remove('copied'); }, 2000);
            }
            showToast('Copied to clipboard');
        }).catch(() => showToast('Failed to copy'));
    };

    // ===== SEARCH & FILTER =====
    function filterDuas(query) {
        query = query.toLowerCase();
        let visibleCount = 0;
        if (els.searchClear) els.searchClear.classList.toggle('visible', query.length > 0);
        els.cards.forEach(card => {
            const isMatch = card.textContent.toLowerCase().includes(query) ||
                           (card.getAttribute('data-keywords') || "").includes(query);
            card.classList.toggle('hidden-card', !isMatch);
            if (isMatch) visibleCount++;
        });
        if (els.noResults) els.noResults.classList.toggle('visible', visibleCount === 0);
    }

    window.clearSearch = function() {
        if (els.searchInput) els.searchInput.value = '';
        filterDuas('');
        if (els.searchClear) els.searchClear.classList.remove('visible');
    };

window.filterCategory = function(cat, btn) {
    if (els.pills) els.pills.forEach(p => p.classList.remove('active'));
    if (btn && btn.classList.contains('pill')) btn.classList.add('active');

    let visibleCount = 0;
    els.cards.forEach(card => {
        const cats = card.getAttribute('data-categories').split(',');
        const isMatch = cat === 'all' || cats.includes(cat);
        card.classList.toggle('hidden-card', !isMatch);
        card.style.display = '';  // ✅ always clear any stuck inline style
        if (isMatch) visibleCount++;
    });

    // Expand all collapsed sections when filtering
    document.querySelectorAll('.section-header.collapsed').forEach(sh => {
        sh.classList.remove('collapsed');
        const hint = sh.querySelector('.section-collapse-hint');
        if (hint) hint.textContent = 'tap to collapse';

        let next = sh.nextElementSibling;
        while (next && !next.classList.contains('section-header')) {
            if (next.classList.contains('dua-card')) {
                next.style.display = ''; 
            }
            next = next.nextElementSibling;
        }
    });

    if (els.noResults) els.noResults.classList.toggle('visible', visibleCount === 0);
    window.scrollTo({ top: 0, behavior: 'smooth' });
};

    // ===== BOOKMARKS PANEL =====
    window.toggleBookmarksPanel = function() {
        let panel = document.getElementById('bookmarksPanel');
        if (!panel) {
            const div = document.createElement('div');
            div.id = 'bookmarksPanel';
            div.className = 'side-panel';
            div.innerHTML = `
                <div class="panel-header">
                    <div class="panel-title">Your Saved Duas</div>
                    <button class="panel-close" onclick="toggleBookmarksPanel()">✕</button>
                </div>
                <div id="bookmarkListContainer"></div>`;
            document.body.appendChild(div);
            if (!document.querySelector('.overlay')) {
                const ov = document.createElement('div');
                ov.className = 'overlay';
                ov.onclick = toggleBookmarksPanel;
                document.body.appendChild(ov);
            }
        }
        renderBookmarksPanel();
        const p = document.getElementById('bookmarksPanel');
        const overlay = document.querySelector('.overlay');
        const isOpening = !p.classList.contains('active');

        p.classList.toggle('active');
        overlay.classList.toggle('active');

        if (isOpening) {
            lockScroll();
            setBottomNavActive('saved');
        } else {
            unlockScroll();
            setBottomNavActive('home');
        }
    };

    function renderBookmarksPanel() {
        const container = document.getElementById('bookmarkListContainer');
        if (!container) return;
        if (STATE.bookmarks.length === 0) {
            container.innerHTML = '<div class="panel-empty">No bookmarks yet.<br>Tap the star icon to save duas here.</div>';
            return;
        }
        let html = '';
        STATE.bookmarks.forEach(id => {
            const card = document.querySelector(`.dua-card[data-id="${id}"]`);
            if (card) {
                const title = card.querySelector('.dua-title').textContent;
                const arabic = card.querySelector('.arabic-text').textContent;
                html += `<div class="panel-item" onclick="scrollToDua(${id}); toggleBookmarksPanel()">
                    <div class="panel-item-title">${title}</div>
                    <div class="panel-item-arabic">${arabic}</div>
                </div>`;
            }
        });
        container.innerHTML = html;
    }

    // ===== SCROLL TO DUA =====
       window.scrollToDua = function(id) {
        const card = document.querySelector(`.dua-card[data-id="${id}"]`);
        if (card) {
            card.classList.remove('hidden-card');
            card.style.display = '';
            card.classList.add('expanded');
            const header = card.querySelector('.card-header');
            if (header) header.setAttribute('aria-expanded', 'true');
            setTimeout(() => {
                card.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 100);
            card.style.borderColor = 'var(--emerald-light)';
            card.style.boxShadow = '0 0 20px rgba(46, 196, 122, 0.15)';
            setTimeout(() => {
                card.style.borderColor = '';
                card.style.boxShadow = '';
            }, 2500);
        }
    };
    // ===== TASBEEH =====
    const DHIKR_LIST = [
        { id: 'subhanallah', ar: 'سُبْحَانَ ٱللَّهِ', en: 'Subhanallah', virtue: '33× after every salah', defaultTarget: 33 },
        { id: 'alhamdulillah', ar: 'ٱلْحَمْدُ لِلَّهِ', en: 'Alhamdulillah', virtue: '33× after every salah', defaultTarget: 33 },
        { id: 'allahuakbar', ar: 'ٱللَّهُ أَكْبَرُ', en: 'Allahu Akbar', virtue: '34× after every salah', defaultTarget: 34 },
        { id: 'lailaha', ar: 'لَا إِلَٰهَ إِلَّا ٱللَّهُ', en: 'La ilaha illallah', virtue: 'Best dhikr — Tirmidhi 3383', defaultTarget: 100 },
        { id: 'astaghfirullah', ar: 'أَسْتَغْفِرُ ٱللَّهَ', en: 'Astaghfirullah', virtue: '100× daily — Muslim 2702', defaultTarget: 100 },
        { id: 'subhanwabi', ar: 'سُبْحَانَ ٱللَّهِ وَبِحَمْدِهِ', en: 'Subhanallahi wa bihamdihi', virtue: 'Plants a tree in Jannah — Tirmidhi 3464', defaultTarget: 100 },
        { id: 'lahawla', ar: 'لَا حَوْلَ وَلَا قُوَّةَ إِلَّا بِٱللَّهِ', en: 'La hawla wala quwwata illa billah', virtue: 'A treasure of Jannah — Bukhari 6384', defaultTarget: 33 }
    ];

    let tasbeehCount = 0;
    let tasbeehTarget = 33;
    let currentDhikrIndex = 0;

    // Load saved totals
    function getDhikrTotals() {
        try { return JSON.parse(localStorage.getItem('crown_dhikr_totals') || '{}'); } catch { return {}; }
    }
    function saveDhikrTotal(id, count) {
        const totals = getDhikrTotals();
        totals[id] = (totals[id] || 0) + count;
        localStorage.setItem('crown_dhikr_totals', JSON.stringify(totals));
    }
    function getOverallTotal() {
        const totals = getDhikrTotals();
        return Object.values(totals).reduce((sum, v) => sum + v, 0);
    }

    function renderDhikrSelector() {
        const container = document.getElementById('dhikrSelector');
        if (!container) return;
        container.innerHTML = DHIKR_LIST.map((d, i) => `
            <div class="dhikr-option${i === currentDhikrIndex ? ' active' : ''}" onclick="selectDhikr(${i})">
                <div class="dhikr-option-ar">${d.ar}</div>
                <div class="dhikr-option-en">${d.en}</div>
            </div>
        `).join('');
        // Scroll active into view
        const active = container.querySelector('.dhikr-option.active');
        if (active) active.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
    }

    function updateTasbeehUI() {
        const d = DHIKR_LIST[currentDhikrIndex];
        const arEl = document.getElementById('tasbeehArabic');
        const virtueEl = document.getElementById('tasbeehVirtue');
        const lifetimeEl = document.getElementById('tasbeehLifetime');
        if (arEl) arEl.textContent = d.ar;
        if (virtueEl) virtueEl.textContent = d.virtue;
        if (lifetimeEl) lifetimeEl.innerHTML = `TOTAL: <span>${getOverallTotal().toLocaleString()}</span>`;
    }

    window.selectDhikr = function(index) {
        // Save current session count before switching
        if (tasbeehCount > 0) {
            saveDhikrTotal(DHIKR_LIST[currentDhikrIndex].id, tasbeehCount);
        }
        currentDhikrIndex = index;
        const d = DHIKR_LIST[index];
        tasbeehTarget = d.defaultTarget;
        tasbeehCount = 0;
        const display = document.getElementById('tasbeehDisplay');
        if (display) display.textContent = '0';
        const tt = document.getElementById('tasbeehTargetLabel');
        if (tt) tt.textContent = `TARGET: ${tasbeehTarget}`;
        // Update preset active states
        document.querySelectorAll('.tasbeeh-preset').forEach(p => p.classList.remove('active'));
        updateTasbeehUI();
        renderDhikrSelector();
        localStorage.setItem('crown_dhikr_selected', index);
    };

    window.openTasbeeh = function() {
        const tp = document.querySelector('.tasbeeh-panel');
        if (tp) tp.classList.add('active');
        lockScroll();
        setBottomNavActive('tasbeeh');
        // Restore last selected dhikr
        const saved = parseInt(localStorage.getItem('crown_dhikr_selected') || '0', 10);
        currentDhikrIndex = (saved >= 0 && saved < DHIKR_LIST.length) ? saved : 0;
        tasbeehTarget = DHIKR_LIST[currentDhikrIndex].defaultTarget;
        resetTasbeeh();
        renderDhikrSelector();
        updateTasbeehUI();
        const tt = document.getElementById('tasbeehTargetLabel');
        if (tt) tt.textContent = `TARGET: ${tasbeehTarget}`;
    };

    window.openTasbeehWith = function(target) {
        openTasbeeh();
        tasbeehTarget = (target === 36) ? 100 : 33;
        const tt = document.getElementById('tasbeehTargetLabel');
        if (tt) tt.textContent = `TARGET: ${tasbeehTarget}`;
    };

    window.closeTasbeeh = function() {
        // Save session count on close
        if (tasbeehCount > 0) {
            saveDhikrTotal(DHIKR_LIST[currentDhikrIndex].id, tasbeehCount);
            tasbeehCount = 0;
        }
        const tp = document.querySelector('.tasbeeh-panel');
        if (tp) tp.classList.remove('active');
        unlockScroll();
        setBottomNavActive('home');
    };

    window.tapTasbeeh = function() {
        tasbeehCount++;
        const display = document.getElementById('tasbeehDisplay');
        const btn = document.querySelector('.tasbeeh-tap-btn');
        if (display) display.textContent = tasbeehCount;
        if (btn) {
            btn.classList.add('pulse');
            setTimeout(() => btn.classList.remove('pulse'), 100);
        }
        if (navigator.vibrate) navigator.vibrate(5);
        if (tasbeehCount === tasbeehTarget && tasbeehTarget !== 0) {
            if (navigator.vibrate) navigator.vibrate([50, 50, 50]);
            saveDhikrTotal(DHIKR_LIST[currentDhikrIndex].id, tasbeehCount);
            tasbeehCount = 0;
            showToast('Target reached! ✨ Count saved.');
            // Auto-advance to next dhikr if user reached target
            setTimeout(() => {
                const display2 = document.getElementById('tasbeehDisplay');
                if (display2) display2.textContent = '0';
                updateTasbeehUI();
            }, 300);
        }
    };

    window.resetTasbeeh = function() {
        // Save partial count before reset
        if (tasbeehCount > 0) {
            saveDhikrTotal(DHIKR_LIST[currentDhikrIndex].id, tasbeehCount);
        }
        tasbeehCount = 0;
        const display = document.getElementById('tasbeehDisplay');
        if (display) display.textContent = '0';
        updateTasbeehUI();
    };

    window.setTasbeehTarget = function(t) {
        tasbeehTarget = t;
        const tt = document.getElementById('tasbeehTargetLabel');
        if (tt) tt.textContent = t === 0 ? 'OPEN COUNT' : `TARGET: ${t}`;
        resetTasbeeh();
        document.querySelectorAll('.tasbeeh-preset').forEach(p => p.classList.remove('active'));
        const activePreset = document.querySelector(`.tasbeeh-preset[onclick="setTasbeehTarget(${t})"]`);
        if (activePreset) activePreset.classList.add('active');
    };

    // ===== ETIQUETTE PANEL =====
    window.openEtiquette = function() {
        const ep = document.querySelector('.etiquette-panel');
        if (!ep) return;
        if (!ep.querySelector('.etiquette-content').innerHTML.trim()) {
            ep.querySelector('.etiquette-content').innerHTML = `
                <h2>The Etiquette of Dua</h2>
                <div class="etiquette-item"><div class="etiquette-num">1</div><div class="etiquette-text"><strong>Begin with praise of Allah</strong> and send Salawat upon the Prophet ﷺ. <span class="ref">(Tirmidhi 3477)</span></div></div>
                <div class="etiquette-item"><div class="etiquette-num">2</div><div class="etiquette-text"><strong>Have absolute certainty (Yaqīn)</strong> that Allah will answer. The Prophet ﷺ said: "Call upon Allah with certainty that He will respond." <span class="ref">(Tirmidhi 3479)</span></div></div>
                <div class="etiquette-item"><div class="etiquette-num">3</div><div class="etiquette-text"><strong>Be persistent — never give up.</strong> "Your dua is answered as long as you do not say: 'I prayed but was not answered.'" <span class="ref">(Bukhari 6340)</span></div></div>
                <div class="etiquette-item"><div class="etiquette-num">4</div><div class="etiquette-text"><strong>Presence of heart.</strong> Allah does not accept dua from a heedless, distracted heart. <span class="ref">(Tirmidhi 3479)</span></div></div>
                <div class="etiquette-item"><div class="etiquette-num">5</div><div class="etiquette-text"><strong>Face the Qiblah</strong> and raise your hands. The Prophet ﷺ was shy to return empty hands that were raised to Him. <span class="ref">(Abu Dawud 1488)</span></div></div>
                <div class="etiquette-item"><div class="etiquette-num">6</div><div class="etiquette-text"><strong>Be in a state of wudu</strong> (ablution) when possible. Purity elevates the dua.</div></div>
                <div class="etiquette-item"><div class="etiquette-num">7</div><div class="etiquette-text"><strong>Use Allah's Beautiful Names</strong> that match your request. Asking for mercy? Use "Yā Raḥmān." Asking for provision? Use "Yā Razzāq." <span class="ref">(Quran 7:180)</span></div></div>
                <div class="etiquette-item"><div class="etiquette-num">8</div><div class="etiquette-text"><strong>Seek the blessed times:</strong> Last third of the night, between Adhan and Iqamah, while prostrating, while fasting, while travelling, on Friday. <span class="ref">(Muslim 757, Abu Dawud 521)</span></div></div>
                <div class="etiquette-item"><div class="etiquette-num">9</div><div class="etiquette-text"><strong>Admit your sins and need</strong> before asking. Acknowledge your weakness — as in the Dua of Yunus and Adam عليهما السلام.</div></div>
                <div class="etiquette-item"><div class="etiquette-num">10</div><div class="etiquette-text"><strong>End with Salawat</strong> upon the Prophet ﷺ. "Every dua is suspended between heaven and earth until you send Salawat upon the Prophet ﷺ." <span class="ref">(Tirmidhi 486)</span></div></div>`;
        }
        ep.classList.add('active');
        lockScroll();
    };

    window.closeEtiquette = function() {
        const ep = document.querySelector('.etiquette-panel');
        if (ep) ep.classList.remove('active');
        unlockScroll();
    };

    // ===== ROUTINE PANEL =====
    window.openRoutine = function() {
        const rp = document.querySelector('.routine-panel');
        if (!rp) return;
        if (!rp.querySelector('.routine-content').innerHTML.trim()) {
            rp.querySelector('.routine-content').innerHTML = `
                <h2>Recommended Daily Routine</h2>
                <div class="routine-item">
                    <div class="routine-time">🌅 MORNING (After Fajr)</div>
                    <div class="routine-desc">
                        1. <span class="dua-ref" onclick="scrollToDua(2);closeRoutine()">Ayatul Kursi</span><br>
                        2. <span class="dua-ref" onclick="scrollToDua(6);closeRoutine()">3 Quls (3x each)</span><br>
                        3. <span class="dua-ref" onclick="scrollToDua(12);closeRoutine()">Bismillah Protection (3x)</span><br>
                        4. <span class="dua-ref" onclick="scrollToDua(16);closeRoutine()">Sayyid al-Istighfar</span><br>
                        5. <span class="dua-ref" onclick="scrollToDua(14);closeRoutine()">Contentment with Allah (3x)</span><br>
                        6. <span class="dua-ref" onclick="scrollToDua(35);closeRoutine()">Hasbiyallah (7x)</span><br>
                        7. <span class="dua-ref" onclick="scrollToDua(38);closeRoutine()">Beneficial Knowledge</span><br>
                        8. <span class="dua-ref" onclick="scrollToDua(34);closeRoutine()">Morning Remembrance</span>
                    </div>
                </div>
                <div class="routine-item">
                    <div class="routine-time">🌇 EVENING (After Asr/Maghrib)</div>
                    <div class="routine-desc">
                        Same as morning adhkar, plus:<br>
                        • <span class="dua-ref" onclick="scrollToDua(23);closeRoutine()">Asking for 'Afiyah</span><br>
                        • <span class="dua-ref" onclick="scrollToDua(48);closeRoutine()">Protection from Four Evils</span>
                    </div>
                </div>
                <div class="routine-item">
                    <div class="routine-time">🕌 IN EVERY PRAYER</div>
                    <div class="routine-desc">
                        • <span class="dua-ref" onclick="scrollToDua(1);closeRoutine()">Al-Fatiha</span><br>
                        • <span class="dua-ref" onclick="scrollToDua(13);closeRoutine()">Four Refuges (before salam)</span><br>
                        • <span class="dua-ref" onclick="scrollToDua(7);closeRoutine()">Rabbana Atina</span><br>
                        • <span class="dua-ref" onclick="scrollToDua(46);closeRoutine()">Ibrahimic Salawat</span>
                    </div>
                </div>
                <div class="routine-item">
                    <div class="routine-time">🌙 BEFORE SLEEP</div>
                    <div class="routine-desc">
                        1. <span class="dua-ref" onclick="scrollToDua(2);closeRoutine()">Ayatul Kursi</span><br>
                        2. <span class="dua-ref" onclick="scrollToDua(6);closeRoutine()">3 Quls (Blow & Wipe 3x)</span><br>
                        3. <span class="dua-ref" onclick="scrollToDua(5);closeRoutine()">Last 2 Verses of Al-Baqarah</span><br>
                        4. <span class="dua-ref" onclick="scrollToDua(49);closeRoutine()">Sleep Dua</span><br>
                        5. <span class="dua-ref" onclick="scrollToDua(36);closeRoutine()">Tahlil (before sleeping)</span>
                    </div>
                </div>
                <div class="routine-item">
                    <div class="routine-time">📿 DAILY DHIKR</div>
                    <div class="routine-desc">
                        • <span class="dua-ref" onclick="scrollToDua(36);closeRoutine()">Tahlil 100x</span> — Use the Tasbeeh counter<br>
                        • SubhanAllah 33x, Alhamdulillah 33x, Allahu Akbar 34x after each prayer<br>
                        • <span class="dua-ref" onclick="scrollToDua(19);closeRoutine()">Ya Muqallibal Qulub</span> — as often as possible
                    </div>
                </div>`;
        }
        rp.classList.add('active');
        lockScroll();
        setBottomNavActive('routine');
    };

    window.closeRoutine = function() {
        const rp = document.querySelector('.routine-panel');
        if (rp) rp.classList.remove('active');
        unlockScroll();
        setBottomNavActive('home');
    };

    // ===== SHARE =====
    window.sharePage = function() {
        if (navigator.share) {
            navigator.share({
                title: 'Essential Duas by فلاح',
                text: '55 Essential Islamic Duas from Quran & Sunnah — by Engineer Mohammad Falah',
                url: window.location.href
            });
        } else {
            navigator.clipboard.writeText(window.location.href).then(() => {
                showToast('Link copied to clipboard');
            }).catch(() => showToast('Failed to copy'));
        }
    };

    window.shareDua = function(id) {
        const card = document.querySelector(`.dua-card[data-id="${id}"]`);
        if (!card) return;
        const title = card.querySelector('.dua-title').textContent;
        const arabic = card.querySelector('.arabic-text').textContent;
        const text = `${title}\n\n${arabic}\n\nFrom: Essential Duas by فلاح\n${window.location.href}`;
        if (navigator.share) {
            navigator.share({ title: title, text: text });
        } else {
            navigator.clipboard.writeText(text).then(() => {
                showToast('Dua copied to clipboard');
            }).catch(() => showToast('Failed to copy'));
        }
    };

    // ===== UTILITIES =====
    function updateStats() {
        if (els.bookmarkCount) els.bookmarkCount.innerText = STATE.bookmarks.length;
        if (els.readCount) els.readCount.innerText = STATE.read.length;

        // Update progress ring
        const ring = document.getElementById('readProgressRing');
        if (ring) {
            const total = 55;
            const read = STATE.read.length;
            const circumference = 2 * Math.PI * 22;
            const offset = circumference - (read / total) * circumference;
            ring.style.strokeDashoffset = offset;
        }
    }

    function showToast(msg) {
        // toast lives after the <script> tag, so cache it lazily on first use
        if (!els.toast) els.toast = document.getElementById('toast');
        if (!els.toast) return;
        els.toast.innerText = msg;
        els.toast.classList.add('show');
        setTimeout(() => els.toast.classList.remove('show'), 3000);
    }

    function checkStreak() {
        const today = new Date().toDateString();
        if (STATE.lastVisit !== today) {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            if (STATE.lastVisit === yesterday.toDateString()) STATE.streak++;
            else STATE.streak = 1;
            STATE.lastVisit = today;
            localStorage.setItem('crown_streak', STATE.streak);
            localStorage.setItem('crown_last_visit', today);
        }
        if (els.streakCount) els.streakCount.innerText = STATE.streak;
        if (els.lastVisit) els.lastVisit.innerText = 'Today';
    }

    function loadDailyDua() {
        const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
        const duaIndex = (dayOfYear % 55) + 1;
        setTimeout(() => {
            const card = document.querySelector(`.dua-card[data-id="${duaIndex}"]`);
            if (card && els.dailyArabic) {
                els.dailyArabic.innerText = card.querySelector('.arabic-text').innerText;
                els.dailyTranslation.innerText = card.querySelector('.translation').innerText.substring(0, 80) + '...';
                document.getElementById('dailyDua').onclick = function() { scrollToDua(duaIndex); };
            }
        }, 500);
    }

        // ===== RANDOM DUA =====
    window.showRandomDua = function() {
        const visibleCards = Array.from(els.cards).filter(c => 
            !c.classList.contains('hidden-card') && c.style.display !== 'none'
        );
        if (visibleCards.length === 0) {
            showToast('No duas available');
            return;
        }

        const randomCard = visibleCards[Math.floor(Math.random() * visibleCards.length)];

        // Collapse all first
        els.cards.forEach(card => {
            card.classList.remove('expanded');
            const header = card.querySelector('.card-header');
            if (header) header.setAttribute('aria-expanded', 'false');
        });

        // Expand random card
        randomCard.classList.add('expanded');
        const header = randomCard.querySelector('.card-header');
        if (header) header.setAttribute('aria-expanded', 'true');

        setTimeout(() => {
            randomCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 100);

        randomCard.classList.add('random-glow');
        randomCard.style.borderColor = 'var(--emerald-light)';
        randomCard.style.boxShadow = '0 0 25px rgba(46, 196, 122, 0.2)';

        setTimeout(() => {
            randomCard.classList.remove('random-glow');
            randomCard.style.borderColor = '';
            randomCard.style.boxShadow = '';
        }, 3000);

        const duaNum = randomCard.querySelector('.dua-number').textContent;
        const duaTitle = randomCard.querySelector('.dua-title').textContent.substring(0, 40);
        showToast(`🎲 Dua #${duaNum}: ${duaTitle}...`);
    };

    // ===== SECTION COLLAPSE/EXPAND =====
    window.toggleSection = function(sectionHeader) {
        const isCollapsed = sectionHeader.classList.toggle('collapsed');
        const sectionName = sectionHeader.getAttribute('data-section');

        // Update hint text
        const hint = sectionHeader.querySelector('.section-collapse-hint');
        if (hint) {
            hint.textContent = isCollapsed ? 'tap to expand' : 'tap to collapse';
        }

        // Find all cards that belong to this section
        // Walk through siblings until we hit the next section-header
        let nextElement = sectionHeader.nextElementSibling;
        while (nextElement) {
            // Stop if we hit another section header
            if (nextElement.classList.contains('section-header')) break;

            // Toggle dua cards
            if (nextElement.classList.contains('dua-card')) {
                if (isCollapsed) {
                    nextElement.style.display = 'none';
                } else {
                    nextElement.style.display = '';
                    // Re-trigger visibility animation
                    if (!nextElement.classList.contains('visible')) {
                        setTimeout(() => nextElement.classList.add('visible'), 50);
                    }
                }
            }

            nextElement = nextElement.nextElementSibling;
        }

        // Save state
        const collapsedSections = JSON.parse(localStorage.getItem('crown_collapsed_sections') || '[]');
        if (isCollapsed) {
            if (!collapsedSections.includes(sectionName)) {
                collapsedSections.push(sectionName);
            }
        } else {
            const idx = collapsedSections.indexOf(sectionName);
            if (idx !== -1) collapsedSections.splice(idx, 1);
        }
        localStorage.setItem('crown_collapsed_sections', JSON.stringify(collapsedSections));

        showToast(isCollapsed ? `${sectionHeader.querySelector('.section-title').textContent} — Collapsed` : `${sectionHeader.querySelector('.section-title').textContent} — Expanded`);
    };

    // ===== BOTTOM NAV HANDLER =====
        // ===== BOTTOM NAV HANDLER =====
    window.handleBottomNav = function(action, btn) {
        // Update active state
        document.querySelectorAll('.bottom-nav-item').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        // Close all panels first
        const tp = document.querySelector('.tasbeeh-panel.active');
        if (tp) { tp.classList.remove('active'); unlockScroll(); }

        const ep = document.querySelector('.etiquette-panel.active');
        if (ep) { ep.classList.remove('active'); unlockScroll(); }

        const rp = document.querySelector('.routine-panel.active');
        if (rp) { rp.classList.remove('active'); unlockScroll(); }

        const pp = document.querySelector('.prayer-panel.active');
        if (pp) { pp.classList.remove('active'); unlockScroll(); }

        const bp = document.getElementById('bookmarksPanel');
        const ov = document.querySelector('.overlay');
        if (bp && bp.classList.contains('active')) {
            bp.classList.remove('active');
            if (ov) ov.classList.remove('active');
            unlockScroll();
        }

        // Now open the requested panel
        switch (action) {
                      case 'home':
                els.pills.forEach(p => p.classList.remove('active'));
                const allPill = document.querySelector('.pill[data-category="all"]');
                if (allPill) allPill.classList.add('active');
                els.cards.forEach(card => {
                    card.classList.remove('hidden-card');
                    card.style.display = '';
                });
                // Expand all collapsed sections
                document.querySelectorAll('.section-header.collapsed').forEach(sh => {
                    sh.classList.remove('collapsed');
                    const hint = sh.querySelector('.section-collapse-hint');
                    if (hint) hint.textContent = 'tap to collapse';
                    let next = sh.nextElementSibling;
                    while (next && !next.classList.contains('section-header')) {
                        if (next.classList.contains('dua-card')) next.style.display = '';
                        next = next.nextElementSibling;
                    }
                });
                if (els.noResults) els.noResults.classList.remove('visible');
                if (els.searchInput) els.searchInput.value = '';
                if (els.searchClear) els.searchClear.classList.remove('visible');
                window.scrollTo({ top: 0, behavior: 'smooth' });
                break;
            case 'routine':
                setTimeout(() => openRoutine(), 50);
                break;
            case 'tasbeeh':
                setTimeout(() => openTasbeeh(), 50);
                break;
            case 'saved':
                setTimeout(() => {
                    // Force open bookmarks (not toggle)
                    let panel = document.getElementById('bookmarksPanel');
                    if (!panel) {
                        const div = document.createElement('div');
                        div.id = 'bookmarksPanel';
                        div.className = 'side-panel';
                        div.innerHTML = `
                            <div class="panel-header">
                                <div class="panel-title">Your Saved Duas</div>
                                <button class="panel-close" onclick="toggleBookmarksPanel()">✕</button>
                            </div>
                            <div id="bookmarkListContainer"></div>`;
                        document.body.appendChild(div);
                    }
                    renderBookmarksPanel();
                    document.getElementById('bookmarksPanel').classList.add('active');
                    let overlay = document.querySelector('.overlay');
                    if (!overlay) {
                        overlay = document.createElement('div');
                        overlay.className = 'overlay';
                        overlay.onclick = toggleBookmarksPanel;
                        document.body.appendChild(overlay);
                    }
                    overlay.classList.add('active');
                    lockScroll();
                }, 50);
                break;
            case 'prayer':
                setTimeout(() => openPrayer(), 50);
                break;
        }
    };

    // ===== PROGRESS PANEL =====
    window.openProgress = function() {
        let pp = document.querySelector('.progress-panel');
        if (!pp) {
            pp = document.createElement('div');
            pp.className = 'progress-panel';
            pp.setAttribute('onclick', 'if(event.target===this) closeProgress()');
            pp.innerHTML = `
                <button class="etiquette-close" onclick="closeProgress()">✕</button>
                <div class="progress-panel-content" id="progressPanelContent"></div>`;
            document.body.appendChild(pp);
        }
        renderProgressPanel();
        pp.classList.add('active');
        lockScroll();
    };

    window.closeProgress = function() {
        const pp = document.querySelector('.progress-panel');
        if (pp) pp.classList.remove('active');
        unlockScroll();
    };

    function renderProgressPanel() {
        const container = document.getElementById('progressPanelContent');
        if (!container) return;

        const total = 55;
        const readCount = STATE.read.length;
        const bookmarkCount = STATE.bookmarks.length;
        const readPct = Math.round((readCount / total) * 100);

        // Calculate categories explored with counts
        const allCats = ['quran','protection','forgiveness','guidance','wellbeing','prophets','morning-evening','provision','prayer','family','travel','scholars'];
        const catMap = {};
        allCats.forEach(c => catMap[c] = 0);
        STATE.read.forEach(id => {
            const card = document.querySelector(`.dua-card[data-id="${id}"]`);
            if (card) {
                (card.getAttribute('data-categories') || '').split(',').forEach(c => {
                    const key = c.trim();
                    if (key in catMap) catMap[key]++;
                });
            }
        });
        const catSet = new Set(Object.keys(catMap).filter(k => catMap[k] > 0));

        // Category totals
        const catTotals = {};
        allCats.forEach(c => catTotals[c] = 0);
        document.querySelectorAll('.dua-card').forEach(card => {
            (card.getAttribute('data-categories') || '').split(',').forEach(c => {
                const key = c.trim();
                if (key in catTotals) catTotals[key]++;
            });
        });

        // Weekly activity
        const activity = JSON.parse(localStorage.getItem('crown_activity') || '[]');
        const dayNames = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
        let weekHTML = '';
        for (let i = 6; i >= 0; i--) {
            const d = new Date(); d.setDate(d.getDate() - i);
            const dateStr = d.toISOString().slice(0, 10);
            const isActive = activity.includes(dateStr);
            const isToday = i === 0;
            weekHTML += `<div class="progress-day-cell${isActive ? ' active' : ''}${isToday ? ' today' : ''}">
                <div>${dayNames[d.getDay()]}</div>
                <div style="font-size:0.8rem;margin-top:2px;">${isActive ? '\u2713' : '\u00b7'}</div>
            </div>`;
        }
        const totalDays = activity.length;

        // Category bars
        let catBarsHTML = '';
        allCats.forEach(cat => {
            const count = catMap[cat] || 0;
            const catTotal = catTotals[cat] || 1;
            const pct = Math.round((count / catTotal) * 100);
            const label = cat.charAt(0).toUpperCase() + cat.slice(1).replace('-', ' ');
            catBarsHTML += `<div class="progress-category-bar">
                <div class="progress-cat-label">${label}</div>
                <div class="progress-cat-bar"><div class="progress-cat-fill" style="width:${pct}%"></div></div>
                <div class="progress-cat-count">${count}/${catTotal}</div>
            </div>`;
        });

        // Achievements
        const achievements = [
            { icon: '🌱', name: 'First Step', earned: readCount >= 1, desc: 'Read your first dua' },
            { icon: '📖', name: 'Bookworm', earned: bookmarkCount >= 5, desc: 'Bookmark 5 duas' },
            { icon: '🔥', name: 'On Fire', earned: STATE.streak >= 3, desc: '3-day streak' },
            { icon: '⭐', name: 'Dedicated', earned: STATE.streak >= 7, desc: '7-day streak' },
            { icon: '🌍', name: 'Explorer', earned: catSet.size >= 6, desc: 'Explore 6 categories' },
            { icon: '💪', name: 'Halfway', earned: readCount >= 28, desc: 'Read 28+ duas' },
            { icon: '🏆', name: 'Crown Master', earned: readCount >= 55, desc: 'All 55 duas' },
            { icon: '🔮', name: 'Scholar', earned: catSet.size >= 12, desc: 'All 12 categories' },
        ];
        const earnedCount = achievements.filter(a => a.earned).length;
        let achieveHTML = achievements.map(a => `
            <div class="achievement-badge ${a.earned ? 'earned' : 'locked'}" title="${a.desc}">
                <div class="achievement-icon">${a.icon}</div>
                <div class="achievement-name">${a.name}</div>
            </div>`).join('');

        // Milestone
        let milestone = '';
        if (readCount >= 55) milestone = '🏆 Completed the entire Crown Collection!';
        else if (readCount >= 40) milestone = '⭐ Almost there \u2014 a true seeker of knowledge!';
        else if (readCount >= 25) milestone = '💪 Halfway champion \u2014 keep going!';
        else if (readCount >= 10) milestone = '🌱 Growing beautifully \u2014 10+ duas learned!';
        else if (readCount >= 1) milestone = '✨ The journey of a thousand miles begins with one step.';
        else milestone = '📖 Start your journey \u2014 tap "Mark Read" on any dua!';

        container.innerHTML = `
            <h2>Your Journey</h2>

            <div class="progress-stat-card">
                <div class="progress-stat-icon">📖</div>
                <div class="progress-stat-info">
                    <div class="progress-stat-label">Duas Read</div>
                    <div class="progress-stat-value">${readCount} / ${total}</div>
                    <div class="progress-bar-visual">
                        <div class="progress-bar-fill" style="width:${readPct}%"></div>
                    </div>
                    <div class="progress-stat-sub">${readPct}% complete</div>
                </div>
            </div>

            <div class="progress-stat-card">
                <div class="progress-stat-icon">🔥</div>
                <div class="progress-stat-info">
                    <div class="progress-stat-label">Current Streak</div>
                    <div class="progress-stat-value">${STATE.streak} days</div>
                    <div class="progress-stat-sub">Total days active: ${totalDays}</div>
                </div>
            </div>

            <div class="progress-stat-card" style="flex-direction:column;">
                <div class="progress-stat-label" style="margin-bottom:8px;">This Week</div>
                <div class="progress-week-grid">${weekHTML}</div>
            </div>

            <div class="progress-stat-card">
                <div class="progress-stat-icon">\u2b50</div>
                <div class="progress-stat-info">
                    <div class="progress-stat-label">Bookmarked</div>
                    <div class="progress-stat-value">${bookmarkCount}</div>
                    <div class="progress-stat-sub">Your favourite duas saved for quick access</div>
                </div>
            </div>

            <div class="progress-stat-card" style="flex-direction:column;">
                <div class="progress-stat-label" style="margin-bottom:8px;">Category Breakdown</div>
                ${catBarsHTML}
            </div>

            <div class="progress-stat-card" style="flex-direction:column;">
                <div class="progress-stat-label" style="margin-bottom:8px;">Achievements (${earnedCount}/${achievements.length})</div>
                <div class="progress-achievements">${achieveHTML}</div>
            </div>

            <div class="progress-stat-card" style="text-align:center;justify-content:center;flex-direction:column;">
                <div style="font-size:1.2rem;margin-bottom:8px;">${milestone}</div>
            </div>

            <button class="progress-reset-btn" onclick="if(confirm('Reset all reading progress? Bookmarks will be kept.')) { STATE.read=[]; localStorage.setItem('crown_read',JSON.stringify([])); document.querySelectorAll('.dua-card').forEach(c=>{c.classList.remove('read-card');const b=c.querySelector('.action-btn[onclick*=markRead]');if(b){b.classList.remove('read');b.innerHTML='\u2713 Mark Read';}}); updateStats(); renderProgressPanel(); showToast('Progress reset'); }">\u26a0 Reset Reading Progress</button>

            <button class="progress-share-btn" onclick="shareProgress()">📤 Share Your Progress</button>
        `;
    }

    window.shareProgress = async function() {
        showToast('Generating image...');

        const total = 55;
        const readCount = STATE.read.length;
        const readPct = Math.round((readCount / total) * 100);
        const bookmarkCount = STATE.bookmarks.length;
        const streak = parseInt(localStorage.getItem('crown_streak') || '0');
        const daysActive = parseInt(localStorage.getItem('crown_days_active') || '0');

        // Build achievements summary
        const achievements = [
            { name: 'First Step', icon: '🌱', req: 1 },
            { name: 'Bookworm', icon: '📖', req: 5 },
            { name: 'On Fire', icon: '🔥', req: 10 },
            { name: 'Dedicated', icon: '⭐', req: 20 },
            { name: 'Explorer', icon: '🌍', req: 30 },
            { name: 'Halfway', icon: '💪', req: 28 },
            { name: 'Crown Master', icon: '🏆', req: 55 },
            { name: 'Scholar', icon: '🔮', req: 55 }
        ];
        const earned = achievements.filter(a => readCount >= a.req).map(a => a.icon).join(' ');

        // Milestone text
        let milestone = '';
        if (readCount >= 55) milestone = '🏆 Completed the entire Crown Collection!';
        else if (readPct >= 40) milestone = '⭐ Nearly there — a true seeker of knowledge!';
        else if (readPct >= 25) milestone = '💪 Halfway hero — keep going!';
        else if (readPct >= 10) milestone = '🌱 Beautiful growth — 10+ duas learned!';
        else if (readCount >= 1) milestone = '✨ Every journey starts with a single step.';
        else milestone = '📖 Start your journey today!';

        const wrap = document.createElement('div');
        wrap.style.cssText = `
            position:fixed; left:-9999px; top:0;
            width:500px; padding:40px 36px;
            background: linear-gradient(145deg, #0c1a13, #142a20);
            border-radius:24px; font-family:serif;
            border: 1px solid rgba(46,196,122,0.2);
        `;
        wrap.innerHTML = `
            <div style="text-align:center;margin-bottom:20px;">
                <div style="font-family:'Noto Naskh Arabic','Amiri',serif;font-size:16px;color:#2ec47a;margin-bottom:4px;">ف</div>
                <div style="font-family:'Cinzel',serif;font-size:11px;letter-spacing:3px;text-transform:uppercase;color:#2ec47a;margin-bottom:6px;">Essential Duas by فلاح</div>
                <div style="font-family:'Cinzel',serif;font-size:16px;letter-spacing:2px;text-transform:uppercase;color:#e0eccc;font-weight:600;">My Journey</div>
            </div>
            <div style="display:flex;gap:12px;margin-bottom:16px;">
                <div style="flex:1;background:rgba(46,196,122,0.06);border:1px solid rgba(46,196,122,0.12);border-radius:14px;padding:16px;text-align:center;">
                    <div style="font-family:'Cinzel',serif;font-size:24px;color:#d4af37;">${readCount}<span style="font-size:14px;color:rgba(224,238,210,0.5);">/${total}</span></div>
                    <div style="font-family:'Cinzel',serif;font-size:8px;letter-spacing:2px;text-transform:uppercase;color:rgba(224,238,210,0.5);margin-top:4px;">Duas Read</div>
                </div>
                <div style="flex:1;background:rgba(46,196,122,0.06);border:1px solid rgba(46,196,122,0.12);border-radius:14px;padding:16px;text-align:center;">
                    <div style="font-family:'Cinzel',serif;font-size:24px;color:#d4af37;">${streak}</div>
                    <div style="font-family:'Cinzel',serif;font-size:8px;letter-spacing:2px;text-transform:uppercase;color:rgba(224,238,210,0.5);margin-top:4px;">Day Streak</div>
                </div>
                <div style="flex:1;background:rgba(46,196,122,0.06);border:1px solid rgba(46,196,122,0.12);border-radius:14px;padding:16px;text-align:center;">
                    <div style="font-family:'Cinzel',serif;font-size:24px;color:#d4af37;">${bookmarkCount}</div>
                    <div style="font-family:'Cinzel',serif;font-size:8px;letter-spacing:2px;text-transform:uppercase;color:rgba(224,238,210,0.5);margin-top:4px;">Saved</div>
                </div>
            </div>
            ${earned ? `<div style="text-align:center;font-size:1.4rem;margin-bottom:12px;letter-spacing:4px;">${earned}</div>` : ''}
            <div style="text-align:center;font-family:'Playfair Display',serif;font-size:14px;color:rgba(224,238,210,0.85);margin-bottom:16px;">${milestone}</div>
            <div style="display:flex;justify-content:space-between;padding-top:14px;border-top:1px solid rgba(46,196,122,0.1);">
                <span style="font-family:'Cinzel',serif;font-size:9px;letter-spacing:1px;text-transform:uppercase;color:rgba(160,210,180,0.55);">${readPct}% Complete</span>
                <span style="font-family:'Cinzel',serif;font-size:9px;letter-spacing:1px;text-transform:uppercase;color:rgba(160,210,180,0.35);">فلاح · mohhp.github.io/Essential-duas</span>
            </div>
        `;
        document.body.appendChild(wrap);

        try {
            if (typeof html2canvas === 'undefined') {
                showToast('Image library loading, try again...');
                document.body.removeChild(wrap);
                return;
            }
            const canvas = await html2canvas(wrap, {
                backgroundColor: '#0c1a13',
                scale: 2,
                useCORS: true,
                logging: false
            });
            document.body.removeChild(wrap);

            canvas.toBlob(async (blob) => {
                if (!blob) { showToast('Failed to generate'); return; }
                if (navigator.canShare && navigator.canShare({ files: [new File([blob], 'progress.png', { type: 'image/png' })] })) {
                    try {
                        await navigator.share({
                            files: [new File([blob], 'progress.png', { type: 'image/png' })],
                            title: 'My Dua Journey',
                            text: 'From Essential Duas by فلاح'
                        });
                        showToast('Shared!');
                        return;
                    } catch(e) { /* fallthrough */ }
                }
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url; a.download = 'my-dua-journey.png';
                a.click(); URL.revokeObjectURL(url);
                showToast('Image downloaded!');
            }, 'image/png');
        } catch(e) {
            document.body.removeChild(wrap);
            showToast('Failed to generate image');
        }
    };

    // ===== AUDIO RECITATION (Web Speech API) =====
    let currentUtterance = null;
    let currentAudioBtn = null;

    function injectAudioButtons() {
        document.querySelectorAll('.copy-row').forEach(row => {
            const card = row.closest('.dua-card');
            if (!card) return;
            const id = card.getAttribute('data-id');
            const btn = document.createElement('button');
            btn.className = 'action-btn audio-btn';
            btn.innerHTML = '🔊 Listen';
            btn.onclick = function() { toggleAudio(id, btn); };
            row.insertBefore(btn, row.firstChild);
        });
    }

    window.toggleAudio = function(id, btn) {
        // If already playing this dua, stop it
        if (currentAudioBtn === btn && speechSynthesis.speaking) {
            speechSynthesis.cancel();
            btn.classList.remove('playing');
            btn.innerHTML = '🔊 Listen';
            currentAudioBtn = null;
            currentUtterance = null;
            return;
        }

        // Stop any currently playing
        if (speechSynthesis.speaking) {
            speechSynthesis.cancel();
            if (currentAudioBtn) {
                currentAudioBtn.classList.remove('playing');
                currentAudioBtn.innerHTML = '🔊 Listen';
            }
        }

        const card = document.querySelector(`.dua-card[data-id="${id}"]`);
        if (!card) return;
        const arabic = card.querySelector('.arabic-text')?.textContent;
        if (!arabic) return;

        // Check for Arabic voice
        const voices = speechSynthesis.getVoices();
        const arabicVoice = voices.find(v => v.lang.startsWith('ar'));

        if (!arabicVoice && voices.length > 0) {
            showToast('Arabic voice not available on this device — trying default');
        }

        const utterance = new SpeechSynthesisUtterance(arabic);
        utterance.lang = 'ar-SA';
        utterance.rate = 0.8;
        utterance.pitch = 1;
        if (arabicVoice) utterance.voice = arabicVoice;

        btn.classList.add('playing');
        btn.innerHTML = '⏹ Stop';
        currentAudioBtn = btn;
        currentUtterance = utterance;

        utterance.onend = function() {
            btn.classList.remove('playing');
            btn.innerHTML = '🔊 Listen';
            currentAudioBtn = null;
            currentUtterance = null;
        };

        utterance.onerror = function() {
            btn.classList.remove('playing');
            btn.innerHTML = '🔊 Listen';
            currentAudioBtn = null;
            currentUtterance = null;
            showToast('Audio playback failed');
        };

        speechSynthesis.speak(utterance);
    };

    // Pre-load voices (some browsers need this)
    if ('speechSynthesis' in window) {
        speechSynthesis.getVoices();
        speechSynthesis.onvoiceschanged = () => speechSynthesis.getVoices();
    }

    // ===== TIME-BASED DUA SUGGESTIONS =====
    const TIME_DUA_MAP = {
        fajr:    { icon: '🌅', label: 'Fajr / Early Morning', period: 'Start your day with these blessed supplications', ids: [12, 14, 16, 23, 34, 35, 36, 38] },
        morning: { icon: '☀️', label: 'Morning Adhkar', period: 'The Prophet ﷺ never missed his morning remembrance', ids: [12, 14, 16, 23, 34, 35, 36] },
        dhuhr:   { icon: '🕐', label: 'Midday Remembrance', period: 'Take a moment to reconnect in the middle of your day', ids: [1, 7, 10, 19, 20, 41] },
        asr:     { icon: '🌤', label: 'Afternoon Reflection', period: 'The Prophet ﷺ sought refuge from the trials of the day', ids: [13, 25, 27, 29, 42] },
        maghrib: { icon: '🌆', label: 'Evening Adhkar', period: 'As the sun sets, renew your protection', ids: [12, 14, 16, 23, 34, 35, 36] },
        isha:    { icon: '🌙', label: 'Night Supplications', period: 'Prepare for sleep with these powerful duas', ids: [2, 5, 6, 11, 47, 18] },
        latenight: { icon: '🌌', label: 'Late Night / Tahajjud', period: 'The last third of the night — when duas are answered', ids: [9, 16, 17, 18, 24, 26, 3] }
    };

    function getTimePeriod() {
        const h = new Date().getHours();
        if (h >= 4 && h < 6) return 'fajr';
        if (h >= 6 && h < 11) return 'morning';
        if (h >= 11 && h < 14) return 'dhuhr';
        if (h >= 14 && h < 16) return 'asr';
        if (h >= 16 && h < 19) return 'maghrib';
        if (h >= 19 && h < 22) return 'isha';
        return 'latenight';
    }

    function renderTimeBanner() {
        const container = document.getElementById('timeBanner');
        if (!container) return;

        const period = getTimePeriod();
        const data = TIME_DUA_MAP[period];
        if (!data) return;

        const chips = data.ids.map(id => {
            const card = document.querySelector(`.dua-card[data-id="${id}"]`);
            if (!card) return '';
            const title = card.querySelector('.dua-title')?.textContent?.split('—')[0]?.trim() || `Dua #${id}`;
            const short = title.length > 30 ? title.substring(0, 28) + '…' : title;
            return `<span class="time-dua-chip" onclick="scrollToDua(${id})">#${id} ${short}</span>`;
        }).join('');

        container.innerHTML = `
            <div class="time-banner">
                <div class="time-banner-header">
                    <span class="time-banner-icon">${data.icon}</span>
                    <span class="time-banner-title">Suggested Now — ${data.label}</span>
                </div>
                <div class="time-banner-period">${data.period}</div>
                <div class="time-banner-duas">${chips}</div>
            </div>
        `;
    }

    // ===== DAILY ACTIVITY TRACKING =====
    function trackDailyActivity() {
        const today = new Date().toISOString().slice(0, 10);
        let activity = JSON.parse(localStorage.getItem('crown_activity') || '[]');
        if (!activity.includes(today)) {
            activity.push(today);
            if (activity.length > 90) activity = activity.slice(-90);
            localStorage.setItem('crown_activity', JSON.stringify(activity));
        }
    }

    // ===== SCROLL TO TOP =====
    window.scrollToTop = function() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    // ===== SCROLL TO DAILY DUA =====
    window.scrollToDailyDua = function() {
        const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
        const duaIndex = (dayOfYear % 55) + 1;
        scrollToDua(duaIndex);
    };

    window.shareDailyDua = function() {
        const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
        const duaIndex = (dayOfYear % 55) + 1;
        shareAsImage(duaIndex);
    };

    // ===== THEME TOGGLE (LIGHT/DARK) =====
    function applyTheme() {
        const saved = localStorage.getItem('crown_theme') || 'dark';
        if (saved === 'light') {
            document.documentElement.setAttribute('data-theme', 'light');
        } else {
            document.documentElement.removeAttribute('data-theme');
        }
        const btn = document.getElementById('themeToggle');
        if (btn) btn.innerHTML = saved === 'light' ? '🌙' : '☀';
    }

    window.toggleTheme = function() {
        const isLight = document.documentElement.getAttribute('data-theme') === 'light';
        if (isLight) {
            document.documentElement.removeAttribute('data-theme');
            localStorage.setItem('crown_theme', 'dark');
        } else {
            document.documentElement.setAttribute('data-theme', 'light');
            localStorage.setItem('crown_theme', 'light');
        }
        const btn = document.getElementById('themeToggle');
        if (btn) btn.innerHTML = isLight ? '☀' : '🌙';
        showToast(isLight ? 'Dark Mode' : 'Light Mode');
    };

    // ===== MEMORIZATION MODE =====
    window.toggleMemorizeMode = function() {
        const btn = document.getElementById('memorizeToggle');
        const isActive = btn && btn.classList.toggle('active');
        els.cards.forEach(card => {
            if (isActive) {
                card.classList.add('memorize-mode');
                card.querySelectorAll('.arabic-text').forEach(t => t.classList.remove('revealed'));
                // Remove any existing rating rows
                card.querySelectorAll('.sr-rating-row').forEach(r => r.remove());
            } else {
                card.classList.remove('memorize-mode');
                card.querySelectorAll('.sr-rating-row').forEach(r => r.remove());
            }
        });
        if (isActive) updateSRBadges();
        showToast(isActive ? 'Memorize Mode ON — tap Arabic to reveal' : 'Memorize Mode OFF');
    };

    // Arabic reveal on tap (delegated) — enhanced with SR rating
    document.addEventListener('click', function(e) {
        const arabicEl = e.target.closest('.memorize-mode .arabic-text');
        if (arabicEl) {
            const wasRevealed = arabicEl.classList.contains('revealed');
            arabicEl.classList.toggle('revealed');

            if (!wasRevealed) {
                // Show rating buttons
                const card = arabicEl.closest('.dua-card');
                if (card && !card.querySelector('.sr-rating-row')) {
                    const id = parseInt(card.getAttribute('data-id'));
                    const container = arabicEl.closest('.arabic-container') || arabicEl.parentElement;
                    const row = document.createElement('div');
                    row.className = 'sr-rating-row';
                    row.innerHTML = `
                        <button class="sr-rating-btn sr-easy" onclick="rateSR(${id}, 'easy', this)">✓ Easy</button>
                        <button class="sr-rating-btn sr-hard" onclick="rateSR(${id}, 'hard', this)">✗ Hard</button>`;
                    container.after(row);
                    requestAnimationFrame(() => row.classList.add('visible'));
                }
            }
        }
    });

    // ===== SPACED REPETITION SYSTEM =====
    function getSRData() {
        try { return JSON.parse(localStorage.getItem('crown_sr') || '{}'); } catch(e) { return {}; }
    }
    function saveSRData(data) {
        localStorage.setItem('crown_sr', JSON.stringify(data));
    }

    window.rateSR = function(duaId, rating, btn) {
        const sr = getSRData();
        const entry = sr[duaId] || { interval: 1, easeFactor: 2.0, nextReview: 0 };

        if (rating === 'easy') {
            entry.interval = Math.min(entry.interval * entry.easeFactor, 365);
            entry.easeFactor = Math.min(entry.easeFactor + 0.1, 3.0);
        } else {
            entry.interval = 1;
            entry.easeFactor = Math.max(entry.easeFactor - 0.2, 1.3);
        }
        entry.nextReview = Date.now() + (entry.interval * 86400000);
        sr[duaId] = entry;
        saveSRData(sr);

        // Remove rating row
        const row = btn.closest('.sr-rating-row');
        if (row) {
            row.classList.remove('visible');
            setTimeout(() => row.remove(), 300);
        }

        const days = Math.round(entry.interval);
        showToast(rating === 'easy' ? `Next review in ${days} day${days > 1 ? 's' : ''}` : 'Will review again tomorrow');
        updateSRBadges();
    };

    function getDueCount() {
        const sr = getSRData();
        const now = Date.now();
        return Object.values(sr).filter(e => e.nextReview <= now).length;
    }

    function updateSRBadges() {
        const sr = getSRData();
        const now = Date.now();

        // Update memorize button text with due count
        const btn = document.getElementById('memorizeToggle');
        if (btn) {
            const due = getDueCount();
            btn.textContent = due > 0 ? `🧠 Memorize (${due} due)` : '🧠 Memorize';
        }

        // Add/remove review badges on cards
        els.cards.forEach(card => {
            const id = parseInt(card.getAttribute('data-id'));
            const existing = card.querySelector('.sr-review-badge');
            if (existing) existing.remove();

            if (sr[id] && sr[id].nextReview <= now) {
                const titleEl = card.querySelector('.dua-title');
                if (titleEl) {
                    const badge = document.createElement('span');
                    badge.className = 'sr-review-badge';
                    badge.textContent = 'Review Due';
                    titleEl.appendChild(badge);
                }
            }
        });
    }

    // Update SR badges on load
    document.addEventListener('DOMContentLoaded', () => {
        setTimeout(updateSRBadges, 1000);
    });

    // ===== SHARE AS IMAGE =====
    function injectShareImageButtons() {
        document.querySelectorAll('.copy-row').forEach(row => {
            const card = row.closest('.dua-card');
            if (!card) return;
            const id = card.getAttribute('data-id');
            const btn = document.createElement('button');
            btn.className = 'action-btn';
            btn.innerHTML = '🖼 Share Image';
            btn.onclick = function() { shareAsImage(id); };
            row.appendChild(btn);
        });
    }

    window.shareAsImage = async function(id) {
        const card = document.querySelector(`.dua-card[data-id="${id}"]`);
        if (!card) return;

        showToast('Generating image...');

        const title = card.querySelector('.dua-title')?.textContent || '';
        const arabic = card.querySelector('.arabic-text')?.textContent || '';
        const translation = card.querySelector('.translation')?.textContent || '';
        const ref = card.querySelector('.ref-text')?.textContent || '';

        // Build a clean off-screen card for rendering
        const wrap = document.createElement('div');
        wrap.style.cssText = `
            position:fixed; left:-9999px; top:0;
            width:600px; padding:48px 40px;
            background: linear-gradient(145deg, #0c1a13, #142a20);
            border-radius:24px; font-family:serif;
            border: 1px solid rgba(46,196,122,0.2);
        `;
        wrap.innerHTML = `
            <div style="text-align:center;margin-bottom:24px;">
                <div style="font-family:'Noto Naskh Arabic','Amiri',serif;font-size:16px;color:#2ec47a;margin-bottom:4px;">ف</div>
                <div style="font-family:'Cinzel',serif;font-size:11px;letter-spacing:3px;text-transform:uppercase;color:#2ec47a;margin-bottom:6px;">Essential Duas by فلاح</div>
                <div style="font-family:'Cinzel',serif;font-size:13px;letter-spacing:1px;text-transform:uppercase;color:#e0eccc;font-weight:600;">${title.replace(/<[^>]*>/g,'')}</div>
            </div>
            <div style="background:rgba(46,196,122,0.05);border:1px solid rgba(46,196,122,0.12);border-radius:16px;padding:28px 24px;margin-bottom:20px;">
                <div style="font-family:'Noto Naskh Arabic','Amiri',serif;font-size:24px;line-height:2.2;text-align:right;direction:rtl;color:#f5f9f0;word-spacing:4px;">${arabic}</div>
            </div>
            <div style="font-family:'Playfair Display',serif;font-size:15px;color:rgba(224,238,210,0.85);line-height:1.8;font-style:italic;margin-bottom:16px;">${translation}</div>
            <div style="display:flex;justify-content:space-between;align-items:center;padding-top:14px;border-top:1px solid rgba(46,196,122,0.1);">
                <span style="font-family:'Cinzel',serif;font-size:9px;letter-spacing:1px;text-transform:uppercase;color:rgba(160,210,180,0.55);">📖 ${ref}</span>
                <span style="font-family:'Cinzel',serif;font-size:9px;letter-spacing:1px;text-transform:uppercase;color:rgba(160,210,180,0.35);">فلاح · mohhp.github.io/Essential-duas</span>
            </div>
        `;
        document.body.appendChild(wrap);

        try {
            if (typeof html2canvas === 'undefined') {
                showToast('Image library loading, try again...');
                document.body.removeChild(wrap);
                return;
            }
            const canvas = await html2canvas(wrap, {
                backgroundColor: '#0c1a13',
                scale: 2,
                useCORS: true,
                logging: false
            });
            document.body.removeChild(wrap);

            canvas.toBlob(async (blob) => {
                if (!blob) { showToast('Failed to generate'); return; }

                // Try native share first
                if (navigator.canShare && navigator.canShare({ files: [new File([blob], 'dua.png', { type: 'image/png' })] })) {
                    try {
                        await navigator.share({
                            files: [new File([blob], 'dua.png', { type: 'image/png' })],
                            title: title,
                            text: 'From Essential Duas by فلاح'
                        });
                        showToast('Shared!');
                        return;
                    } catch(e) { /* user cancelled or share failed, fall through to download */ }
                }

                // Fallback: download
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url; a.download = `dua-${id}.png`;
                a.click(); URL.revokeObjectURL(url);
                showToast('Image downloaded!');
            }, 'image/png');
        } catch(e) {
            document.body.removeChild(wrap);
            showToast('Failed to generate image');
        }
    };

    // ===== ARABIC WORD POPUP =====
    const ARABIC_DICT = {
        // Helper: keys are diacritic-stripped Arabic. Values: [root, meaning]
        // ===== DIVINE NAMES & ATTRIBUTES =====
        'الله': ['أ ل ه', 'Allah — God'],
        'اللهم': ['أ ل ه', 'O Allah (invocation)'],
        'الرحمن': ['ر ح م', 'The Most Gracious'],
        'الرحيم': ['ر ح م', 'The Most Merciful'],
        'الصمد': ['ص م د', 'The Eternal Refuge'],
        'الاحد': ['و ح د', 'The One, Unique'],
        'احد': ['و ح د', 'one / anyone'],
        'الشافي': ['ش ف ي', 'The Healer'],
        'الحي': ['ح ي ي', 'The Ever-Living'],
        'القيوم': ['ق و م', 'The Sustainer of All'],
        'الحليم': ['ح ل م', 'The Forbearing'],
        'العظيم': ['ع ظ م', 'The Magnificent'],
        'العليم': ['ع ل م', 'The All-Knowing'],
        'العلي': ['ع ل و', 'The Most High'],
        'السميع': ['س م ع', 'The All-Hearing'],
        'الظاهر': ['ظ ه ر', 'The Manifest'],
        'الباطن': ['ب ط ن', 'The Hidden'],
        'الاخر': ['أ خ ر', 'The Last'],
        'الاول': ['أ و ل', 'The First'],
        'الوهاب': ['و ه ب', 'The Bestower'],
        'المنان': ['م ن ن', 'The Gracious Giver'],
        'المقدم': ['ق د م', 'The Expediter'],
        'المؤخر': ['أ خ ر', 'The Delayer'],
        'عفو': ['ع ف و', 'Pardoning; The Pardoner'],
        'حميد': ['ح م د', 'Praiseworthy'],
        'مجيد': ['م ج د', 'Glorious'],
        'قدير': ['ق د ر', 'All-Powerful'],
        'سميع': ['س م ع', 'All-Hearing'],
        'عدل': ['ع د ل', 'Just / Justice'],
        'الكريم': ['ك ر م', 'The Most Generous'],
        'بديع': ['ب د ع', 'Originator'],

        // ===== CORE ISLAMIC VOCABULARY =====
        'بسم': ['س م و', 'in the name of'],
        'الحمد': ['ح م د', 'all praise'],
        'حمدا': ['ح م د', 'praise (n.)'],
        'رب': ['ر ب ب', 'Lord / Sustainer'],
        'ربي': ['ر ب ب', 'my Lord'],
        'ربنا': ['ر ب ب', 'our Lord'],
        'ربه': ['ر ب ب', 'his Lord'],
        'ربك': ['ر ب ب', 'your Lord'],
        'ربا': ['ر ب ب', 'as a Lord'],
        'العالمين': ['ع ل م', 'the worlds / all creation'],
        'مالك': ['م ل ك', 'Master / Owner'],
        'ملك': ['م ل ك', 'King / Sovereign'],
        'الملك': ['م ل ك', 'the Dominion / Kingdom'],
        'يوم': ['ي و م', 'day'],
        'يوما': ['ي و م', 'a day'],
        'الدين': ['د ي ن', 'the religion / the Judgment'],
        'دينا': ['د ي ن', 'as a religion'],
        'ديني': ['د ي ن', 'my religion'],

        // ===== SURAH AL-FATIHA =====
        'اياك': ['إ ي ي', 'You alone'],
        'نعبد': ['ع ب د', 'we worship'],
        'نستعين': ['ع و ن', 'we seek help'],
        'اهدنا': ['ه د ي', 'guide us'],
        'الصراط': ['ص ر ط', 'the path'],
        'صراط': ['ص ر ط', 'path of'],
        'المستقيم': ['ق و م', 'the straight'],
        'الذين': ['—', 'those who'],
        'الذي': ['—', 'the one who / that which'],
        'انعمت': ['ن ع م', 'You have blessed'],
        'عليهم': ['ع ل و', 'upon them'],
        'غير': ['غ ي ر', 'other than / not'],
        'المغضوب': ['غ ض ب', 'those who earned wrath'],
        'الضالين': ['ض ل ل', 'those who went astray'],

        // ===== AYAT AL-KURSI =====
        'الاه': ['أ ل ه', 'god / deity'],
        'الا': ['—', 'except / but'],
        'هو': ['—', 'He'],
        'تاخذه': ['أ خ ذ', 'overtakes Him'],
        'سنه': ['و س ن', 'slumber / drowsiness'],
        'نوم': ['ن و م', 'sleep'],
        'السماوات': ['س م و', 'the heavens'],
        'السماء': ['س م و', 'the sky / heaven'],
        'الارض': ['أ ر ض', 'the earth'],
        'يشفع': ['ش ف ع', 'intercedes'],
        'عنده': ['ع ن د', 'with Him / in His presence'],
        'عندك': ['ع ن د', 'with You'],
        'باذنه': ['أ ذ ن', 'by His permission'],
        'يعلم': ['ع ل م', 'He knows'],
        'ايديهم': ['ي د ي', 'their hands / before them'],
        'خلفهم': ['خ ل ف', 'behind them'],
        'يحيطون': ['ح و ط', 'they encompass'],
        'بشيء': ['ش ي أ', 'anything / something'],
        'شيء': ['ش ي أ', 'a thing'],
        'علمه': ['ع ل م', 'His knowledge'],
        'شاء': ['ش ي أ', 'He willed'],
        'وسع': ['و س ع', 'encompasses / extends over'],
        'كرسيه': ['ك ر س', 'His Throne (Kursi)'],
        'يؤوده': ['أ و د', 'burdens / tires Him'],
        'حفظهما': ['ح ف ظ', 'preserving them both'],

        // ===== SURAHS AL-IKHLAS, AL-FALAQ, AN-NAS =====
        'قل': ['ق و ل', 'say'],
        'يلد': ['و ل د', 'He begets'],
        'يولد': ['و ل د', 'He was begotten'],
        'يكن': ['ك و ن', 'there is / was'],
        'كفوا': ['ك ف أ', 'equivalent / equal'],
        'اعوذ': ['ع و ذ', 'I seek refuge'],
        'برب': ['ر ب ب', 'in the Lord of'],
        'الفلق': ['ف ل ق', 'the daybreak'],
        'شر': ['ش ر ر', 'evil / harm'],
        'خلق': ['خ ل ق', 'He created / creation'],
        'غاسق': ['غ س ق', 'darkness'],
        'وقب': ['و ق ب', 'when it settles'],
        'النفاثات': ['ن ف ث', 'the ones who blow'],
        'العقد': ['ع ق د', 'the knots'],
        'حاسد': ['ح س د', 'an envier'],
        'حسد': ['ح س د', 'envies'],
        'الناس': ['ن و س', 'mankind / the people'],
        'الوسواس': ['و س و س', 'the whisperer'],
        'الخناس': ['خ ن س', 'the retreater (sneaky)'],
        'يوسوس': ['و س و س', 'whispers'],
        'صدور': ['ص د ر', 'chests / hearts'],
        'الجنه': ['ج ن ن', 'the jinn'],

        // ===== COMMON DUA VERBS =====
        'اسالك': ['س أ ل', 'I ask You'],
        'اغفر': ['غ ف ر', 'forgive'],
        'فاغفر': ['غ ف ر', 'so forgive'],
        'يغفر': ['غ ف ر', 'forgives'],
        'تغفر': ['غ ف ر', 'You forgive'],
        'غفرانك': ['غ ف ر', 'Your forgiveness'],
        'ارحمهما': ['ر ح م', 'have mercy on them both'],
        'ارحمنا': ['ر ح م', 'have mercy on us'],
        'رحمه': ['ر ح م', 'mercy / a mercy'],
        'رحمتك': ['ر ح م', 'Your mercy'],
        'برحمتك': ['ر ح م', 'by Your mercy'],
        'ارحم': ['ر ح م', 'most merciful'],
        'الراحمين': ['ر ح م', 'the most merciful ones'],
        'وقنا': ['و ق ي', 'and protect us'],
        'عذاب': ['ع ذ ب', 'punishment / torment'],
        'النار': ['ن و ر', 'the Fire'],
        'جهنم': ['ج ه ن م', 'Hell / Jahannam'],
        'اشف': ['ش ف ي', 'heal'],
        'شافي': ['ش ف ي', 'healer / curer'],
        'شفاء': ['ش ف ي', 'healing / cure'],
        'هب': ['و ه ب', 'grant / bestow'],
        'اشرح': ['ش ر ح', 'expand / open'],
        'يسر': ['ي س ر', 'ease / make easy'],
        'يسره': ['ي س ر', 'make it easy'],
        'بارك': ['ب ر ك', 'bless'],
        'باركت': ['ب ر ك', 'You have blessed'],
        'بركه': ['ب ر ك', 'blessing of'],
        'ثبت': ['ث ب ت', 'make firm / steady'],
        'افتح': ['ف ت ح', 'open'],
        'احلل': ['ح ل ل', 'untie / loosen'],
        'اجعلني': ['ج ع ل', 'make me'],
        'تجعل': ['ج ع ل', 'You make'],
        'جعلته': ['ج ع ل', 'You made it'],
        'اكفني': ['ك ف ي', 'suffice me'],
        'فاعف': ['ع ف و', 'so pardon'],
        'العفو': ['ع ف و', 'pardon / forgiveness'],
        'تحب': ['ح ب ب', 'You love'],
        'اقض': ['ق ض ي', 'settle / decree'],
        'فانصرنا': ['ن ص ر', 'so grant us victory'],
        'صل': ['ص ل و', 'send blessings upon'],
        'صلى': ['ص ل و', 'sent blessings'],
        'صليت': ['ص ل و', 'You sent blessings'],
        'سلم': ['س ل م', 'peace / bestow peace'],

        // ===== COMMON NOUNS =====
        'نفسا': ['ن ف س', 'a soul'],
        'نفسي': ['ن ف س', 'my soul / myself'],
        'انفسنا': ['ن ف س', 'ourselves'],
        'قلبي': ['ق ل ب', 'my heart'],
        'قلب': ['ق ل ب', 'a heart'],
        'قلوبنا': ['ق ل ب', 'our hearts'],
        'القلوب': ['ق ل ب', 'the hearts'],
        'مقلب': ['ق ل ب', 'Turner of'],
        'الابصار': ['ب ص ر', 'the eyes / sight'],
        'علما': ['ع ل م', 'knowledge'],
        'علم': ['ع ل م', 'knowledge'],
        'بعلمك': ['ع ل م', 'by Your knowledge'],
        'علام': ['ع ل م', 'Knower of'],
        'علمته': ['ع ل م', 'You taught someone'],
        'الغيوب': ['غ ي ب', 'the unseen things'],
        'الغيب': ['غ ي ب', 'the unseen'],
        'ذنبي': ['ذ ن ب', 'my sin'],
        'بذنبي': ['ذ ن ب', 'my sin'],
        'ذنوبنا': ['ذ ن ب', 'our sins'],
        'الذنوب': ['ذ ن ب', 'the sins'],
        'صدري': ['ص د ر', 'my chest / heart'],
        'لساني': ['ل س ن', 'my tongue'],
        'عقده': ['ع ق د', 'a knot'],
        'الصلاه': ['ص ل و', 'the prayer'],
        'الصلوه': ['ص ل و', 'the prayer'],
        'الدنيا': ['د ن و', 'this worldly life'],
        'الاخره': ['أ خ ر', 'the Hereafter'],
        'حسنه': ['ح س ن', 'goodness / a good deed'],
        'خيرا': ['خ ي ر', 'good / goodness'],
        'خير': ['خ ي ر', 'best / good'],
        'امري': ['أ م ر', 'my affair'],
        'الامر': ['أ م ر', 'the matter / affair'],
        'عبدك': ['ع ب د', 'Your servant'],
        'عبادك': ['ع ب د', 'Your servants'],
        'ابن': ['ب ن و', 'son of'],
        'امتك': ['أ م و', 'Your female servant'],
        'ناصيتي': ['ن ص ي', 'my forelock'],
        'بناصيته': ['ن ص ي', 'by his forelock'],
        'بيدك': ['ي د ي', 'in Your hand'],
        'الجنه': ['ج ن ن', 'Paradise'],
        'الجلال': ['ج ل ل', 'Majesty'],
        'الاكرام': ['ك ر م', 'Honor / Generosity'],
        'العرش': ['ع ر ش', 'the Throne'],
        'القران': ['ق ر أ', 'the Quran'],
        'ربيع': ['ر ب ع', 'spring / delight'],
        'نور': ['ن و ر', 'light'],
        'بنور': ['ن و ر', 'by the light of'],
        'ملاء': ['م ل أ', 'filling / fullness'],
        'دعاء': ['د ع و', 'supplication'],
        'دعوه': ['د ع و', 'a supplication'],
        'ذريه': ['ذ ر ر', 'offspring / progeny'],
        'ذريتي': ['ذ ر ر', 'my offspring'],
        'طيبه': ['ط ي ب', 'good / pure'],
        'والدي': ['و ل د', 'my parents'],
        'ربياني': ['ر ب و', 'they raised me'],
        'صغيرا': ['ص غ ر', 'when I was small'],

        // ===== COMMON PARTICLES & PREPOSITIONS =====
        'في': ['—', 'in / within'],
        'من': ['—', 'from / of'],
        'عن': ['—', 'from / about'],
        'على': ['—', 'upon / on'],
        'الى': ['—', 'to / toward'],
        'اليك': ['—', 'to You'],
        'اليه': ['—', 'to him / it'],
        'بين': ['—', 'between'],
        'بعد': ['—', 'after'],
        'قبل': ['—', 'before'],
        'عند': ['—', 'at / with'],
        'فوقك': ['—', 'above You'],
        'دونك': ['—', 'besides You'],
        'مع': ['—', 'with'],
        'بما': ['—', 'with what / by what'],
        'لها': ['—', 'for it (f.)'],
        'له': ['—', 'for him / to Him'],
        'لنا': ['—', 'for us'],
        'لي': ['—', 'for me'],
        'لك': ['—', 'for You / to You'],
        'بك': ['—', 'in You / by You'],
        'به': ['—', 'in it / by it'],
        'فيه': ['—', 'in it'],
        'في': ['—', 'in / concerning'],
        'عليها': ['—', 'upon it (f.)'],
        'علينا': ['—', 'upon us'],
        'علي': ['—', 'upon me'],
        'عنا': ['—', 'from us'],
        'عني': ['—', 'from me'],
        'عنه': ['—', 'from him / it'],
        'منه': ['—', 'from him / from it'],
        'بي': ['—', 'in me / with me'],

        // ===== CONJUNCTIONS & NEGATION =====
        'لا': ['—', 'no / not'],
        'لم': ['—', 'did not (past negation)'],
        'ان': ['—', 'that / indeed'],
        'انك': ['—', 'indeed You'],
        'اني': ['—', 'indeed I'],
        'انه': ['—', 'indeed it / he'],
        'بان': ['—', 'because / that'],
        'اذا': ['—', 'when / if'],
        'اذ': ['—', 'when (past)'],
        'كما': ['—', 'just as / as'],
        'او': ['—', 'or'],
        'ثم': ['—', 'then'],
        'ما': ['—', 'what / that which'],
        'من': ['—', 'who / whoever'],

        // ===== PRONOUNS =====
        'انت': ['—', 'You (God)'],
        'انا': ['—', 'I / me'],
        'هذا': ['—', 'this'],
        'كنت': ['ك و ن', 'I was / You were'],
        'كنا': ['ك و ن', 'we were'],

        // ===== MORE DUA VOCABULARY =====
        'الهم': ['ه م م', 'worry / anxiety'],
        'الحزن': ['ح ز ن', 'sadness / grief'],
        'حزني': ['ح ز ن', 'my grief'],
        'همي': ['ه م م', 'my worry'],
        'العجز': ['ع ج ز', 'inability'],
        'الكسل': ['ك س ل', 'laziness'],
        'البخل': ['ب خ ل', 'stinginess'],
        'الجبن': ['ج ب ن', 'cowardice'],
        'الدين': ['د ي ن', 'the debt / religion'],
        'ضلع': ['ض ل ع', 'burden of'],
        'غلبه': ['غ ل ب', 'domination of / being overcome by'],
        'الرجال': ['ر ج ل', 'men / people'],
        'الفقر': ['ف ق ر', 'poverty'],
        'طاعتك': ['ط و ع', 'Your obedience'],
        'المعاصي': ['ع ص ي', 'sins / disobedience'],
        'تقواها': ['و ق ي', 'its piety'],
        'زكها': ['ز ك و', 'purify it'],
        'زكاها': ['ز ك و', 'purified it'],
        'وليها': ['و ل ي', 'its Guardian'],
        'مولاها': ['و ل ي', 'its Protector'],
        'العافيه': ['ع ف و', 'wellbeing / safety'],
        'المعافاه': ['ع ف و', 'lasting wellbeing'],
        'الدائمه': ['د و م', 'the lasting / permanent'],
        'اصبحنا': ['ص ب ح', 'we have entered the morning'],
        'اصبح': ['ص ب ح', 'has entered the morning'],
        'حسبي': ['ح س ب', 'sufficient for me'],
        'توكلت': ['و ك ل', 'I have placed my trust'],
        'اسلمت': ['س ل م', 'I have submitted'],
        'امنت': ['أ م ن', 'I have believed'],
        'انبت': ['ن و ب', 'I have turned in repentance'],
        'خاصمت': ['خ ص م', 'I have disputed'],
        'حاكمت': ['ح ك م', 'I have sought judgment'],
        'رضيت': ['ر ض ي', 'I am pleased / I accept'],
        'بالاسلام': ['س ل م', 'with Islam'],
        'محمد': ['ح م د', 'Muhammad ﷺ'],
        'نبيا': ['ن ب أ', 'as a Prophet'],
        'ال': ['—', 'family of'],
        'ابراهيم': ['—', 'Ibrahim (Abraham)'],
        'الرسول': ['ر س ل', 'the Messenger'],
        'رسله': ['ر س ل', 'His messengers'],
        'المؤمنون': ['أ م ن', 'the believers'],
        'المؤمنين': ['أ م ن', 'the believers'],
        'سمعنا': ['س م ع', 'we hear / we heard'],
        'اطعنا': ['ط و ع', 'we obey / we obeyed'],
        'المصير': ['ص ي ر', 'the destination / return'],
        'يكلف': ['ك ل ف', 'burdens / charges'],
        'وسعها': ['و س ع', 'its capacity'],
        'كسبت': ['ك س ب', 'it earned'],
        'اكتسبت': ['ك س ب', 'it has earned'],
        'تؤاخذنا': ['أ خ ذ', 'hold us accountable'],
        'نسينا': ['ن س ي', 'we forgot'],
        'اخطانا': ['خ ط أ', 'we erred'],
        'تحمل': ['ح م ل', 'place / burden'],
        'اصرا': ['أ ص ر', 'a burden / hardship'],
        'حملته': ['ح م ل', 'You placed it'],
        'قبلنا': ['ق ب ل', 'before us'],
        'طاقه': ['ط و ق', 'power / ability'],

        // ===== ISTIKHARAH DUA =====
        'استخيرك': ['خ ي ر', 'I seek Your guidance'],
        'استقدرك': ['ق د ر', 'I seek Your power'],
        'بقدرتك': ['ق د ر', 'by Your power'],
        'فضلك': ['ف ض ل', 'Your bounty'],
        'تقدر': ['ق د ر', 'You have power'],
        'اقدر': ['ق د ر', 'I do not have power'],
        'تعلم': ['ع ل م', 'You know'],
        'اعلم': ['ع ل م', 'I know'],
        'معاشي': ['ع ي ش', 'my livelihood'],
        'عاقبه': ['ع ق ب', 'consequence / end'],
        'فاقدره': ['ق د ر', 'then decree it'],
        'فاصرفه': ['ص ر ف', 'then turn it away'],
        'اصرفني': ['ص ر ف', 'turn me away'],

        // ===== SAYYID AL-ISTIGHFAR =====
        'خلقتني': ['خ ل ق', 'You created me'],
        'عبدك': ['ع ب د', 'Your servant'],
        'عهدك': ['ع ه د', 'Your covenant'],
        'وعدك': ['و ع د', 'Your promise'],
        'استطعت': ['ط و ع', 'I am able'],
        'صنعت': ['ص ن ع', 'I have done'],
        'ابوء': ['ب و أ', 'I acknowledge'],
        'بنعمتك': ['ن ع م', 'Your favor / blessings'],

        // ===== PROTECTION DUAS =====
        'بكلمات': ['ك ل م', 'by the words of'],
        'التامات': ['ت م م', 'the perfect (words)'],
        'يضر': ['ض ر ر', 'harms'],
        'اسمه': ['س م و', 'His name'],
        'اسم': ['س م و', 'a name'],
        'سميت': ['س م و', 'You named'],
        'فتنه': ['ف ت ن', 'trial / tribulation'],
        'المحيا': ['ح ي ي', 'life'],
        'الممات': ['م و ت', 'death'],
        'المسيح': ['م س ح', 'the Messiah'],
        'الدجال': ['د ج ل', 'the Antichrist (Dajjal)'],
        'القبر': ['ق ب ر', 'the grave'],
        'الخبث': ['خ ب ث', 'male evil (jinn)'],
        'الخبائث': ['خ ب ث', 'female evil (jinn)'],

        // ===== IBRAHIMIC PRAYER =====
        'محمد': ['ح م د', 'Muhammad ﷺ'],
        'ابراهيم': ['—', 'Ibrahim (Abraham) ﷺ'],

        // ===== NATURE & COSMIC =====
        'السبع': ['س ب ع', 'the seven'],
        'التوراه': ['—', 'the Torah'],
        'الانجيل': ['—', 'the Gospel (Injeel)'],
        'الفرقان': ['ف ر ق', 'the Criterion (Quran)'],
        'فالق': ['ف ل ق', 'Splitter / Cleaver of'],
        'الحب': ['ح ب ب', 'the seed'],
        'النوى': ['ن و ي', 'the date-stone'],

        // ===== MISC IMPORTANT WORDS =====
        'سبحانك': ['س ب ح', 'Glory be to You'],
        'سبحان': ['س ب ح', 'Glory be to'],
        'الظالمين': ['ظ ل م', 'the wrongdoers'],
        'ظلمنا': ['ظ ل م', 'we have wronged'],
        'زدني': ['ز ي د', 'increase me'],
        'نافعا': ['ن ف ع', 'beneficial'],
        'ينفع': ['ن ف ع', 'benefits'],
        'يخشع': ['خ ش ع', 'is humbled'],
        'تشبع': ['ش ب ع', 'is satisfied'],
        'يستجاب': ['ج و ب', 'is answered'],
        'رزقا': ['ر ز ق', 'provision'],
        'طيبا': ['ط ي ب', 'good / pure'],
        'عملا': ['ع م ل', 'a deed'],
        'متقبلا': ['ق ب ل', 'accepted'],
        'مقيم': ['ق و م', 'establisher of'],
        'تقبل': ['ق ب ل', 'accept'],
        'صالحا': ['ص ل ح', 'righteous (deed)'],
        'الصالحين': ['ص ل ح', 'the righteous'],
        'ترضاه': ['ر ض ي', 'that pleases You'],
        'ادخلني': ['د خ ل', 'admit me'],
        'اوزعني': ['و ز ع', 'inspire me'],
        'اشكر': ['ش ك ر', 'to be grateful'],
        'نعمتك': ['ن ع م', 'Your blessing'],
        'الضر': ['ض ر ر', 'the affliction / harm'],
        'مسني': ['م س س', 'has afflicted me'],
        'سقما': ['س ق م', 'sickness'],
        'يغادر': ['غ د ر', 'leaves behind'],
        'مذهب': ['ذ ه ب', 'Remover of'],
        'الباس': ['ب أ س', 'the suffering / hardship'],
        'يفقهوا': ['ف ق ه', 'they understand'],
        'قولي': ['ق و ل', 'my speech'],
        'قول': ['ق و ل', 'a saying / word'],
        'عمل': ['ع م ل', 'a deed'],
        'حسنت': ['ح س ن', 'You have made good'],
        'خلقي': ['خ ل ق', 'my creation / form'],
        'فحسن': ['ح س ن', 'so make good'],
        'خلقي': ['خ ل ق', 'my character'],
        'بحلالك': ['ح ل ل', 'with Your lawful'],
        'حرامك': ['ح ر م', 'Your unlawful'],
        'اغنني': ['غ ن ي', 'enrich me / make me free of need'],
        'سواك': ['س و ي', 'other than You'],
        'سهلا': ['س ه ل', 'easy'],
        'سهل': ['س ه ل', 'easy / there is no ease'],
        'شئت': ['ش ي أ', 'You will / wish'],
        'وحده': ['و ح د', 'alone / uniquely'],
        'شريك': ['ش ر ك', 'partner'],
        'كل': ['ك ل ل', 'every / all'],
        'كله': ['ك ل ل', 'all of it'],
        'دقه': ['د ق ق', 'its minor'],
        'جله': ['ج ل ل', 'its major'],
        'اوله': ['أ و ل', 'its first'],
        'اخره': ['أ خ ر', 'its last'],
        'علانيته': ['ع ل ن', 'its open / public'],
        'سره': ['س ر ر', 'its secret'],
        'قدمت': ['ق د م', 'I have put forward'],
        'اخرت': ['أ خ ر', 'I delayed'],
        'اسررت': ['س ر ر', 'I concealed'],
        'اعلنت': ['ع ل ن', 'I declared'],
        'اشهد': ['ش ه د', 'I testify / bear witness'],
        'كتابك': ['ك ت ب', 'Your Book'],
        'كتبه': ['ك ت ب', 'His books'],
        'ملائكته': ['م ل ك', 'His angels'],
        'نفرق': ['ف ر ق', 'we differentiate'],
        'توفاها': ['و ف ي', 'You take its soul'],
        'احييتها': ['ح ي ي', 'You give it life'],
        'فاحفظها': ['ح ف ظ', 'then protect it'],
        'امتها': ['م و ت', 'You cause it to die'],
        'مماتها': ['م و ت', 'its death'],
        'محياها': ['ح ي ي', 'its life'],
        'خلقك': ['خ ل ق', 'Your creation'],
        'باقيتني': ['ب ق ي', 'You keep me alive'],
        'ابقيتني': ['ب ق ي', 'You keep me alive'],
        'حكمك': ['ح ك م', 'Your decree'],
        'قضاؤك': ['ق ض ي', 'Your judgment'],
        'ماض': ['م ض ي', 'executed / enacted'],
        'استاثرت': ['أ ث ر', 'You kept exclusively'],
        'انزلته': ['ن ز ل', 'You revealed it'],
        'انزل': ['ن ز ل', 'was revealed'],
        'جلاء': ['ج ل و', 'removal / departure of'],
        'ذهاب': ['ذ ه ب', 'going away of'],
        'مولانا': ['و ل ي', 'our Protector'],
        'اقدامنا': ['ق د م', 'our feet'],
        'الكافرين': ['ك ف ر', 'the disbelievers'],
        'القوم': ['ق و م', 'the people'],
        'المستضعفين': ['ض ع ف', 'the oppressed / weak'],
        'لمنقلبون': ['ق ل ب', 'surely returning'],
        'تكلني': ['و ك ل', 'leave me to'],
        'طرفه': ['ط ر ف', 'blink of'],
        'عين': ['ع ي ن', 'an eye'],
        'شاني': ['ش أ ن', 'my affairs / condition'],
        'اصلح': ['ص ل ح', 'rectify / set right'],
        'يعنيني': ['ع ن ي', 'concerns me'],
        'حسن': ['ح س ن', 'excellence / beauty of'],
        'سخطك': ['س خ ط', 'Your displeasure'],
        'غضبك': ['غ ض ب', 'Your anger'],
        'عافيتك': ['ع ف و', 'Your protection'],
        'عقوبتك': ['ع ق ب', 'Your punishment'],
        'العتبى': ['ع ت ب', 'appeasement / making amends'],
        'احصي': ['ح ص ي', 'enumerate / count'],
        'ثناء': ['ث ن ي', 'praise'],
        'اثني': ['ث ن ي', 'I praise'],

        // ===== Connector words appearing frequently =====
        'وهو': ['—', 'and He is'],
        'فانه': ['—', 'for indeed it'],
        'فانك': ['—', 'for indeed You'],
    };

    // Strip Arabic diacritics for dictionary lookup
    function stripDiacritics(text) {
        return text.replace(/[\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06ED\uFE70-\uFE7F]/g, '')
                   .replace(/\u0671/g, '\u0627') // alef wasla → alef
                   .replace(/ٰ/g, '')            // superscript alef
                   .replace(/ى/g, 'ي')           // alef maqsura → ya
                   .replace(/ة/g, 'ه')           // ta marbuta → ha
                   .replace(/ؤ/g, 'و')           // hamza on waw
                   .replace(/ئ/g, 'ي')           // hamza on ya
                   .replace(/أ|إ|آ/g, 'ا')       // hamza forms → alef
                   .trim();
    }

    function lookupWord(rawWord) {
        const cleaned = rawWord.replace(/[۞ۚۖۗ،,\.]/g, '').trim();
        if (!cleaned) return null;
        const stripped = stripDiacritics(cleaned);
        // Try exact match first
        if (ARABIC_DICT[stripped]) {
            return { word: cleaned, root: ARABIC_DICT[stripped][0], meaning: ARABIC_DICT[stripped][1] };
        }
        // Try without leading و (conjunction)
        if (stripped.startsWith('و') && stripped.length > 2) {
            const withoutWaw = stripped.slice(1);
            if (ARABIC_DICT[withoutWaw]) {
                return { word: cleaned, root: ARABIC_DICT[withoutWaw][0], meaning: 'and ' + ARABIC_DICT[withoutWaw][1] };
            }
        }
        // Try without leading ف
        if (stripped.startsWith('ف') && stripped.length > 2) {
            const withoutFa = stripped.slice(1);
            if (ARABIC_DICT[withoutFa]) {
                return { word: cleaned, root: ARABIC_DICT[withoutFa][0], meaning: 'so ' + ARABIC_DICT[withoutFa][1] };
            }
        }
        // Try without leading بال / وال / لل / ال
        for (const prefix of ['بال', 'وال', 'لل', 'ال', 'ب', 'ل', 'ك']) {
            if (stripped.startsWith(prefix) && stripped.length > prefix.length + 1) {
                const base = stripped.slice(prefix.length);
                if (ARABIC_DICT[base]) {
                    let prefixMeaning = prefix === 'ب' ? 'by/with ' : prefix === 'ل' ? 'for/to ' : prefix === 'ك' ? 'like ' : '';
                    return { word: cleaned, root: ARABIC_DICT[base][0], meaning: prefixMeaning + ARABIC_DICT[base][1] };
                }
            }
        }
        return { word: cleaned, root: null, meaning: null };
    }

    // Word popup elements
    let wordPopup = null;
    let activeWordSpan = null;

    function createWordPopup() {
        wordPopup = document.createElement('div');
        wordPopup.className = 'word-popup';
        wordPopup.innerHTML = `
            <div class="word-popup-arrow arrow-bottom"></div>
            <div class="word-popup-arabic"></div>
            <div class="word-popup-divider"></div>
            <div class="word-popup-root-label">ROOT LETTERS</div>
            <div class="word-popup-root"></div>
            <div class="word-popup-divider"></div>
            <div class="word-popup-meaning"></div>
        `;
        document.body.appendChild(wordPopup);
    }

    function showWordPopup(span, data) {
        if (!wordPopup) createWordPopup();
        if (activeWordSpan) activeWordSpan.classList.remove('active-word');
        activeWordSpan = span;
        span.classList.add('active-word');

        const arabicEl = wordPopup.querySelector('.word-popup-arabic');
        const rootEl = wordPopup.querySelector('.word-popup-root');
        const rootLabelEl = wordPopup.querySelector('.word-popup-root-label');
        const meaningEl = wordPopup.querySelector('.word-popup-meaning');
        const arrow = wordPopup.querySelector('.word-popup-arrow');

        arabicEl.textContent = data.word;
        if (data.root && data.root !== '—') {
            rootLabelEl.style.display = '';
            rootEl.style.display = '';
            rootEl.textContent = data.root;
            rootEl.previousElementSibling.style.display = '';
        } else {
            rootLabelEl.style.display = 'none';
            rootEl.style.display = 'none';
            rootEl.previousElementSibling.style.display = 'none';
        }
        if (data.meaning) {
            meaningEl.style.display = '';
            meaningEl.textContent = data.meaning;
            meaningEl.previousElementSibling.style.display = '';
        } else {
            meaningEl.style.display = 'none';
            meaningEl.previousElementSibling.style.display = 'none';
        }

        // Position popup above the word
        wordPopup.classList.remove('visible');
        wordPopup.style.left = '0';
        wordPopup.style.top = '0';
        wordPopup.style.display = 'block';

        requestAnimationFrame(() => {
            const rect = span.getBoundingClientRect();
            const popupRect = wordPopup.getBoundingClientRect();
            const vw = window.innerWidth;
            const vh = window.innerHeight;

            let left = rect.left + rect.width / 2 - popupRect.width / 2;
            left = Math.max(8, Math.min(left, vw - popupRect.width - 8));

            let top = rect.top - popupRect.height - 10;
            let arrowOnTop = false;

            if (top < 8) {
                top = rect.bottom + 10;
                arrowOnTop = true;
            }

            arrow.className = arrowOnTop ? 'word-popup-arrow arrow-top' : 'word-popup-arrow arrow-bottom';

            // Adjust arrow horizontal position to point at word center
            const wordCenter = rect.left + rect.width / 2;
            const arrowLeft = wordCenter - left;
            arrow.style.left = Math.max(16, Math.min(arrowLeft, popupRect.width - 16)) + 'px';

            wordPopup.style.left = left + 'px';
            wordPopup.style.top = top + 'px';
            wordPopup.classList.add('visible');
        });
    }

    function dismissWordPopup() {
        if (wordPopup) wordPopup.classList.remove('visible');
        if (activeWordSpan) {
            activeWordSpan.classList.remove('active-word');
            activeWordSpan = null;
        }
    }

    function wrapArabicWords() {
        document.querySelectorAll('.arabic-text').forEach(el => {
            if (el.dataset.wordsWrapped) return;
            const text = el.textContent;
            // Split on whitespace, preserving decorative symbols as separate tokens
            const tokens = text.split(/(\s+)/);
            el.innerHTML = '';
            tokens.forEach(token => {
                if (/^\s+$/.test(token)) {
                    el.appendChild(document.createTextNode(token));
                    return;
                }
                // Skip if it's only decorative symbols
                const cleaned = token.replace(/[۞ۚۖۗ]/g, '').trim();
                if (!cleaned) {
                    el.appendChild(document.createTextNode(token));
                    return;
                }
                const span = document.createElement('span');
                span.className = 'arabic-word';
                span.textContent = token;
                span.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const data = lookupWord(this.textContent);
                    if (data) showWordPopup(this, data);
                });
                el.appendChild(span);
            });
            el.dataset.wordsWrapped = '1';
        });
    }

    // Dismiss on tap outside or scroll
    document.addEventListener('click', function(e) {
        if (wordPopup && !wordPopup.contains(e.target) && !e.target.classList.contains('arabic-word')) {
            dismissWordPopup();
        }
    });
    window.addEventListener('scroll', dismissWordPopup, { passive: true });

    // ===== PRAYER TIMES & QIBLA =====
    const PRAYER_NAMES = ['fajr', 'sunrise', 'dhuhr', 'asr', 'maghrib', 'isha'];
    const PRAYER_LABELS = { fajr: 'Fajr', sunrise: 'Sunrise', dhuhr: 'Dhuhr', asr: 'Asr', maghrib: 'Maghrib', isha: 'Isha' };
    const PRAYER_ICONS = { fajr: '🌅', sunrise: '☀️', dhuhr: '🕛', asr: '🌤', maghrib: '🌇', isha: '🌙' };
    const KAABA_LAT = 21.4225;
    const KAABA_LNG = 39.8262;

    let prayerTimesData = null;
    let countdownInterval = null;
    let compassWatchId = null;
    let userQibla = null;

    window.openPrayer = function() {
        const pp = document.querySelector('.prayer-panel');
        if (pp) pp.classList.add('active');
        lockScroll();
        setBottomNavActive('prayer');
        // Auto-detect location if not cached
        const cached = localStorage.getItem('crown_location');
        if (cached) {
            const loc = JSON.parse(cached);
            onLocationReady(loc.lat, loc.lng, loc.city || '');
        } else {
            requestLocation();
        }
    };

    window.closePrayer = function() {
        const pp = document.querySelector('.prayer-panel');
        if (pp) pp.classList.remove('active');
        unlockScroll();
        setBottomNavActive('home');
        if (countdownInterval) { clearInterval(countdownInterval); countdownInterval = null; }
    };

    window.requestLocation = function() {
        const locText = document.getElementById('prayerLocText');
        if (locText) locText.textContent = 'Detecting location...';

        if (!navigator.geolocation) {
            if (locText) locText.textContent = 'Geolocation not supported';
            return;
        }

        navigator.geolocation.getCurrentPosition(
            async (pos) => {
                const lat = pos.coords.latitude;
                const lng = pos.coords.longitude;
                let city = '';
                // Reverse geocode for city name
                try {
                    const resp = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json&zoom=10`);
                    const data = await resp.json();
                    city = data.address?.city || data.address?.town || data.address?.village || data.address?.state || '';
                } catch(e) { /* offline — no city name */ }

                localStorage.setItem('crown_location', JSON.stringify({ lat, lng, city }));
                onLocationReady(lat, lng, city);
            },
            (err) => {
                if (locText) locText.textContent = 'Location denied — tap ↻ to retry';
            },
            { enableHighAccuracy: false, timeout: 10000, maximumAge: 600000 }
        );
    };

    function onLocationReady(lat, lng, city) {
        const locText = document.getElementById('prayerLocText');
        if (locText) locText.textContent = city || `${lat.toFixed(2)}°, ${lng.toFixed(2)}°`;

        calculateAndRenderPrayers(lat, lng);
        calculateQibla(lat, lng);
        initCompass();

        // Restore notification toggle
        const toggle = document.getElementById('notifyToggle');
        if (toggle) toggle.checked = localStorage.getItem('crown_notifications') === 'true';
    }

    function calculateAndRenderPrayers(lat, lng) {
        if (typeof adhan === 'undefined') {
            const grid = document.getElementById('prayerTimesGrid');
            if (grid) grid.innerHTML = '<div style="text-align:center;padding:20px;opacity:0.6;">Prayer library loading...</div>';
            setTimeout(() => calculateAndRenderPrayers(lat, lng), 500);
            return;
        }

        const coordinates = new adhan.Coordinates(lat, lng);
        const params = adhan.CalculationMethod.MuslimWorldLeague();
        params.madhab = adhan.Madhab.Hanafi;
        const date = new Date();
        const pt = new adhan.PrayerTimes(coordinates, date, params);

        prayerTimesData = {
            fajr: pt.fajr,
            sunrise: pt.sunrise,
            dhuhr: pt.dhuhr,
            asr: pt.asr,
            maghrib: pt.maghrib,
            isha: pt.isha
        };

        renderPrayerGrid();
        startCountdown();
    }

    function renderPrayerGrid() {
        const grid = document.getElementById('prayerTimesGrid');
        if (!grid || !prayerTimesData) return;

        const now = new Date();
        const current = getCurrentPrayer(now);
        const next = getNextPrayer(now);

        grid.innerHTML = PRAYER_NAMES.map(name => {
            const time = prayerTimesData[name];
            const timeStr = formatTime(time);
            const isCurrent = current === name;
            const isNext = next === name;
            const cls = isCurrent ? ' current-prayer' : isNext ? ' next-prayer' : '';
            return `<div class="prayer-time-row${cls}">
                <span class="prayer-time-icon">${PRAYER_ICONS[name]}</span>
                <span class="prayer-time-name">${PRAYER_LABELS[name]}</span>
                <span class="prayer-time-value">${timeStr}</span>
                ${isCurrent ? '<span class="prayer-now-badge">NOW</span>' : ''}
                ${isNext ? '<span class="prayer-next-badge">NEXT</span>' : ''}
            </div>`;
        }).join('');
    }

    function getCurrentPrayer(now) {
        if (!prayerTimesData) return null;
        // Work backwards: if now >= isha, current is isha; if now >= maghrib, current is maghrib; etc.
        for (let i = PRAYER_NAMES.length - 1; i >= 0; i--) {
            if (now >= prayerTimesData[PRAYER_NAMES[i]]) return PRAYER_NAMES[i];
        }
        return null; // Before fajr
    }

    function getNextPrayer(now) {
        if (!prayerTimesData) return null;
        for (let i = 0; i < PRAYER_NAMES.length; i++) {
            if (now < prayerTimesData[PRAYER_NAMES[i]]) return PRAYER_NAMES[i];
        }
        return 'fajr'; // After isha — next is fajr tomorrow
    }

    function startCountdown() {
        if (countdownInterval) clearInterval(countdownInterval);
        updateCountdown();
        countdownInterval = setInterval(updateCountdown, 1000);
    }

    function updateCountdown() {
        if (!prayerTimesData) return;
        const now = new Date();
        const next = getNextPrayer(now);
        const nameEl = document.getElementById('nextPrayerName');
        const timeEl = document.getElementById('nextPrayerCountdown');
        if (!nameEl || !timeEl) return;

        nameEl.textContent = PRAYER_LABELS[next] || '--';

        let target = prayerTimesData[next];
        if (!target || now >= target) {
            // Next is tomorrow's fajr
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const cached = localStorage.getItem('crown_location');
            if (cached && typeof adhan !== 'undefined') {
                const loc = JSON.parse(cached);
                const coords = new adhan.Coordinates(loc.lat, loc.lng);
                const params = adhan.CalculationMethod.MuslimWorldLeague();
                params.madhab = adhan.Madhab.Hanafi;
                const tpt = new adhan.PrayerTimes(coords, tomorrow, params);
                target = tpt.fajr;
            } else {
                timeEl.textContent = '--:--:--';
                return;
            }
        }

        const diff = target - now;
        if (diff <= 0) {
            // Just passed — re-render grid and recalculate
            const cached = localStorage.getItem('crown_location');
            if (cached) {
                const loc = JSON.parse(cached);
                calculateAndRenderPrayers(loc.lat, loc.lng);
            }
            return;
        }

        const h = Math.floor(diff / 3600000);
        const m = Math.floor((diff % 3600000) / 60000);
        const s = Math.floor((diff % 60000) / 1000);
        timeEl.textContent = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;

        // Also re-render grid to update current/next highlighting
        renderPrayerGrid();
    }

    function formatTime(date) {
        if (!date) return '--:--';
        let h = date.getHours();
        const m = String(date.getMinutes()).padStart(2, '0');
        const ampm = h >= 12 ? 'PM' : 'AM';
        h = h % 12 || 12;
        return `${h}:${m} ${ampm}`;
    }

    // --- Enhanced getTimePeriod using real prayer times ---
    const _originalGetTimePeriod = typeof getTimePeriod === 'function' ? getTimePeriod : null;
    function getTimePeriodFromPrayers() {
        if (!prayerTimesData) return null;
        const now = new Date();
        if (now < prayerTimesData.fajr) return 'latenight';
        if (now < prayerTimesData.sunrise) return 'fajr';
        if (now < prayerTimesData.dhuhr) return 'morning';
        if (now < prayerTimesData.asr) return 'dhuhr';
        if (now < prayerTimesData.maghrib) return 'asr';
        if (now < prayerTimesData.isha) return 'maghrib';
        const cutoff = new Date(prayerTimesData.isha);
        cutoff.setHours(cutoff.getHours() + 2);
        if (now < cutoff) return 'isha';
        return 'latenight';
    }

    // ===== QIBLA COMPASS =====
    function calculateQibla(lat, lng) {
        const latR = lat * Math.PI / 180;
        const lngR = lng * Math.PI / 180;
        const kLatR = KAABA_LAT * Math.PI / 180;
        const kLngR = KAABA_LNG * Math.PI / 180;
        const dLng = kLngR - lngR;

        const x = Math.sin(dLng);
        const y = Math.cos(latR) * Math.tan(kLatR) - Math.sin(latR) * Math.cos(dLng);
        let qibla = Math.atan2(x, y) * 180 / Math.PI;
        if (qibla < 0) qibla += 360;

        userQibla = qibla;

        const degEl = document.getElementById('qiblaDegree');
        const statusEl = document.getElementById('qiblaStatus');
        if (degEl) degEl.textContent = `${Math.round(qibla)}° from North`;
        if (statusEl) statusEl.textContent = 'Point your phone — arrow shows Qibla';

        // Static fallback: rotate arrow to qibla bearing
        const arrow = document.getElementById('qiblaArrow');
        if (arrow) arrow.style.transform = `translate(-50%, -100%) rotate(${qibla}deg)`;
    }

    function initCompass() {
        if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
            // iOS 13+ — needs explicit permission
            const statusEl = document.getElementById('qiblaStatus');
            if (statusEl && !sessionStorage.getItem('compass_requested')) {
                statusEl.innerHTML = '<button class="loc-refresh" onclick="requestCompassPermission()" style="font-size:0.85rem;padding:8px 16px;">Enable Compass</button>';
            }
        } else if ('ondeviceorientationabsolute' in window) {
            window.addEventListener('deviceorientationabsolute', handleCompass, true);
        } else if ('ondeviceorientation' in window) {
            window.addEventListener('deviceorientation', handleCompass, true);
        }
    }

    window.requestCompassPermission = function() {
        sessionStorage.setItem('compass_requested', 'true');
        DeviceOrientationEvent.requestPermission().then(state => {
            if (state === 'granted') {
                window.addEventListener('deviceorientation', handleCompass, true);
                const statusEl = document.getElementById('qiblaStatus');
                if (statusEl) statusEl.textContent = 'Compass active — point your phone';
            }
        }).catch(() => {});
    };

    function handleCompass(e) {
        let heading = e.webkitCompassHeading || (e.alpha != null ? (360 - e.alpha) : null);
        if (heading == null || userQibla == null) return;

        const arrow = document.getElementById('qiblaArrow');
        const compass = document.getElementById('qiblaCompass');
        if (arrow) {
            const rotation = userQibla - heading;
            arrow.style.transform = `translate(-50%, -100%) rotate(${rotation}deg)`;
        }
        if (compass) {
            compass.style.transform = `rotate(${-heading}deg)`;
        }
    }

    // ===== PRAYER NOTIFICATIONS =====
    let notificationTimeouts = [];

    window.togglePrayerNotifications = function(enabled) {
        localStorage.setItem('crown_notifications', enabled ? 'true' : 'false');
        if (enabled) {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission().then(perm => {
                    if (perm !== 'granted') {
                        const toggle = document.getElementById('notifyToggle');
                        if (toggle) toggle.checked = false;
                        localStorage.setItem('crown_notifications', 'false');
                        showToast('Notification permission denied');
                    } else {
                        schedulePrayerNotifications();
                    }
                });
            } else if ('Notification' in window && Notification.permission === 'granted') {
                schedulePrayerNotifications();
                showToast('Prayer alerts enabled');
            } else {
                const toggle = document.getElementById('notifyToggle');
                if (toggle) toggle.checked = false;
                localStorage.setItem('crown_notifications', 'false');
                showToast('Notifications not supported');
            }
        } else {
            clearPrayerNotifications();
            showToast('Prayer alerts disabled');
        }
    };

    function schedulePrayerNotifications() {
        clearPrayerNotifications();
        if (!prayerTimesData) return;
        const now = new Date();

        PRAYER_NAMES.forEach(name => {
            if (name === 'sunrise') return; // Don't notify for sunrise
            const time = prayerTimesData[name];
            if (!time || time <= now) return;
            const delay = time - now;
            if (delay > 0 && delay < 86400000) { // Within 24 hours
                const tid = setTimeout(() => {
                    if ('Notification' in window && Notification.permission === 'granted') {
                        new Notification(`${PRAYER_ICONS[name]} ${PRAYER_LABELS[name]} Time`, {
                            body: `It's time for ${PRAYER_LABELS[name]} prayer`,
                            icon: 'icon-192.png',
                            tag: `prayer-${name}`,
                            renotify: true
                        });
                    }
                }, delay);
                notificationTimeouts.push(tid);
            }
        });
    }

    function clearPrayerNotifications() {
        notificationTimeouts.forEach(tid => clearTimeout(tid));
        notificationTimeouts = [];
    }

    // Re-schedule notifications on visibility change
    document.addEventListener('visibilitychange', () => {
        if (!document.hidden && localStorage.getItem('crown_notifications') === 'true' && prayerTimesData) {
            schedulePrayerNotifications();
        }
    });

    // Auto-calculate prayer times on load if location is cached (for time banner enhancement)
    document.addEventListener('DOMContentLoaded', function() {
        const cached = localStorage.getItem('crown_location');
        if (cached && typeof adhan !== 'undefined') {
            const loc = JSON.parse(cached);
            const coordinates = new adhan.Coordinates(loc.lat, loc.lng);
            const params = adhan.CalculationMethod.MuslimWorldLeague();
            params.madhab = adhan.Madhab.Hanafi;
            const pt = new adhan.PrayerTimes(coordinates, new Date(), params);
            prayerTimesData = {
                fajr: pt.fajr, sunrise: pt.sunrise, dhuhr: pt.dhuhr,
                asr: pt.asr, maghrib: pt.maghrib, isha: pt.isha
            };
            // Schedule notifications if enabled
            if (localStorage.getItem('crown_notifications') === 'true') {
                schedulePrayerNotifications();
            }
        }
    });

    // ===== REGISTER SERVICE WORKER =====
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js').catch(() => {});
    }

    // ===== START =====
    document.addEventListener('DOMContentLoaded', init);
</script>

<!-- ===== OVERLAY ===== -->
<div class="overlay" onclick="toggleBookmarksPanel()"></div>

<!-- ===== TASBEEH PANEL ===== -->
<div class="tasbeeh-panel" onclick="if(event.target === this) closeTasbeeh()">
    <button class="tasbeeh-close" onclick="closeTasbeeh()">✕</button>
    <div class="tasbeeh-title">DIGITAL TASBEEH</div>
    <div class="dhikr-selector" id="dhikrSelector"></div>
    <div class="tasbeeh-arabic" id="tasbeehArabic">سُبْحَانَ ٱللَّهِ</div>
    <div class="tasbeeh-virtue" id="tasbeehVirtue">33× after every salah</div>
    <div class="tasbeeh-count-display" id="tasbeehDisplay">0</div>
    <div class="tasbeeh-target" id="tasbeehTargetLabel">TARGET: 33</div>
    <button class="tasbeeh-tap-btn" onclick="tapTasbeeh()">TAP</button>
    <div class="tasbeeh-controls">
        <button class="tasbeeh-ctrl-btn" onclick="resetTasbeeh()">RESET</button>
    </div>
    <div class="tasbeeh-presets">
        <button class="tasbeeh-preset" onclick="setTasbeehTarget(33)">33</button>
        <button class="tasbeeh-preset" onclick="setTasbeehTarget(100)">100</button>
        <button class="tasbeeh-preset" onclick="setTasbeehTarget(0)">∞</button>
    </div>
    <div class="tasbeeh-lifetime" id="tasbeehLifetime">TOTAL: <span>0</span></div>
</div>

<!-- ===== ETIQUETTE PANEL ===== -->
<div class="etiquette-panel" onclick="if(event.target === this) closeEtiquette()">
    <button class="etiquette-close" onclick="closeEtiquette()">✕</button>
    <div class="etiquette-content"></div>
</div>

<!-- ===== ROUTINE PANEL ===== -->
<div class="routine-panel" onclick="if(event.target === this) closeRoutine()">
    <button class="etiquette-close" onclick="closeRoutine()">✕</button>
    <div class="routine-content"></div>
</div>

<!-- ===== PRAYER PANEL ===== -->
<div class="prayer-panel" onclick="if(event.target === this) closePrayer()">
    <button class="etiquette-close" onclick="closePrayer()">✕</button>
    <div class="prayer-panel-content" id="prayerPanelContent">
        <h2>Prayer Times</h2>
        <div class="prayer-location-bar" id="prayerLocationBar">
            <span class="loc-icon">📍</span>
            <span class="loc-text" id="prayerLocText">Tap to detect location</span>
            <button class="loc-refresh" onclick="requestLocation()" title="Refresh location">↻</button>
        </div>
        <div class="prayer-countdown-card" id="prayerCountdown">
            <div class="prayer-countdown-label">Next Prayer</div>
            <div class="prayer-countdown-name" id="nextPrayerName">--</div>
            <div class="prayer-countdown-time" id="nextPrayerCountdown">--:--:--</div>
        </div>
        <div class="prayer-times-grid" id="prayerTimesGrid"></div>
        <div class="qibla-section" id="qiblaSection">
            <div class="qibla-title">Qibla Direction</div>
            <div class="qibla-compass" id="qiblaCompass">
                <span class="compass-n">N</span>
                <span class="compass-s">S</span>
                <span class="compass-e">E</span>
                <span class="compass-w">W</span>
                <div class="qibla-arrow" id="qiblaArrow"></div>
            </div>
            <div class="qibla-degree" id="qiblaDegree">--°</div>
            <div class="qibla-status" id="qiblaStatus">Enable location to see Qibla</div>
        </div>
        <div class="prayer-notify-row">
            <span class="prayer-notify-label">🔔 Prayer Alerts</span>
            <label class="toggle-switch">
                <input type="checkbox" id="notifyToggle" onchange="togglePrayerNotifications(this.checked)">
                <span class="toggle-slider"></span>
            </label>
        </div>
    </div>
</div>

<!-- ===== TOAST ===== -->
<div class="toast" id="toast"></div>

<!-- ===== FOOTER ===== -->
<footer class="footer">
    <div class="footer-ornament">
        <span class="line"></span>
        <span>✦</span>
        <span class="line"></span>
    </div>
    <div class="footer-text">
        The Crown Collection<br>
        55 Essential Duas from Quran & Sunnah
    </div>
    <div class="footer-brand-row">
        <div class="footer-logo-mini">
            <div class="footer-crescent"></div>
            <span class="footer-fa-mini">ف</span>
        </div>
        <span class="footer-credit-text">Engineer Mohammad Falah · المهندس محمد فلاح</span>
    </div>
    <div class="footer-copyright">© 2025 فلاح · All rights reserved</div>
    <div class="footer-arabic">سُبْحَانَكَ اللَّهُمَّ وَبِحَمْدِكَ أَشْهَدُ أَنْ لَا إِلَٰهَ إِلَّا أَنْتَ أَسْتَغْفِرُكَ وَأَتُوبُ إِلَيْكَ</div>
</footer>

<!-- ===== BACK TO TOP ===== -->
<button class="back-to-top" onclick="scrollToTop()">↑</button>

<!-- ===== BOTTOM NAV (Always last before </body>) ===== -->
<nav class="bottom-nav" id="bottomNav">
    <button class="bottom-nav-item active" data-nav="home" onclick="handleBottomNav('home', this)">
        <span class="icon">🏠</span>
        <span>Home</span>
    </button>
    <button class="bottom-nav-item" data-nav="routine" onclick="handleBottomNav('routine', this)">
        <span class="icon">📅</span>
        <span>Routine</span>
    </button>
    <button class="bottom-nav-item" data-nav="tasbeeh" onclick="handleBottomNav('tasbeeh', this)">
        <span class="icon">📿</span>
        <span>Tasbeeh</span>
    </button>
    <button class="bottom-nav-item" data-nav="saved" onclick="handleBottomNav('saved', this)">
        <span class="icon">★</span>
        <span>Saved</span>
    </button>
    <button class="bottom-nav-item" data-nav="prayer" onclick="handleBottomNav('prayer', this)">
        <span class="icon">🕌</span>
        <span>Prayer</span>
    </button>
</nav>

</body>
</html>
